[2024-07-24T23:27:45.082+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-24T23:27:45.404+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-24T23:27:45.414+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-24T23:27:45.415+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-24T23:27:45.429+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-02 06:00:00+00:00
[2024-07-24T23:27:45.442+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=1417) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-24T23:27:45.444+0000] {standard_task_runner.py:64} INFO - Started process 1434 to run task
[2024-07-24T23:27:45.444+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-02T06:00:00+00:00', '--job-id', '539', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpm2x05wg7']
[2024-07-24T23:27:45.446+0000] {standard_task_runner.py:91} INFO - Job 539: Subtask motower_dcaparc
[2024-07-24T23:27:45.497+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-24T23:27:45.606+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-02T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-02T06:00:00+00:00'
[2024-07-24T23:27:45.607+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-24T23:27:45.624+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-24T23:27:45.635+0000] {motower_daily.py:120} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-24T23:27:45.696+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-24T23:27:45.698+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-24T23:27:45.699+0000] {motower_daily.py:130} INFO - GET CA PARC FILE OF THE DAY 2024-06-01
[2024-07-24T23:27:45.699+0000] {motower_daily.py:134} INFO - READING ca-parc/2024/06/01.csv
[2024-07-24T23:27:45.722+0000] {motower_daily.py:139} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240601  5.327182e+08  8.044059e+08  16715871    9176426  12042566   875452  5841327   297932     1379325  1.395652e+09
[2024-07-24T23:27:45.723+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-24T23:27:45.724+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-24T23:27:45.724+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-24T23:27:45.725+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-24T23:27:45.725+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-24T23:27:45.726+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-24T23:27:45.726+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-24T23:27:45.727+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-24T23:27:45.727+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-24T23:27:45.728+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-24T23:27:45.728+0000] {motower_daily.py:142} INFO - MERGING BDD AND CA
[2024-07-24T23:27:45.732+0000] {motower_daily.py:144} INFO - prepare final daily data
[2024-07-24T23:27:45.733+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-24T23:27:45.736+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-24T23:27:45.737+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-24T23:27:45.738+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-24T23:27:45.738+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-24T23:27:45.739+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:155: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-24T23:27:45.739+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:156: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-24T23:27:45.740+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:157: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-24T23:27:45.740+0000] {logging_mixin.py:188} INFO - 6
[2024-07-24T23:27:45.751+0000] {motower_daily.py:193} INFO - ADD  SEGMENT
[2024-07-24T23:27:45.933+0000] {motower_daily.py:198} INFO - DATA VALIDATION AFTER MERGING
[2024-07-24T23:27:45.933+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-24T23:27:45.934+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-24T23:27:45.941+0000] {motower_daily.py:209} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-01  5.206589e+08  7.907621e+08   14770374.0  8934529.0  3810606.0  121316.0  3061852.0  193275.0    442619.0  1.368038e+09
[2024-07-24T23:27:45.941+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-24T23:27:45.942+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-24T23:27:45.942+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-24T23:27:45.943+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-24T23:27:45.943+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-24T23:27:45.943+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-24T23:27:45.944+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-24T23:27:45.944+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-24T23:27:45.944+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-24T23:27:45.945+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-24T23:27:45.969+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-24T23:27:45.994+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-24T23:27:46.557+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-24T23:27:46.558+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-24T23:27:46.570+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-02T06:00:00+00:00, execution_date=20240602T060000, start_date=20240724T232745, end_date=20240724T232746
[2024-07-24T23:27:46.621+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-24T23:27:46.635+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-25T08:32:31.078+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-25T08:32:31.379+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-25T08:32:31.389+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-25T08:32:31.390+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-25T08:32:31.403+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-02 06:00:00+00:00
[2024-07-25T08:32:31.415+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=1935) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-25T08:32:31.417+0000] {standard_task_runner.py:64} INFO - Started process 1946 to run task
[2024-07-25T08:32:31.420+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-02T06:00:00+00:00', '--job-id', '677', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpy3kwg518']
[2024-07-25T08:32:31.429+0000] {standard_task_runner.py:91} INFO - Job 677: Subtask motower_dcaparc
[2024-07-25T08:32:31.503+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-25T08:32:31.635+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-02T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-02T06:00:00+00:00'
[2024-07-25T08:32:31.636+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-25T08:32:31.657+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-25T08:32:31.669+0000] {motower_daily.py:120} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-25T08:32:31.736+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-25T08:32:31.738+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-25T08:32:31.739+0000] {motower_daily.py:130} INFO - GET CA PARC FILE OF THE DAY 2024-06-01
[2024-07-25T08:32:31.739+0000] {motower_daily.py:134} INFO - READING ca-parc/2024/06/01.csv
[2024-07-25T08:32:31.767+0000] {motower_daily.py:139} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240601  5.327182e+08  8.044059e+08  16715871    9176426  12042566   875452  5841327   297932     1379325  1.395652e+09
[2024-07-25T08:32:31.768+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-25T08:32:31.769+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-25T08:32:31.770+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-25T08:32:31.771+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-25T08:32:31.771+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-25T08:32:31.772+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-25T08:32:31.772+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-25T08:32:31.773+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-25T08:32:31.773+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-25T08:32:31.774+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-25T08:32:31.774+0000] {motower_daily.py:142} INFO - MERGING BDD AND CA
[2024-07-25T08:32:31.778+0000] {motower_daily.py:144} INFO - prepare final daily data
[2024-07-25T08:32:31.780+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-25T08:32:31.783+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-25T08:32:31.784+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-25T08:32:31.785+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-25T08:32:31.786+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-25T08:32:31.786+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:155: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-25T08:32:31.787+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:156: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-25T08:32:31.787+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:157: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-25T08:32:31.787+0000] {logging_mixin.py:188} INFO - 6
[2024-07-25T08:32:31.801+0000] {motower_daily.py:193} INFO - ADD  SEGMENT
[2024-07-25T08:32:31.997+0000] {motower_daily.py:198} INFO - DATA VALIDATION AFTER MERGING
[2024-07-25T08:32:31.997+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-25T08:32:31.998+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-25T08:32:32.005+0000] {motower_daily.py:209} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-01  5.206589e+08  7.907621e+08   14770374.0  8934529.0  3810606.0  121316.0  3061852.0  193275.0    442619.0  1.368038e+09
[2024-07-25T08:32:32.005+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-25T08:32:32.006+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-25T08:32:32.006+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-25T08:32:32.006+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-25T08:32:32.007+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-25T08:32:32.007+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-25T08:32:32.007+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-25T08:32:32.008+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-25T08:32:32.008+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-25T08:32:32.008+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-25T08:32:32.034+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-25T08:32:32.058+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-25T08:32:32.414+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-25T08:32:32.415+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-25T08:32:32.423+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-02T06:00:00+00:00, execution_date=20240602T060000, start_date=20240725T083231, end_date=20240725T083232
[2024-07-25T08:32:32.476+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-25T08:32:32.491+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-25T08:32:32.493+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-25T10:36:08.430+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-25T10:36:08.766+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-25T10:36:08.782+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-25T10:36:08.782+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-25T10:36:08.807+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-02 06:00:00+00:00
[2024-07-25T10:36:08.821+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=4990) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-25T10:36:08.823+0000] {standard_task_runner.py:64} INFO - Started process 5008 to run task
[2024-07-25T10:36:08.823+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-02T06:00:00+00:00', '--job-id', '1166', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmptydm7r2t']
[2024-07-25T10:36:08.826+0000] {standard_task_runner.py:91} INFO - Job 1166: Subtask motower_dcaparc
[2024-07-25T10:36:08.924+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-25T10:36:09.145+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-02T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-02T06:00:00+00:00'
[2024-07-25T10:36:09.146+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-25T10:36:09.166+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-25T10:36:09.180+0000] {motower_daily.py:120} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-25T10:36:09.249+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-25T10:36:09.251+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-25T10:36:09.251+0000] {motower_daily.py:130} INFO - GET CA PARC FILE OF THE DAY 2024-06-01
[2024-07-25T10:36:09.251+0000] {motower_daily.py:134} INFO - READING ca-parc/2024/06/01.csv
[2024-07-25T10:36:09.277+0000] {motower_daily.py:139} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240601  5.327182e+08  8.044059e+08  16715871    9176426  12042566   875452  5841327   297932     1379325  1.395652e+09
[2024-07-25T10:36:09.278+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-25T10:36:09.279+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-25T10:36:09.279+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-25T10:36:09.280+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-25T10:36:09.280+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-25T10:36:09.281+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-25T10:36:09.281+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-25T10:36:09.282+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-25T10:36:09.282+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-25T10:36:09.282+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-25T10:36:09.283+0000] {motower_daily.py:142} INFO - MERGING BDD AND CA
[2024-07-25T10:36:09.286+0000] {motower_daily.py:144} INFO - prepare final daily data
[2024-07-25T10:36:09.288+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-25T10:36:09.290+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-25T10:36:09.292+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-25T10:36:09.293+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-25T10:36:09.294+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-25T10:36:09.294+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:155: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-25T10:36:09.294+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:156: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-25T10:36:09.295+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:157: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-25T10:36:09.295+0000] {logging_mixin.py:188} INFO - 6
[2024-07-25T10:36:09.306+0000] {motower_daily.py:193} INFO - ADD  SEGMENT
[2024-07-25T10:36:09.573+0000] {motower_daily.py:198} INFO - DATA VALIDATION AFTER MERGING
[2024-07-25T10:36:09.573+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-25T10:36:09.575+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-25T10:36:09.591+0000] {motower_daily.py:209} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-01  5.206589e+08  7.907621e+08   14770374.0  8934529.0  3810606.0  121316.0  3061852.0  193275.0    442619.0  1.368038e+09
[2024-07-25T10:36:09.592+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-25T10:36:09.593+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-25T10:36:09.594+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-25T10:36:09.594+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-25T10:36:09.595+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-25T10:36:09.596+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-25T10:36:09.597+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-25T10:36:09.598+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-25T10:36:09.598+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-25T10:36:09.599+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-25T10:36:09.644+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-25T10:36:09.689+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-25T10:36:10.282+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-25T10:36:10.283+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-25T10:36:10.296+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-02T06:00:00+00:00, execution_date=20240602T060000, start_date=20240725T103608, end_date=20240725T103610
[2024-07-25T10:36:10.358+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-25T10:36:10.383+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-25T10:36:10.384+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-25T11:58:31.487+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-25T11:58:31.927+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-25T11:58:31.945+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-25T11:58:31.946+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-25T11:58:31.975+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-02 06:00:00+00:00
[2024-07-25T11:58:31.994+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=7366) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-25T11:58:31.995+0000] {standard_task_runner.py:64} INFO - Started process 7380 to run task
[2024-07-25T11:58:32.002+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-02T06:00:00+00:00', '--job-id', '1600', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmp5kxcdtxu']
[2024-07-25T11:58:32.014+0000] {standard_task_runner.py:91} INFO - Job 1600: Subtask motower_dcaparc
[2024-07-25T11:58:32.199+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-25T11:58:32.406+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-02T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-02T06:00:00+00:00'
[2024-07-25T11:58:32.407+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-25T11:58:32.431+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-25T11:58:32.461+0000] {motower_daily.py:120} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-25T11:58:32.553+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-25T11:58:32.560+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-25T11:58:32.560+0000] {motower_daily.py:130} INFO - GET CA PARC FILE OF THE DAY 2024-06-01
[2024-07-25T11:58:32.560+0000] {motower_daily.py:134} INFO - READING ca-parc/2024/06/01.csv
[2024-07-25T11:58:32.612+0000] {motower_daily.py:139} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240601  5.327182e+08  8.044059e+08  16715871    9176426  12042566   875452  5841327   297932     1379325  1.395652e+09
[2024-07-25T11:58:32.613+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-25T11:58:32.614+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-25T11:58:32.616+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-25T11:58:32.617+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-25T11:58:32.617+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-25T11:58:32.618+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-25T11:58:32.618+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-25T11:58:32.619+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-25T11:58:32.619+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-25T11:58:32.620+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-25T11:58:32.620+0000] {motower_daily.py:142} INFO - MERGING BDD AND CA
[2024-07-25T11:58:32.626+0000] {motower_daily.py:144} INFO - prepare final daily data
[2024-07-25T11:58:32.629+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-25T11:58:32.632+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-25T11:58:32.634+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-25T11:58:32.635+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-25T11:58:32.636+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-25T11:58:32.637+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:155: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-25T11:58:32.638+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:156: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-25T11:58:32.638+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:157: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-25T11:58:32.638+0000] {logging_mixin.py:188} INFO - 6
[2024-07-25T11:58:32.639+0000] {logging_mixin.py:188} INFO - 2024-06-01 00:00:00
[2024-07-25T11:58:32.655+0000] {motower_daily.py:198} INFO - ADD  SEGMENT
[2024-07-25T11:58:33.037+0000] {motower_daily.py:203} INFO - DATA VALIDATION AFTER MERGING
[2024-07-25T11:58:33.037+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-25T11:58:33.039+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-25T11:58:33.054+0000] {motower_daily.py:214} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-01  5.206589e+08  7.907621e+08   14770374.0  8934529.0  3810606.0  121316.0  3061852.0  193275.0    442619.0  1.368038e+09
[2024-07-25T11:58:33.054+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-25T11:58:33.055+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-25T11:58:33.056+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-25T11:58:33.057+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-25T11:58:33.057+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-25T11:58:33.058+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-25T11:58:33.058+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-25T11:58:33.059+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-25T11:58:33.059+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-25T11:58:33.060+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-25T11:58:33.099+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-25T11:58:33.136+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-25T11:58:33.656+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-25T11:58:33.657+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-25T11:58:33.671+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-02T06:00:00+00:00, execution_date=20240602T060000, start_date=20240725T115831, end_date=20240725T115833
[2024-07-25T11:58:33.742+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-25T11:58:33.769+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-25T11:58:33.775+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-25T12:12:25.833+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-25T12:12:25.868+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-25T12:12:25.881+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-25T12:12:25.882+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-25T12:12:25.900+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-02 06:00:00+00:00
[2024-07-25T12:12:25.917+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=8001) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-25T12:12:25.918+0000] {standard_task_runner.py:64} INFO - Started process 8018 to run task
[2024-07-25T12:12:25.919+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-02T06:00:00+00:00', '--job-id', '1756', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpqll6z45o']
[2024-07-25T12:12:25.922+0000] {standard_task_runner.py:91} INFO - Job 1756: Subtask motower_dcaparc
[2024-07-25T12:12:25.991+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-25T12:12:26.129+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-02T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-02T06:00:00+00:00'
[2024-07-25T12:12:26.130+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-25T12:12:26.150+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-25T12:12:26.169+0000] {motower_daily.py:120} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-25T12:12:26.254+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-25T12:12:26.256+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-25T12:12:26.257+0000] {motower_daily.py:130} INFO - GET CA PARC FILE OF THE DAY 2024-06-01
[2024-07-25T12:12:26.257+0000] {motower_daily.py:134} INFO - READING ca-parc/2024/06/01.csv
[2024-07-25T12:12:26.290+0000] {motower_daily.py:139} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240601  5.327182e+08  8.044059e+08  16715871    9176426  12042566   875452  5841327   297932     1379325  1.395652e+09
[2024-07-25T12:12:26.290+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-25T12:12:26.293+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-25T12:12:26.293+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-25T12:12:26.294+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-25T12:12:26.294+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-25T12:12:26.295+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-25T12:12:26.295+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-25T12:12:26.296+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-25T12:12:26.296+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-25T12:12:26.297+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-25T12:12:26.297+0000] {motower_daily.py:142} INFO - MERGING BDD AND CA
[2024-07-25T12:12:26.302+0000] {motower_daily.py:144} INFO - prepare final daily data
[2024-07-25T12:12:26.304+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-25T12:12:26.307+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-25T12:12:26.308+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-25T12:12:26.309+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-25T12:12:26.310+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-25T12:12:26.310+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:155: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-25T12:12:26.311+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:156: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-25T12:12:26.311+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:157: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-25T12:12:26.312+0000] {logging_mixin.py:188} INFO - 6
[2024-07-25T12:12:26.312+0000] {logging_mixin.py:188} INFO - 2024-06-01 00:00:00
[2024-07-25T12:12:26.325+0000] {motower_daily.py:198} INFO - ADD  SEGMENT
[2024-07-25T12:12:26.589+0000] {motower_daily.py:203} INFO - DATA VALIDATION AFTER MERGING
[2024-07-25T12:12:26.589+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-25T12:12:26.590+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-25T12:12:26.602+0000] {motower_daily.py:214} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-01  5.206589e+08  7.907621e+08   14770374.0  8934529.0  3810606.0  121316.0  3061852.0  193275.0    442619.0  1.368038e+09
[2024-07-25T12:12:26.602+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-25T12:12:26.603+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-25T12:12:26.604+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-25T12:12:26.604+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-25T12:12:26.605+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-25T12:12:26.605+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-25T12:12:26.606+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-25T12:12:26.606+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-25T12:12:26.607+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-25T12:12:26.608+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-25T12:12:26.647+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-25T12:12:26.689+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-25T12:12:27.502+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-25T12:12:27.503+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-25T12:12:27.550+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-02T06:00:00+00:00, execution_date=20240602T060000, start_date=20240725T121225, end_date=20240725T121227
[2024-07-25T12:12:28.044+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-25T12:12:28.070+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-25T12:12:28.083+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-25T12:43:45.394+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-25T12:43:45.424+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-25T12:43:45.433+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-25T12:43:45.434+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-25T12:43:45.447+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-02 06:00:00+00:00
[2024-07-25T12:43:45.458+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=9402) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-25T12:43:45.459+0000] {standard_task_runner.py:64} INFO - Started process 9414 to run task
[2024-07-25T12:43:45.459+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-02T06:00:00+00:00', '--job-id', '2088', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpr710k8ep']
[2024-07-25T12:43:45.461+0000] {standard_task_runner.py:91} INFO - Job 2088: Subtask motower_dcaparc
[2024-07-25T12:43:45.528+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-25T12:43:45.639+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-02T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-02T06:00:00+00:00'
[2024-07-25T12:43:45.640+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-25T12:43:45.662+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-25T12:43:45.673+0000] {motower_daily.py:120} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-25T12:43:45.748+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-25T12:43:45.750+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-25T12:43:45.751+0000] {motower_daily.py:130} INFO - GET CA PARC FILE OF THE DAY 2024-06-01
[2024-07-25T12:43:45.751+0000] {motower_daily.py:134} INFO - READING ca-parc/2024/06/01.csv
[2024-07-25T12:43:45.785+0000] {motower_daily.py:139} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240601  5.327182e+08  8.044059e+08  16715871    9176426  12042566   875452  5841327   297932     1379325  1.395652e+09
[2024-07-25T12:43:45.786+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-25T12:43:45.788+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-25T12:43:45.788+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-25T12:43:45.789+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-25T12:43:45.789+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-25T12:43:45.790+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-25T12:43:45.791+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-25T12:43:45.792+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-25T12:43:45.792+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-25T12:43:45.793+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-25T12:43:45.793+0000] {motower_daily.py:142} INFO - MERGING BDD AND CA
[2024-07-25T12:43:45.798+0000] {motower_daily.py:144} INFO - prepare final daily data
[2024-07-25T12:43:45.800+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-25T12:43:45.803+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-25T12:43:45.804+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-25T12:43:45.805+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-25T12:43:45.806+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-25T12:43:45.806+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:155: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-25T12:43:45.807+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:156: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-25T12:43:45.807+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:157: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-25T12:43:45.807+0000] {logging_mixin.py:188} INFO - 6
[2024-07-25T12:43:45.807+0000] {logging_mixin.py:188} INFO - 2024-06-01 00:00:00
[2024-07-25T12:43:45.818+0000] {motower_daily.py:198} INFO - ADD  SEGMENT
[2024-07-25T12:43:45.971+0000] {motower_daily.py:203} INFO - DATA VALIDATION AFTER MERGING
[2024-07-25T12:43:45.972+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-25T12:43:45.972+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-25T12:43:45.980+0000] {motower_daily.py:214} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-01  5.206589e+08  7.907621e+08   14770374.0  8934529.0  3810606.0  121316.0  3061852.0  193275.0    442619.0  1.368038e+09
[2024-07-25T12:43:45.980+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-25T12:43:45.981+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-25T12:43:45.981+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-25T12:43:45.981+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-25T12:43:45.982+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-25T12:43:45.982+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-25T12:43:45.982+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-25T12:43:45.983+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-25T12:43:45.983+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-25T12:43:45.983+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-25T12:43:46.007+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-25T12:43:46.032+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-25T12:43:46.675+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-25T12:43:46.676+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-25T12:43:46.691+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-02T06:00:00+00:00, execution_date=20240602T060000, start_date=20240725T124345, end_date=20240725T124346
[2024-07-25T12:43:47.127+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-25T12:43:47.148+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-25T12:43:47.152+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-25T15:06:09.292+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-25T15:06:09.332+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-25T15:06:09.344+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-25T15:06:09.344+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-25T15:06:09.358+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-02 06:00:00+00:00
[2024-07-25T15:06:09.372+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=14046) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-25T15:06:09.374+0000] {standard_task_runner.py:64} INFO - Started process 14057 to run task
[2024-07-25T15:06:09.374+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-02T06:00:00+00:00', '--job-id', '3019', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpwmkfqs25']
[2024-07-25T15:06:09.376+0000] {standard_task_runner.py:91} INFO - Job 3019: Subtask motower_dcaparc
[2024-07-25T15:06:09.445+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-25T15:06:09.555+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-02T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-02T06:00:00+00:00'
[2024-07-25T15:06:09.556+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-25T15:06:09.579+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-25T15:06:09.592+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-25T15:06:09.671+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-25T15:06:09.673+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-25T15:06:09.673+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-01
[2024-07-25T15:06:09.674+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/01.csv
[2024-07-25T15:06:09.701+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240601  5.327182e+08  8.044059e+08  16715871    9176426  12042566   875452  5841327   297932     1379325  1.395652e+09
[2024-07-25T15:06:09.702+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-25T15:06:09.703+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-25T15:06:09.704+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-25T15:06:09.704+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-25T15:06:09.705+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-25T15:06:09.705+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-25T15:06:09.706+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-25T15:06:09.706+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-25T15:06:09.707+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-25T15:06:09.707+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-25T15:06:09.708+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-25T15:06:09.712+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-25T15:06:09.714+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-25T15:06:09.717+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-25T15:06:09.718+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-25T15:06:09.719+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-25T15:06:09.719+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-25T15:06:09.720+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-25T15:06:09.720+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-25T15:06:09.721+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-25T15:06:09.721+0000] {logging_mixin.py:188} INFO - 6
[2024-07-25T15:06:09.721+0000] {logging_mixin.py:188} INFO - 2024-06-01 00:00:00
[2024-07-25T15:06:09.737+0000] {motower_daily.py:200} INFO - ADD  SEGMENT
[2024-07-25T15:06:09.938+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-25T15:06:09.938+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-25T15:06:09.939+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-25T15:06:09.947+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-01  5.206589e+08  7.907621e+08   14770374.0  8934529.0  3810606.0  121316.0  3061852.0  193275.0    442619.0  1.368038e+09
[2024-07-25T15:06:09.947+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-25T15:06:09.948+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-25T15:06:09.948+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-25T15:06:09.949+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-25T15:06:09.950+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-25T15:06:09.950+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-25T15:06:09.951+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-25T15:06:09.951+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-25T15:06:09.952+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-25T15:06:09.952+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-25T15:06:09.987+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-25T15:06:10.028+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-25T15:06:10.537+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-25T15:06:10.538+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-25T15:06:10.548+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-02T06:00:00+00:00, execution_date=20240602T060000, start_date=20240725T150609, end_date=20240725T150610
[2024-07-25T15:06:10.594+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-25T15:06:10.622+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-25T15:06:10.623+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-26T11:25:16.247+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-26T11:25:16.513+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-26T11:25:16.523+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-26T11:25:16.524+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-26T11:25:16.537+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-02 06:00:00+00:00
[2024-07-26T11:25:16.548+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=884) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-26T11:25:16.550+0000] {standard_task_runner.py:64} INFO - Started process 895 to run task
[2024-07-26T11:25:16.550+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-02T06:00:00+00:00', '--job-id', '3326', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpf321m3k2']
[2024-07-26T11:25:16.552+0000] {standard_task_runner.py:91} INFO - Job 3326: Subtask motower_dcaparc
[2024-07-26T11:25:16.602+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-26T11:25:16.700+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-02T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-02T06:00:00+00:00'
[2024-07-26T11:25:16.701+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-26T11:25:16.715+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-26T11:25:16.724+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-26T11:25:16.773+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T11:25:16.774+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T11:25:16.775+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-01
[2024-07-26T11:25:16.775+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/01.csv
[2024-07-26T11:25:16.795+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240601  5.327182e+08  8.044059e+08  16715871    9176426  12042566   875452  5841327   297932     1379325  1.395652e+09
[2024-07-26T11:25:16.796+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T11:25:16.797+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T11:25:16.797+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T11:25:16.798+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T11:25:16.798+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T11:25:16.799+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T11:25:16.799+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-26T11:25:16.799+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-26T11:25:16.800+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T11:25:16.800+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T11:25:16.800+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-26T11:25:16.804+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-26T11:25:16.805+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-26T11:25:16.807+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-26T11:25:16.807+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-26T11:25:16.808+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-26T11:25:16.808+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-26T11:25:16.809+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-26T11:25:16.809+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-26T11:25:16.810+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-26T11:25:16.810+0000] {logging_mixin.py:188} INFO - 6
[2024-07-26T11:25:16.810+0000] {logging_mixin.py:188} INFO - 2024-06-01 00:00:00
[2024-07-26T11:25:16.818+0000] {motower_daily.py:200} INFO - ADD  SEGMENT
[2024-07-26T11:25:16.969+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-26T11:25:16.970+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T11:25:16.971+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T11:25:16.978+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-01  5.206589e+08  7.907621e+08   14770374.0  8934529.0  3810606.0  121316.0  3061852.0  193275.0    442619.0  1.368038e+09
[2024-07-26T11:25:16.978+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T11:25:16.979+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T11:25:16.979+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T11:25:16.980+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T11:25:16.980+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T11:25:16.980+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T11:25:16.981+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-26T11:25:16.981+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-26T11:25:16.981+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T11:25:16.982+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T11:25:17.007+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T11:25:17.033+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T11:25:17.039+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-26T11:25:17.040+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 130, in gen_motower_daily
    df_faits = data[["jour","mois","annee","id_site", "ca_voix","ca_data", "ca_total" ,
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/frame.py", line 3899, in __getitem__
    indexer = self.columns._get_indexer_strict(key, "columns")[1]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 6115, in _get_indexer_strict
    self._raise_if_missing(keyarr, indexer, axis_name)
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 6179, in _raise_if_missing
    raise KeyError(f"{not_found} not in index")
KeyError: "['id_site'] not in index"
[2024-07-26T11:25:17.050+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-02T06:00:00+00:00, execution_date=20240602T060000, start_date=20240726T112516, end_date=20240726T112517
[2024-07-26T11:25:17.061+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-07-26T11:25:17.061+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-26T11:25:17.061+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-26T11:25:17.067+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-26T11:25:17.067+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-26T11:25:17.067+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 130, in gen_motower_daily
    df_faits = data[["jour","mois","annee","id_site", "ca_voix","ca_data", "ca_total" ,
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/frame.py", line 3899, in __getitem__
    indexer = self.columns._get_indexer_strict(key, "columns")[1]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 6115, in _get_indexer_strict
    self._raise_if_missing(keyarr, indexer, axis_name)
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 6179, in _raise_if_missing
    raise KeyError(f"{not_found} not in index")
KeyError: "['id_site'] not in index"

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-07-26T11:25:17.070+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-07-26T11:25:17.070+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-26T11:25:17.071+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-26T11:25:17.080+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 3326 for task motower_dcaparc ("['id_site'] not in index"; 895)
[2024-07-26T11:25:17.124+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-07-26T11:25:17.140+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-26T11:25:17.142+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-26T11:30:46.009+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-26T11:30:46.284+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-26T11:30:46.293+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-26T11:30:46.293+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-26T11:30:46.307+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-02 06:00:00+00:00
[2024-07-26T11:30:46.318+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=1364) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-26T11:30:46.320+0000] {standard_task_runner.py:64} INFO - Started process 1377 to run task
[2024-07-26T11:30:46.320+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-02T06:00:00+00:00', '--job-id', '3462', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmp_qiwjuna']
[2024-07-26T11:30:46.322+0000] {standard_task_runner.py:91} INFO - Job 3462: Subtask motower_dcaparc
[2024-07-26T11:30:46.368+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-26T11:30:46.462+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-02T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-02T06:00:00+00:00'
[2024-07-26T11:30:46.463+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-26T11:30:46.482+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-26T11:30:46.492+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-26T11:30:46.543+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T11:30:46.545+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T11:30:46.545+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-01
[2024-07-26T11:30:46.546+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/01.csv
[2024-07-26T11:30:46.574+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240601  5.327182e+08  8.044059e+08  16715871    9176426  12042566   875452  5841327   297932     1379325  1.395652e+09
[2024-07-26T11:30:46.575+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T11:30:46.576+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T11:30:46.576+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T11:30:46.577+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T11:30:46.577+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T11:30:46.578+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T11:30:46.578+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-26T11:30:46.579+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-26T11:30:46.579+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T11:30:46.580+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T11:30:46.580+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-26T11:30:46.585+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-26T11:30:46.587+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-26T11:30:46.589+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-26T11:30:46.590+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-26T11:30:46.591+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-26T11:30:46.591+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-26T11:30:46.592+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-26T11:30:46.592+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-26T11:30:46.593+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-26T11:30:46.593+0000] {logging_mixin.py:188} INFO - 6
[2024-07-26T11:30:46.593+0000] {logging_mixin.py:188} INFO - 2024-06-01 00:00:00
[2024-07-26T11:30:46.606+0000] {motower_daily.py:200} INFO - ADD  SEGMENT
[2024-07-26T11:30:46.866+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-26T11:30:46.866+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T11:30:46.867+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T11:30:46.877+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-01  5.206589e+08  7.907621e+08   14770374.0  8934529.0  3810606.0  121316.0  3061852.0  193275.0    442619.0  1.368038e+09
[2024-07-26T11:30:46.878+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T11:30:46.879+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T11:30:46.879+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T11:30:46.880+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T11:30:46.880+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T11:30:46.881+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T11:30:46.882+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-26T11:30:46.882+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-26T11:30:46.883+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T11:30:46.883+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T11:30:46.912+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T11:30:46.940+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T11:30:46.959+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-26T11:30:46.959+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 135, in gen_motower_daily
    write_pg(PG_SAVE_HOST, PG_SAVE_DB, PG_SAVE_USER, PG_SAVE_PASSWORD, df_dimension, "motower_daily_caparc_dimension")
  File "/opt/airflow/dags/gps/common/rwpg.py", line 44, in write_pg
    columns = CONFIG["output_tables"][table]
              ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
KeyError: 'motower_daily_caparc_dimension'
[2024-07-26T11:30:46.977+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-02T06:00:00+00:00, execution_date=20240602T060000, start_date=20240726T113046, end_date=20240726T113046
[2024-07-26T11:30:46.996+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-07-26T11:30:46.997+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-26T11:30:46.998+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-26T11:30:47.009+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-26T11:30:47.010+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-26T11:30:47.012+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 135, in gen_motower_daily
    write_pg(PG_SAVE_HOST, PG_SAVE_DB, PG_SAVE_USER, PG_SAVE_PASSWORD, df_dimension, "motower_daily_caparc_dimension")
  File "/opt/airflow/dags/gps/common/rwpg.py", line 44, in write_pg
    columns = CONFIG["output_tables"][table]
              ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
KeyError: 'motower_daily_caparc_dimension'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-07-26T11:30:47.017+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-07-26T11:30:47.018+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-26T11:30:47.019+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-26T11:30:47.040+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 3462 for task motower_dcaparc ('motower_daily_caparc_dimension'; 1377)
[2024-07-26T11:30:47.096+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-07-26T11:30:47.119+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-26T11:30:47.121+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-26T11:39:07.494+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-26T11:39:07.857+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-26T11:39:07.870+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-26T11:39:07.871+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-26T11:39:07.889+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-02 06:00:00+00:00
[2024-07-26T11:39:07.904+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=1871) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-26T11:39:07.906+0000] {standard_task_runner.py:64} INFO - Started process 1890 to run task
[2024-07-26T11:39:07.907+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-02T06:00:00+00:00', '--job-id', '3595', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpnk4alcny']
[2024-07-26T11:39:07.910+0000] {standard_task_runner.py:91} INFO - Job 3595: Subtask motower_dcaparc
[2024-07-26T11:39:07.987+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-26T11:39:08.121+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-02T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-02T06:00:00+00:00'
[2024-07-26T11:39:08.122+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-26T11:39:08.152+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-26T11:39:08.171+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-26T11:39:08.257+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T11:39:08.259+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T11:39:08.259+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-01
[2024-07-26T11:39:08.260+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/01.csv
[2024-07-26T11:39:08.291+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240601  5.327182e+08  8.044059e+08  16715871    9176426  12042566   875452  5841327   297932     1379325  1.395652e+09
[2024-07-26T11:39:08.292+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T11:39:08.293+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T11:39:08.294+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T11:39:08.295+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T11:39:08.295+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T11:39:08.296+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T11:39:08.296+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-26T11:39:08.297+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-26T11:39:08.297+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T11:39:08.298+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T11:39:08.299+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-26T11:39:08.304+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-26T11:39:08.307+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-26T11:39:08.310+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-26T11:39:08.311+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-26T11:39:08.312+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-26T11:39:08.313+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-26T11:39:08.313+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-26T11:39:08.314+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-26T11:39:08.315+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-26T11:39:08.315+0000] {logging_mixin.py:188} INFO - 6
[2024-07-26T11:39:08.315+0000] {logging_mixin.py:188} INFO - 2024-06-01 00:00:00
[2024-07-26T11:39:08.328+0000] {motower_daily.py:200} INFO - ADD  SEGMENT
[2024-07-26T11:39:08.585+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-26T11:39:08.585+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T11:39:08.586+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T11:39:08.594+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-01  5.206589e+08  7.907621e+08   14770374.0  8934529.0  3810606.0  121316.0  3061852.0  193275.0    442619.0  1.368038e+09
[2024-07-26T11:39:08.594+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T11:39:08.595+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T11:39:08.595+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T11:39:08.596+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T11:39:08.596+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T11:39:08.596+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T11:39:08.597+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-26T11:39:08.597+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-26T11:39:08.597+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T11:39:08.598+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T11:39:08.626+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T11:39:08.658+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T11:39:09.286+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-26T11:39:09.287+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1890, in _execute_context
    self.dialect.do_executemany(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/psycopg2.py", line 982, in do_executemany
    context._psycopg2_fetched_rows = xtras.execute_values(
                                     ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/psycopg2/extras.py", line 1299, in execute_values
    cur.execute(b''.join(parts))
psycopg2.errors.UndefinedColumn: column "mois" of relation "motower_daily_caparc" does not exist
LINE 1: ...rm, segment, previous_segment, evolution_segment, mois, anne...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 136, in gen_motower_daily
    write_pg(PG_SAVE_HOST, PG_SAVE_DB, PG_SAVE_USER, PG_SAVE_PASSWORD, data, "motower_daily_caparc")
  File "/opt/airflow/dags/gps/common/rwpg.py", line 66, in write_pg
    data.to_sql(table, engine, index=False, if_exists = 'append')
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
           ^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
           ^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1385, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 334, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1577, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1953, in _execute_context
    self._handle_dbapi_exception(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2134, in _handle_dbapi_exception
    util.raise_(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/util/compat.py", line 211, in raise_
    raise exception
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1890, in _execute_context
    self.dialect.do_executemany(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/psycopg2.py", line 982, in do_executemany
    context._psycopg2_fetched_rows = xtras.execute_values(
                                     ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/psycopg2/extras.py", line 1299, in execute_values
    cur.execute(b''.join(parts))
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column "mois" of relation "motower_daily_caparc" does not exist
LINE 1: ...rm, segment, previous_segment, evolution_segment, mois, anne...
                                                             ^

[SQL: INSERT INTO motower_daily_caparc (jour, code_oci, code_oci_id, autre_code, clutter, commune, departement, type_du_site, type_geolocalite, gestionnaire, latitude, longitude, localisation, partenaires, proprietaire, position_site, site, statut, projet, region, ca_data, ca_voix, ca_total, parc_global, parc_data, parc_2g, parc_3g, parc_4g, parc_5g, autre_parc, trafic_data_in, trafic_voix_in, trafic_data_in_mo, ca_mtd, ca_norm, segment, previous_segment, evolution_segment, mois, annee) VALUES (%(jour)s, %(code_oci)s, %(code_oci_id)s, %(autre_code)s, %(clutter)s, %(commune)s, %(departement)s, %(type_du_site)s, %(type_geolocalite)s, %(gestionnaire)s, %(latitude)s, %(longitude)s, %(localisation)s, %(partenaires)s, %(proprietaire)s, %(position_site)s, %(site)s, %(statut)s, %(projet)s, %(region)s, %(ca_data)s, %(ca_voix)s, %(ca_total)s, %(parc_global)s, %(parc_data)s, %(parc_2g)s, %(parc_3g)s, %(parc_4g)s, %(parc_5g)s, %(autre_parc)s, %(trafic_data_in)s, %(trafic_voix_in)s, %(trafic_data_in_mo)s, %(ca_mtd)s, %(ca_norm)s, %(segment)s, %(previous_segment)s, %(evolution_segment)s, %(mois)s, %(annee)s)]
[parameters: ({'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI2831', 'code_oci_id': 2831.0, 'autre_code': 'ABJ419', 'clutter': 'URBAIN', 'commune': 'PORT-BOUET', 'departement': 'ABIDJAN', 'type_du_site': 'MACRO', 'type_geolocalite': 'capitale economique', 'gestionnaire': 'Esco', 'latitude': 5.241082, 'longitude': -3.91019, 'localisation': 'abidjan', 'partenaires': 'LA COQUILLE', 'proprietaire': 'OCI', 'position_site': 'Axe Routier', 'site': 'PHCIE_RTE_BASSAM', 'statut': 'SERVICE', 'projet': None, 'region': "DISTRICT AUTONOME D'ABIDJAN", 'ca_data': 585246.5, 'ca_voix': 319805.2, 'ca_total': 956035.44, 'parc_global': 9514.0, 'parc_data': 6605.0, 'parc_2g': 2113.0, 'parc_3g': 93.0, 'parc_4g': 2550.0, 'parc_5g': 177.0, 'autre_parc': 407.0, 'trafic_data_in': 1104383.2, 'trafic_voix_in': 53278.24, 'trafic_data_in_mo': 1104.3832, 'ca_mtd': 956035.44, 'ca_norm': 28681063.2, 'segment': 'PREMIUM', 'previous_segment': None, 'evolution_segment': None, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3257', 'code_oci_id': 3257.0, 'autre_code': 'ABJ410', 'clutter': 'RURAL', 'commune': 'BONGO', 'departement': 'GRAND-BASSAM', 'type_du_site': 'MACRO', 'type_geolocalite': 'Village noyau', 'gestionnaire': 'Esco', 'latitude': 5.406709, 'longitude': -3.517256, 'localisation': 'intérieur', 'partenaires': 'LA COQUILLE', 'proprietaire': 'OCI', 'position_site': 'localité', 'site': 'CTCI', 'statut': 'SERVICE', 'projet': None, 'region': 'SUD-COMOE', 'ca_data': 121609.5, 'ca_voix': 82856.15, 'ca_total': 215874.66, 'parc_global': 2254.0, 'parc_data': 1541.0, 'parc_2g': 658.0, 'parc_3g': 21.0, 'parc_4g': 517.0, 'parc_5g': 3.0, 'autre_parc': 86.0, 'trafic_data_in': 286305.0, 'trafic_voix_in': 15792.22, 'trafic_data_in_mo': 286.305, 'ca_mtd': 215874.66, 'ca_norm': 6476239.8, 'segment': 'NORMAL', 'previous_segment': None, 'evolution_segment': None, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3428', 'code_oci_id': 3428.0, 'autre_code': 'IHS_LGN_039M', 'clutter': 'URBAIN', 'commune': 'ADJAME', 'departement': 'ABIDJAN', 'type_du_site': 'MACRO', 'type_geolocalite': 'capitale economique', 'gestionnaire': 'IHS', 'latitude': 5.349078, 'longitude': -4.026079, 'localisation': 'abidjan', 'partenaires': 'MOSAIK TELECOM', 'proprietaire': 'IHS', 'position_site': 'localité', 'site': 'ADJAME_NEW', 'statut': 'SERVICE', 'projet': 'deplacement de sites 2022', 'region': "DISTRICT AUTONOME D'ABIDJAN", 'ca_data': 283735.0, 'ca_voix': 186713.81, 'ca_total': 500731.8, 'parc_global': 4564.0, 'parc_data': 3088.0, 'parc_2g': 606.0, 'parc_3g': 22.0, 'parc_4g': 1036.0, 'parc_5g': 114.0, 'autre_parc': 114.0, 'trafic_data_in': 748361.56, 'trafic_voix_in': 24169.3, 'trafic_data_in_mo': 748.36156, 'ca_mtd': 500731.8, 'ca_norm': 15021954.0, 'segment': 'NORMAL', 'previous_segment': None, 'evolution_segment': None, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI2587', 'code_oci_id': 2587.0, 'autre_code': 'IHS_LGN_986M', 'clutter': 'URBAIN', 'commune': 'ABOBO', 'departement': 'ABIDJAN', 'type_du_site': 'MACRO', 'type_geolocalite': 'capitale economique', 'gestionnaire': 'IHS', 'latitude': 5.434921, 'longitude': -4.028741, 'localisation': 'abidjan', 'partenaires': 'MOSAIK TELECOM', 'proprietaire': 'IHS', 'position_site': 'Localité', 'site': 'ABOBO_NEW5', 'statut': 'SERVICE', 'projet': 'ATHENA 80 SITES', 'region': "DISTRICT AUTONOME D'ABIDJAN", 'ca_data': 480902.84, 'ca_voix': 212184.77, 'ca_total': 709591.6, 'parc_global': 7900.0, 'parc_data': 4255.0, 'parc_2g': 1227.0, 'parc_3g': 52.0, 'parc_4g': 1630.0, 'parc_5g': 101.0, 'autre_parc': 211.0, 'trafic_data_in': 1410212.1, 'trafic_voix_in': 40453.93, 'trafic_data_in_mo': 1410.2121000000002, 'ca_mtd': 709591.6, 'ca_norm': 21287748.0, 'segment': 'PREMIUM', 'previous_segment': None, 'evolution_segment': None, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3260', 'code_oci_id': 3260.0, 'autre_code': 'YAM039', 'clutter': 'RURAL', 'commune': 'TIASSALE', 'departement': 'TIASSALE', 'type_du_site': 'MACRO', 'type_geolocalite': 'Village noyau', 'gestionnaire': 'Esco', 'latitude': 6.00251389, 'longitude': -4.85460001, 'localisation': 'Intérieur', 'partenaires': 'KTC', 'proprietaire': 'Particulier', 'position_site': 'localité', 'site': 'SCB_GDFLEUVE', 'statut': 'SERVICE', 'projet': None, 'region': 'AGNEBY-TIASSA', 'ca_data': None, 'ca_voix': None, 'ca_total': None, 'parc_global': None, 'parc_data': None, 'parc_2g': None, 'parc_3g': None, 'parc_4g': None, 'parc_5g': None, 'autre_parc': None, 'trafic_data_in': None, 'trafic_voix_in': None, 'trafic_data_in_mo': None, 'ca_mtd': None, 'ca_norm': None, 'segment': None, 'previous_segment': None, 'evolution_segment': None, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3446', 'code_oci_id': 3446.0, 'autre_code': 'IHS_NCE_057M', 'clutter': 'URBAIN', 'commune': "M'BAHIAKRO", 'departement': "M'BAHIAKRO", 'type_du_site': 'MACRO', 'type_geolocalite': 'Chef-lieu de departement', 'gestionnaire': 'IHS', 'latitude': 7.4544, 'longitude': -4.3360467, 'localisation': 'intérieur', 'partenaires': 'AJS', 'proprietaire': 'IHS', 'position_site': 'localité', 'site': 'MBAHIAKRO_BIS', 'statut': 'SERVICE', 'projet': None, 'region': 'IFFOU', 'ca_data': 95793.31, 'ca_voix': 78506.79, 'ca_total': 183206.1, 'parc_global': 6831.0, 'parc_data': 1639.0, 'parc_2g': 1046.0, 'parc_3g': 50.0, 'parc_4g': 572.0, 'parc_5g': 9.0, 'autre_parc': 103.0, 'trafic_data_in': 237113.25, 'trafic_voix_in': 17435.01, 'trafic_data_in_mo': 237.11325, 'ca_mtd': 183206.1, 'ca_norm': 5496183.0, 'segment': 'NORMAL', 'previous_segment': None, 'evolution_segment': None, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI2886', 'code_oci_id': 2886.0, 'autre_code': 'KOR020', 'clutter': 'RURAL', 'commune': 'GBONGAHA', 'departement': 'SEGUELON', 'type_du_site': 'MACRO', 'type_geolocalite': 'Village noyau', 'gestionnaire': 'Esco', 'latitude': 9.055241, 'longitude': -6.940734, 'localisation': 'intérieur', 'partenaires': 'TID', 'proprietaire': 'OCI', 'position_site': 'Localité', 'site': 'KARABIRI', 'statut': 'SERVICE', 'projet': 'ATHENA 112 SITES', 'region': 'KABADOUGOU', 'ca_data': 64399.0, 'ca_voix': 57702.19, 'ca_total': 125859.19, 'parc_global': 2474.0, 'parc_data': 1492.0, 'parc_2g': 983.0, 'parc_3g': 27.0, 'parc_4g': 498.0, 'parc_5g': 3.0, 'autre_parc': 72.0, 'trafic_data_in': 100381.695, 'trafic_voix_in': 11929.88, 'trafic_data_in_mo': 100.38169500000001, 'ca_mtd': 125859.19, 'ca_norm': 3775775.7, 'segment': 'A DEVELOPER', 'previous_segment': None, 'evolution_segment': None, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI2698', 'code_oci_id': 2698.0, 'autre_code': 'YAM024', 'clutter': 'RURAL', 'commune': 'DIDIEVI', 'departement': 'DIDIEVI', 'type_du_site': 'MACRO', 'type_geolocalite': 'Village noyau', 'gestionnaire': 'Esco', 'latitude': 7.159391, 'longitude': -4.808514, 'localisation': 'intérieur', 'partenaires': 'AJS', 'proprietaire': 'OCI', 'position_site': 'localité', 'site': 'POU_OKA', 'statut': 'SERVICE', 'projet': 'ATHENA 112 SITES', 'region': 'BELIER', 'ca_data': 35792.9, 'ca_voix': 35397.63, 'ca_total': 72989.53, 'parc_global': 1209.0, 'parc_data': 836.0, 'parc_2g': 516.0, 'parc_3g': 15.0, 'parc_4g': 264.0, 'parc_5g': 4.0, 'autre_parc': 65.0, 'trafic_data_in': 62178.35, 'trafic_voix_in': 13839.72, 'trafic_data_in_mo': 62.17835, 'ca_mtd': 72989.53, 'ca_norm': 2189685.9, 'segment': 'A DEVELOPER', 'previous_segment': None, 'evolution_segment': None, 'mois': 6, 'annee': 2024}  ... displaying 10 of 3107 total bound parameter sets ...  {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3369', 'code_oci_id': 3369.0, 'autre_code': 'ABJ528', 'clutter': 'URBAIN', 'commune': 'YOPOUGON', 'departement': 'ABIDJAN', 'type_du_site': 'MACRO', 'type_geolocalite': 'capitale economique', 'gestionnaire': 'ESCO', 'latitude': 5.324418, 'longitude': -4.06488, 'localisation': 'abidjan', 'partenaires': 'SII', 'proprietaire': 'OCI', 'position_site': 'localité', 'site': 'ST_FRANCOIS', 'statut': 'SERVICE', 'projet': None, 'region': "DISTRICT AUTONOME D'ABIDJAN", 'ca_data': 462131.2, 'ca_voix': 178586.05, 'ca_total': 667171.25, 'parc_global': 3331.0, 'parc_data': 2737.0, 'parc_2g': 165.0, 'parc_3g': 22.0, 'parc_4g': 1188.0, 'parc_5g': 113.0, 'autre_parc': 59.0, 'trafic_data_in': 1269518.1, 'trafic_voix_in': 36183.13, 'trafic_data_in_mo': 1269.5181, 'ca_mtd': 667171.25, 'ca_norm': 20015137.5, 'segment': 'PREMIUM', 'previous_segment': None, 'evolution_segment': None, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3326', 'code_oci_id': 3326.0, 'autre_code': 'ABJ527', 'clutter': 'URBAIN', 'commune': 'YOPOUGON', 'departement': 'ABIDJAN', 'type_du_site': 'MACRO', 'type_geolocalite': 'capitale economique', 'gestionnaire': 'ESCO', 'latitude': 5.328539, 'longitude': -4.107447, 'localisation': 'abidjan', 'partenaires': 'SII', 'proprietaire': 'OCI', 'position_site': 'localité', 'site': 'YOP_LUBAF', 'statut': 'SERVICE', 'projet': None, 'region': "DISTRICT AUTONOME D'ABIDJAN", 'ca_data': 468166.16, 'ca_voix': 249111.7, 'ca_total': 742102.9, 'parc_global': 3203.0, 'parc_data': 2847.0, 'parc_2g': 95.0, 'parc_3g': 18.0, 'parc_4g': 1256.0, 'parc_5g': 168.0, 'autre_parc': 76.0, 'trafic_data_in': 1167098.0, 'trafic_voix_in': 40619.5, 'trafic_data_in_mo': 1167.098, 'ca_mtd': 742102.9, 'ca_norm': 22263087.0, 'segment': 'PREMIUM', 'previous_segment': None, 'evolution_segment': None, 'mois': 6, 'annee': 2024})]
(Background on this error at: https://sqlalche.me/e/14/f405)
[2024-07-26T11:39:09.318+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-02T06:00:00+00:00, execution_date=20240602T060000, start_date=20240726T113907, end_date=20240726T113909
[2024-07-26T11:39:09.346+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-07-26T11:39:09.347+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-26T11:39:09.348+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-26T11:39:09.361+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-26T11:39:09.362+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-26T11:39:09.363+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1890, in _execute_context
    self.dialect.do_executemany(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/psycopg2.py", line 982, in do_executemany
    context._psycopg2_fetched_rows = xtras.execute_values(
                                     ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/psycopg2/extras.py", line 1299, in execute_values
    cur.execute(b''.join(parts))
psycopg2.errors.UndefinedColumn: column "mois" of relation "motower_daily_caparc" does not exist
LINE 1: ...rm, segment, previous_segment, evolution_segment, mois, anne...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 136, in gen_motower_daily
    write_pg(PG_SAVE_HOST, PG_SAVE_DB, PG_SAVE_USER, PG_SAVE_PASSWORD, data, "motower_daily_caparc")
  File "/opt/airflow/dags/gps/common/rwpg.py", line 66, in write_pg
    data.to_sql(table, engine, index=False, if_exists = 'append')
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
           ^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
           ^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1385, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 334, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1577, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1953, in _execute_context
    self._handle_dbapi_exception(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2134, in _handle_dbapi_exception
    util.raise_(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/util/compat.py", line 211, in raise_
    raise exception
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1890, in _execute_context
    self.dialect.do_executemany(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/psycopg2.py", line 982, in do_executemany
    context._psycopg2_fetched_rows = xtras.execute_values(
                                     ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/psycopg2/extras.py", line 1299, in execute_values
    cur.execute(b''.join(parts))
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column "mois" of relation "motower_daily_caparc" does not exist
LINE 1: ...rm, segment, previous_segment, evolution_segment, mois, anne...
                                                             ^

[SQL: INSERT INTO motower_daily_caparc (jour, code_oci, code_oci_id, autre_code, clutter, commune, departement, type_du_site, type_geolocalite, gestionnaire, latitude, longitude, localisation, partenaires, proprietaire, position_site, site, statut, projet, region, ca_data, ca_voix, ca_total, parc_global, parc_data, parc_2g, parc_3g, parc_4g, parc_5g, autre_parc, trafic_data_in, trafic_voix_in, trafic_data_in_mo, ca_mtd, ca_norm, segment, previous_segment, evolution_segment, mois, annee) VALUES (%(jour)s, %(code_oci)s, %(code_oci_id)s, %(autre_code)s, %(clutter)s, %(commune)s, %(departement)s, %(type_du_site)s, %(type_geolocalite)s, %(gestionnaire)s, %(latitude)s, %(longitude)s, %(localisation)s, %(partenaires)s, %(proprietaire)s, %(position_site)s, %(site)s, %(statut)s, %(projet)s, %(region)s, %(ca_data)s, %(ca_voix)s, %(ca_total)s, %(parc_global)s, %(parc_data)s, %(parc_2g)s, %(parc_3g)s, %(parc_4g)s, %(parc_5g)s, %(autre_parc)s, %(trafic_data_in)s, %(trafic_voix_in)s, %(trafic_data_in_mo)s, %(ca_mtd)s, %(ca_norm)s, %(segment)s, %(previous_segment)s, %(evolution_segment)s, %(mois)s, %(annee)s)]
[parameters: ({'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI2831', 'code_oci_id': 2831.0, 'autre_code': 'ABJ419', 'clutter': 'URBAIN', 'commune': 'PORT-BOUET', 'departement': 'ABIDJAN', 'type_du_site': 'MACRO', 'type_geolocalite': 'capitale economique', 'gestionnaire': 'Esco', 'latitude': 5.241082, 'longitude': -3.91019, 'localisation': 'abidjan', 'partenaires': 'LA COQUILLE', 'proprietaire': 'OCI', 'position_site': 'Axe Routier', 'site': 'PHCIE_RTE_BASSAM', 'statut': 'SERVICE', 'projet': None, 'region': "DISTRICT AUTONOME D'ABIDJAN", 'ca_data': 585246.5, 'ca_voix': 319805.2, 'ca_total': 956035.44, 'parc_global': 9514.0, 'parc_data': 6605.0, 'parc_2g': 2113.0, 'parc_3g': 93.0, 'parc_4g': 2550.0, 'parc_5g': 177.0, 'autre_parc': 407.0, 'trafic_data_in': 1104383.2, 'trafic_voix_in': 53278.24, 'trafic_data_in_mo': 1104.3832, 'ca_mtd': 956035.44, 'ca_norm': 28681063.2, 'segment': 'PREMIUM', 'previous_segment': None, 'evolution_segment': None, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3257', 'code_oci_id': 3257.0, 'autre_code': 'ABJ410', 'clutter': 'RURAL', 'commune': 'BONGO', 'departement': 'GRAND-BASSAM', 'type_du_site': 'MACRO', 'type_geolocalite': 'Village noyau', 'gestionnaire': 'Esco', 'latitude': 5.406709, 'longitude': -3.517256, 'localisation': 'intérieur', 'partenaires': 'LA COQUILLE', 'proprietaire': 'OCI', 'position_site': 'localité', 'site': 'CTCI', 'statut': 'SERVICE', 'projet': None, 'region': 'SUD-COMOE', 'ca_data': 121609.5, 'ca_voix': 82856.15, 'ca_total': 215874.66, 'parc_global': 2254.0, 'parc_data': 1541.0, 'parc_2g': 658.0, 'parc_3g': 21.0, 'parc_4g': 517.0, 'parc_5g': 3.0, 'autre_parc': 86.0, 'trafic_data_in': 286305.0, 'trafic_voix_in': 15792.22, 'trafic_data_in_mo': 286.305, 'ca_mtd': 215874.66, 'ca_norm': 6476239.8, 'segment': 'NORMAL', 'previous_segment': None, 'evolution_segment': None, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3428', 'code_oci_id': 3428.0, 'autre_code': 'IHS_LGN_039M', 'clutter': 'URBAIN', 'commune': 'ADJAME', 'departement': 'ABIDJAN', 'type_du_site': 'MACRO', 'type_geolocalite': 'capitale economique', 'gestionnaire': 'IHS', 'latitude': 5.349078, 'longitude': -4.026079, 'localisation': 'abidjan', 'partenaires': 'MOSAIK TELECOM', 'proprietaire': 'IHS', 'position_site': 'localité', 'site': 'ADJAME_NEW', 'statut': 'SERVICE', 'projet': 'deplacement de sites 2022', 'region': "DISTRICT AUTONOME D'ABIDJAN", 'ca_data': 283735.0, 'ca_voix': 186713.81, 'ca_total': 500731.8, 'parc_global': 4564.0, 'parc_data': 3088.0, 'parc_2g': 606.0, 'parc_3g': 22.0, 'parc_4g': 1036.0, 'parc_5g': 114.0, 'autre_parc': 114.0, 'trafic_data_in': 748361.56, 'trafic_voix_in': 24169.3, 'trafic_data_in_mo': 748.36156, 'ca_mtd': 500731.8, 'ca_norm': 15021954.0, 'segment': 'NORMAL', 'previous_segment': None, 'evolution_segment': None, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI2587', 'code_oci_id': 2587.0, 'autre_code': 'IHS_LGN_986M', 'clutter': 'URBAIN', 'commune': 'ABOBO', 'departement': 'ABIDJAN', 'type_du_site': 'MACRO', 'type_geolocalite': 'capitale economique', 'gestionnaire': 'IHS', 'latitude': 5.434921, 'longitude': -4.028741, 'localisation': 'abidjan', 'partenaires': 'MOSAIK TELECOM', 'proprietaire': 'IHS', 'position_site': 'Localité', 'site': 'ABOBO_NEW5', 'statut': 'SERVICE', 'projet': 'ATHENA 80 SITES', 'region': "DISTRICT AUTONOME D'ABIDJAN", 'ca_data': 480902.84, 'ca_voix': 212184.77, 'ca_total': 709591.6, 'parc_global': 7900.0, 'parc_data': 4255.0, 'parc_2g': 1227.0, 'parc_3g': 52.0, 'parc_4g': 1630.0, 'parc_5g': 101.0, 'autre_parc': 211.0, 'trafic_data_in': 1410212.1, 'trafic_voix_in': 40453.93, 'trafic_data_in_mo': 1410.2121000000002, 'ca_mtd': 709591.6, 'ca_norm': 21287748.0, 'segment': 'PREMIUM', 'previous_segment': None, 'evolution_segment': None, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3260', 'code_oci_id': 3260.0, 'autre_code': 'YAM039', 'clutter': 'RURAL', 'commune': 'TIASSALE', 'departement': 'TIASSALE', 'type_du_site': 'MACRO', 'type_geolocalite': 'Village noyau', 'gestionnaire': 'Esco', 'latitude': 6.00251389, 'longitude': -4.85460001, 'localisation': 'Intérieur', 'partenaires': 'KTC', 'proprietaire': 'Particulier', 'position_site': 'localité', 'site': 'SCB_GDFLEUVE', 'statut': 'SERVICE', 'projet': None, 'region': 'AGNEBY-TIASSA', 'ca_data': None, 'ca_voix': None, 'ca_total': None, 'parc_global': None, 'parc_data': None, 'parc_2g': None, 'parc_3g': None, 'parc_4g': None, 'parc_5g': None, 'autre_parc': None, 'trafic_data_in': None, 'trafic_voix_in': None, 'trafic_data_in_mo': None, 'ca_mtd': None, 'ca_norm': None, 'segment': None, 'previous_segment': None, 'evolution_segment': None, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3446', 'code_oci_id': 3446.0, 'autre_code': 'IHS_NCE_057M', 'clutter': 'URBAIN', 'commune': "M'BAHIAKRO", 'departement': "M'BAHIAKRO", 'type_du_site': 'MACRO', 'type_geolocalite': 'Chef-lieu de departement', 'gestionnaire': 'IHS', 'latitude': 7.4544, 'longitude': -4.3360467, 'localisation': 'intérieur', 'partenaires': 'AJS', 'proprietaire': 'IHS', 'position_site': 'localité', 'site': 'MBAHIAKRO_BIS', 'statut': 'SERVICE', 'projet': None, 'region': 'IFFOU', 'ca_data': 95793.31, 'ca_voix': 78506.79, 'ca_total': 183206.1, 'parc_global': 6831.0, 'parc_data': 1639.0, 'parc_2g': 1046.0, 'parc_3g': 50.0, 'parc_4g': 572.0, 'parc_5g': 9.0, 'autre_parc': 103.0, 'trafic_data_in': 237113.25, 'trafic_voix_in': 17435.01, 'trafic_data_in_mo': 237.11325, 'ca_mtd': 183206.1, 'ca_norm': 5496183.0, 'segment': 'NORMAL', 'previous_segment': None, 'evolution_segment': None, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI2886', 'code_oci_id': 2886.0, 'autre_code': 'KOR020', 'clutter': 'RURAL', 'commune': 'GBONGAHA', 'departement': 'SEGUELON', 'type_du_site': 'MACRO', 'type_geolocalite': 'Village noyau', 'gestionnaire': 'Esco', 'latitude': 9.055241, 'longitude': -6.940734, 'localisation': 'intérieur', 'partenaires': 'TID', 'proprietaire': 'OCI', 'position_site': 'Localité', 'site': 'KARABIRI', 'statut': 'SERVICE', 'projet': 'ATHENA 112 SITES', 'region': 'KABADOUGOU', 'ca_data': 64399.0, 'ca_voix': 57702.19, 'ca_total': 125859.19, 'parc_global': 2474.0, 'parc_data': 1492.0, 'parc_2g': 983.0, 'parc_3g': 27.0, 'parc_4g': 498.0, 'parc_5g': 3.0, 'autre_parc': 72.0, 'trafic_data_in': 100381.695, 'trafic_voix_in': 11929.88, 'trafic_data_in_mo': 100.38169500000001, 'ca_mtd': 125859.19, 'ca_norm': 3775775.7, 'segment': 'A DEVELOPER', 'previous_segment': None, 'evolution_segment': None, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI2698', 'code_oci_id': 2698.0, 'autre_code': 'YAM024', 'clutter': 'RURAL', 'commune': 'DIDIEVI', 'departement': 'DIDIEVI', 'type_du_site': 'MACRO', 'type_geolocalite': 'Village noyau', 'gestionnaire': 'Esco', 'latitude': 7.159391, 'longitude': -4.808514, 'localisation': 'intérieur', 'partenaires': 'AJS', 'proprietaire': 'OCI', 'position_site': 'localité', 'site': 'POU_OKA', 'statut': 'SERVICE', 'projet': 'ATHENA 112 SITES', 'region': 'BELIER', 'ca_data': 35792.9, 'ca_voix': 35397.63, 'ca_total': 72989.53, 'parc_global': 1209.0, 'parc_data': 836.0, 'parc_2g': 516.0, 'parc_3g': 15.0, 'parc_4g': 264.0, 'parc_5g': 4.0, 'autre_parc': 65.0, 'trafic_data_in': 62178.35, 'trafic_voix_in': 13839.72, 'trafic_data_in_mo': 62.17835, 'ca_mtd': 72989.53, 'ca_norm': 2189685.9, 'segment': 'A DEVELOPER', 'previous_segment': None, 'evolution_segment': None, 'mois': 6, 'annee': 2024}  ... displaying 10 of 3107 total bound parameter sets ...  {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3369', 'code_oci_id': 3369.0, 'autre_code': 'ABJ528', 'clutter': 'URBAIN', 'commune': 'YOPOUGON', 'departement': 'ABIDJAN', 'type_du_site': 'MACRO', 'type_geolocalite': 'capitale economique', 'gestionnaire': 'ESCO', 'latitude': 5.324418, 'longitude': -4.06488, 'localisation': 'abidjan', 'partenaires': 'SII', 'proprietaire': 'OCI', 'position_site': 'localité', 'site': 'ST_FRANCOIS', 'statut': 'SERVICE', 'projet': None, 'region': "DISTRICT AUTONOME D'ABIDJAN", 'ca_data': 462131.2, 'ca_voix': 178586.05, 'ca_total': 667171.25, 'parc_global': 3331.0, 'parc_data': 2737.0, 'parc_2g': 165.0, 'parc_3g': 22.0, 'parc_4g': 1188.0, 'parc_5g': 113.0, 'autre_parc': 59.0, 'trafic_data_in': 1269518.1, 'trafic_voix_in': 36183.13, 'trafic_data_in_mo': 1269.5181, 'ca_mtd': 667171.25, 'ca_norm': 20015137.5, 'segment': 'PREMIUM', 'previous_segment': None, 'evolution_segment': None, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3326', 'code_oci_id': 3326.0, 'autre_code': 'ABJ527', 'clutter': 'URBAIN', 'commune': 'YOPOUGON', 'departement': 'ABIDJAN', 'type_du_site': 'MACRO', 'type_geolocalite': 'capitale economique', 'gestionnaire': 'ESCO', 'latitude': 5.328539, 'longitude': -4.107447, 'localisation': 'abidjan', 'partenaires': 'SII', 'proprietaire': 'OCI', 'position_site': 'localité', 'site': 'YOP_LUBAF', 'statut': 'SERVICE', 'projet': None, 'region': "DISTRICT AUTONOME D'ABIDJAN", 'ca_data': 468166.16, 'ca_voix': 249111.7, 'ca_total': 742102.9, 'parc_global': 3203.0, 'parc_data': 2847.0, 'parc_2g': 95.0, 'parc_3g': 18.0, 'parc_4g': 1256.0, 'parc_5g': 168.0, 'autre_parc': 76.0, 'trafic_data_in': 1167098.0, 'trafic_voix_in': 40619.5, 'trafic_data_in_mo': 1167.098, 'ca_mtd': 742102.9, 'ca_norm': 22263087.0, 'segment': 'PREMIUM', 'previous_segment': None, 'evolution_segment': None, 'mois': 6, 'annee': 2024})]
(Background on this error at: https://sqlalche.me/e/14/f405)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-07-26T11:39:09.381+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-07-26T11:39:09.381+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-26T11:39:09.382+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-26T11:39:09.404+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 3595 for task motower_dcaparc ((psycopg2.errors.UndefinedColumn) column "mois" of relation "motower_daily_caparc" does not exist
LINE 1: ...rm, segment, previous_segment, evolution_segment, mois, anne...
                                                             ^

[SQL: INSERT INTO motower_daily_caparc (jour, code_oci, code_oci_id, autre_code, clutter, commune, departement, type_du_site, type_geolocalite, gestionnaire, latitude, longitude, localisation, partenaires, proprietaire, position_site, site, statut, projet, region, ca_data, ca_voix, ca_total, parc_global, parc_data, parc_2g, parc_3g, parc_4g, parc_5g, autre_parc, trafic_data_in, trafic_voix_in, trafic_data_in_mo, ca_mtd, ca_norm, segment, previous_segment, evolution_segment, mois, annee) VALUES (%(jour)s, %(code_oci)s, %(code_oci_id)s, %(autre_code)s, %(clutter)s, %(commune)s, %(departement)s, %(type_du_site)s, %(type_geolocalite)s, %(gestionnaire)s, %(latitude)s, %(longitude)s, %(localisation)s, %(partenaires)s, %(proprietaire)s, %(position_site)s, %(site)s, %(statut)s, %(projet)s, %(region)s, %(ca_data)s, %(ca_voix)s, %(ca_total)s, %(parc_global)s, %(parc_data)s, %(parc_2g)s, %(parc_3g)s, %(parc_4g)s, %(parc_5g)s, %(autre_parc)s, %(trafic_data_in)s, %(trafic_voix_in)s, %(trafic_data_in_mo)s, %(ca_mtd)s, %(ca_norm)s, %(segment)s, %(previous_segment)s, %(evolution_segment)s, %(mois)s, %(annee)s)]
[parameters: ({'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI2831', 'code_oci_id': 2831.0, 'autre_code': 'ABJ419', 'clutter': 'URBAIN', 'commune': 'PORT-BOUET', 'departement': 'ABIDJAN', 'type_du_site': 'MACRO', 'type_geolocalite': 'capitale economique', 'gestionnaire': 'Esco', 'latitude': 5.241082, 'longitude': -3.91019, 'localisation': 'abidjan', 'partenaires': 'LA COQUILLE', 'proprietaire': 'OCI', 'position_site': 'Axe Routier', 'site': 'PHCIE_RTE_BASSAM', 'statut': 'SERVICE', 'projet': None, 'region': "DISTRICT AUTONOME D'ABIDJAN", 'ca_data': 585246.5, 'ca_voix': 319805.2, 'ca_total': 956035.44, 'parc_global': 9514.0, 'parc_data': 6605.0, 'parc_2g': 2113.0, 'parc_3g': 93.0, 'parc_4g': 2550.0, 'parc_5g': 177.0, 'autre_parc': 407.0, 'trafic_data_in': 1104383.2, 'trafic_voix_in': 53278.24, 'trafic_data_in_mo': 1104.3832, 'ca_mtd': 956035.44, 'ca_norm': 28681063.2, 'segment': 'PREMIUM', 'previous_segment': None, 'evolution_segment': None, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3257', 'code_oci_id': 3257.0, 'autre_code': 'ABJ410', 'clutter': 'RURAL', 'commune': 'BONGO', 'departement': 'GRAND-BASSAM', 'type_du_site': 'MACRO', 'type_geolocalite': 'Village noyau', 'gestionnaire': 'Esco', 'latitude': 5.406709, 'longitude': -3.517256, 'localisation': 'intérieur', 'partenaires': 'LA COQUILLE', 'proprietaire': 'OCI', 'position_site': 'localité', 'site': 'CTCI', 'statut': 'SERVICE', 'projet': None, 'region': 'SUD-COMOE', 'ca_data': 121609.5, 'ca_voix': 82856.15, 'ca_total': 215874.66, 'parc_global': 2254.0, 'parc_data': 1541.0, 'parc_2g': 658.0, 'parc_3g': 21.0, 'parc_4g': 517.0, 'parc_5g': 3.0, 'autre_parc': 86.0, 'trafic_data_in': 286305.0, 'trafic_voix_in': 15792.22, 'trafic_data_in_mo': 286.305, 'ca_mtd': 215874.66, 'ca_norm': 6476239.8, 'segment': 'NORMAL', 'previous_segment': None, 'evolution_segment': None, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3428', 'code_oci_id': 3428.0, 'autre_code': 'IHS_LGN_039M', 'clutter': 'URBAIN', 'commune': 'ADJAME', 'departement': 'ABIDJAN', 'type_du_site': 'MACRO', 'type_geolocalite': 'capitale economique', 'gestionnaire': 'IHS', 'latitude': 5.349078, 'longitude': -4.026079, 'localisation': 'abidjan', 'partenaires': 'MOSAIK TELECOM', 'proprietaire': 'IHS', 'position_site': 'localité', 'site': 'ADJAME_NEW', 'statut': 'SERVICE', 'projet': 'deplacement de sites 2022', 'region': "DISTRICT AUTONOME D'ABIDJAN", 'ca_data': 283735.0, 'ca_voix': 186713.81, 'ca_total': 500731.8, 'parc_global': 4564.0, 'parc_data': 3088.0, 'parc_2g': 606.0, 'parc_3g': 22.0, 'parc_4g': 1036.0, 'parc_5g': 114.0, 'autre_parc': 114.0, 'trafic_data_in': 748361.56, 'trafic_voix_in': 24169.3, 'trafic_data_in_mo': 748.36156, 'ca_mtd': 500731.8, 'ca_norm': 15021954.0, 'segment': 'NORMAL', 'previous_segment': None, 'evolution_segment': None, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI2587', 'code_oci_id': 2587.0, 'autre_code': 'IHS_LGN_986M', 'clutter': 'URBAIN', 'commune': 'ABOBO', 'departement': 'ABIDJAN', 'type_du_site': 'MACRO', 'type_geolocalite': 'capitale economique', 'gestionnaire': 'IHS', 'latitude': 5.434921, 'longitude': -4.028741, 'localisation': 'abidjan', 'partenaires': 'MOSAIK TELECOM', 'proprietaire': 'IHS', 'position_site': 'Localité', 'site': 'ABOBO_NEW5', 'statut': 'SERVICE', 'projet': 'ATHENA 80 SITES', 'region': "DISTRICT AUTONOME D'ABIDJAN", 'ca_data': 480902.84, 'ca_voix': 212184.77, 'ca_total': 709591.6, 'parc_global': 7900.0, 'parc_data': 4255.0, 'parc_2g': 1227.0, 'parc_3g': 52.0, 'parc_4g': 1630.0, 'parc_5g': 101.0, 'autre_parc': 211.0, 'trafic_data_in': 1410212.1, 'trafic_voix_in': 40453.93, 'trafic_data_in_mo': 1410.2121000000002, 'ca_mtd': 709591.6, 'ca_norm': 21287748.0, 'segment': 'PREMIUM', 'previous_segment': None, 'evolution_segment': None, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3260', 'code_oci_id': 3260.0, 'autre_code': 'YAM039', 'clutter': 'RURAL', 'commune': 'TIASSALE', 'departement': 'TIASSALE', 'type_du_site': 'MACRO', 'type_geolocalite': 'Village noyau', 'gestionnaire': 'Esco', 'latitude': 6.00251389, 'longitude': -4.85460001, 'localisation': 'Intérieur', 'partenaires': 'KTC', 'proprietaire': 'Particulier', 'position_site': 'localité', 'site': 'SCB_GDFLEUVE', 'statut': 'SERVICE', 'projet': None, 'region': 'AGNEBY-TIASSA', 'ca_data': None, 'ca_voix': None, 'ca_total': None, 'parc_global': None, 'parc_data': None, 'parc_2g': None, 'parc_3g': None, 'parc_4g': None, 'parc_5g': None, 'autre_parc': None, 'trafic_data_in': None, 'trafic_voix_in': None, 'trafic_data_in_mo': None, 'ca_mtd': None, 'ca_norm': None, 'segment': None, 'previous_segment': None, 'evolution_segment': None, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3446', 'code_oci_id': 3446.0, 'autre_code': 'IHS_NCE_057M', 'clutter': 'URBAIN', 'commune': "M'BAHIAKRO", 'departement': "M'BAHIAKRO", 'type_du_site': 'MACRO', 'type_geolocalite': 'Chef-lieu de departement', 'gestionnaire': 'IHS', 'latitude': 7.4544, 'longitude': -4.3360467, 'localisation': 'intérieur', 'partenaires': 'AJS', 'proprietaire': 'IHS', 'position_site': 'localité', 'site': 'MBAHIAKRO_BIS', 'statut': 'SERVICE', 'projet': None, 'region': 'IFFOU', 'ca_data': 95793.31, 'ca_voix': 78506.79, 'ca_total': 183206.1, 'parc_global': 6831.0, 'parc_data': 1639.0, 'parc_2g': 1046.0, 'parc_3g': 50.0, 'parc_4g': 572.0, 'parc_5g': 9.0, 'autre_parc': 103.0, 'trafic_data_in': 237113.25, 'trafic_voix_in': 17435.01, 'trafic_data_in_mo': 237.11325, 'ca_mtd': 183206.1, 'ca_norm': 5496183.0, 'segment': 'NORMAL', 'previous_segment': None, 'evolution_segment': None, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI2886', 'code_oci_id': 2886.0, 'autre_code': 'KOR020', 'clutter': 'RURAL', 'commune': 'GBONGAHA', 'departement': 'SEGUELON', 'type_du_site': 'MACRO', 'type_geolocalite': 'Village noyau', 'gestionnaire': 'Esco', 'latitude': 9.055241, 'longitude': -6.940734, 'localisation': 'intérieur', 'partenaires': 'TID', 'proprietaire': 'OCI', 'position_site': 'Localité', 'site': 'KARABIRI', 'statut': 'SERVICE', 'projet': 'ATHENA 112 SITES', 'region': 'KABADOUGOU', 'ca_data': 64399.0, 'ca_voix': 57702.19, 'ca_total': 125859.19, 'parc_global': 2474.0, 'parc_data': 1492.0, 'parc_2g': 983.0, 'parc_3g': 27.0, 'parc_4g': 498.0, 'parc_5g': 3.0, 'autre_parc': 72.0, 'trafic_data_in': 100381.695, 'trafic_voix_in': 11929.88, 'trafic_data_in_mo': 100.38169500000001, 'ca_mtd': 125859.19, 'ca_norm': 3775775.7, 'segment': 'A DEVELOPER', 'previous_segment': None, 'evolution_segment': None, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI2698', 'code_oci_id': 2698.0, 'autre_code': 'YAM024', 'clutter': 'RURAL', 'commune': 'DIDIEVI', 'departement': 'DIDIEVI', 'type_du_site': 'MACRO', 'type_geolocalite': 'Village noyau', 'gestionnaire': 'Esco', 'latitude': 7.159391, 'longitude': -4.808514, 'localisation': 'intérieur', 'partenaires': 'AJS', 'proprietaire': 'OCI', 'position_site': 'localité', 'site': 'POU_OKA', 'statut': 'SERVICE', 'projet': 'ATHENA 112 SITES', 'region': 'BELIER', 'ca_data': 35792.9, 'ca_voix': 35397.63, 'ca_total': 72989.53, 'parc_global': 1209.0, 'parc_data': 836.0, 'parc_2g': 516.0, 'parc_3g': 15.0, 'parc_4g': 264.0, 'parc_5g': 4.0, 'autre_parc': 65.0, 'trafic_data_in': 62178.35, 'trafic_voix_in': 13839.72, 'trafic_data_in_mo': 62.17835, 'ca_mtd': 72989.53, 'ca_norm': 2189685.9, 'segment': 'A DEVELOPER', 'previous_segment': None, 'evolution_segment': None, 'mois': 6, 'annee': 2024}  ... displaying 10 of 3107 total bound parameter sets ...  {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3369', 'code_oci_id': 3369.0, 'autre_code': 'ABJ528', 'clutter': 'URBAIN', 'commune': 'YOPOUGON', 'departement': 'ABIDJAN', 'type_du_site': 'MACRO', 'type_geolocalite': 'capitale economique', 'gestionnaire': 'ESCO', 'latitude': 5.324418, 'longitude': -4.06488, 'localisation': 'abidjan', 'partenaires': 'SII', 'proprietaire': 'OCI', 'position_site': 'localité', 'site': 'ST_FRANCOIS', 'statut': 'SERVICE', 'projet': None, 'region': "DISTRICT AUTONOME D'ABIDJAN", 'ca_data': 462131.2, 'ca_voix': 178586.05, 'ca_total': 667171.25, 'parc_global': 3331.0, 'parc_data': 2737.0, 'parc_2g': 165.0, 'parc_3g': 22.0, 'parc_4g': 1188.0, 'parc_5g': 113.0, 'autre_parc': 59.0, 'trafic_data_in': 1269518.1, 'trafic_voix_in': 36183.13, 'trafic_data_in_mo': 1269.5181, 'ca_mtd': 667171.25, 'ca_norm': 20015137.5, 'segment': 'PREMIUM', 'previous_segment': None, 'evolution_segment': None, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3326', 'code_oci_id': 3326.0, 'autre_code': 'ABJ527', 'clutter': 'URBAIN', 'commune': 'YOPOUGON', 'departement': 'ABIDJAN', 'type_du_site': 'MACRO', 'type_geolocalite': 'capitale economique', 'gestionnaire': 'ESCO', 'latitude': 5.328539, 'longitude': -4.107447, 'localisation': 'abidjan', 'partenaires': 'SII', 'proprietaire': 'OCI', 'position_site': 'localité', 'site': 'YOP_LUBAF', 'statut': 'SERVICE', 'projet': None, 'region': "DISTRICT AUTONOME D'ABIDJAN", 'ca_data': 468166.16, 'ca_voix': 249111.7, 'ca_total': 742102.9, 'parc_global': 3203.0, 'parc_data': 2847.0, 'parc_2g': 95.0, 'parc_3g': 18.0, 'parc_4g': 1256.0, 'parc_5g': 168.0, 'autre_parc': 76.0, 'trafic_data_in': 1167098.0, 'trafic_voix_in': 40619.5, 'trafic_data_in_mo': 1167.098, 'ca_mtd': 742102.9, 'ca_norm': 22263087.0, 'segment': 'PREMIUM', 'previous_segment': None, 'evolution_segment': None, 'mois': 6, 'annee': 2024})]
(Background on this error at: https://sqlalche.me/e/14/f405); 1890)
[2024-07-26T11:39:09.470+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-07-26T11:39:09.487+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-26T11:42:16.396+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-26T11:42:16.433+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-26T11:42:16.446+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-26T11:42:16.446+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-26T11:42:16.469+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-02 06:00:00+00:00
[2024-07-26T11:42:16.484+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=2135) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-26T11:42:16.486+0000] {standard_task_runner.py:64} INFO - Started process 2148 to run task
[2024-07-26T11:42:16.486+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-02T06:00:00+00:00', '--job-id', '3670', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpnsdcsmmi']
[2024-07-26T11:42:16.489+0000] {standard_task_runner.py:91} INFO - Job 3670: Subtask motower_dcaparc
[2024-07-26T11:42:16.552+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-26T11:42:16.678+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-02T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-02T06:00:00+00:00'
[2024-07-26T11:42:16.679+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-26T11:42:16.703+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-26T11:42:16.723+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-26T11:42:16.812+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T11:42:16.814+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T11:42:16.815+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-01
[2024-07-26T11:42:16.815+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/01.csv
[2024-07-26T11:42:16.850+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240601  5.327182e+08  8.044059e+08  16715871    9176426  12042566   875452  5841327   297932     1379325  1.395652e+09
[2024-07-26T11:42:16.851+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T11:42:16.852+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T11:42:16.853+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T11:42:16.854+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T11:42:16.854+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T11:42:16.855+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T11:42:16.855+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-26T11:42:16.856+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-26T11:42:16.857+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T11:42:16.857+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T11:42:16.858+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-26T11:42:16.862+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-26T11:42:16.864+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-26T11:42:16.867+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-26T11:42:16.869+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-26T11:42:16.869+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-26T11:42:16.870+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-26T11:42:16.871+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-26T11:42:16.871+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-26T11:42:16.872+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-26T11:42:16.872+0000] {logging_mixin.py:188} INFO - 6
[2024-07-26T11:42:16.873+0000] {logging_mixin.py:188} INFO - 2024-06-01 00:00:00
[2024-07-26T11:42:16.887+0000] {motower_daily.py:200} INFO - ADD  SEGMENT
[2024-07-26T11:42:17.073+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-26T11:42:17.073+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T11:42:17.075+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T11:42:17.084+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-01  5.206589e+08  7.907621e+08   14770374.0  8934529.0  3810606.0  121316.0  3061852.0  193275.0    442619.0  1.368038e+09
[2024-07-26T11:42:17.085+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T11:42:17.085+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T11:42:17.086+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T11:42:17.086+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T11:42:17.087+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T11:42:17.087+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T11:42:17.088+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-26T11:42:17.088+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-26T11:42:17.089+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T11:42:17.089+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T11:42:17.116+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T11:42:17.152+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T11:42:18.215+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-26T11:42:18.216+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-26T11:42:18.233+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-02T06:00:00+00:00, execution_date=20240602T060000, start_date=20240726T114216, end_date=20240726T114218
[2024-07-26T11:42:18.299+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-26T11:42:18.321+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-26T11:42:18.324+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-26T12:09:21.339+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-26T12:09:21.668+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-26T12:09:21.679+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-26T12:09:21.679+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-26T12:09:21.691+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-02 06:00:00+00:00
[2024-07-26T12:09:21.705+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=220) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-26T12:09:21.707+0000] {standard_task_runner.py:64} INFO - Started process 236 to run task
[2024-07-26T12:09:21.708+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-02T06:00:00+00:00', '--job-id', '15', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpwzhv61cf']
[2024-07-26T12:09:21.712+0000] {standard_task_runner.py:91} INFO - Job 15: Subtask motower_dcaparc
[2024-07-26T12:09:21.777+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [running]> on host 38513f9ed169
[2024-07-26T12:09:21.944+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-02T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-02T06:00:00+00:00'
[2024-07-26T12:09:21.948+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-26T12:09:21.972+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-26T12:09:21.990+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-26T12:09:22.079+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T12:09:22.081+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T12:09:22.081+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-01
[2024-07-26T12:09:22.082+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/01.csv
[2024-07-26T12:09:22.116+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240601  5.327182e+08  8.044059e+08  16715871    9176426  12042566   875452  5841327   297932     1379325  1.395652e+09
[2024-07-26T12:09:22.116+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T12:09:22.117+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T12:09:22.118+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T12:09:22.119+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T12:09:22.120+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T12:09:22.120+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T12:09:22.121+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-26T12:09:22.121+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-26T12:09:22.122+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T12:09:22.123+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T12:09:22.123+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-26T12:09:22.129+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-26T12:09:22.131+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-26T12:09:22.134+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-26T12:09:22.143+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-26T12:09:22.144+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-26T12:09:22.144+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-26T12:09:22.158+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-26T12:09:22.160+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-26T12:09:22.160+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-26T12:09:22.161+0000] {logging_mixin.py:188} INFO - 6
[2024-07-26T12:09:22.161+0000] {logging_mixin.py:188} INFO - 2024-06-01 00:00:00
[2024-07-26T12:09:22.182+0000] {motower_daily.py:200} INFO - ADD  SEGMENT
[2024-07-26T12:09:22.532+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-26T12:09:22.532+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T12:09:22.534+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T12:09:22.544+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-01  5.206589e+08  7.907621e+08   14770374.0  8934529.0  3810606.0  121316.0  3061852.0  193275.0    442619.0  1.368038e+09
[2024-07-26T12:09:22.545+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T12:09:22.545+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T12:09:22.546+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T12:09:22.547+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T12:09:22.547+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T12:09:22.548+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T12:09:22.548+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-26T12:09:22.548+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-26T12:09:22.549+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T12:09:22.549+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T12:09:22.581+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T12:09:22.607+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T12:09:22.614+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:133: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['mois'] = data["jour"].dt.month

[2024-07-26T12:09:22.615+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:134: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['annee'] = data["jour"].dt.month

[2024-07-26T12:09:23.024+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-26T12:09:23.025+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1890, in _execute_context
    self.dialect.do_executemany(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/psycopg2.py", line 982, in do_executemany
    context._psycopg2_fetched_rows = xtras.execute_values(
                                     ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/psycopg2/extras.py", line 1299, in execute_values
    cur.execute(b''.join(parts))
psycopg2.errors.DatatypeMismatch: column "mois" is of type date but expression is of type integer
LINE 1: ...83.2, 53278.24, 1104.3832, 956035.44, 28681063.2, 6, 6),('20...
                                                             ^
HINT:  You will need to rewrite or cast the expression.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 137, in gen_motower_daily
    write_pg(PG_SAVE_HOST, PG_SAVE_DB, PG_SAVE_USER, PG_SAVE_PASSWORD, df_faits, "motower_daily_caparc_faits")
  File "/opt/airflow/dags/gps/common/rwpg.py", line 66, in write_pg
    data.to_sql(table, engine, index=False, if_exists = 'append')
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
           ^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
           ^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1385, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 334, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1577, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1953, in _execute_context
    self._handle_dbapi_exception(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2134, in _handle_dbapi_exception
    util.raise_(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/util/compat.py", line 211, in raise_
    raise exception
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1890, in _execute_context
    self.dialect.do_executemany(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/psycopg2.py", line 982, in do_executemany
    context._psycopg2_fetched_rows = xtras.execute_values(
                                     ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/psycopg2/extras.py", line 1299, in execute_values
    cur.execute(b''.join(parts))
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.DatatypeMismatch) column "mois" is of type date but expression is of type integer
LINE 1: ...83.2, 53278.24, 1104.3832, 956035.44, 28681063.2, 6, 6),('20...
                                                             ^
HINT:  You will need to rewrite or cast the expression.

[SQL: INSERT INTO motower_daily_caparc_faits (jour, ca_voix, ca_data, ca_total, parc_global, parc_data, parc_2g, parc_3g, parc_4g, parc_5g, autre_parc, trafic_data_in, trafic_voix_in, trafic_data_in_mo, ca_mtd, ca_norm, mois, annee) VALUES (%(jour)s, %(ca_voix)s, %(ca_data)s, %(ca_total)s, %(parc_global)s, %(parc_data)s, %(parc_2g)s, %(parc_3g)s, %(parc_4g)s, %(parc_5g)s, %(autre_parc)s, %(trafic_data_in)s, %(trafic_voix_in)s, %(trafic_data_in_mo)s, %(ca_mtd)s, %(ca_norm)s, %(mois)s, %(annee)s)]
[parameters: ({'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 319805.2, 'ca_data': 585246.5, 'ca_total': 956035.44, 'parc_global': 9514.0, 'parc_data': 6605.0, 'parc_2g': 2113.0, 'parc_3g': 93.0, 'parc_4g': 2550.0, 'parc_5g': 177.0, 'autre_parc': 407.0, 'trafic_data_in': 1104383.2, 'trafic_voix_in': 53278.24, 'trafic_data_in_mo': 1104.3832, 'ca_mtd': 956035.44, 'ca_norm': 28681063.2, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 82856.15, 'ca_data': 121609.5, 'ca_total': 215874.66, 'parc_global': 2254.0, 'parc_data': 1541.0, 'parc_2g': 658.0, 'parc_3g': 21.0, 'parc_4g': 517.0, 'parc_5g': 3.0, 'autre_parc': 86.0, 'trafic_data_in': 286305.0, 'trafic_voix_in': 15792.22, 'trafic_data_in_mo': 286.305, 'ca_mtd': 215874.66, 'ca_norm': 6476239.8, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 186713.81, 'ca_data': 283735.0, 'ca_total': 500731.8, 'parc_global': 4564.0, 'parc_data': 3088.0, 'parc_2g': 606.0, 'parc_3g': 22.0, 'parc_4g': 1036.0, 'parc_5g': 114.0, 'autre_parc': 114.0, 'trafic_data_in': 748361.56, 'trafic_voix_in': 24169.3, 'trafic_data_in_mo': 748.36156, 'ca_mtd': 500731.8, 'ca_norm': 15021954.0, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 212184.77, 'ca_data': 480902.84, 'ca_total': 709591.6, 'parc_global': 7900.0, 'parc_data': 4255.0, 'parc_2g': 1227.0, 'parc_3g': 52.0, 'parc_4g': 1630.0, 'parc_5g': 101.0, 'autre_parc': 211.0, 'trafic_data_in': 1410212.1, 'trafic_voix_in': 40453.93, 'trafic_data_in_mo': 1410.2121000000002, 'ca_mtd': 709591.6, 'ca_norm': 21287748.0, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': None, 'ca_data': None, 'ca_total': None, 'parc_global': None, 'parc_data': None, 'parc_2g': None, 'parc_3g': None, 'parc_4g': None, 'parc_5g': None, 'autre_parc': None, 'trafic_data_in': None, 'trafic_voix_in': None, 'trafic_data_in_mo': None, 'ca_mtd': None, 'ca_norm': None, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 78506.79, 'ca_data': 95793.31, 'ca_total': 183206.1, 'parc_global': 6831.0, 'parc_data': 1639.0, 'parc_2g': 1046.0, 'parc_3g': 50.0, 'parc_4g': 572.0, 'parc_5g': 9.0, 'autre_parc': 103.0, 'trafic_data_in': 237113.25, 'trafic_voix_in': 17435.01, 'trafic_data_in_mo': 237.11325, 'ca_mtd': 183206.1, 'ca_norm': 5496183.0, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 57702.19, 'ca_data': 64399.0, 'ca_total': 125859.19, 'parc_global': 2474.0, 'parc_data': 1492.0, 'parc_2g': 983.0, 'parc_3g': 27.0, 'parc_4g': 498.0, 'parc_5g': 3.0, 'autre_parc': 72.0, 'trafic_data_in': 100381.695, 'trafic_voix_in': 11929.88, 'trafic_data_in_mo': 100.38169500000001, 'ca_mtd': 125859.19, 'ca_norm': 3775775.7, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 35397.63, 'ca_data': 35792.9, 'ca_total': 72989.53, 'parc_global': 1209.0, 'parc_data': 836.0, 'parc_2g': 516.0, 'parc_3g': 15.0, 'parc_4g': 264.0, 'parc_5g': 4.0, 'autre_parc': 65.0, 'trafic_data_in': 62178.35, 'trafic_voix_in': 13839.72, 'trafic_data_in_mo': 62.17835, 'ca_mtd': 72989.53, 'ca_norm': 2189685.9, 'mois': 6, 'annee': 6}  ... displaying 10 of 3107 total bound parameter sets ...  {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 178586.05, 'ca_data': 462131.2, 'ca_total': 667171.25, 'parc_global': 3331.0, 'parc_data': 2737.0, 'parc_2g': 165.0, 'parc_3g': 22.0, 'parc_4g': 1188.0, 'parc_5g': 113.0, 'autre_parc': 59.0, 'trafic_data_in': 1269518.1, 'trafic_voix_in': 36183.13, 'trafic_data_in_mo': 1269.5181, 'ca_mtd': 667171.25, 'ca_norm': 20015137.5, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 249111.7, 'ca_data': 468166.16, 'ca_total': 742102.9, 'parc_global': 3203.0, 'parc_data': 2847.0, 'parc_2g': 95.0, 'parc_3g': 18.0, 'parc_4g': 1256.0, 'parc_5g': 168.0, 'autre_parc': 76.0, 'trafic_data_in': 1167098.0, 'trafic_voix_in': 40619.5, 'trafic_data_in_mo': 1167.098, 'ca_mtd': 742102.9, 'ca_norm': 22263087.0, 'mois': 6, 'annee': 6})]
(Background on this error at: https://sqlalche.me/e/14/f405)
[2024-07-26T12:09:23.040+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-02T06:00:00+00:00, execution_date=20240602T060000, start_date=20240726T120921, end_date=20240726T120923
[2024-07-26T12:09:23.056+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-07-26T12:09:23.057+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-26T12:09:23.058+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-26T12:09:23.073+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-26T12:09:23.074+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-26T12:09:23.075+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1890, in _execute_context
    self.dialect.do_executemany(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/psycopg2.py", line 982, in do_executemany
    context._psycopg2_fetched_rows = xtras.execute_values(
                                     ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/psycopg2/extras.py", line 1299, in execute_values
    cur.execute(b''.join(parts))
psycopg2.errors.DatatypeMismatch: column "mois" is of type date but expression is of type integer
LINE 1: ...83.2, 53278.24, 1104.3832, 956035.44, 28681063.2, 6, 6),('20...
                                                             ^
HINT:  You will need to rewrite or cast the expression.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 137, in gen_motower_daily
    write_pg(PG_SAVE_HOST, PG_SAVE_DB, PG_SAVE_USER, PG_SAVE_PASSWORD, df_faits, "motower_daily_caparc_faits")
  File "/opt/airflow/dags/gps/common/rwpg.py", line 66, in write_pg
    data.to_sql(table, engine, index=False, if_exists = 'append')
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
           ^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
           ^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1385, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 334, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1577, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1953, in _execute_context
    self._handle_dbapi_exception(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2134, in _handle_dbapi_exception
    util.raise_(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/util/compat.py", line 211, in raise_
    raise exception
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1890, in _execute_context
    self.dialect.do_executemany(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/psycopg2.py", line 982, in do_executemany
    context._psycopg2_fetched_rows = xtras.execute_values(
                                     ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/psycopg2/extras.py", line 1299, in execute_values
    cur.execute(b''.join(parts))
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.DatatypeMismatch) column "mois" is of type date but expression is of type integer
LINE 1: ...83.2, 53278.24, 1104.3832, 956035.44, 28681063.2, 6, 6),('20...
                                                             ^
HINT:  You will need to rewrite or cast the expression.

[SQL: INSERT INTO motower_daily_caparc_faits (jour, ca_voix, ca_data, ca_total, parc_global, parc_data, parc_2g, parc_3g, parc_4g, parc_5g, autre_parc, trafic_data_in, trafic_voix_in, trafic_data_in_mo, ca_mtd, ca_norm, mois, annee) VALUES (%(jour)s, %(ca_voix)s, %(ca_data)s, %(ca_total)s, %(parc_global)s, %(parc_data)s, %(parc_2g)s, %(parc_3g)s, %(parc_4g)s, %(parc_5g)s, %(autre_parc)s, %(trafic_data_in)s, %(trafic_voix_in)s, %(trafic_data_in_mo)s, %(ca_mtd)s, %(ca_norm)s, %(mois)s, %(annee)s)]
[parameters: ({'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 319805.2, 'ca_data': 585246.5, 'ca_total': 956035.44, 'parc_global': 9514.0, 'parc_data': 6605.0, 'parc_2g': 2113.0, 'parc_3g': 93.0, 'parc_4g': 2550.0, 'parc_5g': 177.0, 'autre_parc': 407.0, 'trafic_data_in': 1104383.2, 'trafic_voix_in': 53278.24, 'trafic_data_in_mo': 1104.3832, 'ca_mtd': 956035.44, 'ca_norm': 28681063.2, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 82856.15, 'ca_data': 121609.5, 'ca_total': 215874.66, 'parc_global': 2254.0, 'parc_data': 1541.0, 'parc_2g': 658.0, 'parc_3g': 21.0, 'parc_4g': 517.0, 'parc_5g': 3.0, 'autre_parc': 86.0, 'trafic_data_in': 286305.0, 'trafic_voix_in': 15792.22, 'trafic_data_in_mo': 286.305, 'ca_mtd': 215874.66, 'ca_norm': 6476239.8, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 186713.81, 'ca_data': 283735.0, 'ca_total': 500731.8, 'parc_global': 4564.0, 'parc_data': 3088.0, 'parc_2g': 606.0, 'parc_3g': 22.0, 'parc_4g': 1036.0, 'parc_5g': 114.0, 'autre_parc': 114.0, 'trafic_data_in': 748361.56, 'trafic_voix_in': 24169.3, 'trafic_data_in_mo': 748.36156, 'ca_mtd': 500731.8, 'ca_norm': 15021954.0, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 212184.77, 'ca_data': 480902.84, 'ca_total': 709591.6, 'parc_global': 7900.0, 'parc_data': 4255.0, 'parc_2g': 1227.0, 'parc_3g': 52.0, 'parc_4g': 1630.0, 'parc_5g': 101.0, 'autre_parc': 211.0, 'trafic_data_in': 1410212.1, 'trafic_voix_in': 40453.93, 'trafic_data_in_mo': 1410.2121000000002, 'ca_mtd': 709591.6, 'ca_norm': 21287748.0, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': None, 'ca_data': None, 'ca_total': None, 'parc_global': None, 'parc_data': None, 'parc_2g': None, 'parc_3g': None, 'parc_4g': None, 'parc_5g': None, 'autre_parc': None, 'trafic_data_in': None, 'trafic_voix_in': None, 'trafic_data_in_mo': None, 'ca_mtd': None, 'ca_norm': None, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 78506.79, 'ca_data': 95793.31, 'ca_total': 183206.1, 'parc_global': 6831.0, 'parc_data': 1639.0, 'parc_2g': 1046.0, 'parc_3g': 50.0, 'parc_4g': 572.0, 'parc_5g': 9.0, 'autre_parc': 103.0, 'trafic_data_in': 237113.25, 'trafic_voix_in': 17435.01, 'trafic_data_in_mo': 237.11325, 'ca_mtd': 183206.1, 'ca_norm': 5496183.0, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 57702.19, 'ca_data': 64399.0, 'ca_total': 125859.19, 'parc_global': 2474.0, 'parc_data': 1492.0, 'parc_2g': 983.0, 'parc_3g': 27.0, 'parc_4g': 498.0, 'parc_5g': 3.0, 'autre_parc': 72.0, 'trafic_data_in': 100381.695, 'trafic_voix_in': 11929.88, 'trafic_data_in_mo': 100.38169500000001, 'ca_mtd': 125859.19, 'ca_norm': 3775775.7, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 35397.63, 'ca_data': 35792.9, 'ca_total': 72989.53, 'parc_global': 1209.0, 'parc_data': 836.0, 'parc_2g': 516.0, 'parc_3g': 15.0, 'parc_4g': 264.0, 'parc_5g': 4.0, 'autre_parc': 65.0, 'trafic_data_in': 62178.35, 'trafic_voix_in': 13839.72, 'trafic_data_in_mo': 62.17835, 'ca_mtd': 72989.53, 'ca_norm': 2189685.9, 'mois': 6, 'annee': 6}  ... displaying 10 of 3107 total bound parameter sets ...  {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 178586.05, 'ca_data': 462131.2, 'ca_total': 667171.25, 'parc_global': 3331.0, 'parc_data': 2737.0, 'parc_2g': 165.0, 'parc_3g': 22.0, 'parc_4g': 1188.0, 'parc_5g': 113.0, 'autre_parc': 59.0, 'trafic_data_in': 1269518.1, 'trafic_voix_in': 36183.13, 'trafic_data_in_mo': 1269.5181, 'ca_mtd': 667171.25, 'ca_norm': 20015137.5, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 249111.7, 'ca_data': 468166.16, 'ca_total': 742102.9, 'parc_global': 3203.0, 'parc_data': 2847.0, 'parc_2g': 95.0, 'parc_3g': 18.0, 'parc_4g': 1256.0, 'parc_5g': 168.0, 'autre_parc': 76.0, 'trafic_data_in': 1167098.0, 'trafic_voix_in': 40619.5, 'trafic_data_in_mo': 1167.098, 'ca_mtd': 742102.9, 'ca_norm': 22263087.0, 'mois': 6, 'annee': 6})]
(Background on this error at: https://sqlalche.me/e/14/f405)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-07-26T12:09:23.089+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-07-26T12:09:23.090+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-26T12:09:23.090+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-26T12:09:23.106+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 15 for task motower_dcaparc ((psycopg2.errors.DatatypeMismatch) column "mois" is of type date but expression is of type integer
LINE 1: ...83.2, 53278.24, 1104.3832, 956035.44, 28681063.2, 6, 6),('20...
                                                             ^
HINT:  You will need to rewrite or cast the expression.

[SQL: INSERT INTO motower_daily_caparc_faits (jour, ca_voix, ca_data, ca_total, parc_global, parc_data, parc_2g, parc_3g, parc_4g, parc_5g, autre_parc, trafic_data_in, trafic_voix_in, trafic_data_in_mo, ca_mtd, ca_norm, mois, annee) VALUES (%(jour)s, %(ca_voix)s, %(ca_data)s, %(ca_total)s, %(parc_global)s, %(parc_data)s, %(parc_2g)s, %(parc_3g)s, %(parc_4g)s, %(parc_5g)s, %(autre_parc)s, %(trafic_data_in)s, %(trafic_voix_in)s, %(trafic_data_in_mo)s, %(ca_mtd)s, %(ca_norm)s, %(mois)s, %(annee)s)]
[parameters: ({'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 319805.2, 'ca_data': 585246.5, 'ca_total': 956035.44, 'parc_global': 9514.0, 'parc_data': 6605.0, 'parc_2g': 2113.0, 'parc_3g': 93.0, 'parc_4g': 2550.0, 'parc_5g': 177.0, 'autre_parc': 407.0, 'trafic_data_in': 1104383.2, 'trafic_voix_in': 53278.24, 'trafic_data_in_mo': 1104.3832, 'ca_mtd': 956035.44, 'ca_norm': 28681063.2, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 82856.15, 'ca_data': 121609.5, 'ca_total': 215874.66, 'parc_global': 2254.0, 'parc_data': 1541.0, 'parc_2g': 658.0, 'parc_3g': 21.0, 'parc_4g': 517.0, 'parc_5g': 3.0, 'autre_parc': 86.0, 'trafic_data_in': 286305.0, 'trafic_voix_in': 15792.22, 'trafic_data_in_mo': 286.305, 'ca_mtd': 215874.66, 'ca_norm': 6476239.8, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 186713.81, 'ca_data': 283735.0, 'ca_total': 500731.8, 'parc_global': 4564.0, 'parc_data': 3088.0, 'parc_2g': 606.0, 'parc_3g': 22.0, 'parc_4g': 1036.0, 'parc_5g': 114.0, 'autre_parc': 114.0, 'trafic_data_in': 748361.56, 'trafic_voix_in': 24169.3, 'trafic_data_in_mo': 748.36156, 'ca_mtd': 500731.8, 'ca_norm': 15021954.0, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 212184.77, 'ca_data': 480902.84, 'ca_total': 709591.6, 'parc_global': 7900.0, 'parc_data': 4255.0, 'parc_2g': 1227.0, 'parc_3g': 52.0, 'parc_4g': 1630.0, 'parc_5g': 101.0, 'autre_parc': 211.0, 'trafic_data_in': 1410212.1, 'trafic_voix_in': 40453.93, 'trafic_data_in_mo': 1410.2121000000002, 'ca_mtd': 709591.6, 'ca_norm': 21287748.0, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': None, 'ca_data': None, 'ca_total': None, 'parc_global': None, 'parc_data': None, 'parc_2g': None, 'parc_3g': None, 'parc_4g': None, 'parc_5g': None, 'autre_parc': None, 'trafic_data_in': None, 'trafic_voix_in': None, 'trafic_data_in_mo': None, 'ca_mtd': None, 'ca_norm': None, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 78506.79, 'ca_data': 95793.31, 'ca_total': 183206.1, 'parc_global': 6831.0, 'parc_data': 1639.0, 'parc_2g': 1046.0, 'parc_3g': 50.0, 'parc_4g': 572.0, 'parc_5g': 9.0, 'autre_parc': 103.0, 'trafic_data_in': 237113.25, 'trafic_voix_in': 17435.01, 'trafic_data_in_mo': 237.11325, 'ca_mtd': 183206.1, 'ca_norm': 5496183.0, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 57702.19, 'ca_data': 64399.0, 'ca_total': 125859.19, 'parc_global': 2474.0, 'parc_data': 1492.0, 'parc_2g': 983.0, 'parc_3g': 27.0, 'parc_4g': 498.0, 'parc_5g': 3.0, 'autre_parc': 72.0, 'trafic_data_in': 100381.695, 'trafic_voix_in': 11929.88, 'trafic_data_in_mo': 100.38169500000001, 'ca_mtd': 125859.19, 'ca_norm': 3775775.7, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 35397.63, 'ca_data': 35792.9, 'ca_total': 72989.53, 'parc_global': 1209.0, 'parc_data': 836.0, 'parc_2g': 516.0, 'parc_3g': 15.0, 'parc_4g': 264.0, 'parc_5g': 4.0, 'autre_parc': 65.0, 'trafic_data_in': 62178.35, 'trafic_voix_in': 13839.72, 'trafic_data_in_mo': 62.17835, 'ca_mtd': 72989.53, 'ca_norm': 2189685.9, 'mois': 6, 'annee': 6}  ... displaying 10 of 3107 total bound parameter sets ...  {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 178586.05, 'ca_data': 462131.2, 'ca_total': 667171.25, 'parc_global': 3331.0, 'parc_data': 2737.0, 'parc_2g': 165.0, 'parc_3g': 22.0, 'parc_4g': 1188.0, 'parc_5g': 113.0, 'autre_parc': 59.0, 'trafic_data_in': 1269518.1, 'trafic_voix_in': 36183.13, 'trafic_data_in_mo': 1269.5181, 'ca_mtd': 667171.25, 'ca_norm': 20015137.5, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 249111.7, 'ca_data': 468166.16, 'ca_total': 742102.9, 'parc_global': 3203.0, 'parc_data': 2847.0, 'parc_2g': 95.0, 'parc_3g': 18.0, 'parc_4g': 1256.0, 'parc_5g': 168.0, 'autre_parc': 76.0, 'trafic_data_in': 1167098.0, 'trafic_voix_in': 40619.5, 'trafic_data_in_mo': 1167.098, 'ca_mtd': 742102.9, 'ca_norm': 22263087.0, 'mois': 6, 'annee': 6})]
(Background on this error at: https://sqlalche.me/e/14/f405); 236)
[2024-07-26T12:09:23.174+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-07-26T12:09:23.201+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-26T12:09:23.203+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-26T12:11:57.409+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-26T12:11:57.870+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-26T12:11:57.885+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-26T12:11:57.886+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-26T12:11:57.906+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-02 06:00:00+00:00
[2024-07-26T12:11:57.935+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=658) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-26T12:11:57.936+0000] {standard_task_runner.py:64} INFO - Started process 677 to run task
[2024-07-26T12:11:57.935+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-02T06:00:00+00:00', '--job-id', '152', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmp_32d2he7']
[2024-07-26T12:11:57.938+0000] {standard_task_runner.py:91} INFO - Job 152: Subtask motower_dcaparc
[2024-07-26T12:11:58.051+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [running]> on host 38513f9ed169
[2024-07-26T12:11:58.179+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-02T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-02T06:00:00+00:00'
[2024-07-26T12:11:58.180+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-26T12:11:58.205+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-26T12:11:58.220+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-26T12:11:58.292+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T12:11:58.295+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T12:11:58.295+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-01
[2024-07-26T12:11:58.295+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/01.csv
[2024-07-26T12:11:58.322+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240601  5.327182e+08  8.044059e+08  16715871    9176426  12042566   875452  5841327   297932     1379325  1.395652e+09
[2024-07-26T12:11:58.322+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T12:11:58.323+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T12:11:58.324+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T12:11:58.324+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T12:11:58.325+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T12:11:58.325+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T12:11:58.326+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-26T12:11:58.327+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-26T12:11:58.327+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T12:11:58.328+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T12:11:58.328+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-26T12:11:58.332+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-26T12:11:58.333+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-26T12:11:58.335+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-26T12:11:58.336+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-26T12:11:58.337+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-26T12:11:58.337+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-26T12:11:58.338+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-26T12:11:58.338+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-26T12:11:58.339+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-26T12:11:58.339+0000] {logging_mixin.py:188} INFO - 6
[2024-07-26T12:11:58.340+0000] {logging_mixin.py:188} INFO - 2024-06-01 00:00:00
[2024-07-26T12:11:58.351+0000] {motower_daily.py:200} INFO - ADD  SEGMENT
[2024-07-26T12:11:58.603+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-26T12:11:58.604+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T12:11:58.606+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T12:11:58.617+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-01  5.206589e+08  7.907621e+08   14770374.0  8934529.0  3810606.0  121316.0  3061852.0  193275.0    442619.0  1.368038e+09
[2024-07-26T12:11:58.618+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T12:11:58.619+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T12:11:58.620+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T12:11:58.620+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T12:11:58.621+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T12:11:58.621+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T12:11:58.622+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-26T12:11:58.622+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-26T12:11:58.622+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T12:11:58.623+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T12:11:58.654+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T12:11:58.685+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T12:11:58.693+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:133: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['mois'] = data["jour"].dt.month

[2024-07-26T12:11:58.694+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:134: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['annee'] = data["jour"].dt.month

[2024-07-26T12:11:59.131+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-26T12:11:59.132+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1890, in _execute_context
    self.dialect.do_executemany(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/psycopg2.py", line 982, in do_executemany
    context._psycopg2_fetched_rows = xtras.execute_values(
                                     ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/psycopg2/extras.py", line 1299, in execute_values
    cur.execute(b''.join(parts))
psycopg2.errors.DatatypeMismatch: column "mois" is of type date but expression is of type integer
LINE 1: ...83.2, 53278.24, 1104.3832, 956035.44, 28681063.2, 6, 6),('20...
                                                             ^
HINT:  You will need to rewrite or cast the expression.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 137, in gen_motower_daily
    write_pg(PG_SAVE_HOST, PG_SAVE_DB, PG_SAVE_USER, PG_SAVE_PASSWORD, df_faits, "motower_daily_caparc_faits")
  File "/opt/airflow/dags/gps/common/rwpg.py", line 66, in write_pg
    data.to_sql(table, engine, index=False, if_exists = 'append')
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
           ^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
           ^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1385, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 334, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1577, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1953, in _execute_context
    self._handle_dbapi_exception(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2134, in _handle_dbapi_exception
    util.raise_(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/util/compat.py", line 211, in raise_
    raise exception
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1890, in _execute_context
    self.dialect.do_executemany(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/psycopg2.py", line 982, in do_executemany
    context._psycopg2_fetched_rows = xtras.execute_values(
                                     ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/psycopg2/extras.py", line 1299, in execute_values
    cur.execute(b''.join(parts))
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.DatatypeMismatch) column "mois" is of type date but expression is of type integer
LINE 1: ...83.2, 53278.24, 1104.3832, 956035.44, 28681063.2, 6, 6),('20...
                                                             ^
HINT:  You will need to rewrite or cast the expression.

[SQL: INSERT INTO motower_daily_caparc_faits (jour, ca_voix, ca_data, ca_total, parc_global, parc_data, parc_2g, parc_3g, parc_4g, parc_5g, autre_parc, trafic_data_in, trafic_voix_in, trafic_data_in_mo, ca_mtd, ca_norm, mois, annee) VALUES (%(jour)s, %(ca_voix)s, %(ca_data)s, %(ca_total)s, %(parc_global)s, %(parc_data)s, %(parc_2g)s, %(parc_3g)s, %(parc_4g)s, %(parc_5g)s, %(autre_parc)s, %(trafic_data_in)s, %(trafic_voix_in)s, %(trafic_data_in_mo)s, %(ca_mtd)s, %(ca_norm)s, %(mois)s, %(annee)s)]
[parameters: ({'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 319805.2, 'ca_data': 585246.5, 'ca_total': 956035.44, 'parc_global': 9514.0, 'parc_data': 6605.0, 'parc_2g': 2113.0, 'parc_3g': 93.0, 'parc_4g': 2550.0, 'parc_5g': 177.0, 'autre_parc': 407.0, 'trafic_data_in': 1104383.2, 'trafic_voix_in': 53278.24, 'trafic_data_in_mo': 1104.3832, 'ca_mtd': 956035.44, 'ca_norm': 28681063.2, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 82856.15, 'ca_data': 121609.5, 'ca_total': 215874.66, 'parc_global': 2254.0, 'parc_data': 1541.0, 'parc_2g': 658.0, 'parc_3g': 21.0, 'parc_4g': 517.0, 'parc_5g': 3.0, 'autre_parc': 86.0, 'trafic_data_in': 286305.0, 'trafic_voix_in': 15792.22, 'trafic_data_in_mo': 286.305, 'ca_mtd': 215874.66, 'ca_norm': 6476239.8, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 186713.81, 'ca_data': 283735.0, 'ca_total': 500731.8, 'parc_global': 4564.0, 'parc_data': 3088.0, 'parc_2g': 606.0, 'parc_3g': 22.0, 'parc_4g': 1036.0, 'parc_5g': 114.0, 'autre_parc': 114.0, 'trafic_data_in': 748361.56, 'trafic_voix_in': 24169.3, 'trafic_data_in_mo': 748.36156, 'ca_mtd': 500731.8, 'ca_norm': 15021954.0, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 212184.77, 'ca_data': 480902.84, 'ca_total': 709591.6, 'parc_global': 7900.0, 'parc_data': 4255.0, 'parc_2g': 1227.0, 'parc_3g': 52.0, 'parc_4g': 1630.0, 'parc_5g': 101.0, 'autre_parc': 211.0, 'trafic_data_in': 1410212.1, 'trafic_voix_in': 40453.93, 'trafic_data_in_mo': 1410.2121000000002, 'ca_mtd': 709591.6, 'ca_norm': 21287748.0, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': None, 'ca_data': None, 'ca_total': None, 'parc_global': None, 'parc_data': None, 'parc_2g': None, 'parc_3g': None, 'parc_4g': None, 'parc_5g': None, 'autre_parc': None, 'trafic_data_in': None, 'trafic_voix_in': None, 'trafic_data_in_mo': None, 'ca_mtd': None, 'ca_norm': None, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 78506.79, 'ca_data': 95793.31, 'ca_total': 183206.1, 'parc_global': 6831.0, 'parc_data': 1639.0, 'parc_2g': 1046.0, 'parc_3g': 50.0, 'parc_4g': 572.0, 'parc_5g': 9.0, 'autre_parc': 103.0, 'trafic_data_in': 237113.25, 'trafic_voix_in': 17435.01, 'trafic_data_in_mo': 237.11325, 'ca_mtd': 183206.1, 'ca_norm': 5496183.0, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 57702.19, 'ca_data': 64399.0, 'ca_total': 125859.19, 'parc_global': 2474.0, 'parc_data': 1492.0, 'parc_2g': 983.0, 'parc_3g': 27.0, 'parc_4g': 498.0, 'parc_5g': 3.0, 'autre_parc': 72.0, 'trafic_data_in': 100381.695, 'trafic_voix_in': 11929.88, 'trafic_data_in_mo': 100.38169500000001, 'ca_mtd': 125859.19, 'ca_norm': 3775775.7, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 35397.63, 'ca_data': 35792.9, 'ca_total': 72989.53, 'parc_global': 1209.0, 'parc_data': 836.0, 'parc_2g': 516.0, 'parc_3g': 15.0, 'parc_4g': 264.0, 'parc_5g': 4.0, 'autre_parc': 65.0, 'trafic_data_in': 62178.35, 'trafic_voix_in': 13839.72, 'trafic_data_in_mo': 62.17835, 'ca_mtd': 72989.53, 'ca_norm': 2189685.9, 'mois': 6, 'annee': 6}  ... displaying 10 of 3107 total bound parameter sets ...  {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 178586.05, 'ca_data': 462131.2, 'ca_total': 667171.25, 'parc_global': 3331.0, 'parc_data': 2737.0, 'parc_2g': 165.0, 'parc_3g': 22.0, 'parc_4g': 1188.0, 'parc_5g': 113.0, 'autre_parc': 59.0, 'trafic_data_in': 1269518.1, 'trafic_voix_in': 36183.13, 'trafic_data_in_mo': 1269.5181, 'ca_mtd': 667171.25, 'ca_norm': 20015137.5, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 249111.7, 'ca_data': 468166.16, 'ca_total': 742102.9, 'parc_global': 3203.0, 'parc_data': 2847.0, 'parc_2g': 95.0, 'parc_3g': 18.0, 'parc_4g': 1256.0, 'parc_5g': 168.0, 'autre_parc': 76.0, 'trafic_data_in': 1167098.0, 'trafic_voix_in': 40619.5, 'trafic_data_in_mo': 1167.098, 'ca_mtd': 742102.9, 'ca_norm': 22263087.0, 'mois': 6, 'annee': 6})]
(Background on this error at: https://sqlalche.me/e/14/f405)
[2024-07-26T12:11:59.150+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-02T06:00:00+00:00, execution_date=20240602T060000, start_date=20240726T121157, end_date=20240726T121159
[2024-07-26T12:11:59.171+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-07-26T12:11:59.172+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-26T12:11:59.173+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-26T12:11:59.185+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-26T12:11:59.186+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-26T12:11:59.187+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1890, in _execute_context
    self.dialect.do_executemany(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/psycopg2.py", line 982, in do_executemany
    context._psycopg2_fetched_rows = xtras.execute_values(
                                     ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/psycopg2/extras.py", line 1299, in execute_values
    cur.execute(b''.join(parts))
psycopg2.errors.DatatypeMismatch: column "mois" is of type date but expression is of type integer
LINE 1: ...83.2, 53278.24, 1104.3832, 956035.44, 28681063.2, 6, 6),('20...
                                                             ^
HINT:  You will need to rewrite or cast the expression.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 137, in gen_motower_daily
    write_pg(PG_SAVE_HOST, PG_SAVE_DB, PG_SAVE_USER, PG_SAVE_PASSWORD, df_faits, "motower_daily_caparc_faits")
  File "/opt/airflow/dags/gps/common/rwpg.py", line 66, in write_pg
    data.to_sql(table, engine, index=False, if_exists = 'append')
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
           ^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
           ^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1385, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 334, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1577, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1953, in _execute_context
    self._handle_dbapi_exception(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2134, in _handle_dbapi_exception
    util.raise_(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/util/compat.py", line 211, in raise_
    raise exception
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1890, in _execute_context
    self.dialect.do_executemany(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/psycopg2.py", line 982, in do_executemany
    context._psycopg2_fetched_rows = xtras.execute_values(
                                     ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/psycopg2/extras.py", line 1299, in execute_values
    cur.execute(b''.join(parts))
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.DatatypeMismatch) column "mois" is of type date but expression is of type integer
LINE 1: ...83.2, 53278.24, 1104.3832, 956035.44, 28681063.2, 6, 6),('20...
                                                             ^
HINT:  You will need to rewrite or cast the expression.

[SQL: INSERT INTO motower_daily_caparc_faits (jour, ca_voix, ca_data, ca_total, parc_global, parc_data, parc_2g, parc_3g, parc_4g, parc_5g, autre_parc, trafic_data_in, trafic_voix_in, trafic_data_in_mo, ca_mtd, ca_norm, mois, annee) VALUES (%(jour)s, %(ca_voix)s, %(ca_data)s, %(ca_total)s, %(parc_global)s, %(parc_data)s, %(parc_2g)s, %(parc_3g)s, %(parc_4g)s, %(parc_5g)s, %(autre_parc)s, %(trafic_data_in)s, %(trafic_voix_in)s, %(trafic_data_in_mo)s, %(ca_mtd)s, %(ca_norm)s, %(mois)s, %(annee)s)]
[parameters: ({'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 319805.2, 'ca_data': 585246.5, 'ca_total': 956035.44, 'parc_global': 9514.0, 'parc_data': 6605.0, 'parc_2g': 2113.0, 'parc_3g': 93.0, 'parc_4g': 2550.0, 'parc_5g': 177.0, 'autre_parc': 407.0, 'trafic_data_in': 1104383.2, 'trafic_voix_in': 53278.24, 'trafic_data_in_mo': 1104.3832, 'ca_mtd': 956035.44, 'ca_norm': 28681063.2, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 82856.15, 'ca_data': 121609.5, 'ca_total': 215874.66, 'parc_global': 2254.0, 'parc_data': 1541.0, 'parc_2g': 658.0, 'parc_3g': 21.0, 'parc_4g': 517.0, 'parc_5g': 3.0, 'autre_parc': 86.0, 'trafic_data_in': 286305.0, 'trafic_voix_in': 15792.22, 'trafic_data_in_mo': 286.305, 'ca_mtd': 215874.66, 'ca_norm': 6476239.8, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 186713.81, 'ca_data': 283735.0, 'ca_total': 500731.8, 'parc_global': 4564.0, 'parc_data': 3088.0, 'parc_2g': 606.0, 'parc_3g': 22.0, 'parc_4g': 1036.0, 'parc_5g': 114.0, 'autre_parc': 114.0, 'trafic_data_in': 748361.56, 'trafic_voix_in': 24169.3, 'trafic_data_in_mo': 748.36156, 'ca_mtd': 500731.8, 'ca_norm': 15021954.0, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 212184.77, 'ca_data': 480902.84, 'ca_total': 709591.6, 'parc_global': 7900.0, 'parc_data': 4255.0, 'parc_2g': 1227.0, 'parc_3g': 52.0, 'parc_4g': 1630.0, 'parc_5g': 101.0, 'autre_parc': 211.0, 'trafic_data_in': 1410212.1, 'trafic_voix_in': 40453.93, 'trafic_data_in_mo': 1410.2121000000002, 'ca_mtd': 709591.6, 'ca_norm': 21287748.0, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': None, 'ca_data': None, 'ca_total': None, 'parc_global': None, 'parc_data': None, 'parc_2g': None, 'parc_3g': None, 'parc_4g': None, 'parc_5g': None, 'autre_parc': None, 'trafic_data_in': None, 'trafic_voix_in': None, 'trafic_data_in_mo': None, 'ca_mtd': None, 'ca_norm': None, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 78506.79, 'ca_data': 95793.31, 'ca_total': 183206.1, 'parc_global': 6831.0, 'parc_data': 1639.0, 'parc_2g': 1046.0, 'parc_3g': 50.0, 'parc_4g': 572.0, 'parc_5g': 9.0, 'autre_parc': 103.0, 'trafic_data_in': 237113.25, 'trafic_voix_in': 17435.01, 'trafic_data_in_mo': 237.11325, 'ca_mtd': 183206.1, 'ca_norm': 5496183.0, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 57702.19, 'ca_data': 64399.0, 'ca_total': 125859.19, 'parc_global': 2474.0, 'parc_data': 1492.0, 'parc_2g': 983.0, 'parc_3g': 27.0, 'parc_4g': 498.0, 'parc_5g': 3.0, 'autre_parc': 72.0, 'trafic_data_in': 100381.695, 'trafic_voix_in': 11929.88, 'trafic_data_in_mo': 100.38169500000001, 'ca_mtd': 125859.19, 'ca_norm': 3775775.7, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 35397.63, 'ca_data': 35792.9, 'ca_total': 72989.53, 'parc_global': 1209.0, 'parc_data': 836.0, 'parc_2g': 516.0, 'parc_3g': 15.0, 'parc_4g': 264.0, 'parc_5g': 4.0, 'autre_parc': 65.0, 'trafic_data_in': 62178.35, 'trafic_voix_in': 13839.72, 'trafic_data_in_mo': 62.17835, 'ca_mtd': 72989.53, 'ca_norm': 2189685.9, 'mois': 6, 'annee': 6}  ... displaying 10 of 3107 total bound parameter sets ...  {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 178586.05, 'ca_data': 462131.2, 'ca_total': 667171.25, 'parc_global': 3331.0, 'parc_data': 2737.0, 'parc_2g': 165.0, 'parc_3g': 22.0, 'parc_4g': 1188.0, 'parc_5g': 113.0, 'autre_parc': 59.0, 'trafic_data_in': 1269518.1, 'trafic_voix_in': 36183.13, 'trafic_data_in_mo': 1269.5181, 'ca_mtd': 667171.25, 'ca_norm': 20015137.5, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 249111.7, 'ca_data': 468166.16, 'ca_total': 742102.9, 'parc_global': 3203.0, 'parc_data': 2847.0, 'parc_2g': 95.0, 'parc_3g': 18.0, 'parc_4g': 1256.0, 'parc_5g': 168.0, 'autre_parc': 76.0, 'trafic_data_in': 1167098.0, 'trafic_voix_in': 40619.5, 'trafic_data_in_mo': 1167.098, 'ca_mtd': 742102.9, 'ca_norm': 22263087.0, 'mois': 6, 'annee': 6})]
(Background on this error at: https://sqlalche.me/e/14/f405)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-07-26T12:11:59.197+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-07-26T12:11:59.198+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-26T12:11:59.198+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-26T12:11:59.630+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 152 for task motower_dcaparc ((psycopg2.errors.DatatypeMismatch) column "mois" is of type date but expression is of type integer
LINE 1: ...83.2, 53278.24, 1104.3832, 956035.44, 28681063.2, 6, 6),('20...
                                                             ^
HINT:  You will need to rewrite or cast the expression.

[SQL: INSERT INTO motower_daily_caparc_faits (jour, ca_voix, ca_data, ca_total, parc_global, parc_data, parc_2g, parc_3g, parc_4g, parc_5g, autre_parc, trafic_data_in, trafic_voix_in, trafic_data_in_mo, ca_mtd, ca_norm, mois, annee) VALUES (%(jour)s, %(ca_voix)s, %(ca_data)s, %(ca_total)s, %(parc_global)s, %(parc_data)s, %(parc_2g)s, %(parc_3g)s, %(parc_4g)s, %(parc_5g)s, %(autre_parc)s, %(trafic_data_in)s, %(trafic_voix_in)s, %(trafic_data_in_mo)s, %(ca_mtd)s, %(ca_norm)s, %(mois)s, %(annee)s)]
[parameters: ({'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 319805.2, 'ca_data': 585246.5, 'ca_total': 956035.44, 'parc_global': 9514.0, 'parc_data': 6605.0, 'parc_2g': 2113.0, 'parc_3g': 93.0, 'parc_4g': 2550.0, 'parc_5g': 177.0, 'autre_parc': 407.0, 'trafic_data_in': 1104383.2, 'trafic_voix_in': 53278.24, 'trafic_data_in_mo': 1104.3832, 'ca_mtd': 956035.44, 'ca_norm': 28681063.2, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 82856.15, 'ca_data': 121609.5, 'ca_total': 215874.66, 'parc_global': 2254.0, 'parc_data': 1541.0, 'parc_2g': 658.0, 'parc_3g': 21.0, 'parc_4g': 517.0, 'parc_5g': 3.0, 'autre_parc': 86.0, 'trafic_data_in': 286305.0, 'trafic_voix_in': 15792.22, 'trafic_data_in_mo': 286.305, 'ca_mtd': 215874.66, 'ca_norm': 6476239.8, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 186713.81, 'ca_data': 283735.0, 'ca_total': 500731.8, 'parc_global': 4564.0, 'parc_data': 3088.0, 'parc_2g': 606.0, 'parc_3g': 22.0, 'parc_4g': 1036.0, 'parc_5g': 114.0, 'autre_parc': 114.0, 'trafic_data_in': 748361.56, 'trafic_voix_in': 24169.3, 'trafic_data_in_mo': 748.36156, 'ca_mtd': 500731.8, 'ca_norm': 15021954.0, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 212184.77, 'ca_data': 480902.84, 'ca_total': 709591.6, 'parc_global': 7900.0, 'parc_data': 4255.0, 'parc_2g': 1227.0, 'parc_3g': 52.0, 'parc_4g': 1630.0, 'parc_5g': 101.0, 'autre_parc': 211.0, 'trafic_data_in': 1410212.1, 'trafic_voix_in': 40453.93, 'trafic_data_in_mo': 1410.2121000000002, 'ca_mtd': 709591.6, 'ca_norm': 21287748.0, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': None, 'ca_data': None, 'ca_total': None, 'parc_global': None, 'parc_data': None, 'parc_2g': None, 'parc_3g': None, 'parc_4g': None, 'parc_5g': None, 'autre_parc': None, 'trafic_data_in': None, 'trafic_voix_in': None, 'trafic_data_in_mo': None, 'ca_mtd': None, 'ca_norm': None, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 78506.79, 'ca_data': 95793.31, 'ca_total': 183206.1, 'parc_global': 6831.0, 'parc_data': 1639.0, 'parc_2g': 1046.0, 'parc_3g': 50.0, 'parc_4g': 572.0, 'parc_5g': 9.0, 'autre_parc': 103.0, 'trafic_data_in': 237113.25, 'trafic_voix_in': 17435.01, 'trafic_data_in_mo': 237.11325, 'ca_mtd': 183206.1, 'ca_norm': 5496183.0, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 57702.19, 'ca_data': 64399.0, 'ca_total': 125859.19, 'parc_global': 2474.0, 'parc_data': 1492.0, 'parc_2g': 983.0, 'parc_3g': 27.0, 'parc_4g': 498.0, 'parc_5g': 3.0, 'autre_parc': 72.0, 'trafic_data_in': 100381.695, 'trafic_voix_in': 11929.88, 'trafic_data_in_mo': 100.38169500000001, 'ca_mtd': 125859.19, 'ca_norm': 3775775.7, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 35397.63, 'ca_data': 35792.9, 'ca_total': 72989.53, 'parc_global': 1209.0, 'parc_data': 836.0, 'parc_2g': 516.0, 'parc_3g': 15.0, 'parc_4g': 264.0, 'parc_5g': 4.0, 'autre_parc': 65.0, 'trafic_data_in': 62178.35, 'trafic_voix_in': 13839.72, 'trafic_data_in_mo': 62.17835, 'ca_mtd': 72989.53, 'ca_norm': 2189685.9, 'mois': 6, 'annee': 6}  ... displaying 10 of 3107 total bound parameter sets ...  {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 178586.05, 'ca_data': 462131.2, 'ca_total': 667171.25, 'parc_global': 3331.0, 'parc_data': 2737.0, 'parc_2g': 165.0, 'parc_3g': 22.0, 'parc_4g': 1188.0, 'parc_5g': 113.0, 'autre_parc': 59.0, 'trafic_data_in': 1269518.1, 'trafic_voix_in': 36183.13, 'trafic_data_in_mo': 1269.5181, 'ca_mtd': 667171.25, 'ca_norm': 20015137.5, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 249111.7, 'ca_data': 468166.16, 'ca_total': 742102.9, 'parc_global': 3203.0, 'parc_data': 2847.0, 'parc_2g': 95.0, 'parc_3g': 18.0, 'parc_4g': 1256.0, 'parc_5g': 168.0, 'autre_parc': 76.0, 'trafic_data_in': 1167098.0, 'trafic_voix_in': 40619.5, 'trafic_data_in_mo': 1167.098, 'ca_mtd': 742102.9, 'ca_norm': 22263087.0, 'mois': 6, 'annee': 6})]
(Background on this error at: https://sqlalche.me/e/14/f405); 677)
[2024-07-26T12:11:59.735+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-07-26T12:11:59.767+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-26T12:11:59.772+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-26T12:17:51.068+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-26T12:17:51.102+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-26T12:17:51.114+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-26T12:17:51.115+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-26T12:17:51.134+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-02 06:00:00+00:00
[2024-07-26T12:17:51.151+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=119) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-26T12:17:51.153+0000] {standard_task_runner.py:64} INFO - Started process 140 to run task
[2024-07-26T12:17:51.153+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-02T06:00:00+00:00', '--job-id', '18', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpsrehydty']
[2024-07-26T12:17:51.155+0000] {standard_task_runner.py:91} INFO - Job 18: Subtask motower_dcaparc
[2024-07-26T12:17:51.209+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [running]> on host 88c2b04746a4
[2024-07-26T12:17:51.321+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-02T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-02T06:00:00+00:00'
[2024-07-26T12:17:51.322+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-26T12:17:51.338+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-26T12:17:51.352+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-26T12:17:51.414+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T12:17:51.416+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T12:17:51.416+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-01
[2024-07-26T12:17:51.416+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/01.csv
[2024-07-26T12:17:51.441+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240601  5.327182e+08  8.044059e+08  16715871    9176426  12042566   875452  5841327   297932     1379325  1.395652e+09
[2024-07-26T12:17:51.442+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T12:17:51.443+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T12:17:51.443+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T12:17:51.444+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T12:17:51.444+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T12:17:51.445+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T12:17:51.445+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-26T12:17:51.446+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-26T12:17:51.446+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T12:17:51.446+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T12:17:51.447+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-26T12:17:51.450+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-26T12:17:51.451+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-26T12:17:51.453+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-26T12:17:51.454+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-26T12:17:51.455+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-26T12:17:51.455+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-26T12:17:51.456+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-26T12:17:51.456+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-26T12:17:51.456+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-26T12:17:51.457+0000] {logging_mixin.py:188} INFO - 6
[2024-07-26T12:17:51.457+0000] {logging_mixin.py:188} INFO - 2024-06-01 00:00:00
[2024-07-26T12:17:51.466+0000] {motower_daily.py:200} INFO - ADD  SEGMENT
[2024-07-26T12:17:51.607+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-26T12:17:51.607+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T12:17:51.608+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T12:17:51.616+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-01  5.206589e+08  7.907621e+08   14770374.0  8934529.0  3810606.0  121316.0  3061852.0  193275.0    442619.0  1.368038e+09
[2024-07-26T12:17:51.616+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T12:17:51.617+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T12:17:51.617+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T12:17:51.618+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T12:17:51.618+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T12:17:51.619+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T12:17:51.619+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-26T12:17:51.619+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-26T12:17:51.620+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T12:17:51.620+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T12:17:51.646+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T12:17:51.673+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T12:17:51.681+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:133: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['mois'] = data["jour"].dt.month

[2024-07-26T12:17:51.682+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:134: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['annee'] = data["jour"].dt.month

[2024-07-26T12:17:51.980+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-26T12:17:51.980+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1890, in _execute_context
    self.dialect.do_executemany(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/psycopg2.py", line 982, in do_executemany
    context._psycopg2_fetched_rows = xtras.execute_values(
                                     ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/psycopg2/extras.py", line 1299, in execute_values
    cur.execute(b''.join(parts))
psycopg2.errors.DatatypeMismatch: column "mois" is of type date but expression is of type integer
LINE 1: ...83.2, 53278.24, 1104.3832, 956035.44, 28681063.2, 6, 6),('20...
                                                             ^
HINT:  You will need to rewrite or cast the expression.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 137, in gen_motower_daily
    write_pg(PG_SAVE_HOST, PG_SAVE_DB, PG_SAVE_USER, PG_SAVE_PASSWORD, df_faits, "motower_daily_caparc_faits")
  File "/opt/airflow/dags/gps/common/rwpg.py", line 66, in write_pg
    data.to_sql(table, engine, index=False, if_exists = 'append')
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
           ^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
           ^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1385, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 334, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1577, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1953, in _execute_context
    self._handle_dbapi_exception(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2134, in _handle_dbapi_exception
    util.raise_(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/util/compat.py", line 211, in raise_
    raise exception
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1890, in _execute_context
    self.dialect.do_executemany(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/psycopg2.py", line 982, in do_executemany
    context._psycopg2_fetched_rows = xtras.execute_values(
                                     ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/psycopg2/extras.py", line 1299, in execute_values
    cur.execute(b''.join(parts))
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.DatatypeMismatch) column "mois" is of type date but expression is of type integer
LINE 1: ...83.2, 53278.24, 1104.3832, 956035.44, 28681063.2, 6, 6),('20...
                                                             ^
HINT:  You will need to rewrite or cast the expression.

[SQL: INSERT INTO motower_daily_caparc_faits (jour, ca_voix, ca_data, ca_total, parc_global, parc_data, parc_2g, parc_3g, parc_4g, parc_5g, autre_parc, trafic_data_in, trafic_voix_in, trafic_data_in_mo, ca_mtd, ca_norm, mois, annee) VALUES (%(jour)s, %(ca_voix)s, %(ca_data)s, %(ca_total)s, %(parc_global)s, %(parc_data)s, %(parc_2g)s, %(parc_3g)s, %(parc_4g)s, %(parc_5g)s, %(autre_parc)s, %(trafic_data_in)s, %(trafic_voix_in)s, %(trafic_data_in_mo)s, %(ca_mtd)s, %(ca_norm)s, %(mois)s, %(annee)s)]
[parameters: ({'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 319805.2, 'ca_data': 585246.5, 'ca_total': 956035.44, 'parc_global': 9514.0, 'parc_data': 6605.0, 'parc_2g': 2113.0, 'parc_3g': 93.0, 'parc_4g': 2550.0, 'parc_5g': 177.0, 'autre_parc': 407.0, 'trafic_data_in': 1104383.2, 'trafic_voix_in': 53278.24, 'trafic_data_in_mo': 1104.3832, 'ca_mtd': 956035.44, 'ca_norm': 28681063.2, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 82856.15, 'ca_data': 121609.5, 'ca_total': 215874.66, 'parc_global': 2254.0, 'parc_data': 1541.0, 'parc_2g': 658.0, 'parc_3g': 21.0, 'parc_4g': 517.0, 'parc_5g': 3.0, 'autre_parc': 86.0, 'trafic_data_in': 286305.0, 'trafic_voix_in': 15792.22, 'trafic_data_in_mo': 286.305, 'ca_mtd': 215874.66, 'ca_norm': 6476239.8, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 186713.81, 'ca_data': 283735.0, 'ca_total': 500731.8, 'parc_global': 4564.0, 'parc_data': 3088.0, 'parc_2g': 606.0, 'parc_3g': 22.0, 'parc_4g': 1036.0, 'parc_5g': 114.0, 'autre_parc': 114.0, 'trafic_data_in': 748361.56, 'trafic_voix_in': 24169.3, 'trafic_data_in_mo': 748.36156, 'ca_mtd': 500731.8, 'ca_norm': 15021954.0, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 212184.77, 'ca_data': 480902.84, 'ca_total': 709591.6, 'parc_global': 7900.0, 'parc_data': 4255.0, 'parc_2g': 1227.0, 'parc_3g': 52.0, 'parc_4g': 1630.0, 'parc_5g': 101.0, 'autre_parc': 211.0, 'trafic_data_in': 1410212.1, 'trafic_voix_in': 40453.93, 'trafic_data_in_mo': 1410.2121000000002, 'ca_mtd': 709591.6, 'ca_norm': 21287748.0, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': None, 'ca_data': None, 'ca_total': None, 'parc_global': None, 'parc_data': None, 'parc_2g': None, 'parc_3g': None, 'parc_4g': None, 'parc_5g': None, 'autre_parc': None, 'trafic_data_in': None, 'trafic_voix_in': None, 'trafic_data_in_mo': None, 'ca_mtd': None, 'ca_norm': None, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 78506.79, 'ca_data': 95793.31, 'ca_total': 183206.1, 'parc_global': 6831.0, 'parc_data': 1639.0, 'parc_2g': 1046.0, 'parc_3g': 50.0, 'parc_4g': 572.0, 'parc_5g': 9.0, 'autre_parc': 103.0, 'trafic_data_in': 237113.25, 'trafic_voix_in': 17435.01, 'trafic_data_in_mo': 237.11325, 'ca_mtd': 183206.1, 'ca_norm': 5496183.0, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 57702.19, 'ca_data': 64399.0, 'ca_total': 125859.19, 'parc_global': 2474.0, 'parc_data': 1492.0, 'parc_2g': 983.0, 'parc_3g': 27.0, 'parc_4g': 498.0, 'parc_5g': 3.0, 'autre_parc': 72.0, 'trafic_data_in': 100381.695, 'trafic_voix_in': 11929.88, 'trafic_data_in_mo': 100.38169500000001, 'ca_mtd': 125859.19, 'ca_norm': 3775775.7, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 35397.63, 'ca_data': 35792.9, 'ca_total': 72989.53, 'parc_global': 1209.0, 'parc_data': 836.0, 'parc_2g': 516.0, 'parc_3g': 15.0, 'parc_4g': 264.0, 'parc_5g': 4.0, 'autre_parc': 65.0, 'trafic_data_in': 62178.35, 'trafic_voix_in': 13839.72, 'trafic_data_in_mo': 62.17835, 'ca_mtd': 72989.53, 'ca_norm': 2189685.9, 'mois': 6, 'annee': 6}  ... displaying 10 of 3107 total bound parameter sets ...  {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 178586.05, 'ca_data': 462131.2, 'ca_total': 667171.25, 'parc_global': 3331.0, 'parc_data': 2737.0, 'parc_2g': 165.0, 'parc_3g': 22.0, 'parc_4g': 1188.0, 'parc_5g': 113.0, 'autre_parc': 59.0, 'trafic_data_in': 1269518.1, 'trafic_voix_in': 36183.13, 'trafic_data_in_mo': 1269.5181, 'ca_mtd': 667171.25, 'ca_norm': 20015137.5, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 249111.7, 'ca_data': 468166.16, 'ca_total': 742102.9, 'parc_global': 3203.0, 'parc_data': 2847.0, 'parc_2g': 95.0, 'parc_3g': 18.0, 'parc_4g': 1256.0, 'parc_5g': 168.0, 'autre_parc': 76.0, 'trafic_data_in': 1167098.0, 'trafic_voix_in': 40619.5, 'trafic_data_in_mo': 1167.098, 'ca_mtd': 742102.9, 'ca_norm': 22263087.0, 'mois': 6, 'annee': 6})]
(Background on this error at: https://sqlalche.me/e/14/f405)
[2024-07-26T12:17:51.992+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-02T06:00:00+00:00, execution_date=20240602T060000, start_date=20240726T121751, end_date=20240726T121751
[2024-07-26T12:17:52.003+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-07-26T12:17:52.004+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-26T12:17:52.004+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-26T12:17:52.011+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-26T12:17:52.011+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-26T12:17:52.011+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1890, in _execute_context
    self.dialect.do_executemany(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/psycopg2.py", line 982, in do_executemany
    context._psycopg2_fetched_rows = xtras.execute_values(
                                     ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/psycopg2/extras.py", line 1299, in execute_values
    cur.execute(b''.join(parts))
psycopg2.errors.DatatypeMismatch: column "mois" is of type date but expression is of type integer
LINE 1: ...83.2, 53278.24, 1104.3832, 956035.44, 28681063.2, 6, 6),('20...
                                                             ^
HINT:  You will need to rewrite or cast the expression.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 137, in gen_motower_daily
    write_pg(PG_SAVE_HOST, PG_SAVE_DB, PG_SAVE_USER, PG_SAVE_PASSWORD, df_faits, "motower_daily_caparc_faits")
  File "/opt/airflow/dags/gps/common/rwpg.py", line 66, in write_pg
    data.to_sql(table, engine, index=False, if_exists = 'append')
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
           ^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
           ^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1385, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 334, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1577, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1953, in _execute_context
    self._handle_dbapi_exception(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2134, in _handle_dbapi_exception
    util.raise_(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/util/compat.py", line 211, in raise_
    raise exception
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1890, in _execute_context
    self.dialect.do_executemany(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/psycopg2.py", line 982, in do_executemany
    context._psycopg2_fetched_rows = xtras.execute_values(
                                     ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/psycopg2/extras.py", line 1299, in execute_values
    cur.execute(b''.join(parts))
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.DatatypeMismatch) column "mois" is of type date but expression is of type integer
LINE 1: ...83.2, 53278.24, 1104.3832, 956035.44, 28681063.2, 6, 6),('20...
                                                             ^
HINT:  You will need to rewrite or cast the expression.

[SQL: INSERT INTO motower_daily_caparc_faits (jour, ca_voix, ca_data, ca_total, parc_global, parc_data, parc_2g, parc_3g, parc_4g, parc_5g, autre_parc, trafic_data_in, trafic_voix_in, trafic_data_in_mo, ca_mtd, ca_norm, mois, annee) VALUES (%(jour)s, %(ca_voix)s, %(ca_data)s, %(ca_total)s, %(parc_global)s, %(parc_data)s, %(parc_2g)s, %(parc_3g)s, %(parc_4g)s, %(parc_5g)s, %(autre_parc)s, %(trafic_data_in)s, %(trafic_voix_in)s, %(trafic_data_in_mo)s, %(ca_mtd)s, %(ca_norm)s, %(mois)s, %(annee)s)]
[parameters: ({'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 319805.2, 'ca_data': 585246.5, 'ca_total': 956035.44, 'parc_global': 9514.0, 'parc_data': 6605.0, 'parc_2g': 2113.0, 'parc_3g': 93.0, 'parc_4g': 2550.0, 'parc_5g': 177.0, 'autre_parc': 407.0, 'trafic_data_in': 1104383.2, 'trafic_voix_in': 53278.24, 'trafic_data_in_mo': 1104.3832, 'ca_mtd': 956035.44, 'ca_norm': 28681063.2, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 82856.15, 'ca_data': 121609.5, 'ca_total': 215874.66, 'parc_global': 2254.0, 'parc_data': 1541.0, 'parc_2g': 658.0, 'parc_3g': 21.0, 'parc_4g': 517.0, 'parc_5g': 3.0, 'autre_parc': 86.0, 'trafic_data_in': 286305.0, 'trafic_voix_in': 15792.22, 'trafic_data_in_mo': 286.305, 'ca_mtd': 215874.66, 'ca_norm': 6476239.8, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 186713.81, 'ca_data': 283735.0, 'ca_total': 500731.8, 'parc_global': 4564.0, 'parc_data': 3088.0, 'parc_2g': 606.0, 'parc_3g': 22.0, 'parc_4g': 1036.0, 'parc_5g': 114.0, 'autre_parc': 114.0, 'trafic_data_in': 748361.56, 'trafic_voix_in': 24169.3, 'trafic_data_in_mo': 748.36156, 'ca_mtd': 500731.8, 'ca_norm': 15021954.0, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 212184.77, 'ca_data': 480902.84, 'ca_total': 709591.6, 'parc_global': 7900.0, 'parc_data': 4255.0, 'parc_2g': 1227.0, 'parc_3g': 52.0, 'parc_4g': 1630.0, 'parc_5g': 101.0, 'autre_parc': 211.0, 'trafic_data_in': 1410212.1, 'trafic_voix_in': 40453.93, 'trafic_data_in_mo': 1410.2121000000002, 'ca_mtd': 709591.6, 'ca_norm': 21287748.0, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': None, 'ca_data': None, 'ca_total': None, 'parc_global': None, 'parc_data': None, 'parc_2g': None, 'parc_3g': None, 'parc_4g': None, 'parc_5g': None, 'autre_parc': None, 'trafic_data_in': None, 'trafic_voix_in': None, 'trafic_data_in_mo': None, 'ca_mtd': None, 'ca_norm': None, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 78506.79, 'ca_data': 95793.31, 'ca_total': 183206.1, 'parc_global': 6831.0, 'parc_data': 1639.0, 'parc_2g': 1046.0, 'parc_3g': 50.0, 'parc_4g': 572.0, 'parc_5g': 9.0, 'autre_parc': 103.0, 'trafic_data_in': 237113.25, 'trafic_voix_in': 17435.01, 'trafic_data_in_mo': 237.11325, 'ca_mtd': 183206.1, 'ca_norm': 5496183.0, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 57702.19, 'ca_data': 64399.0, 'ca_total': 125859.19, 'parc_global': 2474.0, 'parc_data': 1492.0, 'parc_2g': 983.0, 'parc_3g': 27.0, 'parc_4g': 498.0, 'parc_5g': 3.0, 'autre_parc': 72.0, 'trafic_data_in': 100381.695, 'trafic_voix_in': 11929.88, 'trafic_data_in_mo': 100.38169500000001, 'ca_mtd': 125859.19, 'ca_norm': 3775775.7, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 35397.63, 'ca_data': 35792.9, 'ca_total': 72989.53, 'parc_global': 1209.0, 'parc_data': 836.0, 'parc_2g': 516.0, 'parc_3g': 15.0, 'parc_4g': 264.0, 'parc_5g': 4.0, 'autre_parc': 65.0, 'trafic_data_in': 62178.35, 'trafic_voix_in': 13839.72, 'trafic_data_in_mo': 62.17835, 'ca_mtd': 72989.53, 'ca_norm': 2189685.9, 'mois': 6, 'annee': 6}  ... displaying 10 of 3107 total bound parameter sets ...  {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 178586.05, 'ca_data': 462131.2, 'ca_total': 667171.25, 'parc_global': 3331.0, 'parc_data': 2737.0, 'parc_2g': 165.0, 'parc_3g': 22.0, 'parc_4g': 1188.0, 'parc_5g': 113.0, 'autre_parc': 59.0, 'trafic_data_in': 1269518.1, 'trafic_voix_in': 36183.13, 'trafic_data_in_mo': 1269.5181, 'ca_mtd': 667171.25, 'ca_norm': 20015137.5, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 249111.7, 'ca_data': 468166.16, 'ca_total': 742102.9, 'parc_global': 3203.0, 'parc_data': 2847.0, 'parc_2g': 95.0, 'parc_3g': 18.0, 'parc_4g': 1256.0, 'parc_5g': 168.0, 'autre_parc': 76.0, 'trafic_data_in': 1167098.0, 'trafic_voix_in': 40619.5, 'trafic_data_in_mo': 1167.098, 'ca_mtd': 742102.9, 'ca_norm': 22263087.0, 'mois': 6, 'annee': 6})]
(Background on this error at: https://sqlalche.me/e/14/f405)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-07-26T12:17:52.017+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-07-26T12:17:52.017+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-26T12:17:52.017+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-26T12:17:52.047+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 18 for task motower_dcaparc ((psycopg2.errors.DatatypeMismatch) column "mois" is of type date but expression is of type integer
LINE 1: ...83.2, 53278.24, 1104.3832, 956035.44, 28681063.2, 6, 6),('20...
                                                             ^
HINT:  You will need to rewrite or cast the expression.

[SQL: INSERT INTO motower_daily_caparc_faits (jour, ca_voix, ca_data, ca_total, parc_global, parc_data, parc_2g, parc_3g, parc_4g, parc_5g, autre_parc, trafic_data_in, trafic_voix_in, trafic_data_in_mo, ca_mtd, ca_norm, mois, annee) VALUES (%(jour)s, %(ca_voix)s, %(ca_data)s, %(ca_total)s, %(parc_global)s, %(parc_data)s, %(parc_2g)s, %(parc_3g)s, %(parc_4g)s, %(parc_5g)s, %(autre_parc)s, %(trafic_data_in)s, %(trafic_voix_in)s, %(trafic_data_in_mo)s, %(ca_mtd)s, %(ca_norm)s, %(mois)s, %(annee)s)]
[parameters: ({'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 319805.2, 'ca_data': 585246.5, 'ca_total': 956035.44, 'parc_global': 9514.0, 'parc_data': 6605.0, 'parc_2g': 2113.0, 'parc_3g': 93.0, 'parc_4g': 2550.0, 'parc_5g': 177.0, 'autre_parc': 407.0, 'trafic_data_in': 1104383.2, 'trafic_voix_in': 53278.24, 'trafic_data_in_mo': 1104.3832, 'ca_mtd': 956035.44, 'ca_norm': 28681063.2, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 82856.15, 'ca_data': 121609.5, 'ca_total': 215874.66, 'parc_global': 2254.0, 'parc_data': 1541.0, 'parc_2g': 658.0, 'parc_3g': 21.0, 'parc_4g': 517.0, 'parc_5g': 3.0, 'autre_parc': 86.0, 'trafic_data_in': 286305.0, 'trafic_voix_in': 15792.22, 'trafic_data_in_mo': 286.305, 'ca_mtd': 215874.66, 'ca_norm': 6476239.8, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 186713.81, 'ca_data': 283735.0, 'ca_total': 500731.8, 'parc_global': 4564.0, 'parc_data': 3088.0, 'parc_2g': 606.0, 'parc_3g': 22.0, 'parc_4g': 1036.0, 'parc_5g': 114.0, 'autre_parc': 114.0, 'trafic_data_in': 748361.56, 'trafic_voix_in': 24169.3, 'trafic_data_in_mo': 748.36156, 'ca_mtd': 500731.8, 'ca_norm': 15021954.0, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 212184.77, 'ca_data': 480902.84, 'ca_total': 709591.6, 'parc_global': 7900.0, 'parc_data': 4255.0, 'parc_2g': 1227.0, 'parc_3g': 52.0, 'parc_4g': 1630.0, 'parc_5g': 101.0, 'autre_parc': 211.0, 'trafic_data_in': 1410212.1, 'trafic_voix_in': 40453.93, 'trafic_data_in_mo': 1410.2121000000002, 'ca_mtd': 709591.6, 'ca_norm': 21287748.0, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': None, 'ca_data': None, 'ca_total': None, 'parc_global': None, 'parc_data': None, 'parc_2g': None, 'parc_3g': None, 'parc_4g': None, 'parc_5g': None, 'autre_parc': None, 'trafic_data_in': None, 'trafic_voix_in': None, 'trafic_data_in_mo': None, 'ca_mtd': None, 'ca_norm': None, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 78506.79, 'ca_data': 95793.31, 'ca_total': 183206.1, 'parc_global': 6831.0, 'parc_data': 1639.0, 'parc_2g': 1046.0, 'parc_3g': 50.0, 'parc_4g': 572.0, 'parc_5g': 9.0, 'autre_parc': 103.0, 'trafic_data_in': 237113.25, 'trafic_voix_in': 17435.01, 'trafic_data_in_mo': 237.11325, 'ca_mtd': 183206.1, 'ca_norm': 5496183.0, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 57702.19, 'ca_data': 64399.0, 'ca_total': 125859.19, 'parc_global': 2474.0, 'parc_data': 1492.0, 'parc_2g': 983.0, 'parc_3g': 27.0, 'parc_4g': 498.0, 'parc_5g': 3.0, 'autre_parc': 72.0, 'trafic_data_in': 100381.695, 'trafic_voix_in': 11929.88, 'trafic_data_in_mo': 100.38169500000001, 'ca_mtd': 125859.19, 'ca_norm': 3775775.7, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 35397.63, 'ca_data': 35792.9, 'ca_total': 72989.53, 'parc_global': 1209.0, 'parc_data': 836.0, 'parc_2g': 516.0, 'parc_3g': 15.0, 'parc_4g': 264.0, 'parc_5g': 4.0, 'autre_parc': 65.0, 'trafic_data_in': 62178.35, 'trafic_voix_in': 13839.72, 'trafic_data_in_mo': 62.17835, 'ca_mtd': 72989.53, 'ca_norm': 2189685.9, 'mois': 6, 'annee': 6}  ... displaying 10 of 3107 total bound parameter sets ...  {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 178586.05, 'ca_data': 462131.2, 'ca_total': 667171.25, 'parc_global': 3331.0, 'parc_data': 2737.0, 'parc_2g': 165.0, 'parc_3g': 22.0, 'parc_4g': 1188.0, 'parc_5g': 113.0, 'autre_parc': 59.0, 'trafic_data_in': 1269518.1, 'trafic_voix_in': 36183.13, 'trafic_data_in_mo': 1269.5181, 'ca_mtd': 667171.25, 'ca_norm': 20015137.5, 'mois': 6, 'annee': 6}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'ca_voix': 249111.7, 'ca_data': 468166.16, 'ca_total': 742102.9, 'parc_global': 3203.0, 'parc_data': 2847.0, 'parc_2g': 95.0, 'parc_3g': 18.0, 'parc_4g': 1256.0, 'parc_5g': 168.0, 'autre_parc': 76.0, 'trafic_data_in': 1167098.0, 'trafic_voix_in': 40619.5, 'trafic_data_in_mo': 1167.098, 'ca_mtd': 742102.9, 'ca_norm': 22263087.0, 'mois': 6, 'annee': 6})]
(Background on this error at: https://sqlalche.me/e/14/f405); 140)
[2024-07-26T12:17:52.094+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-07-26T12:17:52.114+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-26T12:17:52.115+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-26T12:20:04.049+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-26T12:20:04.082+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-26T12:20:04.094+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-26T12:20:04.095+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-26T12:20:04.113+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-02 06:00:00+00:00
[2024-07-26T12:20:04.131+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=474) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-26T12:20:04.133+0000] {standard_task_runner.py:64} INFO - Started process 496 to run task
[2024-07-26T12:20:04.133+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-02T06:00:00+00:00', '--job-id', '127', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmph02qov4f']
[2024-07-26T12:20:04.137+0000] {standard_task_runner.py:91} INFO - Job 127: Subtask motower_dcaparc
[2024-07-26T12:20:04.210+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [running]> on host 88c2b04746a4
[2024-07-26T12:20:04.355+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-02T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-02T06:00:00+00:00'
[2024-07-26T12:20:04.356+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-26T12:20:04.378+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-26T12:20:04.392+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-26T12:20:04.462+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T12:20:04.465+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T12:20:04.465+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-01
[2024-07-26T12:20:04.466+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/01.csv
[2024-07-26T12:20:04.491+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240601  5.327182e+08  8.044059e+08  16715871    9176426  12042566   875452  5841327   297932     1379325  1.395652e+09
[2024-07-26T12:20:04.492+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T12:20:04.493+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T12:20:04.494+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T12:20:04.494+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T12:20:04.495+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T12:20:04.496+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T12:20:04.496+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-26T12:20:04.497+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-26T12:20:04.497+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T12:20:04.497+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T12:20:04.498+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-26T12:20:04.503+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-26T12:20:04.504+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-26T12:20:04.507+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-26T12:20:04.508+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-26T12:20:04.509+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-26T12:20:04.509+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-26T12:20:04.510+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-26T12:20:04.510+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-26T12:20:04.511+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-26T12:20:04.511+0000] {logging_mixin.py:188} INFO - 6
[2024-07-26T12:20:04.511+0000] {logging_mixin.py:188} INFO - 2024-06-01 00:00:00
[2024-07-26T12:20:04.524+0000] {motower_daily.py:200} INFO - ADD  SEGMENT
[2024-07-26T12:20:04.736+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-26T12:20:04.737+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T12:20:04.738+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T12:20:04.746+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-01  5.206589e+08  7.907621e+08   14770374.0  8934529.0  3810606.0  121316.0  3061852.0  193275.0    442619.0  1.368038e+09
[2024-07-26T12:20:04.746+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T12:20:04.747+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T12:20:04.747+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T12:20:04.748+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T12:20:04.748+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T12:20:04.749+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T12:20:04.749+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-26T12:20:04.749+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-26T12:20:04.750+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T12:20:04.750+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T12:20:04.777+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T12:20:04.804+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T12:20:04.812+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:133: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['mois'] = data["jour"].dt.month

[2024-07-26T12:20:04.813+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:134: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['annee'] = data["jour"].dt.month

[2024-07-26T12:20:06.144+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-26T12:20:06.145+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-26T12:20:06.165+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-02T06:00:00+00:00, execution_date=20240602T060000, start_date=20240726T122004, end_date=20240726T122006
[2024-07-26T12:20:06.680+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-26T12:20:06.702+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-26T12:20:06.704+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-26T12:23:16.395+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-26T12:23:16.739+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-26T12:23:16.750+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-26T12:23:16.750+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-26T12:23:16.769+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-02 06:00:00+00:00
[2024-07-26T12:23:16.787+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=1313) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-26T12:23:16.789+0000] {standard_task_runner.py:64} INFO - Started process 1329 to run task
[2024-07-26T12:23:16.790+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-02T06:00:00+00:00', '--job-id', '389', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmprlticlbd']
[2024-07-26T12:23:16.793+0000] {standard_task_runner.py:91} INFO - Job 389: Subtask motower_dcaparc
[2024-07-26T12:23:16.868+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [running]> on host 88c2b04746a4
[2024-07-26T12:23:17.004+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-02T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-02T06:00:00+00:00'
[2024-07-26T12:23:17.005+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-26T12:23:17.028+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-26T12:23:17.043+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-26T12:23:17.117+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T12:23:17.120+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T12:23:17.121+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-01
[2024-07-26T12:23:17.121+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/01.csv
[2024-07-26T12:23:17.153+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240601  5.327182e+08  8.044059e+08  16715871    9176426  12042566   875452  5841327   297932     1379325  1.395652e+09
[2024-07-26T12:23:17.154+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T12:23:17.156+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T12:23:17.156+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T12:23:17.158+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T12:23:17.158+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T12:23:17.159+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T12:23:17.159+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-26T12:23:17.160+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-26T12:23:17.160+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T12:23:17.161+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T12:23:17.162+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-26T12:23:17.167+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-26T12:23:17.169+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-26T12:23:17.173+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-26T12:23:17.175+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-26T12:23:17.176+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-26T12:23:17.178+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-26T12:23:17.179+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-26T12:23:17.180+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-26T12:23:17.181+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-26T12:23:17.181+0000] {logging_mixin.py:188} INFO - 6
[2024-07-26T12:23:17.181+0000] {logging_mixin.py:188} INFO - 2024-06-01 00:00:00
[2024-07-26T12:23:17.195+0000] {motower_daily.py:200} INFO - ADD  SEGMENT
[2024-07-26T12:23:17.439+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-26T12:23:17.440+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T12:23:17.441+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T12:23:17.452+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-01  5.206589e+08  7.907621e+08   14770374.0  8934529.0  3810606.0  121316.0  3061852.0  193275.0    442619.0  1.368038e+09
[2024-07-26T12:23:17.452+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T12:23:17.453+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T12:23:17.453+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T12:23:17.454+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T12:23:17.455+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T12:23:17.456+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T12:23:17.456+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-26T12:23:17.457+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-26T12:23:17.457+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T12:23:17.458+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T12:23:17.494+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T12:23:17.532+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T12:23:17.543+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:133: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['mois'] = data["jour"].dt.month

[2024-07-26T12:23:17.544+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:134: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['annee'] = data["jour"].dt.year

[2024-07-26T12:23:18.903+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-26T12:23:18.905+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-26T12:23:18.913+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-02T06:00:00+00:00, execution_date=20240602T060000, start_date=20240726T122316, end_date=20240726T122318
[2024-07-26T12:23:19.010+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-26T12:23:19.029+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-26T12:23:19.031+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-26T12:29:00.845+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-26T12:29:00.883+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-26T12:29:00.894+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-26T12:29:00.894+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-26T12:29:00.914+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-02 06:00:00+00:00
[2024-07-26T12:29:00.929+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=2257) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-26T12:29:00.931+0000] {standard_task_runner.py:64} INFO - Started process 2282 to run task
[2024-07-26T12:29:00.933+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-02T06:00:00+00:00', '--job-id', '684', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpj4i5xxyg']
[2024-07-26T12:29:00.936+0000] {standard_task_runner.py:91} INFO - Job 684: Subtask motower_dcaparc
[2024-07-26T12:29:01.002+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [running]> on host 88c2b04746a4
[2024-07-26T12:29:01.128+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-02T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-02T06:00:00+00:00'
[2024-07-26T12:29:01.129+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-26T12:29:01.155+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-26T12:29:01.181+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-26T12:29:01.289+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T12:29:01.291+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T12:29:01.292+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-01
[2024-07-26T12:29:01.292+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/01.csv
[2024-07-26T12:29:01.325+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240601  5.327182e+08  8.044059e+08  16715871    9176426  12042566   875452  5841327   297932     1379325  1.395652e+09
[2024-07-26T12:29:01.326+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T12:29:01.328+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T12:29:01.329+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T12:29:01.331+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T12:29:01.332+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T12:29:01.333+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T12:29:01.334+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-26T12:29:01.336+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-26T12:29:01.337+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T12:29:01.338+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T12:29:01.339+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-26T12:29:01.343+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-26T12:29:01.346+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-26T12:29:01.348+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-26T12:29:01.350+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-26T12:29:01.351+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-26T12:29:01.352+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-26T12:29:01.353+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-26T12:29:01.353+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-26T12:29:01.354+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-26T12:29:01.354+0000] {logging_mixin.py:188} INFO - 6
[2024-07-26T12:29:01.355+0000] {logging_mixin.py:188} INFO - 2024-06-01 00:00:00
[2024-07-26T12:29:01.368+0000] {motower_daily.py:200} INFO - ADD  SEGMENT
[2024-07-26T12:29:01.619+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-26T12:29:01.620+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T12:29:01.622+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T12:29:01.635+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-01  5.206589e+08  7.907621e+08   14770374.0  8934529.0  3810606.0  121316.0  3061852.0  193275.0    442619.0  1.368038e+09
[2024-07-26T12:29:01.636+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T12:29:01.637+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T12:29:01.637+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T12:29:01.639+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T12:29:01.640+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T12:29:01.641+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T12:29:01.641+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-26T12:29:01.642+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-26T12:29:01.643+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T12:29:01.643+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T12:29:01.678+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T12:29:01.713+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T12:29:01.722+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:133: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['mois'] = data["jour"].dt.month

[2024-07-26T12:29:01.723+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:134: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['annee'] = data["jour"].dt.year

[2024-07-26T12:29:03.316+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-26T12:29:03.317+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-26T12:29:03.334+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-02T06:00:00+00:00, execution_date=20240602T060000, start_date=20240726T122900, end_date=20240726T122903
[2024-07-26T12:29:03.440+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-26T12:29:03.520+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-26T12:29:03.527+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-26T12:39:46.808+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-26T12:39:47.176+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-26T12:39:47.194+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-26T12:39:47.195+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-26T12:39:47.220+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-02 06:00:00+00:00
[2024-07-26T12:39:47.240+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=112) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-26T12:39:47.242+0000] {standard_task_runner.py:64} INFO - Started process 130 to run task
[2024-07-26T12:39:47.248+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-02T06:00:00+00:00', '--job-id', '13', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpulj1pit6']
[2024-07-26T12:39:47.255+0000] {standard_task_runner.py:91} INFO - Job 13: Subtask motower_dcaparc
[2024-07-26T12:39:47.359+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [running]> on host e824106b656d
[2024-07-26T12:39:47.581+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-02T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-02T06:00:00+00:00'
[2024-07-26T12:39:47.582+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-26T12:39:47.624+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-26T12:39:47.640+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-26T12:39:47.721+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T12:39:47.723+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T12:39:47.723+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-01
[2024-07-26T12:39:47.723+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/01.csv
[2024-07-26T12:39:47.769+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240601  5.327182e+08  8.044059e+08  16715871    9176426  12042566   875452  5841327   297932     1379325  1.395652e+09
[2024-07-26T12:39:47.769+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T12:39:47.771+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T12:39:47.771+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T12:39:47.772+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T12:39:47.773+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T12:39:47.773+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T12:39:47.774+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-26T12:39:47.775+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-26T12:39:47.775+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T12:39:47.776+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T12:39:47.776+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-26T12:39:47.781+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-26T12:39:47.783+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-26T12:39:47.785+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-26T12:39:47.787+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-26T12:39:47.788+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-26T12:39:47.788+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-26T12:39:47.789+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-26T12:39:47.790+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-26T12:39:47.790+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-26T12:39:47.790+0000] {logging_mixin.py:188} INFO - 6
[2024-07-26T12:39:47.791+0000] {logging_mixin.py:188} INFO - 2024-06-01 00:00:00
[2024-07-26T12:39:47.805+0000] {motower_daily.py:200} INFO - ADD  SEGMENT
[2024-07-26T12:39:48.037+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-26T12:39:48.037+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T12:39:48.038+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T12:39:48.048+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-01  5.206589e+08  7.907621e+08   14770374.0  8934529.0  3810606.0  121316.0  3061852.0  193275.0    442619.0  1.368038e+09
[2024-07-26T12:39:48.049+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T12:39:48.050+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T12:39:48.050+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T12:39:48.051+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T12:39:48.051+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T12:39:48.052+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T12:39:48.052+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-26T12:39:48.053+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-26T12:39:48.053+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T12:39:48.054+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T12:39:48.092+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T12:39:48.133+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T12:39:48.146+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:137: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['mois'] = data["jour"].dt.month

[2024-07-26T12:39:48.147+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:138: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['annee'] = data["jour"].dt.year

[2024-07-26T12:39:49.535+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-26T12:39:49.536+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-26T12:39:49.547+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-02T06:00:00+00:00, execution_date=20240602T060000, start_date=20240726T123947, end_date=20240726T123949
[2024-07-26T12:39:49.871+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-26T12:39:49.890+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-26T12:39:49.892+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-26T12:45:59.216+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-26T12:45:59.254+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-26T12:45:59.268+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-26T12:45:59.269+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-26T12:45:59.290+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-02 06:00:00+00:00
[2024-07-26T12:45:59.308+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=584) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-26T12:45:59.310+0000] {standard_task_runner.py:64} INFO - Started process 601 to run task
[2024-07-26T12:45:59.310+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-02T06:00:00+00:00', '--job-id', '143', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpie9cgysz']
[2024-07-26T12:45:59.313+0000] {standard_task_runner.py:91} INFO - Job 143: Subtask motower_dcaparc
[2024-07-26T12:45:59.373+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [running]> on host e824106b656d
[2024-07-26T12:45:59.514+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-02T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-02T06:00:00+00:00'
[2024-07-26T12:45:59.515+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-26T12:45:59.545+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-26T12:45:59.561+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-26T12:45:59.640+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T12:45:59.643+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T12:45:59.643+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-01
[2024-07-26T12:45:59.644+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/01.csv
[2024-07-26T12:45:59.675+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240601  5.327182e+08  8.044059e+08  16715871    9176426  12042566   875452  5841327   297932     1379325  1.395652e+09
[2024-07-26T12:45:59.675+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T12:45:59.677+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T12:45:59.678+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T12:45:59.679+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T12:45:59.680+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T12:45:59.681+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T12:45:59.682+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-26T12:45:59.683+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-26T12:45:59.684+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T12:45:59.686+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T12:45:59.686+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-26T12:45:59.691+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-26T12:45:59.692+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-26T12:45:59.696+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-26T12:45:59.698+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-26T12:45:59.699+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-26T12:45:59.699+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-26T12:45:59.700+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-26T12:45:59.701+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-26T12:45:59.702+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-26T12:45:59.703+0000] {logging_mixin.py:188} INFO - 6
[2024-07-26T12:45:59.704+0000] {logging_mixin.py:188} INFO - 2024-06-01 00:00:00
[2024-07-26T12:45:59.714+0000] {motower_daily.py:200} INFO - ADD  SEGMENT
[2024-07-26T12:45:59.929+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-26T12:45:59.930+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T12:45:59.931+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T12:45:59.939+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-01  5.206589e+08  7.907621e+08   14770374.0  8934529.0  3810606.0  121316.0  3061852.0  193275.0    442619.0  1.368038e+09
[2024-07-26T12:45:59.939+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T12:45:59.940+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T12:45:59.940+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T12:45:59.941+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T12:45:59.941+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T12:45:59.942+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T12:45:59.942+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-26T12:45:59.943+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-26T12:45:59.943+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T12:45:59.944+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T12:45:59.972+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T12:46:00.005+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T12:46:00.015+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:139: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['mois'] = data["jour"].dt.month

[2024-07-26T12:46:00.016+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:140: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['annee'] = data["jour"].dt.year

[2024-07-26T12:46:01.214+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-26T12:46:01.216+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-26T12:46:01.231+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-02T06:00:00+00:00, execution_date=20240602T060000, start_date=20240726T124559, end_date=20240726T124601
[2024-07-26T12:46:01.300+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-26T12:46:01.320+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-26T12:50:28.706+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-26T12:50:29.003+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-26T12:50:29.012+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-26T12:50:29.012+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-26T12:50:29.262+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-02 06:00:00+00:00
[2024-07-26T12:50:29.288+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=1061) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-26T12:50:29.290+0000] {standard_task_runner.py:64} INFO - Started process 1077 to run task
[2024-07-26T12:50:29.293+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-02T06:00:00+00:00', '--job-id', '282', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpyr1w28k0']
[2024-07-26T12:50:29.296+0000] {standard_task_runner.py:91} INFO - Job 282: Subtask motower_dcaparc
[2024-07-26T12:50:29.371+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [running]> on host e824106b656d
[2024-07-26T12:50:29.508+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-02T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-02T06:00:00+00:00'
[2024-07-26T12:50:29.510+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-26T12:50:29.528+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-26T12:50:29.543+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-26T12:50:29.619+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T12:50:29.621+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T12:50:29.622+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-01
[2024-07-26T12:50:29.622+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/01.csv
[2024-07-26T12:50:29.651+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240601  5.327182e+08  8.044059e+08  16715871    9176426  12042566   875452  5841327   297932     1379325  1.395652e+09
[2024-07-26T12:50:29.651+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T12:50:29.653+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T12:50:29.654+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T12:50:29.655+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T12:50:29.655+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T12:50:29.656+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T12:50:29.656+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-26T12:50:29.657+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-26T12:50:29.658+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T12:50:29.658+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T12:50:29.659+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-26T12:50:29.663+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-26T12:50:29.665+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-26T12:50:29.667+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-26T12:50:29.669+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-26T12:50:29.670+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-26T12:50:29.671+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-26T12:50:29.671+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-26T12:50:29.672+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-26T12:50:29.673+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-26T12:50:29.673+0000] {logging_mixin.py:188} INFO - 6
[2024-07-26T12:50:29.674+0000] {logging_mixin.py:188} INFO - 2024-06-01 00:00:00
[2024-07-26T12:50:29.686+0000] {motower_daily.py:200} INFO - ADD  SEGMENT
[2024-07-26T12:50:29.900+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-26T12:50:29.901+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T12:50:29.902+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T12:50:29.910+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-01  5.206589e+08  7.907621e+08   14770374.0  8934529.0  3810606.0  121316.0  3061852.0  193275.0    442619.0  1.368038e+09
[2024-07-26T12:50:29.911+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T12:50:29.911+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T12:50:29.911+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T12:50:29.912+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T12:50:29.912+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T12:50:29.913+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T12:50:29.913+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-26T12:50:29.913+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-26T12:50:29.914+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T12:50:29.914+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T12:50:29.944+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T12:50:29.972+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T12:50:29.980+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:139: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['mois'] = data["jour"].dt.month

[2024-07-26T12:50:29.981+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:140: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['annee'] = data["jour"].dt.year

[2024-07-26T12:50:31.191+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-26T12:50:31.193+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-26T12:50:31.206+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-02T06:00:00+00:00, execution_date=20240602T060000, start_date=20240726T125029, end_date=20240726T125031
[2024-07-26T12:50:31.494+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-26T12:50:31.517+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-26T12:50:31.519+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-26T12:53:32.836+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-26T12:53:32.873+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-26T12:53:32.886+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-26T12:53:32.886+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-26T12:53:32.905+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-02 06:00:00+00:00
[2024-07-26T12:53:32.921+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=1531) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-26T12:53:32.923+0000] {standard_task_runner.py:64} INFO - Started process 1545 to run task
[2024-07-26T12:53:32.923+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-02T06:00:00+00:00', '--job-id', '429', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmp4cfgnu23']
[2024-07-26T12:53:32.926+0000] {standard_task_runner.py:91} INFO - Job 429: Subtask motower_dcaparc
[2024-07-26T12:53:32.985+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [running]> on host e824106b656d
[2024-07-26T12:53:33.097+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-02T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-02T06:00:00+00:00'
[2024-07-26T12:53:33.099+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-26T12:53:33.118+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-26T12:53:33.132+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-26T12:53:33.202+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T12:53:33.205+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T12:53:33.205+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-01
[2024-07-26T12:53:33.205+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/01.csv
[2024-07-26T12:53:33.237+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240601  5.327182e+08  8.044059e+08  16715871    9176426  12042566   875452  5841327   297932     1379325  1.395652e+09
[2024-07-26T12:53:33.238+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T12:53:33.239+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T12:53:33.240+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T12:53:33.241+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T12:53:33.242+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T12:53:33.243+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T12:53:33.243+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-26T12:53:33.244+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-26T12:53:33.244+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T12:53:33.245+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T12:53:33.246+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-26T12:53:33.250+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-26T12:53:33.252+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-26T12:53:33.255+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-26T12:53:33.256+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-26T12:53:33.257+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-26T12:53:33.257+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-26T12:53:33.258+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-26T12:53:33.260+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-26T12:53:33.260+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-26T12:53:33.261+0000] {logging_mixin.py:188} INFO - 6
[2024-07-26T12:53:33.261+0000] {logging_mixin.py:188} INFO - 2024-06-01 00:00:00
[2024-07-26T12:53:33.274+0000] {motower_daily.py:200} INFO - ADD  SEGMENT
[2024-07-26T12:53:33.502+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-26T12:53:33.503+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T12:53:33.504+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T12:53:33.514+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-01  5.206589e+08  7.907621e+08   14770374.0  8934529.0  3810606.0  121316.0  3061852.0  193275.0    442619.0  1.368038e+09
[2024-07-26T12:53:33.514+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T12:53:33.515+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T12:53:33.516+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T12:53:33.517+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T12:53:33.517+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T12:53:33.518+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T12:53:33.518+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-26T12:53:33.519+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-26T12:53:33.519+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T12:53:33.520+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T12:53:33.555+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T12:53:33.591+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T12:53:33.600+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:139: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['mois'] = data["jour"].dt.month

[2024-07-26T12:53:33.601+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:140: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['annee'] = data["jour"].dt.year

[2024-07-26T12:53:34.998+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-26T12:53:34.999+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-26T12:53:35.011+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-02T06:00:00+00:00, execution_date=20240602T060000, start_date=20240726T125332, end_date=20240726T125335
[2024-07-26T12:53:35.472+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-26T12:53:35.495+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-26T12:53:35.496+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-29T11:48:42.322+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-29T11:48:42.622+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-29T11:48:42.634+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-29T11:48:42.635+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-29T11:48:42.652+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-02 06:00:00+00:00
[2024-07-29T11:48:42.666+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=2303) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-29T11:48:42.668+0000] {standard_task_runner.py:64} INFO - Started process 2318 to run task
[2024-07-29T11:48:42.668+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-02T06:00:00+00:00', '--job-id', '617', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpu2owjqwc']
[2024-07-29T11:48:42.670+0000] {standard_task_runner.py:91} INFO - Job 617: Subtask motower_dcaparc
[2024-07-29T11:48:42.723+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [running]> on host e824106b656d
[2024-07-29T11:48:42.828+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-02T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-02T06:00:00+00:00'
[2024-07-29T11:48:42.830+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-29T11:48:42.853+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-29T11:48:42.865+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-29T11:48:42.932+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-29T11:48:42.934+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-29T11:48:42.935+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-01
[2024-07-29T11:48:42.935+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/01.csv
[2024-07-29T11:48:42.961+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240601  5.327182e+08  8.044059e+08  16715871    9176426  12042566   875452  5841327   297932     1379325  1.395652e+09
[2024-07-29T11:48:42.961+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-29T11:48:42.963+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-29T11:48:42.963+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-29T11:48:42.964+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-29T11:48:42.964+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-29T11:48:42.965+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-29T11:48:42.965+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-29T11:48:42.966+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-29T11:48:42.966+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-29T11:48:42.967+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-29T11:48:42.967+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-29T11:48:42.973+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-29T11:48:42.975+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-29T11:48:42.978+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-29T11:48:42.979+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-29T11:48:42.980+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-29T11:48:42.980+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-29T11:48:42.981+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-29T11:48:42.981+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-29T11:48:42.982+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-29T11:48:42.982+0000] {logging_mixin.py:188} INFO - 6
[2024-07-29T11:48:42.983+0000] {logging_mixin.py:188} INFO - 2024-06-01 00:00:00
[2024-07-29T11:48:42.996+0000] {motower_daily.py:200} INFO - ADD  SEGMENT
[2024-07-29T11:48:43.206+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-29T11:48:43.207+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-29T11:48:43.208+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-29T11:48:43.216+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-01  5.206589e+08  7.907621e+08   14770374.0  8934529.0  3810606.0  121316.0  3061852.0  193275.0    442619.0  1.368038e+09
[2024-07-29T11:48:43.217+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-29T11:48:43.217+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-29T11:48:43.218+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-29T11:48:43.218+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-29T11:48:43.219+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-29T11:48:43.219+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-29T11:48:43.220+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-29T11:48:43.220+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-29T11:48:43.220+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-29T11:48:43.221+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-29T11:48:43.256+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-29T11:48:43.288+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-29T11:48:43.297+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:139: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['mois'] = data["jour"].dt.month

[2024-07-29T11:48:43.298+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:140: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['annee'] = data["jour"].dt.year

[2024-07-29T11:48:44.365+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-29T11:48:44.366+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-29T11:48:44.376+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-02T06:00:00+00:00, execution_date=20240602T060000, start_date=20240729T114842, end_date=20240729T114844
[2024-07-29T11:48:44.528+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-29T11:48:44.548+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-29T11:48:44.550+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-29T11:58:42.522+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-29T11:58:42.838+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-29T11:58:42.851+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-29T11:58:42.851+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-29T11:58:42.866+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-02 06:00:00+00:00
[2024-07-29T11:58:42.879+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=2721) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-29T11:58:42.881+0000] {standard_task_runner.py:64} INFO - Started process 2738 to run task
[2024-07-29T11:58:42.881+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-02T06:00:00+00:00', '--job-id', '712', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmp0tuzok23']
[2024-07-29T11:58:42.883+0000] {standard_task_runner.py:91} INFO - Job 712: Subtask motower_dcaparc
[2024-07-29T11:58:42.936+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [running]> on host e824106b656d
[2024-07-29T11:58:43.038+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-02T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-02T06:00:00+00:00'
[2024-07-29T11:58:43.040+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-29T11:58:43.061+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-29T11:58:43.071+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-29T11:58:43.126+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-29T11:58:43.129+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-29T11:58:43.129+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-01
[2024-07-29T11:58:43.130+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/01.csv
[2024-07-29T11:58:43.152+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240601  5.327182e+08  8.044059e+08  16715871    9176426  12042566   875452  5841327   297932     1379325  1.395652e+09
[2024-07-29T11:58:43.153+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-29T11:58:43.154+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-29T11:58:43.155+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-29T11:58:43.155+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-29T11:58:43.156+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-29T11:58:43.157+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-29T11:58:43.157+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-29T11:58:43.158+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-29T11:58:43.158+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-29T11:58:43.159+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-29T11:58:43.159+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-29T11:58:43.163+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-29T11:58:43.165+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-29T11:58:43.167+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-29T11:58:43.169+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-29T11:58:43.169+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-29T11:58:43.170+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-29T11:58:43.171+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-29T11:58:43.171+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-29T11:58:43.172+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-29T11:58:43.172+0000] {logging_mixin.py:188} INFO - 6
[2024-07-29T11:58:43.172+0000] {logging_mixin.py:188} INFO - 2024-06-01 00:00:00
[2024-07-29T11:58:43.184+0000] {motower_daily.py:200} INFO - ADD  SEGMENT
[2024-07-29T11:58:43.339+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-29T11:58:43.340+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-29T11:58:43.340+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-29T11:58:43.347+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-01  5.206589e+08  7.907621e+08   14770374.0  8934529.0  3810606.0  121316.0  3061852.0  193275.0    442619.0  1.368038e+09
[2024-07-29T11:58:43.347+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-29T11:58:43.348+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-29T11:58:43.348+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-29T11:58:43.349+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-29T11:58:43.349+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-29T11:58:43.349+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-29T11:58:43.350+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-29T11:58:43.350+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-29T11:58:43.350+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-29T11:58:43.351+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-29T11:58:43.373+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-29T11:58:43.397+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-29T11:58:43.403+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:139: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['mois'] = data["jour"].dt.month

[2024-07-29T11:58:43.404+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:140: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['annee'] = data["jour"].dt.year

[2024-07-29T11:58:44.204+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-29T11:58:44.205+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-29T11:58:44.217+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-02T06:00:00+00:00, execution_date=20240602T060000, start_date=20240729T115842, end_date=20240729T115844
[2024-07-29T11:58:44.260+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-29T11:58:44.281+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-29T11:58:44.285+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-29T14:24:44.126+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-29T14:24:44.408+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-29T14:24:44.418+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-29T14:24:44.418+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-29T14:24:44.432+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-02 06:00:00+00:00
[2024-07-29T14:24:44.445+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=384) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-29T14:24:44.447+0000] {standard_task_runner.py:64} INFO - Started process 405 to run task
[2024-07-29T14:24:44.447+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-02T06:00:00+00:00', '--job-id', '1022', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpxkf3n33m']
[2024-07-29T14:24:44.450+0000] {standard_task_runner.py:91} INFO - Job 1022: Subtask motower_dcaparc
[2024-07-29T14:24:44.502+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [running]> on host e824106b656d
[2024-07-29T14:24:44.606+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-02T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-02T06:00:00+00:00'
[2024-07-29T14:24:44.608+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-29T14:24:44.626+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-29T14:24:44.639+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-29T14:24:44.702+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-29T14:24:44.705+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-29T14:24:44.705+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-01
[2024-07-29T14:24:44.706+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/01.csv
[2024-07-29T14:24:44.733+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240601  5.327182e+08  8.044059e+08  16715871    9176426  12042566   875452  5841327   297932     1379325  1.395652e+09
[2024-07-29T14:24:44.733+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-29T14:24:44.734+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-29T14:24:44.735+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-29T14:24:44.736+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-29T14:24:44.736+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-29T14:24:44.737+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-29T14:24:44.737+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-29T14:24:44.738+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-29T14:24:44.738+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-29T14:24:44.739+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-29T14:24:44.739+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-29T14:24:44.743+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-29T14:24:44.745+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-29T14:24:44.747+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-29T14:24:44.749+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-29T14:24:44.749+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-29T14:24:44.750+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-29T14:24:44.750+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-29T14:24:44.751+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-29T14:24:44.752+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-29T14:24:44.752+0000] {logging_mixin.py:188} INFO - 6
[2024-07-29T14:24:44.752+0000] {logging_mixin.py:188} INFO - 2024-06-01 00:00:00
[2024-07-29T14:24:44.765+0000] {motower_daily.py:200} INFO - ADD  SEGMENT
[2024-07-29T14:24:44.944+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-29T14:24:44.944+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-29T14:24:44.945+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-29T14:24:44.951+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-01  5.206589e+08  7.907621e+08   14770374.0  8934529.0  3810606.0  121316.0  3061852.0  193275.0    442619.0  1.368038e+09
[2024-07-29T14:24:44.952+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-29T14:24:44.952+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-29T14:24:44.953+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-29T14:24:44.953+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-29T14:24:44.953+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-29T14:24:44.954+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-29T14:24:44.954+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-29T14:24:44.954+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-29T14:24:44.955+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-29T14:24:44.955+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-29T14:24:44.980+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-29T14:24:45.005+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-29T14:24:45.015+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:139: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['mois'] = data["jour"].dt.month

[2024-07-29T14:24:45.016+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:140: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['annee'] = data["jour"].dt.year

[2024-07-29T14:24:45.549+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-29T14:24:45.550+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1890, in _execute_context
    self.dialect.do_executemany(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/psycopg2.py", line 982, in do_executemany
    context._psycopg2_fetched_rows = xtras.execute_values(
                                     ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/psycopg2/extras.py", line 1299, in execute_values
    cur.execute(b''.join(parts))
psycopg2.errors.UndefinedColumn: column "code_oci" of relation "motower_daily_caparc_faits" does not exist
LINE 1: INSERT INTO motower_daily_caparc_faits (jour, code_oci, code...
                                                      ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 143, in gen_motower_daily
    write_pg(PG_SAVE_HOST, PG_SAVE_DB, PG_SAVE_USER, PG_SAVE_PASSWORD, df_faits, "motower_daily_caparc_faits")
  File "/opt/airflow/dags/gps/common/rwpg.py", line 66, in write_pg
    data.to_sql(table, engine, index=False, if_exists = 'append')
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
           ^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
           ^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1385, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 334, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1577, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1953, in _execute_context
    self._handle_dbapi_exception(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2134, in _handle_dbapi_exception
    util.raise_(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/util/compat.py", line 211, in raise_
    raise exception
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1890, in _execute_context
    self.dialect.do_executemany(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/psycopg2.py", line 982, in do_executemany
    context._psycopg2_fetched_rows = xtras.execute_values(
                                     ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/psycopg2/extras.py", line 1299, in execute_values
    cur.execute(b''.join(parts))
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column "code_oci" of relation "motower_daily_caparc_faits" does not exist
LINE 1: INSERT INTO motower_daily_caparc_faits (jour, code_oci, code...
                                                      ^

[SQL: INSERT INTO motower_daily_caparc_faits (jour, code_oci, code_oci_id, ca_voix, ca_data, ca_total, parc_global, parc_data, parc_2g, parc_3g, parc_4g, parc_5g, autre_parc, trafic_data_in, trafic_voix_in, trafic_data_in_mo, ca_mtd, ca_norm, mois, annee) VALUES (%(jour)s, %(code_oci)s, %(code_oci_id)s, %(ca_voix)s, %(ca_data)s, %(ca_total)s, %(parc_global)s, %(parc_data)s, %(parc_2g)s, %(parc_3g)s, %(parc_4g)s, %(parc_5g)s, %(autre_parc)s, %(trafic_data_in)s, %(trafic_voix_in)s, %(trafic_data_in_mo)s, %(ca_mtd)s, %(ca_norm)s, %(mois)s, %(annee)s)]
[parameters: ({'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI2831', 'code_oci_id': 2831.0, 'ca_voix': 319805.2, 'ca_data': 585246.5, 'ca_total': 956035.44, 'parc_global': 9514.0, 'parc_data': 6605.0, 'parc_2g': 2113.0, 'parc_3g': 93.0, 'parc_4g': 2550.0, 'parc_5g': 177.0, 'autre_parc': 407.0, 'trafic_data_in': 1104383.2, 'trafic_voix_in': 53278.24, 'trafic_data_in_mo': 1104.3832, 'ca_mtd': 956035.44, 'ca_norm': 28681063.2, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3257', 'code_oci_id': 3257.0, 'ca_voix': 82856.15, 'ca_data': 121609.5, 'ca_total': 215874.66, 'parc_global': 2254.0, 'parc_data': 1541.0, 'parc_2g': 658.0, 'parc_3g': 21.0, 'parc_4g': 517.0, 'parc_5g': 3.0, 'autre_parc': 86.0, 'trafic_data_in': 286305.0, 'trafic_voix_in': 15792.22, 'trafic_data_in_mo': 286.305, 'ca_mtd': 215874.66, 'ca_norm': 6476239.8, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3428', 'code_oci_id': 3428.0, 'ca_voix': 186713.81, 'ca_data': 283735.0, 'ca_total': 500731.8, 'parc_global': 4564.0, 'parc_data': 3088.0, 'parc_2g': 606.0, 'parc_3g': 22.0, 'parc_4g': 1036.0, 'parc_5g': 114.0, 'autre_parc': 114.0, 'trafic_data_in': 748361.56, 'trafic_voix_in': 24169.3, 'trafic_data_in_mo': 748.36156, 'ca_mtd': 500731.8, 'ca_norm': 15021954.0, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI2587', 'code_oci_id': 2587.0, 'ca_voix': 212184.77, 'ca_data': 480902.84, 'ca_total': 709591.6, 'parc_global': 7900.0, 'parc_data': 4255.0, 'parc_2g': 1227.0, 'parc_3g': 52.0, 'parc_4g': 1630.0, 'parc_5g': 101.0, 'autre_parc': 211.0, 'trafic_data_in': 1410212.1, 'trafic_voix_in': 40453.93, 'trafic_data_in_mo': 1410.2121000000002, 'ca_mtd': 709591.6, 'ca_norm': 21287748.0, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3260', 'code_oci_id': 3260.0, 'ca_voix': None, 'ca_data': None, 'ca_total': None, 'parc_global': None, 'parc_data': None, 'parc_2g': None, 'parc_3g': None, 'parc_4g': None, 'parc_5g': None, 'autre_parc': None, 'trafic_data_in': None, 'trafic_voix_in': None, 'trafic_data_in_mo': None, 'ca_mtd': None, 'ca_norm': None, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3446', 'code_oci_id': 3446.0, 'ca_voix': 78506.79, 'ca_data': 95793.31, 'ca_total': 183206.1, 'parc_global': 6831.0, 'parc_data': 1639.0, 'parc_2g': 1046.0, 'parc_3g': 50.0, 'parc_4g': 572.0, 'parc_5g': 9.0, 'autre_parc': 103.0, 'trafic_data_in': 237113.25, 'trafic_voix_in': 17435.01, 'trafic_data_in_mo': 237.11325, 'ca_mtd': 183206.1, 'ca_norm': 5496183.0, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI2886', 'code_oci_id': 2886.0, 'ca_voix': 57702.19, 'ca_data': 64399.0, 'ca_total': 125859.19, 'parc_global': 2474.0, 'parc_data': 1492.0, 'parc_2g': 983.0, 'parc_3g': 27.0, 'parc_4g': 498.0, 'parc_5g': 3.0, 'autre_parc': 72.0, 'trafic_data_in': 100381.695, 'trafic_voix_in': 11929.88, 'trafic_data_in_mo': 100.38169500000001, 'ca_mtd': 125859.19, 'ca_norm': 3775775.7, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI2698', 'code_oci_id': 2698.0, 'ca_voix': 35397.63, 'ca_data': 35792.9, 'ca_total': 72989.53, 'parc_global': 1209.0, 'parc_data': 836.0, 'parc_2g': 516.0, 'parc_3g': 15.0, 'parc_4g': 264.0, 'parc_5g': 4.0, 'autre_parc': 65.0, 'trafic_data_in': 62178.35, 'trafic_voix_in': 13839.72, 'trafic_data_in_mo': 62.17835, 'ca_mtd': 72989.53, 'ca_norm': 2189685.9, 'mois': 6, 'annee': 2024}  ... displaying 10 of 3107 total bound parameter sets ...  {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3369', 'code_oci_id': 3369.0, 'ca_voix': 178586.05, 'ca_data': 462131.2, 'ca_total': 667171.25, 'parc_global': 3331.0, 'parc_data': 2737.0, 'parc_2g': 165.0, 'parc_3g': 22.0, 'parc_4g': 1188.0, 'parc_5g': 113.0, 'autre_parc': 59.0, 'trafic_data_in': 1269518.1, 'trafic_voix_in': 36183.13, 'trafic_data_in_mo': 1269.5181, 'ca_mtd': 667171.25, 'ca_norm': 20015137.5, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3326', 'code_oci_id': 3326.0, 'ca_voix': 249111.7, 'ca_data': 468166.16, 'ca_total': 742102.9, 'parc_global': 3203.0, 'parc_data': 2847.0, 'parc_2g': 95.0, 'parc_3g': 18.0, 'parc_4g': 1256.0, 'parc_5g': 168.0, 'autre_parc': 76.0, 'trafic_data_in': 1167098.0, 'trafic_voix_in': 40619.5, 'trafic_data_in_mo': 1167.098, 'ca_mtd': 742102.9, 'ca_norm': 22263087.0, 'mois': 6, 'annee': 2024})]
(Background on this error at: https://sqlalche.me/e/14/f405)
[2024-07-29T14:24:45.571+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-02T06:00:00+00:00, execution_date=20240602T060000, start_date=20240729T142444, end_date=20240729T142445
[2024-07-29T14:24:45.590+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-07-29T14:24:45.591+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-29T14:24:45.591+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-29T14:24:45.601+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-29T14:24:45.601+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-29T14:24:45.602+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1890, in _execute_context
    self.dialect.do_executemany(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/psycopg2.py", line 982, in do_executemany
    context._psycopg2_fetched_rows = xtras.execute_values(
                                     ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/psycopg2/extras.py", line 1299, in execute_values
    cur.execute(b''.join(parts))
psycopg2.errors.UndefinedColumn: column "code_oci" of relation "motower_daily_caparc_faits" does not exist
LINE 1: INSERT INTO motower_daily_caparc_faits (jour, code_oci, code...
                                                      ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 143, in gen_motower_daily
    write_pg(PG_SAVE_HOST, PG_SAVE_DB, PG_SAVE_USER, PG_SAVE_PASSWORD, df_faits, "motower_daily_caparc_faits")
  File "/opt/airflow/dags/gps/common/rwpg.py", line 66, in write_pg
    data.to_sql(table, engine, index=False, if_exists = 'append')
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/util/_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/generic.py", line 3008, in to_sql
    return sql.to_sql(
           ^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 788, in to_sql
    return pandas_sql.to_sql(
           ^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1958, in to_sql
    total_inserted = sql_engine.insert_records(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1507, in insert_records
    raise err
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1498, in insert_records
    return table.insert(chunksize=chunksize, method=method)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 1059, in insert
    num_inserted = exec_insert(conn, keys, chunk_iter)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 951, in _execute_insert
    result = conn.execute(self.table.insert(), data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1385, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 334, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1577, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1953, in _execute_context
    self._handle_dbapi_exception(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2134, in _handle_dbapi_exception
    util.raise_(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/util/compat.py", line 211, in raise_
    raise exception
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1890, in _execute_context
    self.dialect.do_executemany(
  File "/home/airflow/.local/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/psycopg2.py", line 982, in do_executemany
    context._psycopg2_fetched_rows = xtras.execute_values(
                                     ^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/psycopg2/extras.py", line 1299, in execute_values
    cur.execute(b''.join(parts))
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column "code_oci" of relation "motower_daily_caparc_faits" does not exist
LINE 1: INSERT INTO motower_daily_caparc_faits (jour, code_oci, code...
                                                      ^

[SQL: INSERT INTO motower_daily_caparc_faits (jour, code_oci, code_oci_id, ca_voix, ca_data, ca_total, parc_global, parc_data, parc_2g, parc_3g, parc_4g, parc_5g, autre_parc, trafic_data_in, trafic_voix_in, trafic_data_in_mo, ca_mtd, ca_norm, mois, annee) VALUES (%(jour)s, %(code_oci)s, %(code_oci_id)s, %(ca_voix)s, %(ca_data)s, %(ca_total)s, %(parc_global)s, %(parc_data)s, %(parc_2g)s, %(parc_3g)s, %(parc_4g)s, %(parc_5g)s, %(autre_parc)s, %(trafic_data_in)s, %(trafic_voix_in)s, %(trafic_data_in_mo)s, %(ca_mtd)s, %(ca_norm)s, %(mois)s, %(annee)s)]
[parameters: ({'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI2831', 'code_oci_id': 2831.0, 'ca_voix': 319805.2, 'ca_data': 585246.5, 'ca_total': 956035.44, 'parc_global': 9514.0, 'parc_data': 6605.0, 'parc_2g': 2113.0, 'parc_3g': 93.0, 'parc_4g': 2550.0, 'parc_5g': 177.0, 'autre_parc': 407.0, 'trafic_data_in': 1104383.2, 'trafic_voix_in': 53278.24, 'trafic_data_in_mo': 1104.3832, 'ca_mtd': 956035.44, 'ca_norm': 28681063.2, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3257', 'code_oci_id': 3257.0, 'ca_voix': 82856.15, 'ca_data': 121609.5, 'ca_total': 215874.66, 'parc_global': 2254.0, 'parc_data': 1541.0, 'parc_2g': 658.0, 'parc_3g': 21.0, 'parc_4g': 517.0, 'parc_5g': 3.0, 'autre_parc': 86.0, 'trafic_data_in': 286305.0, 'trafic_voix_in': 15792.22, 'trafic_data_in_mo': 286.305, 'ca_mtd': 215874.66, 'ca_norm': 6476239.8, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3428', 'code_oci_id': 3428.0, 'ca_voix': 186713.81, 'ca_data': 283735.0, 'ca_total': 500731.8, 'parc_global': 4564.0, 'parc_data': 3088.0, 'parc_2g': 606.0, 'parc_3g': 22.0, 'parc_4g': 1036.0, 'parc_5g': 114.0, 'autre_parc': 114.0, 'trafic_data_in': 748361.56, 'trafic_voix_in': 24169.3, 'trafic_data_in_mo': 748.36156, 'ca_mtd': 500731.8, 'ca_norm': 15021954.0, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI2587', 'code_oci_id': 2587.0, 'ca_voix': 212184.77, 'ca_data': 480902.84, 'ca_total': 709591.6, 'parc_global': 7900.0, 'parc_data': 4255.0, 'parc_2g': 1227.0, 'parc_3g': 52.0, 'parc_4g': 1630.0, 'parc_5g': 101.0, 'autre_parc': 211.0, 'trafic_data_in': 1410212.1, 'trafic_voix_in': 40453.93, 'trafic_data_in_mo': 1410.2121000000002, 'ca_mtd': 709591.6, 'ca_norm': 21287748.0, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3260', 'code_oci_id': 3260.0, 'ca_voix': None, 'ca_data': None, 'ca_total': None, 'parc_global': None, 'parc_data': None, 'parc_2g': None, 'parc_3g': None, 'parc_4g': None, 'parc_5g': None, 'autre_parc': None, 'trafic_data_in': None, 'trafic_voix_in': None, 'trafic_data_in_mo': None, 'ca_mtd': None, 'ca_norm': None, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3446', 'code_oci_id': 3446.0, 'ca_voix': 78506.79, 'ca_data': 95793.31, 'ca_total': 183206.1, 'parc_global': 6831.0, 'parc_data': 1639.0, 'parc_2g': 1046.0, 'parc_3g': 50.0, 'parc_4g': 572.0, 'parc_5g': 9.0, 'autre_parc': 103.0, 'trafic_data_in': 237113.25, 'trafic_voix_in': 17435.01, 'trafic_data_in_mo': 237.11325, 'ca_mtd': 183206.1, 'ca_norm': 5496183.0, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI2886', 'code_oci_id': 2886.0, 'ca_voix': 57702.19, 'ca_data': 64399.0, 'ca_total': 125859.19, 'parc_global': 2474.0, 'parc_data': 1492.0, 'parc_2g': 983.0, 'parc_3g': 27.0, 'parc_4g': 498.0, 'parc_5g': 3.0, 'autre_parc': 72.0, 'trafic_data_in': 100381.695, 'trafic_voix_in': 11929.88, 'trafic_data_in_mo': 100.38169500000001, 'ca_mtd': 125859.19, 'ca_norm': 3775775.7, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI2698', 'code_oci_id': 2698.0, 'ca_voix': 35397.63, 'ca_data': 35792.9, 'ca_total': 72989.53, 'parc_global': 1209.0, 'parc_data': 836.0, 'parc_2g': 516.0, 'parc_3g': 15.0, 'parc_4g': 264.0, 'parc_5g': 4.0, 'autre_parc': 65.0, 'trafic_data_in': 62178.35, 'trafic_voix_in': 13839.72, 'trafic_data_in_mo': 62.17835, 'ca_mtd': 72989.53, 'ca_norm': 2189685.9, 'mois': 6, 'annee': 2024}  ... displaying 10 of 3107 total bound parameter sets ...  {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3369', 'code_oci_id': 3369.0, 'ca_voix': 178586.05, 'ca_data': 462131.2, 'ca_total': 667171.25, 'parc_global': 3331.0, 'parc_data': 2737.0, 'parc_2g': 165.0, 'parc_3g': 22.0, 'parc_4g': 1188.0, 'parc_5g': 113.0, 'autre_parc': 59.0, 'trafic_data_in': 1269518.1, 'trafic_voix_in': 36183.13, 'trafic_data_in_mo': 1269.5181, 'ca_mtd': 667171.25, 'ca_norm': 20015137.5, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3326', 'code_oci_id': 3326.0, 'ca_voix': 249111.7, 'ca_data': 468166.16, 'ca_total': 742102.9, 'parc_global': 3203.0, 'parc_data': 2847.0, 'parc_2g': 95.0, 'parc_3g': 18.0, 'parc_4g': 1256.0, 'parc_5g': 168.0, 'autre_parc': 76.0, 'trafic_data_in': 1167098.0, 'trafic_voix_in': 40619.5, 'trafic_data_in_mo': 1167.098, 'ca_mtd': 742102.9, 'ca_norm': 22263087.0, 'mois': 6, 'annee': 2024})]
(Background on this error at: https://sqlalche.me/e/14/f405)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-07-29T14:24:45.612+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-07-29T14:24:45.612+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-29T14:24:45.613+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-29T14:24:45.632+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 1022 for task motower_dcaparc ((psycopg2.errors.UndefinedColumn) column "code_oci" of relation "motower_daily_caparc_faits" does not exist
LINE 1: INSERT INTO motower_daily_caparc_faits (jour, code_oci, code...
                                                      ^

[SQL: INSERT INTO motower_daily_caparc_faits (jour, code_oci, code_oci_id, ca_voix, ca_data, ca_total, parc_global, parc_data, parc_2g, parc_3g, parc_4g, parc_5g, autre_parc, trafic_data_in, trafic_voix_in, trafic_data_in_mo, ca_mtd, ca_norm, mois, annee) VALUES (%(jour)s, %(code_oci)s, %(code_oci_id)s, %(ca_voix)s, %(ca_data)s, %(ca_total)s, %(parc_global)s, %(parc_data)s, %(parc_2g)s, %(parc_3g)s, %(parc_4g)s, %(parc_5g)s, %(autre_parc)s, %(trafic_data_in)s, %(trafic_voix_in)s, %(trafic_data_in_mo)s, %(ca_mtd)s, %(ca_norm)s, %(mois)s, %(annee)s)]
[parameters: ({'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI2831', 'code_oci_id': 2831.0, 'ca_voix': 319805.2, 'ca_data': 585246.5, 'ca_total': 956035.44, 'parc_global': 9514.0, 'parc_data': 6605.0, 'parc_2g': 2113.0, 'parc_3g': 93.0, 'parc_4g': 2550.0, 'parc_5g': 177.0, 'autre_parc': 407.0, 'trafic_data_in': 1104383.2, 'trafic_voix_in': 53278.24, 'trafic_data_in_mo': 1104.3832, 'ca_mtd': 956035.44, 'ca_norm': 28681063.2, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3257', 'code_oci_id': 3257.0, 'ca_voix': 82856.15, 'ca_data': 121609.5, 'ca_total': 215874.66, 'parc_global': 2254.0, 'parc_data': 1541.0, 'parc_2g': 658.0, 'parc_3g': 21.0, 'parc_4g': 517.0, 'parc_5g': 3.0, 'autre_parc': 86.0, 'trafic_data_in': 286305.0, 'trafic_voix_in': 15792.22, 'trafic_data_in_mo': 286.305, 'ca_mtd': 215874.66, 'ca_norm': 6476239.8, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3428', 'code_oci_id': 3428.0, 'ca_voix': 186713.81, 'ca_data': 283735.0, 'ca_total': 500731.8, 'parc_global': 4564.0, 'parc_data': 3088.0, 'parc_2g': 606.0, 'parc_3g': 22.0, 'parc_4g': 1036.0, 'parc_5g': 114.0, 'autre_parc': 114.0, 'trafic_data_in': 748361.56, 'trafic_voix_in': 24169.3, 'trafic_data_in_mo': 748.36156, 'ca_mtd': 500731.8, 'ca_norm': 15021954.0, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI2587', 'code_oci_id': 2587.0, 'ca_voix': 212184.77, 'ca_data': 480902.84, 'ca_total': 709591.6, 'parc_global': 7900.0, 'parc_data': 4255.0, 'parc_2g': 1227.0, 'parc_3g': 52.0, 'parc_4g': 1630.0, 'parc_5g': 101.0, 'autre_parc': 211.0, 'trafic_data_in': 1410212.1, 'trafic_voix_in': 40453.93, 'trafic_data_in_mo': 1410.2121000000002, 'ca_mtd': 709591.6, 'ca_norm': 21287748.0, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3260', 'code_oci_id': 3260.0, 'ca_voix': None, 'ca_data': None, 'ca_total': None, 'parc_global': None, 'parc_data': None, 'parc_2g': None, 'parc_3g': None, 'parc_4g': None, 'parc_5g': None, 'autre_parc': None, 'trafic_data_in': None, 'trafic_voix_in': None, 'trafic_data_in_mo': None, 'ca_mtd': None, 'ca_norm': None, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3446', 'code_oci_id': 3446.0, 'ca_voix': 78506.79, 'ca_data': 95793.31, 'ca_total': 183206.1, 'parc_global': 6831.0, 'parc_data': 1639.0, 'parc_2g': 1046.0, 'parc_3g': 50.0, 'parc_4g': 572.0, 'parc_5g': 9.0, 'autre_parc': 103.0, 'trafic_data_in': 237113.25, 'trafic_voix_in': 17435.01, 'trafic_data_in_mo': 237.11325, 'ca_mtd': 183206.1, 'ca_norm': 5496183.0, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI2886', 'code_oci_id': 2886.0, 'ca_voix': 57702.19, 'ca_data': 64399.0, 'ca_total': 125859.19, 'parc_global': 2474.0, 'parc_data': 1492.0, 'parc_2g': 983.0, 'parc_3g': 27.0, 'parc_4g': 498.0, 'parc_5g': 3.0, 'autre_parc': 72.0, 'trafic_data_in': 100381.695, 'trafic_voix_in': 11929.88, 'trafic_data_in_mo': 100.38169500000001, 'ca_mtd': 125859.19, 'ca_norm': 3775775.7, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI2698', 'code_oci_id': 2698.0, 'ca_voix': 35397.63, 'ca_data': 35792.9, 'ca_total': 72989.53, 'parc_global': 1209.0, 'parc_data': 836.0, 'parc_2g': 516.0, 'parc_3g': 15.0, 'parc_4g': 264.0, 'parc_5g': 4.0, 'autre_parc': 65.0, 'trafic_data_in': 62178.35, 'trafic_voix_in': 13839.72, 'trafic_data_in_mo': 62.17835, 'ca_mtd': 72989.53, 'ca_norm': 2189685.9, 'mois': 6, 'annee': 2024}  ... displaying 10 of 3107 total bound parameter sets ...  {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3369', 'code_oci_id': 3369.0, 'ca_voix': 178586.05, 'ca_data': 462131.2, 'ca_total': 667171.25, 'parc_global': 3331.0, 'parc_data': 2737.0, 'parc_2g': 165.0, 'parc_3g': 22.0, 'parc_4g': 1188.0, 'parc_5g': 113.0, 'autre_parc': 59.0, 'trafic_data_in': 1269518.1, 'trafic_voix_in': 36183.13, 'trafic_data_in_mo': 1269.5181, 'ca_mtd': 667171.25, 'ca_norm': 20015137.5, 'mois': 6, 'annee': 2024}, {'jour': datetime.datetime(2024, 6, 1, 0, 0), 'code_oci': 'OCI3326', 'code_oci_id': 3326.0, 'ca_voix': 249111.7, 'ca_data': 468166.16, 'ca_total': 742102.9, 'parc_global': 3203.0, 'parc_data': 2847.0, 'parc_2g': 95.0, 'parc_3g': 18.0, 'parc_4g': 1256.0, 'parc_5g': 168.0, 'autre_parc': 76.0, 'trafic_data_in': 1167098.0, 'trafic_voix_in': 40619.5, 'trafic_data_in_mo': 1167.098, 'ca_mtd': 742102.9, 'ca_norm': 22263087.0, 'mois': 6, 'annee': 2024})]
(Background on this error at: https://sqlalche.me/e/14/f405); 405)
[2024-07-29T14:24:45.673+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-07-29T14:24:45.696+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-29T14:24:45.699+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-29T14:31:46.356+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-29T14:31:46.652+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-29T14:31:46.661+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-29T14:31:46.662+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-29T14:31:46.675+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-02 06:00:00+00:00
[2024-07-29T14:31:46.688+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=727) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-29T14:31:46.689+0000] {standard_task_runner.py:64} INFO - Started process 739 to run task
[2024-07-29T14:31:46.689+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-02T06:00:00+00:00', '--job-id', '1101', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpfgggm55f']
[2024-07-29T14:31:46.692+0000] {standard_task_runner.py:91} INFO - Job 1101: Subtask motower_dcaparc
[2024-07-29T14:31:46.744+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [running]> on host e824106b656d
[2024-07-29T14:31:46.852+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-02T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-02T06:00:00+00:00'
[2024-07-29T14:31:46.854+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-29T14:31:46.877+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-29T14:31:46.889+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-29T14:31:46.952+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-29T14:31:46.954+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-29T14:31:46.955+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-01
[2024-07-29T14:31:46.956+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/01.csv
[2024-07-29T14:31:46.981+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240601  5.327182e+08  8.044059e+08  16715871    9176426  12042566   875452  5841327   297932     1379325  1.395652e+09
[2024-07-29T14:31:46.982+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-29T14:31:46.984+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-29T14:31:46.984+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-29T14:31:46.985+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-29T14:31:46.985+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-29T14:31:46.986+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-29T14:31:46.987+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-29T14:31:46.988+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-29T14:31:46.988+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-29T14:31:46.989+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-29T14:31:46.989+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-29T14:31:46.993+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-29T14:31:46.995+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-29T14:31:46.998+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-29T14:31:46.999+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-29T14:31:47.000+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-29T14:31:47.001+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-29T14:31:47.001+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-29T14:31:47.002+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-29T14:31:47.002+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-29T14:31:47.002+0000] {logging_mixin.py:188} INFO - 6
[2024-07-29T14:31:47.003+0000] {logging_mixin.py:188} INFO - 2024-06-01 00:00:00
[2024-07-29T14:31:47.015+0000] {motower_daily.py:200} INFO - ADD  SEGMENT
[2024-07-29T14:31:47.197+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-29T14:31:47.197+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-29T14:31:47.198+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-29T14:31:47.205+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-01  5.206589e+08  7.907621e+08   14770374.0  8934529.0  3810606.0  121316.0  3061852.0  193275.0    442619.0  1.368038e+09
[2024-07-29T14:31:47.206+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-29T14:31:47.206+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-29T14:31:47.207+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-29T14:31:47.207+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-29T14:31:47.207+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-29T14:31:47.208+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-29T14:31:47.208+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-29T14:31:47.209+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-29T14:31:47.209+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-29T14:31:47.209+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-29T14:31:47.235+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-29T14:31:47.272+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-29T14:31:47.285+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:139: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['mois'] = data["jour"].dt.month

[2024-07-29T14:31:47.286+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:140: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['annee'] = data["jour"].dt.year

[2024-07-29T14:31:48.740+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-29T14:31:48.741+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-29T14:31:48.752+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-02T06:00:00+00:00, execution_date=20240602T060000, start_date=20240729T143146, end_date=20240729T143148
[2024-07-29T14:31:48.795+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-29T14:31:48.815+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-29T14:31:48.817+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-29T16:02:58.543+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-29T16:02:59.071+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-29T16:02:59.098+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-29T16:02:59.100+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-29T16:02:59.160+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-02 06:00:00+00:00
[2024-07-29T16:02:59.181+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=514) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-29T16:02:59.185+0000] {standard_task_runner.py:64} INFO - Started process 536 to run task
[2024-07-29T16:02:59.208+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-02T06:00:00+00:00', '--job-id', '16', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpw77g92lr']
[2024-07-29T16:02:59.212+0000] {standard_task_runner.py:91} INFO - Job 16: Subtask motower_dcaparc
[2024-07-29T16:02:59.421+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [running]> on host 7d7c82e77e1e
[2024-07-29T16:02:59.776+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-02T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-02T06:00:00+00:00'
[2024-07-29T16:02:59.792+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-29T16:02:59.846+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-29T16:02:59.907+0000] {motower_daily.py:117} INFO - READING None
[2024-07-29T16:02:59.908+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-29T16:02:59.915+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 119, in gen_motower_daily
    data = generate_daily_caparc(
       ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 123, in generate_daily_caparc
    validate_site_actifs(df_bdd_site=bdd, col="code oci", host=smtphost, port=smtpport, user=smtpuser)
                                     ^^^
UnboundLocalError: cannot access local variable 'bdd' where it is not associated with a value
[2024-07-29T16:02:59.975+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-02T06:00:00+00:00, execution_date=20240602T060000, start_date=20240729T160259, end_date=20240729T160259
[2024-07-29T16:03:00.023+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-07-29T16:03:00.025+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-29T16:03:00.025+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-29T16:03:00.042+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-29T16:03:00.042+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-29T16:03:00.044+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 119, in gen_motower_daily
    data = generate_daily_caparc(
       ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 123, in generate_daily_caparc
    validate_site_actifs(df_bdd_site=bdd, col="code oci", host=smtphost, port=smtpport, user=smtpuser)
                                     ^^^
UnboundLocalError: cannot access local variable 'bdd' where it is not associated with a value

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-07-29T16:03:00.057+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-07-29T16:03:00.058+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-29T16:03:00.060+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-29T16:03:00.090+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 16 for task motower_dcaparc (cannot access local variable 'bdd' where it is not associated with a value; 536)
[2024-07-29T16:03:00.119+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-07-29T16:03:00.139+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-29T16:17:09.566+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-29T16:17:09.690+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-29T16:17:09.759+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-29T16:17:09.760+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-29T16:17:09.827+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-02 06:00:00+00:00
[2024-07-29T16:17:09.846+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=804) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-29T16:17:09.848+0000] {standard_task_runner.py:64} INFO - Started process 821 to run task
[2024-07-29T16:17:09.849+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-02T06:00:00+00:00', '--job-id', '55', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmp5_ajtx9o']
[2024-07-29T16:17:09.884+0000] {standard_task_runner.py:91} INFO - Job 55: Subtask motower_dcaparc
[2024-07-29T16:17:10.023+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [running]> on host 7d7c82e77e1e
[2024-07-29T16:17:10.389+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-02T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-02T06:00:00+00:00'
[2024-07-29T16:17:10.391+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-29T16:17:10.431+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-29T16:17:10.465+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/BASE_SITES_202305.xlsx
[2024-07-29T16:17:15.202+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-29T16:17:15.203+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-29T16:17:15.204+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 3791, in get_loc
    return self._engine.get_loc(casted_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "index.pyx", line 152, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 181, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7080, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'code oci'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 119, in gen_motower_daily
    data = generate_daily_caparc(
       ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 123, in generate_daily_caparc
    validate_site_actifs(df_bdd_site=bdd, col="code oci", host=smtphost, port=smtpport, user=smtpuser)
  File "/opt/airflow/dags/gps/common/data_validation.py", line 30, in validate_site_actifs
    number = df_bdd_site[col].nunique()
             ~~~~~~~~~~~^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/frame.py", line 3893, in __getitem__
    indexer = self.columns.get_loc(key)
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 3798, in get_loc
    raise KeyError(key) from err
KeyError: 'code oci'
[2024-07-29T16:17:15.238+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-02T06:00:00+00:00, execution_date=20240602T060000, start_date=20240729T161709, end_date=20240729T161715
[2024-07-29T16:17:15.277+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-07-29T16:17:15.278+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-29T16:17:15.278+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-29T16:17:15.307+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-29T16:17:15.308+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-29T16:17:15.321+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 3791, in get_loc
    return self._engine.get_loc(casted_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "index.pyx", line 152, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 181, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7080, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'code oci'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 119, in gen_motower_daily
    data = generate_daily_caparc(
       ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 123, in generate_daily_caparc
    validate_site_actifs(df_bdd_site=bdd, col="code oci", host=smtphost, port=smtpport, user=smtpuser)
  File "/opt/airflow/dags/gps/common/data_validation.py", line 30, in validate_site_actifs
    number = df_bdd_site[col].nunique()
             ~~~~~~~~~~~^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/frame.py", line 3893, in __getitem__
    indexer = self.columns.get_loc(key)
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 3798, in get_loc
    raise KeyError(key) from err
KeyError: 'code oci'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-07-29T16:17:15.353+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-07-29T16:17:15.355+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-29T16:17:15.360+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-29T16:17:16.212+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 55 for task motower_dcaparc ('code oci'; 821)
[2024-07-29T16:17:16.311+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-07-29T16:17:16.404+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-29T16:17:16.415+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-30T09:11:56.401+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-30T09:11:56.487+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-30T09:11:56.514+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-07-30T09:11:56.514+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-30T09:11:56.556+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-02 06:00:00+00:00
[2024-07-30T09:11:56.576+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=818) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-30T09:11:56.578+0000] {standard_task_runner.py:64} INFO - Started process 832 to run task
[2024-07-30T09:11:56.586+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-02T06:00:00+00:00', '--job-id', '238', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmp2to31he4']
[2024-07-30T09:11:56.590+0000] {standard_task_runner.py:91} INFO - Job 238: Subtask motower_dcaparc
[2024-07-30T09:11:56.702+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [running]> on host 7d7c82e77e1e
[2024-07-30T09:11:56.951+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-02T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-02T06:00:00+00:00'
[2024-07-30T09:11:56.953+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-30T09:11:57.025+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-30T09:11:57.057+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/BASE_SITES_202305.xlsx
[2024-07-30T09:12:02.788+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-30T09:12:02.789+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-30T09:12:02.790+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 3791, in get_loc
    return self._engine.get_loc(casted_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "index.pyx", line 152, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 181, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7080, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'code oci'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 119, in gen_motower_daily
    data = generate_daily_caparc(
       ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 123, in generate_daily_caparc
    validate_site_actifs(df_bdd_site=bdd, col="code oci", host=smtphost, port=smtpport, user=smtpuser)
  File "/opt/airflow/dags/gps/common/data_validation.py", line 30, in validate_site_actifs
    number = df_bdd_site[col].nunique()
             ~~~~~~~~~~~^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/frame.py", line 3893, in __getitem__
    indexer = self.columns.get_loc(key)
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 3798, in get_loc
    raise KeyError(key) from err
KeyError: 'code oci'
[2024-07-30T09:12:02.806+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-02T06:00:00+00:00, execution_date=20240602T060000, start_date=20240730T091156, end_date=20240730T091202
[2024-07-30T09:12:02.830+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-07-30T09:12:02.831+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-30T09:12:02.831+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-30T09:12:02.841+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-30T09:12:02.842+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-30T09:12:02.843+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 3791, in get_loc
    return self._engine.get_loc(casted_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "index.pyx", line 152, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 181, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7080, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'code oci'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 119, in gen_motower_daily
    data = generate_daily_caparc(
       ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 123, in generate_daily_caparc
    validate_site_actifs(df_bdd_site=bdd, col="code oci", host=smtphost, port=smtpport, user=smtpuser)
  File "/opt/airflow/dags/gps/common/data_validation.py", line 30, in validate_site_actifs
    number = df_bdd_site[col].nunique()
             ~~~~~~~~~~~^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/frame.py", line 3893, in __getitem__
    indexer = self.columns.get_loc(key)
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 3798, in get_loc
    raise KeyError(key) from err
KeyError: 'code oci'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-07-30T09:12:02.851+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-07-30T09:12:02.851+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-30T09:12:02.852+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-30T09:12:02.875+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 238 for task motower_dcaparc ('code oci'; 832)
[2024-07-30T09:12:02.936+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-07-30T09:12:02.964+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-30T09:12:02.968+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-08-02T12:22:26.340+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-08-02T12:22:26.822+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-08-02T12:22:26.866+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [queued]>
[2024-08-02T12:22:26.867+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-08-02T12:22:26.923+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-02 06:00:00+00:00
[2024-08-02T12:22:26.943+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=641) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-08-02T12:22:26.971+0000] {standard_task_runner.py:64} INFO - Started process 663 to run task
[2024-08-02T12:22:26.968+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-02T06:00:00+00:00', '--job-id', '802', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmp_a79bqnh']
[2024-08-02T12:22:26.972+0000] {standard_task_runner.py:91} INFO - Job 802: Subtask motower_dcaparc
[2024-08-02T12:22:27.096+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-02T06:00:00+00:00 [running]> on host 0ed00079025b
[2024-08-02T12:22:27.408+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-02T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-02T06:00:00+00:00'
[2024-08-02T12:22:27.410+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-08-02T12:22:27.467+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-08-02T12:22:27.513+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/07/02.csv
[2024-08-02T12:22:27.751+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-08-02T12:22:27.755+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-08-02T12:22:27.756+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-01
[2024-08-02T12:22:27.757+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/01.csv
[2024-08-02T12:22:27.861+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240601  5.327182e+08  8.044059e+08  16715871    9176426  12042566   875452  5841327   297932     1379325  1.395652e+09
[2024-08-02T12:22:27.863+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-08-02T12:22:27.871+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-08-02T12:22:27.872+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-08-02T12:22:27.874+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-08-02T12:22:27.875+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-08-02T12:22:27.877+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-08-02T12:22:27.878+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-08-02T12:22:27.883+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-08-02T12:22:27.883+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-08-02T12:22:27.886+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-08-02T12:22:27.887+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-08-02T12:22:27.899+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-08-02T12:22:27.904+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-08-02T12:22:27.909+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-08-02T12:22:27.914+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-08-02T12:22:27.916+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-08-02T12:22:27.917+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-08-02T12:22:27.919+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-08-02T12:22:27.921+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-08-02T12:22:27.923+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-08-02T12:22:27.924+0000] {logging_mixin.py:188} INFO - 6
[2024-08-02T12:22:27.924+0000] {logging_mixin.py:188} INFO - 2024-06-01 00:00:00
[2024-08-02T12:22:27.962+0000] {motower_daily.py:200} INFO - ADD  SEGMENT
[2024-08-02T12:22:28.587+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-08-02T12:22:28.587+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-08-02T12:22:28.589+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-08-02T12:22:28.605+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-01  5.206589e+08  7.907621e+08   14770374.0  8934529.0  3810606.0  121316.0  3061852.0  193275.0    442619.0  1.368038e+09
[2024-08-02T12:22:28.606+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-08-02T12:22:28.607+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-08-02T12:22:28.609+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-08-02T12:22:28.611+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-08-02T12:22:28.611+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-08-02T12:22:28.613+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-08-02T12:22:28.614+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-08-02T12:22:28.615+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-08-02T12:22:28.616+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-08-02T12:22:28.618+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-08-02T12:22:28.695+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-08-02T12:22:28.800+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-01  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-01  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-01  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-01  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-01  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-08-02T12:22:28.818+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:139: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['mois'] = data["jour"].dt.month

[2024-08-02T12:22:28.820+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:140: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['annee'] = data["jour"].dt.year

[2024-08-02T12:22:33.154+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-08-02T12:22:33.155+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-08-02T12:22:33.182+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-02T06:00:00+00:00, execution_date=20240602T060000, start_date=20240802T122226, end_date=20240802T122233
[2024-08-02T12:22:34.211+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-08-02T12:22:34.248+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-08-02T12:22:34.254+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
