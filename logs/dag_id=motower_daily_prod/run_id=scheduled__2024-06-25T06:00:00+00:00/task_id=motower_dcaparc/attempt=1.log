[2024-07-22T16:56:55.677+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-22T16:56:55.987+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-22T16:56:56.000+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-22T16:56:56.001+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-22T16:56:56.019+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-25 06:00:00+00:00
[2024-07-22T16:56:56.034+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=873) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-22T16:56:56.036+0000] {standard_task_runner.py:64} INFO - Started process 893 to run task
[2024-07-22T16:56:56.036+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-25T06:00:00+00:00', '--job-id', '66', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmplv9yopyh']
[2024-07-22T16:56:56.039+0000] {standard_task_runner.py:91} INFO - Job 66: Subtask motower_dcaparc
[2024-07-22T16:56:56.093+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [running]> on host 5e959f2258db
[2024-07-22T16:56:56.205+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-25T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-25T06:00:00+00:00'
[2024-07-22T16:56:56.208+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-22T16:56:56.235+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-22T16:56:56.239+0000] {connectionpool.py:872} WARNING - Retrying (Retry(total=4, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<urllib3.connection.HTTPConnection object at 0x728630492cc0>: Failed to establish a new connection: [Errno 111] Connection refused')': /motower?location=
[2024-07-22T16:56:56.640+0000] {connectionpool.py:872} WARNING - Retrying (Retry(total=3, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7286304930b0>: Failed to establish a new connection: [Errno 111] Connection refused')': /motower?location=
[2024-07-22T16:56:57.442+0000] {connectionpool.py:872} WARNING - Retrying (Retry(total=2, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7286304933b0>: Failed to establish a new connection: [Errno 111] Connection refused')': /motower?location=
[2024-07-22T16:56:59.044+0000] {connectionpool.py:872} WARNING - Retrying (Retry(total=1, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7286304937d0>: Failed to establish a new connection: [Errno 111] Connection refused')': /motower?location=
[2024-07-22T16:57:02.246+0000] {connectionpool.py:872} WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<urllib3.connection.HTTPConnection object at 0x728630493c80>: Failed to establish a new connection: [Errno 111] Connection refused')': /motower?location=
[2024-07-22T16:57:02.248+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-22T16:57:02.248+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connection.py", line 203, in _new_conn
    sock = connection.create_connection(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connectionpool.py", line 791, in urlopen
    response = self._make_request(
               ^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connectionpool.py", line 497, in _make_request
    conn.request(
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connection.py", line 395, in request
    self.endheaders()
  File "/usr/local/lib/python3.12/http/client.py", line 1331, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "/usr/local/lib/python3.12/http/client.py", line 1091, in _send_output
    self.send(msg)
  File "/usr/local/lib/python3.12/http/client.py", line 1035, in send
    self.connect()
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connection.py", line 243, in connect
    self.sock = self._new_conn()
                ^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connection.py", line 218, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x728630493da0>: Failed to establish a new connection: [Errno 111] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 112, in gen_motower_daily
    data = generate_daily_caparc(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 116, in generate_daily_caparc
    if not client.bucket_exists(table_obj["bucket"]):
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/minio/api.py", line 696, in bucket_exists
    self._execute("HEAD", bucket_name)
  File "/home/airflow/.local/lib/python3.12/site-packages/minio/api.py", line 437, in _execute
    region = self._get_region(bucket_name)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/minio/api.py", line 494, in _get_region
    response = self._url_open(
               ^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/minio/api.py", line 302, in _url_open
    response = self._http.urlopen(
               ^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/poolmanager.py", line 443, in urlopen
    response = conn.urlopen(method, u.request_uri, **kw)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connectionpool.py", line 875, in urlopen
    return self.urlopen(
           ^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connectionpool.py", line 875, in urlopen
    return self.urlopen(
           ^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connectionpool.py", line 875, in urlopen
    return self.urlopen(
           ^^^^^^^^^^^^^
  [Previous line repeated 2 more times]
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connectionpool.py", line 845, in urlopen
    retries = retries.increment(
              ^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/util/retry.py", line 515, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='minio', port=80): Max retries exceeded with url: /motower?location= (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x728630493da0>: Failed to establish a new connection: [Errno 111] Connection refused'))
[2024-07-22T16:57:02.263+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-25T06:00:00+00:00, execution_date=20240625T060000, start_date=20240722T165655, end_date=20240722T165702
[2024-07-22T16:57:02.280+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-07-22T16:57:02.281+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-22T16:57:02.281+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-22T16:57:02.290+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-22T16:57:02.291+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-22T16:57:02.292+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connection.py", line 203, in _new_conn
    sock = connection.create_connection(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connectionpool.py", line 791, in urlopen
    response = self._make_request(
               ^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connectionpool.py", line 497, in _make_request
    conn.request(
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connection.py", line 395, in request
    self.endheaders()
  File "/usr/local/lib/python3.12/http/client.py", line 1331, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "/usr/local/lib/python3.12/http/client.py", line 1091, in _send_output
    self.send(msg)
  File "/usr/local/lib/python3.12/http/client.py", line 1035, in send
    self.connect()
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connection.py", line 243, in connect
    self.sock = self._new_conn()
                ^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connection.py", line 218, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x728630493da0>: Failed to establish a new connection: [Errno 111] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 112, in gen_motower_daily
    data = generate_daily_caparc(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 116, in generate_daily_caparc
    if not client.bucket_exists(table_obj["bucket"]):
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/minio/api.py", line 696, in bucket_exists
    self._execute("HEAD", bucket_name)
  File "/home/airflow/.local/lib/python3.12/site-packages/minio/api.py", line 437, in _execute
    region = self._get_region(bucket_name)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/minio/api.py", line 494, in _get_region
    response = self._url_open(
               ^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/minio/api.py", line 302, in _url_open
    response = self._http.urlopen(
               ^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/poolmanager.py", line 443, in urlopen
    response = conn.urlopen(method, u.request_uri, **kw)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connectionpool.py", line 875, in urlopen
    return self.urlopen(
           ^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connectionpool.py", line 875, in urlopen
    return self.urlopen(
           ^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connectionpool.py", line 875, in urlopen
    return self.urlopen(
           ^^^^^^^^^^^^^
  [Previous line repeated 2 more times]
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connectionpool.py", line 845, in urlopen
    retries = retries.increment(
              ^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/util/retry.py", line 515, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='minio', port=80): Max retries exceeded with url: /motower?location= (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x728630493da0>: Failed to establish a new connection: [Errno 111] Connection refused'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-07-22T16:57:02.298+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-07-22T16:57:02.298+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-22T16:57:02.299+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-22T16:57:02.313+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 66 for task motower_dcaparc (HTTPConnectionPool(host='minio', port=80): Max retries exceeded with url: /motower?location= (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x728630493da0>: Failed to establish a new connection: [Errno 111] Connection refused')); 893)
[2024-07-22T16:57:02.360+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-07-22T16:57:02.377+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-22T16:57:02.378+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-22T17:16:08.990+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-22T17:16:09.314+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-22T17:16:09.324+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-22T17:16:09.325+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-22T17:16:09.343+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-25 06:00:00+00:00
[2024-07-22T17:16:09.357+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=1262) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-22T17:16:09.358+0000] {standard_task_runner.py:64} INFO - Started process 1274 to run task
[2024-07-22T17:16:09.359+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-25T06:00:00+00:00', '--job-id', '107', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpytzzwhce']
[2024-07-22T17:16:09.362+0000] {standard_task_runner.py:91} INFO - Job 107: Subtask motower_dcaparc
[2024-07-22T17:16:09.417+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [running]> on host 5e959f2258db
[2024-07-22T17:16:09.543+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-25T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-25T06:00:00+00:00'
[2024-07-22T17:16:09.548+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-22T17:16:09.569+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-22T17:16:09.573+0000] {connectionpool.py:872} WARNING - Retrying (Retry(total=4, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<urllib3.connection.HTTPConnection object at 0x72863048f3e0>: Failed to establish a new connection: [Errno 111] Connection refused')': /motower?location=
[2024-07-22T17:16:09.975+0000] {connectionpool.py:872} WARNING - Retrying (Retry(total=3, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<urllib3.connection.HTTPConnection object at 0x72863048f7d0>: Failed to establish a new connection: [Errno 111] Connection refused')': /motower?location=
[2024-07-22T17:16:10.777+0000] {connectionpool.py:872} WARNING - Retrying (Retry(total=2, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<urllib3.connection.HTTPConnection object at 0x72863048fc20>: Failed to establish a new connection: [Errno 111] Connection refused')': /motower?location=
[2024-07-22T17:16:12.379+0000] {connectionpool.py:872} WARNING - Retrying (Retry(total=1, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<urllib3.connection.HTTPConnection object at 0x72863048fe30>: Failed to establish a new connection: [Errno 111] Connection refused')': /motower?location=
[2024-07-22T17:16:15.581+0000] {connectionpool.py:872} WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=None, status=None)) after connection broken by 'NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7286304b8440>: Failed to establish a new connection: [Errno 111] Connection refused')': /motower?location=
[2024-07-22T17:16:15.583+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-22T17:16:15.584+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connection.py", line 203, in _new_conn
    sock = connection.create_connection(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connectionpool.py", line 791, in urlopen
    response = self._make_request(
               ^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connectionpool.py", line 497, in _make_request
    conn.request(
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connection.py", line 395, in request
    self.endheaders()
  File "/usr/local/lib/python3.12/http/client.py", line 1331, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "/usr/local/lib/python3.12/http/client.py", line 1091, in _send_output
    self.send(msg)
  File "/usr/local/lib/python3.12/http/client.py", line 1035, in send
    self.connect()
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connection.py", line 243, in connect
    self.sock = self._new_conn()
                ^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connection.py", line 218, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x7286304b8980>: Failed to establish a new connection: [Errno 111] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 116, in generate_daily_caparc
    if not client.bucket_exists(table_obj["bucket"]):
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/minio/api.py", line 696, in bucket_exists
    self._execute("HEAD", bucket_name)
  File "/home/airflow/.local/lib/python3.12/site-packages/minio/api.py", line 437, in _execute
    region = self._get_region(bucket_name)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/minio/api.py", line 494, in _get_region
    response = self._url_open(
               ^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/minio/api.py", line 302, in _url_open
    response = self._http.urlopen(
               ^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/poolmanager.py", line 443, in urlopen
    response = conn.urlopen(method, u.request_uri, **kw)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connectionpool.py", line 875, in urlopen
    return self.urlopen(
           ^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connectionpool.py", line 875, in urlopen
    return self.urlopen(
           ^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connectionpool.py", line 875, in urlopen
    return self.urlopen(
           ^^^^^^^^^^^^^
  [Previous line repeated 2 more times]
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connectionpool.py", line 845, in urlopen
    retries = retries.increment(
              ^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/util/retry.py", line 515, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='minio', port=80): Max retries exceeded with url: /motower?location= (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7286304b8980>: Failed to establish a new connection: [Errno 111] Connection refused'))
[2024-07-22T17:16:15.597+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-25T06:00:00+00:00, execution_date=20240625T060000, start_date=20240722T171609, end_date=20240722T171615
[2024-07-22T17:16:15.610+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-07-22T17:16:15.610+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-22T17:16:15.611+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-22T17:16:15.618+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-22T17:16:15.618+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-22T17:16:15.618+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connection.py", line 203, in _new_conn
    sock = connection.create_connection(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connectionpool.py", line 791, in urlopen
    response = self._make_request(
               ^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connectionpool.py", line 497, in _make_request
    conn.request(
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connection.py", line 395, in request
    self.endheaders()
  File "/usr/local/lib/python3.12/http/client.py", line 1331, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "/usr/local/lib/python3.12/http/client.py", line 1091, in _send_output
    self.send(msg)
  File "/usr/local/lib/python3.12/http/client.py", line 1035, in send
    self.connect()
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connection.py", line 243, in connect
    self.sock = self._new_conn()
                ^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connection.py", line 218, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x7286304b8980>: Failed to establish a new connection: [Errno 111] Connection refused

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 116, in generate_daily_caparc
    if not client.bucket_exists(table_obj["bucket"]):
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/minio/api.py", line 696, in bucket_exists
    self._execute("HEAD", bucket_name)
  File "/home/airflow/.local/lib/python3.12/site-packages/minio/api.py", line 437, in _execute
    region = self._get_region(bucket_name)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/minio/api.py", line 494, in _get_region
    response = self._url_open(
               ^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/minio/api.py", line 302, in _url_open
    response = self._http.urlopen(
               ^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/poolmanager.py", line 443, in urlopen
    response = conn.urlopen(method, u.request_uri, **kw)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connectionpool.py", line 875, in urlopen
    return self.urlopen(
           ^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connectionpool.py", line 875, in urlopen
    return self.urlopen(
           ^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connectionpool.py", line 875, in urlopen
    return self.urlopen(
           ^^^^^^^^^^^^^
  [Previous line repeated 2 more times]
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/connectionpool.py", line 845, in urlopen
    retries = retries.increment(
              ^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/urllib3/util/retry.py", line 515, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='minio', port=80): Max retries exceeded with url: /motower?location= (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7286304b8980>: Failed to establish a new connection: [Errno 111] Connection refused'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-07-22T17:16:15.622+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-07-22T17:16:15.622+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-22T17:16:15.623+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-22T17:16:15.639+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 107 for task motower_dcaparc (HTTPConnectionPool(host='minio', port=80): Max retries exceeded with url: /motower?location= (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7286304b8980>: Failed to establish a new connection: [Errno 111] Connection refused')); 1274)
[2024-07-22T17:16:15.675+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-07-22T17:16:15.692+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-22T17:16:15.694+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-22T17:43:22.312+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-22T17:43:22.666+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-22T17:43:22.679+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-22T17:43:22.680+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-22T17:43:22.696+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-25 06:00:00+00:00
[2024-07-22T17:43:22.709+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=1715) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-22T17:43:22.711+0000] {standard_task_runner.py:64} INFO - Started process 1731 to run task
[2024-07-22T17:43:22.711+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-25T06:00:00+00:00', '--job-id', '143', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpt0qumbeb']
[2024-07-22T17:43:22.714+0000] {standard_task_runner.py:91} INFO - Job 143: Subtask motower_dcaparc
[2024-07-22T17:43:22.772+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [running]> on host 5e959f2258db
[2024-07-22T17:43:22.898+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-25T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-25T06:00:00+00:00'
[2024-07-22T17:43:22.900+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-22T17:43:22.917+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-22T17:43:22.927+0000] {motower_daily.py:120} INFO - READING None
[2024-07-22T17:43:22.928+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-22T17:43:22.929+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 126, in generate_daily_caparc
    validate_site_actifs(df_bdd_site=bdd, col="code oci", host=smtphost, port=smtpport, user=smtpuser)
                                     ^^^
UnboundLocalError: cannot access local variable 'bdd' where it is not associated with a value
[2024-07-22T17:43:22.940+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-25T06:00:00+00:00, execution_date=20240625T060000, start_date=20240722T174322, end_date=20240722T174322
[2024-07-22T17:43:22.958+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-07-22T17:43:22.958+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-22T17:43:22.959+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-22T17:43:22.975+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-22T17:43:22.976+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-22T17:43:22.977+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 126, in generate_daily_caparc
    validate_site_actifs(df_bdd_site=bdd, col="code oci", host=smtphost, port=smtpport, user=smtpuser)
                                     ^^^
UnboundLocalError: cannot access local variable 'bdd' where it is not associated with a value

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-07-22T17:43:22.982+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-07-22T17:43:22.982+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-22T17:43:22.983+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-22T17:43:22.999+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 143 for task motower_dcaparc (cannot access local variable 'bdd' where it is not associated with a value; 1731)
[2024-07-22T17:43:23.054+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-07-22T17:43:23.076+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-22T17:43:23.077+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-23T14:35:12.207+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-23T14:35:12.235+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-23T14:35:12.243+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-23T14:35:12.243+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-23T14:35:12.259+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-25 06:00:00+00:00
[2024-07-23T14:35:12.268+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=168) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-23T14:35:12.270+0000] {standard_task_runner.py:64} INFO - Started process 172 to run task
[2024-07-23T14:35:12.270+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-25T06:00:00+00:00', '--job-id', '15', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmplf72rasb']
[2024-07-23T14:35:12.272+0000] {standard_task_runner.py:91} INFO - Job 15: Subtask motower_dcaparc
[2024-07-23T14:35:12.314+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [running]> on host 1437ca0d1cc4
[2024-07-23T14:35:12.388+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-25T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-25T06:00:00+00:00'
[2024-07-23T14:35:12.390+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-23T14:35:12.402+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-23T14:35:12.408+0000] {motower_daily.py:120} INFO - READING None
[2024-07-23T14:35:12.409+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-23T14:35:12.409+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 126, in generate_daily_caparc
    validate_site_actifs(df_bdd_site=bdd, col="code oci", host=smtphost, port=smtpport, user=smtpuser)
                                     ^^^
UnboundLocalError: cannot access local variable 'bdd' where it is not associated with a value
[2024-07-23T14:35:12.418+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-25T06:00:00+00:00, execution_date=20240625T060000, start_date=20240723T143512, end_date=20240723T143512
[2024-07-23T14:35:12.429+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-07-23T14:35:12.430+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-23T14:35:12.430+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-23T14:35:12.436+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-23T14:35:12.436+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-23T14:35:12.436+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 126, in generate_daily_caparc
    validate_site_actifs(df_bdd_site=bdd, col="code oci", host=smtphost, port=smtpport, user=smtpuser)
                                     ^^^
UnboundLocalError: cannot access local variable 'bdd' where it is not associated with a value

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-07-23T14:35:12.439+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-07-23T14:35:12.439+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-23T14:35:12.439+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-23T14:35:12.450+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 15 for task motower_dcaparc (cannot access local variable 'bdd' where it is not associated with a value; 172)
[2024-07-23T14:35:12.483+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-07-23T14:35:12.499+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-23T14:35:12.500+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-23T15:06:39.910+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-23T15:06:40.248+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-23T15:06:40.261+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-23T15:06:40.261+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-23T15:06:40.283+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-25 06:00:00+00:00
[2024-07-23T15:06:40.298+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=593) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-23T15:06:40.299+0000] {standard_task_runner.py:64} INFO - Started process 614 to run task
[2024-07-23T15:06:40.300+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-25T06:00:00+00:00', '--job-id', '106', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmp5p747ch3']
[2024-07-23T15:06:40.302+0000] {standard_task_runner.py:91} INFO - Job 106: Subtask motower_dcaparc
[2024-07-23T15:06:40.361+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [running]> on host 4dd3fd89b847
[2024-07-23T15:06:40.514+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-25T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-25T06:00:00+00:00'
[2024-07-23T15:06:40.516+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-23T15:06:40.539+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-23T15:06:40.551+0000] {motower_daily.py:120} INFO - READING None
[2024-07-23T15:06:40.552+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-23T15:06:40.552+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 126, in generate_daily_caparc
    validate_site_actifs(df_bdd_site=bdd, col="code oci", host=smtphost, port=smtpport, user=smtpuser)
                                     ^^^
UnboundLocalError: cannot access local variable 'bdd' where it is not associated with a value
[2024-07-23T15:06:40.581+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-25T06:00:00+00:00, execution_date=20240625T060000, start_date=20240723T150640, end_date=20240723T150640
[2024-07-23T15:06:40.603+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-07-23T15:06:40.604+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-23T15:06:40.604+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-23T15:06:40.614+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-23T15:06:40.615+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-23T15:06:40.615+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 126, in generate_daily_caparc
    validate_site_actifs(df_bdd_site=bdd, col="code oci", host=smtphost, port=smtpport, user=smtpuser)
                                     ^^^
UnboundLocalError: cannot access local variable 'bdd' where it is not associated with a value

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-07-23T15:06:40.627+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-07-23T15:06:40.628+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-23T15:06:40.628+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-23T15:06:40.647+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 106 for task motower_dcaparc (cannot access local variable 'bdd' where it is not associated with a value; 614)
[2024-07-23T15:06:40.701+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-07-23T15:06:40.713+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-23T15:17:30.054+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-23T15:17:30.087+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-23T15:17:30.104+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-23T15:17:30.107+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-23T15:17:30.126+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-25 06:00:00+00:00
[2024-07-23T15:17:30.142+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=898) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-23T15:17:30.144+0000] {standard_task_runner.py:64} INFO - Started process 914 to run task
[2024-07-23T15:17:30.144+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-25T06:00:00+00:00', '--job-id', '165', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmprbirp7ki']
[2024-07-23T15:17:30.146+0000] {standard_task_runner.py:91} INFO - Job 165: Subtask motower_dcaparc
[2024-07-23T15:17:30.216+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [running]> on host 4dd3fd89b847
[2024-07-23T15:17:30.345+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-25T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-25T06:00:00+00:00'
[2024-07-23T15:17:30.347+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-23T15:17:30.371+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-23T15:17:30.385+0000] {motower_daily.py:120} INFO - READING None
[2024-07-23T15:17:30.386+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-23T15:17:30.386+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 126, in generate_daily_caparc
    validate_site_actifs(df_bdd_site=bdd, col="code oci", host=smtphost, port=smtpport, user=smtpuser)
                                     ^^^
UnboundLocalError: cannot access local variable 'bdd' where it is not associated with a value
[2024-07-23T15:17:30.403+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-25T06:00:00+00:00, execution_date=20240625T060000, start_date=20240723T151730, end_date=20240723T151730
[2024-07-23T15:17:30.432+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-07-23T15:17:30.433+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-23T15:17:30.433+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-23T15:17:30.447+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-23T15:17:30.447+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-23T15:17:30.448+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 126, in generate_daily_caparc
    validate_site_actifs(df_bdd_site=bdd, col="code oci", host=smtphost, port=smtpport, user=smtpuser)
                                     ^^^
UnboundLocalError: cannot access local variable 'bdd' where it is not associated with a value

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-07-23T15:17:30.453+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-07-23T15:17:30.453+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-23T15:17:30.454+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-23T15:17:30.474+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 165 for task motower_dcaparc (cannot access local variable 'bdd' where it is not associated with a value; 914)
[2024-07-23T15:17:30.523+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-07-23T15:17:30.543+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-23T15:17:30.545+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-23T15:36:24.404+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-23T15:36:24.753+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-23T15:36:24.767+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-23T15:36:24.768+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-23T15:36:24.788+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-25 06:00:00+00:00
[2024-07-23T15:36:24.798+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=119) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-23T15:36:24.800+0000] {standard_task_runner.py:64} INFO - Started process 134 to run task
[2024-07-23T15:36:24.800+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-25T06:00:00+00:00', '--job-id', '12', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpeuwmkx0k']
[2024-07-23T15:36:24.802+0000] {standard_task_runner.py:91} INFO - Job 12: Subtask motower_dcaparc
[2024-07-23T15:36:24.857+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [running]> on host ebc7a11cfc7f
[2024-07-23T15:36:24.963+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-25T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-25T06:00:00+00:00'
[2024-07-23T15:36:24.965+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-23T15:36:24.981+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-23T15:36:24.992+0000] {motower_daily.py:120} INFO - READING None
[2024-07-23T15:36:24.993+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-23T15:36:24.993+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 126, in generate_daily_caparc
    validate_site_actifs(df_bdd_site=bdd, col="code oci", host=smtphost, port=smtpport, user=smtpuser)
                                     ^^^
UnboundLocalError: cannot access local variable 'bdd' where it is not associated with a value
[2024-07-23T15:36:25.005+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-25T06:00:00+00:00, execution_date=20240625T060000, start_date=20240723T153624, end_date=20240723T153625
[2024-07-23T15:36:25.022+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-07-23T15:36:25.023+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-23T15:36:25.023+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-23T15:36:25.032+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-23T15:36:25.032+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-23T15:36:25.033+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 126, in generate_daily_caparc
    validate_site_actifs(df_bdd_site=bdd, col="code oci", host=smtphost, port=smtpport, user=smtpuser)
                                     ^^^
UnboundLocalError: cannot access local variable 'bdd' where it is not associated with a value

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-07-23T15:36:25.037+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-07-23T15:36:25.038+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-23T15:36:25.038+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-23T15:36:25.054+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 12 for task motower_dcaparc (cannot access local variable 'bdd' where it is not associated with a value; 134)
[2024-07-23T15:36:25.094+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-07-23T15:36:25.112+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-23T15:36:25.114+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-23T15:47:53.498+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-23T15:47:53.848+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-23T15:47:53.859+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-23T15:47:53.859+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-23T15:47:53.875+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-25 06:00:00+00:00
[2024-07-23T15:47:53.889+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=400) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-23T15:47:53.891+0000] {standard_task_runner.py:64} INFO - Started process 413 to run task
[2024-07-23T15:47:53.891+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-25T06:00:00+00:00', '--job-id', '57', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmp66pn3dgm']
[2024-07-23T15:47:53.893+0000] {standard_task_runner.py:91} INFO - Job 57: Subtask motower_dcaparc
[2024-07-23T15:47:53.945+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [running]> on host ebc7a11cfc7f
[2024-07-23T15:47:54.067+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-25T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-25T06:00:00+00:00'
[2024-07-23T15:47:54.069+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-23T15:47:54.089+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-23T15:47:54.099+0000] {motower_daily.py:120} INFO - READING None
[2024-07-23T15:47:54.100+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-23T15:47:54.100+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 126, in generate_daily_caparc
    validate_site_actifs(df_bdd_site=bdd, col="code oci", host=smtphost, port=smtpport, user=smtpuser)
                                     ^^^
UnboundLocalError: cannot access local variable 'bdd' where it is not associated with a value
[2024-07-23T15:47:54.111+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-25T06:00:00+00:00, execution_date=20240625T060000, start_date=20240723T154753, end_date=20240723T154754
[2024-07-23T15:47:54.128+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-07-23T15:47:54.129+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-23T15:47:54.129+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-23T15:47:54.144+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-23T15:47:54.144+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-23T15:47:54.146+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 126, in generate_daily_caparc
    validate_site_actifs(df_bdd_site=bdd, col="code oci", host=smtphost, port=smtpport, user=smtpuser)
                                     ^^^
UnboundLocalError: cannot access local variable 'bdd' where it is not associated with a value

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-07-23T15:47:54.149+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-07-23T15:47:54.149+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-23T15:47:54.150+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-23T15:47:54.166+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 57 for task motower_dcaparc (cannot access local variable 'bdd' where it is not associated with a value; 413)
[2024-07-23T15:47:54.227+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-07-23T15:47:54.247+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-23T15:47:54.249+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-23T16:16:44.573+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-23T16:16:44.911+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-23T16:16:44.932+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-23T16:16:44.932+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-23T16:16:44.949+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-25 06:00:00+00:00
[2024-07-23T16:16:44.972+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=954) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-23T16:16:44.974+0000] {standard_task_runner.py:64} INFO - Started process 975 to run task
[2024-07-23T16:16:44.976+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-25T06:00:00+00:00', '--job-id', '121', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpdl3zspkd']
[2024-07-23T16:16:44.978+0000] {standard_task_runner.py:91} INFO - Job 121: Subtask motower_dcaparc
[2024-07-23T16:16:45.076+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [running]> on host ebc7a11cfc7f
[2024-07-23T16:16:45.567+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-25T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-25T06:00:00+00:00'
[2024-07-23T16:16:45.568+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-23T16:16:45.627+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-23T16:16:45.658+0000] {motower_daily.py:120} INFO - READING BASE_SITES-cleaned/02.csv
[2024-07-23T16:16:45.823+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-23T16:16:45.825+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3487
[2024-07-23T16:16:45.825+0000] {motower_daily.py:130} INFO - GET CA PARC FILE OF THE DAY 2024-06-24
[2024-07-23T16:16:45.826+0000] {motower_daily.py:134} INFO - READING ca-parc/2024/06/24.csv
[2024-07-23T16:16:45.838+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-23T16:16:45.838+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 136, in generate_daily_caparc
    df_for_validation = ca.groupby("day_id").agg({'ca_voix': 'sum', 'ca_data': 'sum', 'parc': 'sum', 'parc_data': 'sum', "parc_2g": 'sum',
                        ^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/frame.py", line 8869, in groupby
    return DataFrameGroupBy(
           ^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/groupby/groupby.py", line 1278, in __init__
    grouper, exclusions, obj = get_grouper(
                               ^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/groupby/grouper.py", line 1009, in get_grouper
    raise KeyError(gpr)
KeyError: 'day_id'
[2024-07-23T16:16:45.853+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-25T06:00:00+00:00, execution_date=20240625T060000, start_date=20240723T161644, end_date=20240723T161645
[2024-07-23T16:16:45.868+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-07-23T16:16:45.869+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-23T16:16:45.869+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-23T16:16:45.885+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-23T16:16:45.885+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-23T16:16:45.886+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 136, in generate_daily_caparc
    df_for_validation = ca.groupby("day_id").agg({'ca_voix': 'sum', 'ca_data': 'sum', 'parc': 'sum', 'parc_data': 'sum', "parc_2g": 'sum',
                        ^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/frame.py", line 8869, in groupby
    return DataFrameGroupBy(
           ^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/groupby/groupby.py", line 1278, in __init__
    grouper, exclusions, obj = get_grouper(
                               ^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/groupby/grouper.py", line 1009, in get_grouper
    raise KeyError(gpr)
KeyError: 'day_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-07-23T16:16:45.891+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-07-23T16:16:45.892+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-23T16:16:45.892+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-23T16:16:46.061+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 121 for task motower_dcaparc ('day_id'; 975)
[2024-07-23T16:16:46.095+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-07-23T16:16:46.112+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-23T16:16:46.113+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-23T17:16:25.254+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-23T17:16:25.555+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-23T17:16:25.568+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-23T17:16:25.568+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-23T17:16:25.588+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-25 06:00:00+00:00
[2024-07-23T17:16:25.606+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=325) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-23T17:16:25.607+0000] {standard_task_runner.py:64} INFO - Started process 350 to run task
[2024-07-23T17:16:25.608+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-25T06:00:00+00:00', '--job-id', '27', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpmsgmx4oq']
[2024-07-23T17:16:25.611+0000] {standard_task_runner.py:91} INFO - Job 27: Subtask motower_dcaparc
[2024-07-23T17:16:25.694+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [running]> on host 57f550887412
[2024-07-23T17:16:25.827+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-25T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-25T06:00:00+00:00'
[2024-07-23T17:16:25.828+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-23T17:16:25.848+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-23T17:16:25.860+0000] {motower_daily.py:120} INFO - READING BASE_SITES-cleaned/02.csv
[2024-07-23T17:16:25.931+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-23T17:16:25.933+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3487
[2024-07-23T17:16:25.933+0000] {motower_daily.py:130} INFO - GET CA PARC FILE OF THE DAY 2024-06-24
[2024-07-23T17:16:25.933+0000] {motower_daily.py:134} INFO - READING ca-parc/2024/06/24.csv
[2024-07-23T17:16:25.951+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-23T17:16:25.952+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 136, in generate_daily_caparc
    df_for_validation = ca.groupby("date_id").agg({'ca_voix': 'sum', 'ca_data': 'sum', 'parc': 'sum', 'parc_data': 'sum', "parc_2g": 'sum',
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/groupby/generic.py", line 1445, in aggregate
    result = op.agg()
             ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 175, in agg
    return self.agg_dict_like()
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 406, in agg_dict_like
    return self.agg_or_apply_dict_like(op_name="agg")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 1390, in agg_or_apply_dict_like
    result_index, result_data = self.compute_dict_like(
                                ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 445, in compute_dict_like
    func = self.normalize_dictlike_arg(op_name, selected_obj, func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 639, in normalize_dictlike_arg
    raise KeyError(f"Column(s) {list(cols)} do not exist")
KeyError: "Column(s) ['parc'] do not exist"
[2024-07-23T17:16:25.966+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-25T06:00:00+00:00, execution_date=20240625T060000, start_date=20240723T171625, end_date=20240723T171625
[2024-07-23T17:16:25.982+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-07-23T17:16:25.983+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-23T17:16:25.983+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-23T17:16:25.991+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-23T17:16:25.992+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-23T17:16:25.992+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 136, in generate_daily_caparc
    df_for_validation = ca.groupby("date_id").agg({'ca_voix': 'sum', 'ca_data': 'sum', 'parc': 'sum', 'parc_data': 'sum', "parc_2g": 'sum',
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/groupby/generic.py", line 1445, in aggregate
    result = op.agg()
             ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 175, in agg
    return self.agg_dict_like()
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 406, in agg_dict_like
    return self.agg_or_apply_dict_like(op_name="agg")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 1390, in agg_or_apply_dict_like
    result_index, result_data = self.compute_dict_like(
                                ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 445, in compute_dict_like
    func = self.normalize_dictlike_arg(op_name, selected_obj, func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 639, in normalize_dictlike_arg
    raise KeyError(f"Column(s) {list(cols)} do not exist")
KeyError: "Column(s) ['parc'] do not exist"

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-07-23T17:16:25.996+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-07-23T17:16:25.996+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-23T17:16:25.997+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-23T17:16:26.009+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 27 for task motower_dcaparc ("Column(s) ['parc'] do not exist"; 350)
[2024-07-23T17:16:26.065+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-07-23T17:16:26.075+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-23T17:24:33.399+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-23T17:24:33.428+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-23T17:24:33.438+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-23T17:24:33.438+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-23T17:24:33.452+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-25 06:00:00+00:00
[2024-07-23T17:24:33.471+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=645) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-23T17:24:33.472+0000] {standard_task_runner.py:64} INFO - Started process 668 to run task
[2024-07-23T17:24:33.472+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-25T06:00:00+00:00', '--job-id', '99', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmphv19mluf']
[2024-07-23T17:24:33.475+0000] {standard_task_runner.py:91} INFO - Job 99: Subtask motower_dcaparc
[2024-07-23T17:24:33.538+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [running]> on host 57f550887412
[2024-07-23T17:24:33.661+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-25T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-25T06:00:00+00:00'
[2024-07-23T17:24:33.662+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-23T17:24:33.682+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-23T17:24:33.700+0000] {motower_daily.py:120} INFO - READING BASE_SITES-cleaned/02.csv
[2024-07-23T17:24:33.778+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-23T17:24:33.781+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3487
[2024-07-23T17:24:33.781+0000] {motower_daily.py:130} INFO - GET CA PARC FILE OF THE DAY 2024-06-24
[2024-07-23T17:24:33.781+0000] {motower_daily.py:134} INFO - READING ca-parc/2024/06/24.csv
[2024-07-23T17:24:33.803+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-23T17:24:33.803+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 136, in generate_daily_caparc
    df_for_validation = ca.groupby("date_id").agg({'ca_voix': 'sum', 'ca_data': 'sum', 'parc': 'sum', 'parc_data': 'sum', "parc_2g": 'sum',
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/groupby/generic.py", line 1445, in aggregate
    result = op.agg()
             ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 175, in agg
    return self.agg_dict_like()
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 406, in agg_dict_like
    return self.agg_or_apply_dict_like(op_name="agg")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 1390, in agg_or_apply_dict_like
    result_index, result_data = self.compute_dict_like(
                                ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 445, in compute_dict_like
    func = self.normalize_dictlike_arg(op_name, selected_obj, func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 639, in normalize_dictlike_arg
    raise KeyError(f"Column(s) {list(cols)} do not exist")
KeyError: "Column(s) ['parc'] do not exist"
[2024-07-23T17:24:33.817+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-25T06:00:00+00:00, execution_date=20240625T060000, start_date=20240723T172433, end_date=20240723T172433
[2024-07-23T17:24:33.835+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-07-23T17:24:33.836+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-23T17:24:33.836+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-23T17:24:33.847+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-23T17:24:33.848+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-23T17:24:33.849+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 136, in generate_daily_caparc
    df_for_validation = ca.groupby("date_id").agg({'ca_voix': 'sum', 'ca_data': 'sum', 'parc': 'sum', 'parc_data': 'sum', "parc_2g": 'sum',
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/groupby/generic.py", line 1445, in aggregate
    result = op.agg()
             ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 175, in agg
    return self.agg_dict_like()
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 406, in agg_dict_like
    return self.agg_or_apply_dict_like(op_name="agg")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 1390, in agg_or_apply_dict_like
    result_index, result_data = self.compute_dict_like(
                                ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 445, in compute_dict_like
    func = self.normalize_dictlike_arg(op_name, selected_obj, func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 639, in normalize_dictlike_arg
    raise KeyError(f"Column(s) {list(cols)} do not exist")
KeyError: "Column(s) ['parc'] do not exist"

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-07-23T17:24:33.853+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-07-23T17:24:33.854+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-23T17:24:33.854+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-23T17:24:33.871+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 99 for task motower_dcaparc ("Column(s) ['parc'] do not exist"; 668)
[2024-07-23T17:24:33.896+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-07-23T17:24:33.916+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-23T17:24:33.920+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-23T17:30:58.240+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-23T17:30:58.269+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-23T17:30:58.277+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-23T17:30:58.277+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-23T17:30:58.291+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-25 06:00:00+00:00
[2024-07-23T17:30:58.305+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=892) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-23T17:30:58.307+0000] {standard_task_runner.py:64} INFO - Started process 909 to run task
[2024-07-23T17:30:58.308+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-25T06:00:00+00:00', '--job-id', '150', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpsjpreo43']
[2024-07-23T17:30:58.311+0000] {standard_task_runner.py:91} INFO - Job 150: Subtask motower_dcaparc
[2024-07-23T17:30:58.362+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [running]> on host 57f550887412
[2024-07-23T17:30:58.654+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-25T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-25T06:00:00+00:00'
[2024-07-23T17:30:58.668+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-23T17:30:58.694+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-23T17:30:58.708+0000] {motower_daily.py:120} INFO - READING BASE_SITES-cleaned/02.csv
[2024-07-23T17:30:58.779+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-23T17:30:58.781+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3487
[2024-07-23T17:30:58.781+0000] {motower_daily.py:130} INFO - GET CA PARC FILE OF THE DAY 2024-06-24
[2024-07-23T17:30:58.781+0000] {motower_daily.py:134} INFO - READING ca-parc/2024/06/24.csv
[2024-07-23T17:30:58.803+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-23T17:30:58.804+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 136, in generate_daily_caparc
    df_for_validation = ca.groupby("date_id").agg({'ca_voix': 'sum', 'ca_data': 'sum', 'parc': 'sum', 'parc_data': 'sum', "parc_2g": 'sum',
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/groupby/generic.py", line 1445, in aggregate
    result = op.agg()
             ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 175, in agg
    return self.agg_dict_like()
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 406, in agg_dict_like
    return self.agg_or_apply_dict_like(op_name="agg")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 1390, in agg_or_apply_dict_like
    result_index, result_data = self.compute_dict_like(
                                ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 445, in compute_dict_like
    func = self.normalize_dictlike_arg(op_name, selected_obj, func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 639, in normalize_dictlike_arg
    raise KeyError(f"Column(s) {list(cols)} do not exist")
KeyError: "Column(s) ['parc'] do not exist"
[2024-07-23T17:30:58.816+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-25T06:00:00+00:00, execution_date=20240625T060000, start_date=20240723T173058, end_date=20240723T173058
[2024-07-23T17:30:58.842+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-07-23T17:30:58.842+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-23T17:30:58.846+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-23T17:30:58.861+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-23T17:30:58.861+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-23T17:30:58.862+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 136, in generate_daily_caparc
    df_for_validation = ca.groupby("date_id").agg({'ca_voix': 'sum', 'ca_data': 'sum', 'parc': 'sum', 'parc_data': 'sum', "parc_2g": 'sum',
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/groupby/generic.py", line 1445, in aggregate
    result = op.agg()
             ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 175, in agg
    return self.agg_dict_like()
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 406, in agg_dict_like
    return self.agg_or_apply_dict_like(op_name="agg")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 1390, in agg_or_apply_dict_like
    result_index, result_data = self.compute_dict_like(
                                ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 445, in compute_dict_like
    func = self.normalize_dictlike_arg(op_name, selected_obj, func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 639, in normalize_dictlike_arg
    raise KeyError(f"Column(s) {list(cols)} do not exist")
KeyError: "Column(s) ['parc'] do not exist"

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-07-23T17:30:58.866+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-07-23T17:30:58.867+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-23T17:30:58.867+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-23T17:30:58.880+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 150 for task motower_dcaparc ("Column(s) ['parc'] do not exist"; 909)
[2024-07-23T17:30:58.933+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-07-23T17:30:58.949+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-23T17:30:58.950+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-23T18:51:03.977+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-23T18:51:04.278+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-23T18:51:04.290+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-23T18:51:04.290+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-23T18:51:04.313+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-25 06:00:00+00:00
[2024-07-23T18:51:04.327+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=109) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-23T18:51:04.329+0000] {standard_task_runner.py:64} INFO - Started process 130 to run task
[2024-07-23T18:51:04.329+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-25T06:00:00+00:00', '--job-id', '14', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpn7prci41']
[2024-07-23T18:51:04.331+0000] {standard_task_runner.py:91} INFO - Job 14: Subtask motower_dcaparc
[2024-07-23T18:51:04.390+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [running]> on host 77e5f26692d3
[2024-07-23T18:51:04.512+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-25T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-25T06:00:00+00:00'
[2024-07-23T18:51:04.513+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-23T18:51:04.538+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-23T18:51:04.554+0000] {motower_daily.py:120} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-23T18:51:04.653+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-23T18:51:04.656+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-23T18:51:04.656+0000] {motower_daily.py:130} INFO - GET CA PARC FILE OF THE DAY 2024-06-24
[2024-07-23T18:51:04.657+0000] {motower_daily.py:134} INFO - READING ca-parc/2024/06/24.csv
[2024-07-23T18:51:04.692+0000] {motower_daily.py:139} INFO - DAILY KPI -      day_id       ca_voix      ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240624  5.165637e+08  765077813.8  16733340    9443567  11943670   842089  5930353   309964     1387765  1.338748e+09
[2024-07-23T18:51:04.692+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-23T18:51:04.693+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-23T18:51:04.693+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-23T18:51:04.694+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-23T18:51:04.694+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-23T18:51:04.695+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-23T18:51:04.695+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-23T18:51:04.695+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-23T18:51:04.696+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-23T18:51:04.700+0000] {logging_mixin.py:188} INFO - FILE OF 2024-06-24 have invalid parc_data: 

     day_id  parc_data
0  20240624    9443567
[2024-07-23T18:51:04.701+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-23T18:51:04.701+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-23T18:51:04.701+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-23T18:51:04.702+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 141, in generate_daily_caparc
    validate_column(df=df_for_validation, col=col, host=smtphost, port=smtpport, user=smtpuser, file_type="CAPARC", date=date)
  File "/opt/airflow/dags/gps/common/data_validation.py", line 19, in validate_column
    raise ValueError(message)
ValueError: FILE OF 2024-06-24 have invalid parc_data: 

     day_id  parc_data
0  20240624    9443567
[2024-07-23T18:51:04.713+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-25T06:00:00+00:00, execution_date=20240625T060000, start_date=20240723T185104, end_date=20240723T185104
[2024-07-23T18:51:04.729+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-07-23T18:51:04.730+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-23T18:51:04.730+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-23T18:51:04.760+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-23T18:51:04.761+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-23T18:51:04.762+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 141, in generate_daily_caparc
    validate_column(df=df_for_validation, col=col, host=smtphost, port=smtpport, user=smtpuser, file_type="CAPARC", date=date)
  File "/opt/airflow/dags/gps/common/data_validation.py", line 19, in validate_column
    raise ValueError(message)
ValueError: FILE OF 2024-06-24 have invalid parc_data: 

     day_id  parc_data
0  20240624    9443567

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-07-23T18:51:04.766+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-07-23T18:51:04.766+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-23T18:51:04.767+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-23T18:51:04.791+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 14 for task motower_dcaparc (FILE OF 2024-06-24 have invalid parc_data: 

     day_id  parc_data
0  20240624    9443567; 130)
[2024-07-23T18:51:04.831+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-07-23T18:51:04.847+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-23T18:51:04.848+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-24T10:25:37.904+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-24T10:25:37.936+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-24T10:25:37.950+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-24T10:25:37.951+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-24T10:25:37.964+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-25 06:00:00+00:00
[2024-07-24T10:25:37.978+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=1874) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-24T10:25:37.979+0000] {standard_task_runner.py:64} INFO - Started process 1890 to run task
[2024-07-24T10:25:37.980+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-25T06:00:00+00:00', '--job-id', '75', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmp1kxuv0am']
[2024-07-24T10:25:37.982+0000] {standard_task_runner.py:91} INFO - Job 75: Subtask motower_dcaparc
[2024-07-24T10:25:38.048+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [running]> on host 77e5f26692d3
[2024-07-24T10:25:38.150+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-25T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-25T06:00:00+00:00'
[2024-07-24T10:25:38.152+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-24T10:25:38.176+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-24T10:25:38.190+0000] {motower_daily.py:120} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-24T10:25:38.246+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-24T10:25:38.249+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-24T10:25:38.249+0000] {motower_daily.py:130} INFO - GET CA PARC FILE OF THE DAY 2024-06-24
[2024-07-24T10:25:38.249+0000] {motower_daily.py:134} INFO - READING ca-parc/2024/06/24.csv
[2024-07-24T10:25:38.282+0000] {motower_daily.py:139} INFO - DAILY KPI -      day_id       ca_voix      ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240624  5.165637e+08  765077813.8  16733340    9443567  11943670   842089  5930353   309964     1387765  1.338748e+09
[2024-07-24T10:25:38.282+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-24T10:25:38.285+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-24T10:25:38.286+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-24T10:25:38.287+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-24T10:25:38.288+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-24T10:25:38.289+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-24T10:25:38.290+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-24T10:25:38.292+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-24T10:25:38.293+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-24T10:25:38.297+0000] {logging_mixin.py:188} INFO - FILE OF 2024-06-24 have invalid parc_data: 

     day_id  parc_data
0  20240624    9443567
[2024-07-24T10:25:38.298+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-24T10:25:38.298+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-24T10:25:38.298+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-24T10:25:38.299+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 141, in generate_daily_caparc
    validate_column(df=df_for_validation, col=col, host=smtphost, port=smtpport, user=smtpuser, file_type="CAPARC", date=date)
  File "/opt/airflow/dags/gps/common/data_validation.py", line 19, in validate_column
    raise ValueError(message)
ValueError: FILE OF 2024-06-24 have invalid parc_data: 

     day_id  parc_data
0  20240624    9443567
[2024-07-24T10:25:38.309+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-25T06:00:00+00:00, execution_date=20240625T060000, start_date=20240724T102537, end_date=20240724T102538
[2024-07-24T10:25:38.324+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-07-24T10:25:38.325+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-24T10:25:38.326+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-24T10:25:38.336+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-24T10:25:38.337+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-24T10:25:38.342+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 141, in generate_daily_caparc
    validate_column(df=df_for_validation, col=col, host=smtphost, port=smtpport, user=smtpuser, file_type="CAPARC", date=date)
  File "/opt/airflow/dags/gps/common/data_validation.py", line 19, in validate_column
    raise ValueError(message)
ValueError: FILE OF 2024-06-24 have invalid parc_data: 

     day_id  parc_data
0  20240624    9443567

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-07-24T10:25:38.346+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-07-24T10:25:38.347+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-24T10:25:38.347+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-24T10:25:38.365+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 75 for task motower_dcaparc (FILE OF 2024-06-24 have invalid parc_data: 

     day_id  parc_data
0  20240624    9443567; 1890)
[2024-07-24T10:25:38.398+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-07-24T10:25:38.417+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-24T10:25:38.420+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-24T10:29:50.414+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-24T10:29:50.445+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-24T10:29:50.459+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-24T10:29:50.460+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-24T10:29:50.474+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-25 06:00:00+00:00
[2024-07-24T10:29:50.489+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=2091) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-24T10:29:50.490+0000] {standard_task_runner.py:64} INFO - Started process 2107 to run task
[2024-07-24T10:29:50.491+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-25T06:00:00+00:00', '--job-id', '125', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpz4e9clsp']
[2024-07-24T10:29:50.493+0000] {standard_task_runner.py:91} INFO - Job 125: Subtask motower_dcaparc
[2024-07-24T10:29:50.548+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [running]> on host 77e5f26692d3
[2024-07-24T10:29:50.655+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-25T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-25T06:00:00+00:00'
[2024-07-24T10:29:50.657+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-24T10:29:50.678+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-24T10:29:50.691+0000] {motower_daily.py:120} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-24T10:29:50.754+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-24T10:29:50.756+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-24T10:29:50.757+0000] {motower_daily.py:130} INFO - GET CA PARC FILE OF THE DAY 2024-06-24
[2024-07-24T10:29:50.757+0000] {motower_daily.py:134} INFO - READING ca-parc/2024/06/24.csv
[2024-07-24T10:29:50.787+0000] {motower_daily.py:139} INFO - DAILY KPI -      day_id       ca_voix      ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240624  5.165637e+08  765077813.8  16733340    9443567  11943670   842089  5930353   309964     1387765  1.338748e+09
[2024-07-24T10:29:50.788+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-24T10:29:50.791+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-24T10:29:50.792+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-24T10:29:50.794+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-24T10:29:50.794+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-24T10:29:50.796+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-24T10:29:50.797+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-24T10:29:50.798+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-24T10:29:50.798+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-24T10:29:50.804+0000] {logging_mixin.py:188} INFO - FILE OF 2024-06-24 have invalid parc_data: 

     day_id  parc_data
0  20240624    9443567
[2024-07-24T10:29:50.804+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-24T10:29:50.805+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-24T10:29:50.805+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-24T10:29:50.805+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 141, in generate_daily_caparc
    validate_column(df=df_for_validation, col=col, host=smtphost, port=smtpport, user=smtpuser, file_type="CAPARC", date=date)
  File "/opt/airflow/dags/gps/common/data_validation.py", line 19, in validate_column
    raise ValueError(message)
ValueError: FILE OF 2024-06-24 have invalid parc_data: 

     day_id  parc_data
0  20240624    9443567
[2024-07-24T10:29:50.819+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-25T06:00:00+00:00, execution_date=20240625T060000, start_date=20240724T102950, end_date=20240724T102950
[2024-07-24T10:29:50.837+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-07-24T10:29:50.837+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-24T10:29:50.837+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-24T10:29:50.847+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-24T10:29:50.848+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-24T10:29:50.848+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 141, in generate_daily_caparc
    validate_column(df=df_for_validation, col=col, host=smtphost, port=smtpport, user=smtpuser, file_type="CAPARC", date=date)
  File "/opt/airflow/dags/gps/common/data_validation.py", line 19, in validate_column
    raise ValueError(message)
ValueError: FILE OF 2024-06-24 have invalid parc_data: 

     day_id  parc_data
0  20240624    9443567

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-07-24T10:29:50.852+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-07-24T10:29:50.852+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-24T10:29:50.853+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-24T10:29:50.867+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 125 for task motower_dcaparc (FILE OF 2024-06-24 have invalid parc_data: 

     day_id  parc_data
0  20240624    9443567; 2107)
[2024-07-24T10:29:50.909+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-07-24T10:29:50.929+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-24T10:29:50.931+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-24T10:38:20.124+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-24T10:38:20.416+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-24T10:38:20.427+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-24T10:38:20.428+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-24T10:38:20.442+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-25 06:00:00+00:00
[2024-07-24T10:38:20.456+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=119) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-24T10:38:20.458+0000] {standard_task_runner.py:64} INFO - Started process 137 to run task
[2024-07-24T10:38:20.458+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-25T06:00:00+00:00', '--job-id', '16', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpjjj34b82']
[2024-07-24T10:38:20.461+0000] {standard_task_runner.py:91} INFO - Job 16: Subtask motower_dcaparc
[2024-07-24T10:38:20.514+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-24T10:38:20.630+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-25T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-25T06:00:00+00:00'
[2024-07-24T10:38:20.632+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-24T10:38:20.652+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-24T10:38:20.670+0000] {motower_daily.py:120} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-24T10:38:20.737+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-24T10:38:20.739+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-24T10:38:20.740+0000] {motower_daily.py:130} INFO - GET CA PARC FILE OF THE DAY 2024-06-24
[2024-07-24T10:38:20.740+0000] {motower_daily.py:134} INFO - READING ca-parc/2024/06/24.csv
[2024-07-24T10:38:20.770+0000] {motower_daily.py:139} INFO - DAILY KPI -      day_id       ca_voix      ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240624  5.165637e+08  765077813.8  16733340    9443567  11943670   842089  5930353   309964     1387765  1.338748e+09
[2024-07-24T10:38:20.770+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-24T10:38:20.772+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-24T10:38:20.772+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-24T10:38:20.774+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-24T10:38:20.774+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-24T10:38:20.775+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-24T10:38:20.776+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-24T10:38:20.777+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-24T10:38:20.777+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-24T10:38:20.778+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-24T10:38:20.778+0000] {motower_daily.py:142} INFO - MERGING BDD AND CA
[2024-07-24T10:38:20.783+0000] {motower_daily.py:144} INFO - prepare final daily data
[2024-07-24T10:38:20.786+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-24T10:38:20.786+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 148, in generate_daily_caparc
    df_final = bdd_ca[list(DAILY_CAPARC_COL.keys())]
               ~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/frame.py", line 3899, in __getitem__
    indexer = self.columns._get_indexer_strict(key, "columns")[1]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 6115, in _get_indexer_strict
    self._raise_if_missing(keyarr, indexer, axis_name)
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 6179, in _raise_if_missing
    raise KeyError(f"{not_found} not in index")
KeyError: "['trafic_data_in', 'trafic_voix_in'] not in index"
[2024-07-24T10:38:20.803+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-25T06:00:00+00:00, execution_date=20240625T060000, start_date=20240724T103820, end_date=20240724T103820
[2024-07-24T10:38:20.823+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-07-24T10:38:20.824+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-24T10:38:20.824+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-24T10:38:20.834+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-24T10:38:20.834+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-24T10:38:20.835+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 148, in generate_daily_caparc
    df_final = bdd_ca[list(DAILY_CAPARC_COL.keys())]
               ~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/frame.py", line 3899, in __getitem__
    indexer = self.columns._get_indexer_strict(key, "columns")[1]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 6115, in _get_indexer_strict
    self._raise_if_missing(keyarr, indexer, axis_name)
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 6179, in _raise_if_missing
    raise KeyError(f"{not_found} not in index")
KeyError: "['trafic_data_in', 'trafic_voix_in'] not in index"

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-07-24T10:38:20.843+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-07-24T10:38:20.843+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-24T10:38:20.844+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-24T10:38:20.865+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 16 for task motower_dcaparc ("['trafic_data_in', 'trafic_voix_in'] not in index"; 137)
[2024-07-24T10:38:20.917+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-07-24T10:38:20.945+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-24T10:38:20.947+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-24T11:22:55.361+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-24T11:22:55.736+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-24T11:22:55.755+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-24T11:22:55.758+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-24T11:22:55.787+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-25 06:00:00+00:00
[2024-07-24T11:22:55.809+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=865) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-24T11:22:55.811+0000] {standard_task_runner.py:64} INFO - Started process 878 to run task
[2024-07-24T11:22:55.813+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-25T06:00:00+00:00', '--job-id', '67', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpsp_1a7ok']
[2024-07-24T11:22:55.816+0000] {standard_task_runner.py:91} INFO - Job 67: Subtask motower_dcaparc
[2024-07-24T11:22:55.880+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-24T11:22:56.051+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-25T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-25T06:00:00+00:00'
[2024-07-24T11:22:56.052+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-24T11:22:56.095+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-24T11:22:56.113+0000] {motower_daily.py:120} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-24T11:22:56.199+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-24T11:22:56.202+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-24T11:22:56.202+0000] {motower_daily.py:130} INFO - GET CA PARC FILE OF THE DAY 2024-06-24
[2024-07-24T11:22:56.202+0000] {motower_daily.py:134} INFO - READING ca-parc/2024/06/24.csv
[2024-07-24T11:22:56.248+0000] {motower_daily.py:139} INFO - DAILY KPI -      day_id       ca_voix      ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240624  5.165637e+08  765077813.8  16733340    9443567  11943670   842089  5930353   309964     1387765  1.338748e+09
[2024-07-24T11:22:56.249+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-24T11:22:56.252+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-24T11:22:56.252+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-24T11:22:56.253+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-24T11:22:56.254+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-24T11:22:56.254+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-24T11:22:56.255+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-24T11:22:56.255+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-24T11:22:56.256+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-24T11:22:56.256+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-24T11:22:56.257+0000] {motower_daily.py:142} INFO - MERGING BDD AND CA
[2024-07-24T11:22:56.277+0000] {motower_daily.py:144} INFO - prepare final daily data
[2024-07-24T11:22:56.279+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-24T11:22:56.279+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 148, in generate_daily_caparc
    print(bdd_ca.columns())
          ^^^^^^^^^^^^^^^^
TypeError: 'Index' object is not callable
[2024-07-24T11:22:56.297+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-25T06:00:00+00:00, execution_date=20240625T060000, start_date=20240724T112255, end_date=20240724T112256
[2024-07-24T11:22:56.323+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-07-24T11:22:56.324+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-24T11:22:56.324+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-24T11:22:56.340+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-24T11:22:56.341+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-24T11:22:56.342+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 148, in generate_daily_caparc
    print(bdd_ca.columns())
          ^^^^^^^^^^^^^^^^
TypeError: 'Index' object is not callable

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-07-24T11:22:56.353+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-07-24T11:22:56.354+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-24T11:22:56.354+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-24T11:22:56.387+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 67 for task motower_dcaparc ('Index' object is not callable; 878)
[2024-07-24T11:22:56.479+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-07-24T11:22:56.501+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-24T11:24:41.009+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-24T11:24:41.066+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-24T11:24:41.077+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-24T11:24:41.077+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-24T11:24:41.103+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-25 06:00:00+00:00
[2024-07-24T11:24:41.128+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-25T06:00:00+00:00', '--job-id', '123', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmp8unfbk41']
[2024-07-24T11:24:41.131+0000] {standard_task_runner.py:91} INFO - Job 123: Subtask motower_dcaparc
[2024-07-24T11:24:41.122+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=1045) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-24T11:24:41.135+0000] {standard_task_runner.py:64} INFO - Started process 1060 to run task
[2024-07-24T11:24:41.241+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-24T11:24:41.422+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-25T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-25T06:00:00+00:00'
[2024-07-24T11:24:41.423+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-24T11:24:41.446+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-24T11:24:41.460+0000] {motower_daily.py:120} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-24T11:24:41.542+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-24T11:24:41.544+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-24T11:24:41.545+0000] {motower_daily.py:130} INFO - GET CA PARC FILE OF THE DAY 2024-06-24
[2024-07-24T11:24:41.545+0000] {motower_daily.py:134} INFO - READING ca-parc/2024/06/24.csv
[2024-07-24T11:24:41.578+0000] {motower_daily.py:139} INFO - DAILY KPI -      day_id       ca_voix      ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240624  5.165637e+08  765077813.8  16733340    9443567  11943670   842089  5930353   309964     1387765  1.338748e+09
[2024-07-24T11:24:41.579+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-24T11:24:41.580+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-24T11:24:41.581+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-24T11:24:41.582+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-24T11:24:41.582+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-24T11:24:41.583+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-24T11:24:41.583+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-24T11:24:41.584+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-24T11:24:41.584+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-24T11:24:41.586+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-24T11:24:41.586+0000] {motower_daily.py:142} INFO - MERGING BDD AND CA
[2024-07-24T11:24:41.591+0000] {motower_daily.py:144} INFO - prepare final daily data
[2024-07-24T11:24:41.593+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix', 'trafic_data', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-24T11:24:41.594+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-24T11:24:41.594+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 149, in generate_daily_caparc
    df_final = bdd_ca[list(DAILY_CAPARC_COL.keys())]
               ~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/frame.py", line 3899, in __getitem__
    indexer = self.columns._get_indexer_strict(key, "columns")[1]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 6115, in _get_indexer_strict
    self._raise_if_missing(keyarr, indexer, axis_name)
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 6179, in _raise_if_missing
    raise KeyError(f"{not_found} not in index")
KeyError: "['trafic_data_in', 'trafic_voix_in'] not in index"
[2024-07-24T11:24:41.613+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-25T06:00:00+00:00, execution_date=20240625T060000, start_date=20240724T112441, end_date=20240724T112441
[2024-07-24T11:24:41.635+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-07-24T11:24:41.636+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-24T11:24:41.636+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-24T11:24:41.649+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-24T11:24:41.649+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-24T11:24:41.654+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 149, in generate_daily_caparc
    df_final = bdd_ca[list(DAILY_CAPARC_COL.keys())]
               ~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/frame.py", line 3899, in __getitem__
    indexer = self.columns._get_indexer_strict(key, "columns")[1]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 6115, in _get_indexer_strict
    self._raise_if_missing(keyarr, indexer, axis_name)
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 6179, in _raise_if_missing
    raise KeyError(f"{not_found} not in index")
KeyError: "['trafic_data_in', 'trafic_voix_in'] not in index"

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-07-24T11:24:41.660+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-07-24T11:24:41.660+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-24T11:24:41.661+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-24T11:24:41.676+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 123 for task motower_dcaparc ("['trafic_data_in', 'trafic_voix_in'] not in index"; 1060)
[2024-07-24T11:24:41.717+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-07-24T11:24:41.761+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-24T11:24:41.765+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-24T11:54:03.208+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-24T11:54:03.520+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-24T11:54:03.540+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-24T11:54:03.541+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-24T11:54:03.557+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-25 06:00:00+00:00
[2024-07-24T11:54:03.572+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=1589) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-24T11:54:03.574+0000] {standard_task_runner.py:64} INFO - Started process 1613 to run task
[2024-07-24T11:54:03.576+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-25T06:00:00+00:00', '--job-id', '177', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmp_huqdrlv']
[2024-07-24T11:54:03.579+0000] {standard_task_runner.py:91} INFO - Job 177: Subtask motower_dcaparc
[2024-07-24T11:54:03.636+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-24T11:54:03.778+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-25T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-25T06:00:00+00:00'
[2024-07-24T11:54:03.783+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-24T11:54:03.805+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-24T11:54:03.819+0000] {motower_daily.py:120} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-24T11:54:03.887+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-24T11:54:03.891+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-24T11:54:03.891+0000] {motower_daily.py:130} INFO - GET CA PARC FILE OF THE DAY 2024-06-24
[2024-07-24T11:54:03.892+0000] {motower_daily.py:134} INFO - READING ca-parc/2024/06/24.csv
[2024-07-24T11:54:03.920+0000] {motower_daily.py:139} INFO - DAILY KPI -      day_id       ca_voix      ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240624  5.165637e+08  765077813.8  16733340    9443567  11943670   842089  5930353   309964     1387765  1.338748e+09
[2024-07-24T11:54:03.921+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-24T11:54:03.922+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-24T11:54:03.923+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-24T11:54:03.924+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-24T11:54:03.925+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-24T11:54:03.926+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-24T11:54:03.926+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-24T11:54:03.927+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-24T11:54:03.928+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-24T11:54:03.929+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-24T11:54:03.929+0000] {motower_daily.py:142} INFO - MERGING BDD AND CA
[2024-07-24T11:54:03.934+0000] {motower_daily.py:144} INFO - prepare final daily data
[2024-07-24T11:54:03.936+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-24T11:54:03.939+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-24T11:54:03.940+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-24T11:54:03.941+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-24T11:54:03.941+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-24T11:54:03.942+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:155: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-24T11:54:03.943+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:156: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-24T11:54:03.943+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:157: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-24T11:54:03.943+0000] {logging_mixin.py:188} INFO - 6
[2024-07-24T11:54:03.950+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:164: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  daily_month_df = pd.read_sql_query(sql_query, CONN, params=(mois, date))

[2024-07-24T11:54:03.952+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-24T11:54:03.952+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 2262, in execute
    cur.execute(sql, *args)
psycopg2.errors.UndefinedTable: relation "motower_daily_caparc" does not exist
LINE 1: select * from motower_daily_caparc where EXTRACT(MONTH FROM ...
                      ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
         ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 164, in generate_daily_caparc
    daily_month_df = pd.read_sql_query(sql_query, CONN, params=(mois, date))
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 486, in read_sql_query
    return pandas_sql.read_query(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 2326, in read_query
    cursor = self.execute(sql, params)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 2274, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'select * from motower_daily_caparc where EXTRACT(MONTH FROM jour) = %s AND jour < %s': relation "motower_daily_caparc" does not exist
LINE 1: select * from motower_daily_caparc where EXTRACT(MONTH FROM ...
                      ^

[2024-07-24T11:54:03.964+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-25T06:00:00+00:00, execution_date=20240625T060000, start_date=20240724T115403, end_date=20240724T115403
[2024-07-24T11:54:03.982+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-07-24T11:54:03.983+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-24T11:54:03.983+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-24T11:54:03.994+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-24T11:54:03.995+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-24T11:54:03.996+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 2262, in execute
    cur.execute(sql, *args)
psycopg2.errors.UndefinedTable: relation "motower_daily_caparc" does not exist
LINE 1: select * from motower_daily_caparc where EXTRACT(MONTH FROM ...
                      ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
         ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 164, in generate_daily_caparc
    daily_month_df = pd.read_sql_query(sql_query, CONN, params=(mois, date))
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 486, in read_sql_query
    return pandas_sql.read_query(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 2326, in read_query
    cursor = self.execute(sql, params)
             ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/io/sql.py", line 2274, in execute
    raise ex from exc
pandas.errors.DatabaseError: Execution failed on sql 'select * from motower_daily_caparc where EXTRACT(MONTH FROM jour) = %s AND jour < %s': relation "motower_daily_caparc" does not exist
LINE 1: select * from motower_daily_caparc where EXTRACT(MONTH FROM ...
                      ^


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-07-24T11:54:04.002+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-07-24T11:54:04.002+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-24T11:54:04.003+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-24T11:54:04.018+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 177 for task motower_dcaparc (Execution failed on sql 'select * from motower_daily_caparc where EXTRACT(MONTH FROM jour) = %s AND jour < %s': relation "motower_daily_caparc" does not exist
LINE 1: select * from motower_daily_caparc where EXTRACT(MONTH FROM ...
                      ^
; 1613)
[2024-07-24T11:54:04.076+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-07-24T11:54:04.096+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-24T11:54:04.101+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-24T12:04:38.080+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-24T12:04:38.343+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-24T12:04:38.351+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-24T12:04:38.351+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-24T12:04:38.361+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-25 06:00:00+00:00
[2024-07-24T12:04:38.371+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=1898) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-24T12:04:38.372+0000] {standard_task_runner.py:64} INFO - Started process 1910 to run task
[2024-07-24T12:04:38.372+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-25T06:00:00+00:00', '--job-id', '236', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmp9a17_32j']
[2024-07-24T12:04:38.374+0000] {standard_task_runner.py:91} INFO - Job 236: Subtask motower_dcaparc
[2024-07-24T12:04:38.416+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-24T12:04:38.495+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-25T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-25T06:00:00+00:00'
[2024-07-24T12:04:38.496+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-24T12:04:38.510+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-24T12:04:38.519+0000] {motower_daily.py:120} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-24T12:04:38.559+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-24T12:04:38.561+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-24T12:04:38.561+0000] {motower_daily.py:130} INFO - GET CA PARC FILE OF THE DAY 2024-06-24
[2024-07-24T12:04:38.561+0000] {motower_daily.py:134} INFO - READING ca-parc/2024/06/24.csv
[2024-07-24T12:04:38.579+0000] {motower_daily.py:139} INFO - DAILY KPI -      day_id       ca_voix      ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240624  5.165637e+08  765077813.8  16733340    9443567  11943670   842089  5930353   309964     1387765  1.338748e+09
[2024-07-24T12:04:38.579+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-24T12:04:38.580+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-24T12:04:38.580+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-24T12:04:38.581+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-24T12:04:38.581+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-24T12:04:38.582+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-24T12:04:38.582+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-24T12:04:38.582+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-24T12:04:38.583+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-24T12:04:38.583+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-24T12:04:38.583+0000] {motower_daily.py:142} INFO - MERGING BDD AND CA
[2024-07-24T12:04:38.586+0000] {motower_daily.py:144} INFO - prepare final daily data
[2024-07-24T12:04:38.587+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-24T12:04:38.589+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-24T12:04:38.590+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-24T12:04:38.590+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-24T12:04:38.591+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-24T12:04:38.591+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:155: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-24T12:04:38.591+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:156: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-24T12:04:38.592+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:157: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-24T12:04:38.592+0000] {logging_mixin.py:188} INFO - 6
[2024-07-24T12:04:38.603+0000] {motower_daily.py:193} INFO - ADD  SEGMENT
[2024-07-24T12:04:38.790+0000] {motower_daily.py:198} INFO - DATA VALIDATION AFTER MERGING
[2024-07-24T12:04:38.790+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-24T12:04:38.792+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-24T12:04:38.803+0000] {motower_daily.py:209} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-24  5.047696e+08  7.522612e+08   14928167.0  9196059.0  3790896.0  115677.0  3122832.0  199641.0    459520.0  1.296053e+09
[2024-07-24T12:04:38.803+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-24T12:04:38.804+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-24T12:04:38.805+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-24T12:04:38.805+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-24T12:04:38.806+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-24T12:04:38.806+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-24T12:04:38.810+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-24T12:04:38.816+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-24T12:04:38.816+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-24T12:04:38.817+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-24T12:04:38.921+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-24  OCI2831       2831.0  ...   NORMAL             None              None
1 2024-06-24  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-24  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-24  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-24  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-24T12:04:39.004+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-24  OCI2831       2831.0  ...   NORMAL             None              None
1 2024-06-24  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-24  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-24  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-24  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-24T12:04:39.792+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-24T12:04:39.793+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-24T12:04:39.805+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-25T06:00:00+00:00, execution_date=20240625T060000, start_date=20240724T120438, end_date=20240724T120439
[2024-07-24T12:04:40.543+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-24T12:04:40.572+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-24T12:04:40.583+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-24T12:10:05.759+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-24T12:10:05.791+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-24T12:10:05.804+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-24T12:10:05.805+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-24T12:10:05.825+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-25 06:00:00+00:00
[2024-07-24T12:10:05.841+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=2134) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-24T12:10:05.843+0000] {standard_task_runner.py:64} INFO - Started process 2158 to run task
[2024-07-24T12:10:05.852+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-25T06:00:00+00:00', '--job-id', '296', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpc09b3n7c']
[2024-07-24T12:10:05.855+0000] {standard_task_runner.py:91} INFO - Job 296: Subtask motower_dcaparc
[2024-07-24T12:10:05.992+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-24T12:10:06.146+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-25T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-25T06:00:00+00:00'
[2024-07-24T12:10:06.149+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-24T12:10:06.172+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-24T12:10:06.186+0000] {motower_daily.py:120} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-24T12:10:06.264+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-24T12:10:06.266+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-24T12:10:06.266+0000] {motower_daily.py:130} INFO - GET CA PARC FILE OF THE DAY 2024-06-24
[2024-07-24T12:10:06.267+0000] {motower_daily.py:134} INFO - READING ca-parc/2024/06/24.csv
[2024-07-24T12:10:06.301+0000] {motower_daily.py:139} INFO - DAILY KPI -      day_id       ca_voix      ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240624  5.165637e+08  765077813.8  16733340    9443567  11943670   842089  5930353   309964     1387765  1.338748e+09
[2024-07-24T12:10:06.301+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-24T12:10:06.303+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-24T12:10:06.303+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-24T12:10:06.304+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-24T12:10:06.305+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-24T12:10:06.305+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-24T12:10:06.306+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-24T12:10:06.307+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-24T12:10:06.307+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-24T12:10:06.308+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-24T12:10:06.308+0000] {motower_daily.py:142} INFO - MERGING BDD AND CA
[2024-07-24T12:10:06.313+0000] {motower_daily.py:144} INFO - prepare final daily data
[2024-07-24T12:10:06.315+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-24T12:10:06.318+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-24T12:10:06.319+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-24T12:10:06.320+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-24T12:10:06.320+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-24T12:10:06.321+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:155: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-24T12:10:06.321+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:156: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-24T12:10:06.322+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:157: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-24T12:10:06.322+0000] {logging_mixin.py:188} INFO - 6
[2024-07-24T12:10:06.334+0000] {motower_daily.py:193} INFO - ADD  SEGMENT
[2024-07-24T12:10:06.519+0000] {motower_daily.py:198} INFO - DATA VALIDATION AFTER MERGING
[2024-07-24T12:10:06.519+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-24T12:10:06.520+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-24T12:10:06.527+0000] {motower_daily.py:209} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-24  5.047696e+08  7.522612e+08   14928167.0  9196059.0  3790896.0  115677.0  3122832.0  199641.0    459520.0  1.296053e+09
[2024-07-24T12:10:06.528+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-24T12:10:06.528+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-24T12:10:06.529+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-24T12:10:06.529+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-24T12:10:06.529+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-24T12:10:06.530+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-24T12:10:06.530+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-24T12:10:06.531+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-24T12:10:06.531+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-24T12:10:06.531+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-24T12:10:06.555+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-24  OCI2831       2831.0  ...   NORMAL             None              None
1 2024-06-24  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-24  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-24  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-24  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-24T12:10:06.581+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-24  OCI2831       2831.0  ...   NORMAL             None              None
1 2024-06-24  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-24  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-24  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-24  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-24T12:10:06.967+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-24T12:10:06.967+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-24T12:10:06.976+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-25T06:00:00+00:00, execution_date=20240625T060000, start_date=20240724T121005, end_date=20240724T121006
[2024-07-24T12:10:07.001+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-24T12:10:07.017+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-24T12:10:07.019+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-24T23:21:05.255+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-24T23:21:05.559+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-24T23:21:05.570+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-24T23:21:05.571+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-24T23:21:05.587+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-25 06:00:00+00:00
[2024-07-24T23:21:05.597+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=809) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-24T23:21:05.599+0000] {standard_task_runner.py:64} INFO - Started process 828 to run task
[2024-07-24T23:21:05.599+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-25T06:00:00+00:00', '--job-id', '365', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpvdcglc5w']
[2024-07-24T23:21:05.602+0000] {standard_task_runner.py:91} INFO - Job 365: Subtask motower_dcaparc
[2024-07-24T23:21:05.651+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-24T23:21:05.754+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-25T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-25T06:00:00+00:00'
[2024-07-24T23:21:05.757+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-24T23:21:05.777+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-24T23:21:05.791+0000] {motower_daily.py:120} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-24T23:21:05.850+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-24T23:21:05.852+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-24T23:21:05.853+0000] {motower_daily.py:130} INFO - GET CA PARC FILE OF THE DAY 2024-06-24
[2024-07-24T23:21:05.854+0000] {motower_daily.py:134} INFO - READING ca-parc/2024/06/24.csv
[2024-07-24T23:21:05.882+0000] {motower_daily.py:139} INFO - DAILY KPI -      day_id       ca_voix      ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240624  5.165637e+08  765077813.8  16733340    9443567  11943670   842089  5930353   309964     1387765  1.338748e+09
[2024-07-24T23:21:05.883+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-24T23:21:05.884+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-24T23:21:05.885+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-24T23:21:05.886+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-24T23:21:05.887+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-24T23:21:05.888+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-24T23:21:05.888+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-24T23:21:05.889+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-24T23:21:05.889+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-24T23:21:05.889+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-24T23:21:05.890+0000] {motower_daily.py:142} INFO - MERGING BDD AND CA
[2024-07-24T23:21:05.894+0000] {motower_daily.py:144} INFO - prepare final daily data
[2024-07-24T23:21:05.896+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-24T23:21:05.899+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-24T23:21:05.900+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-24T23:21:05.901+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-24T23:21:05.902+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-24T23:21:05.903+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:155: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-24T23:21:05.903+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:156: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-24T23:21:05.904+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:157: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-24T23:21:05.904+0000] {logging_mixin.py:188} INFO - 6
[2024-07-24T23:21:05.917+0000] {motower_daily.py:193} INFO - ADD  SEGMENT
[2024-07-24T23:21:06.127+0000] {motower_daily.py:198} INFO - DATA VALIDATION AFTER MERGING
[2024-07-24T23:21:06.127+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-24T23:21:06.128+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-24T23:21:06.136+0000] {motower_daily.py:209} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-24  5.047696e+08  7.522612e+08   14928167.0  9196059.0  3790896.0  115677.0  3122832.0  199641.0    459520.0  1.296053e+09
[2024-07-24T23:21:06.137+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-24T23:21:06.137+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-24T23:21:06.138+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-24T23:21:06.138+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-24T23:21:06.138+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-24T23:21:06.139+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-24T23:21:06.139+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-24T23:21:06.140+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-24T23:21:06.140+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-24T23:21:06.141+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-24T23:21:06.172+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-24  OCI2831       2831.0  ...   NORMAL             None              None
1 2024-06-24  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-24  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-24  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-24  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-24T23:21:06.207+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-24  OCI2831       2831.0  ...   NORMAL             None              None
1 2024-06-24  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-24  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-24  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-24  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-24T23:21:06.757+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-24T23:21:06.758+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-24T23:21:06.768+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-25T06:00:00+00:00, execution_date=20240625T060000, start_date=20240724T232105, end_date=20240724T232106
[2024-07-24T23:21:06.944+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-24T23:21:06.961+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-24T23:21:06.963+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-24T23:25:31.223+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-24T23:25:31.267+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-24T23:25:31.283+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-24T23:25:31.284+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-24T23:25:31.303+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-25 06:00:00+00:00
[2024-07-24T23:25:31.319+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=1132) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-24T23:25:31.320+0000] {standard_task_runner.py:64} INFO - Started process 1150 to run task
[2024-07-24T23:25:31.321+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-25T06:00:00+00:00', '--job-id', '458', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpiwcm8skw']
[2024-07-24T23:25:31.325+0000] {standard_task_runner.py:91} INFO - Job 458: Subtask motower_dcaparc
[2024-07-24T23:25:31.380+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-24T23:25:31.532+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-25T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-25T06:00:00+00:00'
[2024-07-24T23:25:31.534+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-24T23:25:31.560+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-24T23:25:31.574+0000] {motower_daily.py:120} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-24T23:25:31.645+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-24T23:25:31.647+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-24T23:25:31.648+0000] {motower_daily.py:130} INFO - GET CA PARC FILE OF THE DAY 2024-06-24
[2024-07-24T23:25:31.648+0000] {motower_daily.py:134} INFO - READING ca-parc/2024/06/24.csv
[2024-07-24T23:25:31.677+0000] {motower_daily.py:139} INFO - DAILY KPI -      day_id       ca_voix      ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240624  5.165637e+08  765077813.8  16733340    9443567  11943670   842089  5930353   309964     1387765  1.338748e+09
[2024-07-24T23:25:31.677+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-24T23:25:31.679+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-24T23:25:31.679+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-24T23:25:31.680+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-24T23:25:31.680+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-24T23:25:31.681+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-24T23:25:31.682+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-24T23:25:31.682+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-24T23:25:31.683+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-24T23:25:31.683+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-24T23:25:31.684+0000] {motower_daily.py:142} INFO - MERGING BDD AND CA
[2024-07-24T23:25:31.689+0000] {motower_daily.py:144} INFO - prepare final daily data
[2024-07-24T23:25:31.691+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-24T23:25:31.694+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-24T23:25:31.695+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-24T23:25:31.696+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-24T23:25:31.697+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-24T23:25:31.697+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:155: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-24T23:25:31.698+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:156: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-24T23:25:31.698+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:157: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-24T23:25:31.699+0000] {logging_mixin.py:188} INFO - 6
[2024-07-24T23:25:31.712+0000] {motower_daily.py:193} INFO - ADD  SEGMENT
[2024-07-24T23:25:31.939+0000] {motower_daily.py:198} INFO - DATA VALIDATION AFTER MERGING
[2024-07-24T23:25:31.939+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-24T23:25:31.941+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-24T23:25:31.953+0000] {motower_daily.py:209} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-24  5.047696e+08  7.522612e+08   14928167.0  9196059.0  3790896.0  115677.0  3122832.0  199641.0    459520.0  1.296053e+09
[2024-07-24T23:25:31.953+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-24T23:25:31.954+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-24T23:25:31.955+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-24T23:25:31.955+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-24T23:25:31.956+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-24T23:25:31.956+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-24T23:25:31.957+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-24T23:25:31.958+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-24T23:25:31.958+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-24T23:25:31.959+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-24T23:25:31.990+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-24  OCI2831       2831.0  ...   NORMAL             None              None
1 2024-06-24  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-24  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-24  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-24  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-24T23:25:32.028+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-24  OCI2831       2831.0  ...   NORMAL             None              None
1 2024-06-24  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-24  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-24  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-24  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-24T23:25:32.555+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-24T23:25:32.556+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-24T23:25:32.568+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-25T06:00:00+00:00, execution_date=20240625T060000, start_date=20240724T232531, end_date=20240724T232532
[2024-07-24T23:25:32.627+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-24T23:25:32.639+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-25T08:33:39.737+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-25T08:33:39.760+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-25T08:33:39.767+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-25T08:33:39.767+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-25T08:33:39.776+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-25 06:00:00+00:00
[2024-07-25T08:33:39.784+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=2607) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-25T08:33:39.786+0000] {standard_task_runner.py:64} INFO - Started process 2609 to run task
[2024-07-25T08:33:39.786+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-25T06:00:00+00:00', '--job-id', '899', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpjlalepxe']
[2024-07-25T08:33:39.788+0000] {standard_task_runner.py:91} INFO - Job 899: Subtask motower_dcaparc
[2024-07-25T08:33:39.827+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-25T08:33:39.900+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-25T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-25T06:00:00+00:00'
[2024-07-25T08:33:39.901+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-25T08:33:39.913+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-25T08:33:39.922+0000] {motower_daily.py:120} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-25T08:33:39.958+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-25T08:33:39.959+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-25T08:33:39.960+0000] {motower_daily.py:130} INFO - GET CA PARC FILE OF THE DAY 2024-06-24
[2024-07-25T08:33:39.960+0000] {motower_daily.py:134} INFO - READING ca-parc/2024/06/24.csv
[2024-07-25T08:33:39.976+0000] {motower_daily.py:139} INFO - DAILY KPI -      day_id       ca_voix      ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240624  5.165637e+08  765077813.8  16733340    9443567  11943670   842089  5930353   309964     1387765  1.338748e+09
[2024-07-25T08:33:39.977+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-25T08:33:39.978+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-25T08:33:39.978+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-25T08:33:39.978+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-25T08:33:39.979+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-25T08:33:39.979+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-25T08:33:39.979+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-25T08:33:39.980+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-25T08:33:39.980+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-25T08:33:39.981+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-25T08:33:39.981+0000] {motower_daily.py:142} INFO - MERGING BDD AND CA
[2024-07-25T08:33:39.983+0000] {motower_daily.py:144} INFO - prepare final daily data
[2024-07-25T08:33:39.984+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-25T08:33:39.986+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-25T08:33:39.986+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-25T08:33:39.987+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-25T08:33:39.987+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-25T08:33:39.987+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:155: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-25T08:33:39.988+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:156: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-25T08:33:39.988+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:157: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-25T08:33:39.988+0000] {logging_mixin.py:188} INFO - 6
[2024-07-25T08:33:39.997+0000] {motower_daily.py:193} INFO - ADD  SEGMENT
[2024-07-25T08:33:40.131+0000] {motower_daily.py:198} INFO - DATA VALIDATION AFTER MERGING
[2024-07-25T08:33:40.131+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-25T08:33:40.132+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-25T08:33:40.138+0000] {motower_daily.py:209} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-24  5.047696e+08  7.522612e+08   14928167.0  9196059.0  3790896.0  115677.0  3122832.0  199641.0    459520.0  1.296053e+09
[2024-07-25T08:33:40.138+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-25T08:33:40.139+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-25T08:33:40.139+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-25T08:33:40.140+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-25T08:33:40.140+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-25T08:33:40.140+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-25T08:33:40.141+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-25T08:33:40.141+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-25T08:33:40.141+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-25T08:33:40.142+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-25T08:33:40.164+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-24  OCI2831       2831.0  ...   NORMAL             None              None
1 2024-06-24  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-24  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-24  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-24  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-25T08:33:40.186+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-24  OCI2831       2831.0  ...   NORMAL             None              None
1 2024-06-24  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-24  OCI3428       3428.0  ...   NORMAL             None              None
3 2024-06-24  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-24  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-25T08:33:40.557+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-25T08:33:40.558+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-25T08:33:40.567+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-25T06:00:00+00:00, execution_date=20240625T060000, start_date=20240725T083339, end_date=20240725T083340
[2024-07-25T08:33:40.601+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-25T08:33:40.615+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-25T08:33:40.617+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-25T10:38:58.692+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-25T10:38:58.888+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-25T10:38:58.895+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-25T10:38:58.895+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-25T10:38:58.906+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-25 06:00:00+00:00
[2024-07-25T10:38:58.915+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=5831) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-25T10:38:58.917+0000] {standard_task_runner.py:64} INFO - Started process 5833 to run task
[2024-07-25T10:38:58.917+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-25T06:00:00+00:00', '--job-id', '1432', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpj7xs0t7u']
[2024-07-25T10:38:58.919+0000] {standard_task_runner.py:91} INFO - Job 1432: Subtask motower_dcaparc
[2024-07-25T10:38:58.956+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-25T10:38:59.034+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-25T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-25T06:00:00+00:00'
[2024-07-25T10:38:59.035+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-25T10:38:59.049+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-25T10:38:59.058+0000] {motower_daily.py:120} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-25T10:38:59.096+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-25T10:38:59.098+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-25T10:38:59.098+0000] {motower_daily.py:130} INFO - GET CA PARC FILE OF THE DAY 2024-06-24
[2024-07-25T10:38:59.098+0000] {motower_daily.py:134} INFO - READING ca-parc/2024/06/24.csv
[2024-07-25T10:38:59.115+0000] {motower_daily.py:139} INFO - DAILY KPI -      day_id       ca_voix      ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240624  5.165637e+08  765077813.8  16733340    9443567  11943670   842089  5930353   309964     1387765  1.338748e+09
[2024-07-25T10:38:59.115+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-25T10:38:59.116+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-25T10:38:59.116+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-25T10:38:59.117+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-25T10:38:59.117+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-25T10:38:59.117+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-25T10:38:59.117+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-25T10:38:59.118+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-25T10:38:59.118+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-25T10:38:59.118+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-25T10:38:59.119+0000] {motower_daily.py:142} INFO - MERGING BDD AND CA
[2024-07-25T10:38:59.121+0000] {motower_daily.py:144} INFO - prepare final daily data
[2024-07-25T10:38:59.122+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-25T10:38:59.124+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-25T10:38:59.124+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-25T10:38:59.125+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-25T10:38:59.125+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-25T10:38:59.125+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:155: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-25T10:38:59.126+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:156: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-25T10:38:59.126+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:157: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-25T10:38:59.126+0000] {logging_mixin.py:188} INFO - 6
[2024-07-25T10:38:59.130+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:164: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  daily_month_df = pd.read_sql_query(sql_query, CONN, params=(mois, date))

[2024-07-25T10:38:59.958+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:165: FutureWarning: The behavior of DataFrame concatenation with empty or all-NA entries is deprecated. In a future version, this will no longer exclude empty or all-NA columns when determining the result dtypes. To retain the old behavior, exclude the relevant entries before the concat operation.
  month_data = pd.concat([daily_month_df, df_final])

[2024-07-25T10:39:00.038+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:169: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  last_month = pd.read_sql_query(sql_query, CONN, params=(lmonth.month,exec_date.day))

[2024-07-25T10:39:00.092+0000] {motower_daily.py:174} INFO - ADD  SEGMENT
[2024-07-25T10:39:04.617+0000] {motower_daily.py:198} INFO - DATA VALIDATION AFTER MERGING
[2024-07-25T10:39:04.617+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-25T10:39:04.618+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-25T10:39:04.625+0000] {motower_daily.py:209} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-24  5.047696e+08  7.522612e+08   14928167.0  9196059.0  3790896.0  115677.0  3122832.0  199641.0    459520.0  1.296053e+09
[2024-07-25T10:39:04.626+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-25T10:39:04.626+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-25T10:39:04.626+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-25T10:39:04.627+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-25T10:39:04.627+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-25T10:39:04.628+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-25T10:39:04.628+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-25T10:39:04.628+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-25T10:39:04.628+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-25T10:39:04.629+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-25T10:39:04.652+0000] {logging_mixin.py:188} INFO -    id       jour code_oci  ...  segment previous_segment evolution_segment
0 NaN 2024-06-24  OCI2831  ...  PREMIUM             None              None
1 NaN 2024-06-24  OCI3257  ...  PREMIUM             None              None
2 NaN 2024-06-24  OCI3428  ...  PREMIUM             None              None
3 NaN 2024-06-24  OCI2587  ...  PREMIUM             None              None
4 NaN 2024-06-24  OCI3260  ...     None             None              None

[5 rows x 39 columns]
[2024-07-25T10:39:04.677+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-24  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-24  OCI3257       3257.0  ...  PREMIUM             None              None
2 2024-06-24  OCI3428       3428.0  ...  PREMIUM             None              None
3 2024-06-24  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-24  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-25T10:39:05.171+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-25T10:39:05.171+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-25T10:39:05.180+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-25T06:00:00+00:00, execution_date=20240625T060000, start_date=20240725T103858, end_date=20240725T103905
[2024-07-25T10:39:05.342+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-25T10:39:05.358+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-25T10:39:05.359+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-25T13:27:10.052+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-25T13:27:10.075+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-25T13:27:10.082+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-25T13:27:10.082+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-25T13:27:10.090+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-25 06:00:00+00:00
[2024-07-25T13:27:10.099+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=12691) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-25T13:27:10.101+0000] {standard_task_runner.py:64} INFO - Started process 12693 to run task
[2024-07-25T13:27:10.101+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-25T06:00:00+00:00', '--job-id', '2997', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpzt9rrq9x']
[2024-07-25T13:27:10.103+0000] {standard_task_runner.py:91} INFO - Job 2997: Subtask motower_dcaparc
[2024-07-25T13:27:10.142+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-25T13:27:10.216+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-25T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-25T06:00:00+00:00'
[2024-07-25T13:27:10.217+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-25T13:27:10.229+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-25T13:27:10.238+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-25T13:27:10.276+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-25T13:27:10.278+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-25T13:27:10.278+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-24
[2024-07-25T13:27:10.278+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/24.csv
[2024-07-25T13:27:10.295+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix      ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240624  5.165637e+08  765077813.8  16733340    9443567  11943670   842089  5930353   309964     1387765  1.338748e+09
[2024-07-25T13:27:10.295+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-25T13:27:10.296+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-25T13:27:10.296+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-25T13:27:10.297+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-25T13:27:10.297+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-25T13:27:10.297+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-25T13:27:10.297+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-25T13:27:10.298+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-25T13:27:10.298+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-25T13:27:10.298+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-25T13:27:10.299+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-25T13:27:10.301+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-25T13:27:10.302+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-25T13:27:10.303+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-25T13:27:10.304+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-25T13:27:10.304+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-25T13:27:10.305+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-25T13:27:10.305+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-25T13:27:10.305+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-25T13:27:10.306+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-25T13:27:10.306+0000] {logging_mixin.py:188} INFO - 6
[2024-07-25T13:27:10.306+0000] {logging_mixin.py:188} INFO - 2024-06-24 00:00:00
[2024-07-25T13:27:10.306+0000] {logging_mixin.py:188} INFO - Start date<exec_date
[2024-07-25T13:27:10.310+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:164: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  daily_month_df = pd.read_sql_query(sql_query, CONN, params=(mois, date))

[2024-07-25T13:27:11.129+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:165: FutureWarning: The behavior of DataFrame concatenation with empty or all-NA entries is deprecated. In a future version, this will no longer exclude empty or all-NA columns when determining the result dtypes. To retain the old behavior, exclude the relevant entries before the concat operation.
  month_data = pd.concat([daily_month_df, df_final])

[2024-07-25T13:27:11.139+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:169: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  last_month = pd.read_sql_query(sql_query, CONN, params=(lmonth.month,exec_date.day))

[2024-07-25T13:27:11.188+0000] {logging_mixin.py:188} INFO - (3107, 39)
[2024-07-25T13:27:11.226+0000] {motower_daily.py:175} INFO - ADD  SEGMENT
[2024-07-25T13:27:15.564+0000] {logging_mixin.py:188} INFO - 3074    A DEVELOPER
Name: segment, dtype: object
[2024-07-25T13:27:15.566+0000] {logging_mixin.py:188} INFO - 3104    None
Name: segment, dtype: object
[2024-07-25T13:27:15.566+0000] {logging_mixin.py:188} INFO - hello
[2024-07-25T13:27:15.566+0000] {motower_daily.py:184} INFO - ADD PREVIOUS SEGMENT
[2024-07-25T13:27:15.574+0000] {logging_mixin.py:188} INFO - ########################################################################
[2024-07-25T13:27:15.597+0000] {logging_mixin.py:188} INFO -       id       jour code_oci  ...  previous_segment evolution_segment segment_y
3074 NaN 2024-06-24  OCI3190  ...              None               NaN      None

[1 rows x 40 columns]
[2024-07-25T13:27:15.597+0000] {motower_daily.py:191} INFO - ADD EVOLUTION SEGMENT
[2024-07-25T13:27:15.712+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-25T13:27:15.712+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-25T13:27:15.713+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-25T13:27:15.720+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-24  5.047696e+08  7.522612e+08   14928167.0  9196059.0  3790896.0  115677.0  3122832.0  199641.0    459520.0  1.296053e+09
[2024-07-25T13:27:15.720+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-25T13:27:15.721+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-25T13:27:15.721+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-25T13:27:15.722+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-25T13:27:15.722+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-25T13:27:15.722+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-25T13:27:15.723+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-25T13:27:15.723+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-25T13:27:15.723+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-25T13:27:15.724+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-25T13:27:15.747+0000] {logging_mixin.py:188} INFO -    id       jour code_oci  ...  previous_segment evolution_segment segment_y
0 NaN 2024-06-24  OCI2831  ...           PREMIUM               0.0   PREMIUM
1 NaN 2024-06-24  OCI3257  ...           PREMIUM               0.0   PREMIUM
2 NaN 2024-06-24  OCI3428  ...           PREMIUM               0.0   PREMIUM
3 NaN 2024-06-24  OCI2587  ...           PREMIUM               0.0   PREMIUM
4 NaN 2024-06-24  OCI3260  ...              None               NaN      None

[5 rows x 40 columns]
[2024-07-25T13:27:15.775+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-24  OCI2831       2831.0  ...  PREMIUM          PREMIUM               0.0
1 2024-06-24  OCI3257       3257.0  ...  PREMIUM          PREMIUM               0.0
2 2024-06-24  OCI3428       3428.0  ...  PREMIUM          PREMIUM               0.0
3 2024-06-24  OCI2587       2587.0  ...  PREMIUM          PREMIUM               0.0
4 2024-06-24  OCI3260       3260.0  ...     None             None               NaN

[5 rows x 38 columns]
[2024-07-25T13:27:16.284+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-25T13:27:16.285+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-25T13:27:16.294+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-25T06:00:00+00:00, execution_date=20240625T060000, start_date=20240725T132710, end_date=20240725T132716
[2024-07-25T13:27:16.328+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-25T13:27:16.342+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-25T13:27:16.343+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-25T15:08:28.899+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-25T15:08:28.925+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-25T15:08:28.931+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-25T15:08:28.931+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-25T15:08:28.940+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-25 06:00:00+00:00
[2024-07-25T15:08:28.949+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=14887) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-25T15:08:28.950+0000] {standard_task_runner.py:64} INFO - Started process 14889 to run task
[2024-07-25T15:08:28.950+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-25T06:00:00+00:00', '--job-id', '3288', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmp80o9z6hs']
[2024-07-25T15:08:28.952+0000] {standard_task_runner.py:91} INFO - Job 3288: Subtask motower_dcaparc
[2024-07-25T15:08:28.992+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-25T15:08:29.068+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-25T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-25T06:00:00+00:00'
[2024-07-25T15:08:29.069+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-25T15:08:29.082+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-25T15:08:29.090+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-25T15:08:29.127+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-25T15:08:29.129+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-25T15:08:29.129+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-24
[2024-07-25T15:08:29.129+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/24.csv
[2024-07-25T15:08:29.146+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix      ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240624  5.165637e+08  765077813.8  16733340    9443567  11943670   842089  5930353   309964     1387765  1.338748e+09
[2024-07-25T15:08:29.146+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-25T15:08:29.147+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-25T15:08:29.147+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-25T15:08:29.147+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-25T15:08:29.148+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-25T15:08:29.148+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-25T15:08:29.148+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-25T15:08:29.149+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-25T15:08:29.149+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-25T15:08:29.149+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-25T15:08:29.149+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-25T15:08:29.152+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-25T15:08:29.153+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-25T15:08:29.154+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-25T15:08:29.155+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-25T15:08:29.155+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-25T15:08:29.156+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-25T15:08:29.156+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-25T15:08:29.156+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-25T15:08:29.157+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-25T15:08:29.157+0000] {logging_mixin.py:188} INFO - 6
[2024-07-25T15:08:29.157+0000] {logging_mixin.py:188} INFO - 2024-06-24 00:00:00
[2024-07-25T15:08:29.157+0000] {logging_mixin.py:188} INFO - Start date<exec_date
[2024-07-25T15:08:29.161+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:164: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  daily_month_df = pd.read_sql_query(sql_query, CONN, params=(mois, date))

[2024-07-25T15:08:29.969+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:165: FutureWarning: The behavior of DataFrame concatenation with empty or all-NA entries is deprecated. In a future version, this will no longer exclude empty or all-NA columns when determining the result dtypes. To retain the old behavior, exclude the relevant entries before the concat operation.
  month_data = pd.concat([daily_month_df, df_final])

[2024-07-25T15:08:29.979+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:169: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  last_month = pd.read_sql_query(sql_query, CONN, params=(lmonth.month,exec_date.day))

[2024-07-25T15:08:30.030+0000] {logging_mixin.py:188} INFO - (3107, 39)
[2024-07-25T15:08:30.073+0000] {motower_daily.py:175} INFO - ADD  SEGMENT
[2024-07-25T15:08:34.373+0000] {logging_mixin.py:188} INFO - 3074    A DEVELOPER
Name: segment, dtype: object
[2024-07-25T15:08:34.375+0000] {logging_mixin.py:188} INFO - 3106    None
Name: segment, dtype: object
[2024-07-25T15:08:34.375+0000] {logging_mixin.py:188} INFO - hello
[2024-07-25T15:08:34.375+0000] {motower_daily.py:184} INFO - ADD PREVIOUS SEGMENT
[2024-07-25T15:08:34.384+0000] {logging_mixin.py:188} INFO - ########################################################################
[2024-07-25T15:08:34.405+0000] {logging_mixin.py:188} INFO -       id       jour code_oci  ...  previous_segment evolution_segment segment_y
3074 NaN 2024-06-24  OCI3190  ...              None               NaN      None

[1 rows x 40 columns]
[2024-07-25T15:08:34.405+0000] {motower_daily.py:191} INFO - ADD EVOLUTION SEGMENT
[2024-07-25T15:08:34.517+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-25T15:08:34.518+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-25T15:08:34.519+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-25T15:08:34.526+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-24  5.047696e+08  7.522612e+08   14928167.0  9196059.0  3790896.0  115677.0  3122832.0  199641.0    459520.0  1.296053e+09
[2024-07-25T15:08:34.526+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-25T15:08:34.526+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-25T15:08:34.527+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-25T15:08:34.527+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-25T15:08:34.527+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-25T15:08:34.528+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-25T15:08:34.528+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-25T15:08:34.529+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-25T15:08:34.529+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-25T15:08:34.529+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-25T15:08:34.553+0000] {logging_mixin.py:188} INFO -    id       jour code_oci  ...  previous_segment evolution_segment segment_y
0 NaN 2024-06-24  OCI2831  ...           PREMIUM               0.0   PREMIUM
1 NaN 2024-06-24  OCI3257  ...           PREMIUM               0.0   PREMIUM
2 NaN 2024-06-24  OCI3428  ...           PREMIUM               0.0   PREMIUM
3 NaN 2024-06-24  OCI2587  ...           PREMIUM               0.0   PREMIUM
4 NaN 2024-06-24  OCI3260  ...              None               NaN      None

[5 rows x 40 columns]
[2024-07-25T15:08:34.581+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-24  OCI2831       2831.0  ...  PREMIUM          PREMIUM               0.0
1 2024-06-24  OCI3257       3257.0  ...  PREMIUM          PREMIUM               0.0
2 2024-06-24  OCI3428       3428.0  ...  PREMIUM          PREMIUM               0.0
3 2024-06-24  OCI2587       2587.0  ...  PREMIUM          PREMIUM               0.0
4 2024-06-24  OCI3260       3260.0  ...     None             None               NaN

[5 rows x 38 columns]
[2024-07-25T15:08:35.100+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-25T15:08:35.101+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-25T15:08:35.111+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-25T06:00:00+00:00, execution_date=20240625T060000, start_date=20240725T150828, end_date=20240725T150835
[2024-07-25T15:08:35.173+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-25T15:08:35.187+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-25T15:08:35.189+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-26T11:44:59.263+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-26T11:44:59.309+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-26T11:44:59.324+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-26T11:44:59.325+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-26T11:44:59.349+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-25 06:00:00+00:00
[2024-07-26T11:44:59.363+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=2967) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-26T11:44:59.365+0000] {standard_task_runner.py:64} INFO - Started process 2969 to run task
[2024-07-26T11:44:59.365+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-25T06:00:00+00:00', '--job-id', '3934', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpa5rtc7wr']
[2024-07-26T11:44:59.367+0000] {standard_task_runner.py:91} INFO - Job 3934: Subtask motower_dcaparc
[2024-07-26T11:44:59.417+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-26T11:44:59.534+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-25T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-25T06:00:00+00:00'
[2024-07-26T11:44:59.535+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-26T11:44:59.552+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-26T11:44:59.563+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-26T11:44:59.616+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T11:44:59.618+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T11:44:59.618+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-24
[2024-07-26T11:44:59.619+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/24.csv
[2024-07-26T11:44:59.639+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix      ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240624  5.165637e+08  765077813.8  16733340    9443567  11943670   842089  5930353   309964     1387765  1.338748e+09
[2024-07-26T11:44:59.639+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T11:44:59.640+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T11:44:59.641+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T11:44:59.641+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T11:44:59.641+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T11:44:59.642+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T11:44:59.642+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-26T11:44:59.643+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-26T11:44:59.643+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T11:44:59.643+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T11:44:59.644+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-26T11:44:59.647+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-26T11:44:59.648+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-26T11:44:59.650+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-26T11:44:59.651+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-26T11:44:59.651+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-26T11:44:59.652+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-26T11:44:59.652+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-26T11:44:59.652+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-26T11:44:59.653+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-26T11:44:59.653+0000] {logging_mixin.py:188} INFO - 6
[2024-07-26T11:44:59.653+0000] {logging_mixin.py:188} INFO - 2024-06-24 00:00:00
[2024-07-26T11:44:59.653+0000] {logging_mixin.py:188} INFO - Start date<exec_date
[2024-07-26T11:44:59.657+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:164: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  daily_month_df = pd.read_sql_query(sql_query, CONN, params=(mois, date))

[2024-07-26T11:45:00.594+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:165: FutureWarning: The behavior of DataFrame concatenation with empty or all-NA entries is deprecated. In a future version, this will no longer exclude empty or all-NA columns when determining the result dtypes. To retain the old behavior, exclude the relevant entries before the concat operation.
  month_data = pd.concat([daily_month_df, df_final])

[2024-07-26T11:45:00.692+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:169: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  last_month = pd.read_sql_query(sql_query, CONN, params=(lmonth.month,exec_date.day))

[2024-07-26T11:45:00.715+0000] {logging_mixin.py:188} INFO - (0, 39)
[2024-07-26T11:45:00.765+0000] {motower_daily.py:175} INFO - ADD  SEGMENT
[2024-07-26T11:45:05.582+0000] {logging_mixin.py:188} INFO - 3074    A DEVELOPER
Name: segment, dtype: object
[2024-07-26T11:45:05.582+0000] {logging_mixin.py:188} INFO - Series([], Name: segment, dtype: object)
[2024-07-26T11:45:05.583+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-26T11:45:05.583+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T11:45:05.584+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T11:45:05.592+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-24  5.047696e+08  7.522612e+08   14928167.0  9196059.0  3790896.0  115677.0  3122832.0  199641.0    459520.0  1.296053e+09
[2024-07-26T11:45:05.592+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T11:45:05.593+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T11:45:05.593+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T11:45:05.594+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T11:45:05.594+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T11:45:05.595+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T11:45:05.595+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-26T11:45:05.596+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-26T11:45:05.596+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T11:45:05.597+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T11:45:05.624+0000] {logging_mixin.py:188} INFO -    id       jour code_oci  ...  segment previous_segment evolution_segment
0 NaN 2024-06-24  OCI2831  ...  PREMIUM             None              None
1 NaN 2024-06-24  OCI3257  ...  PREMIUM             None              None
2 NaN 2024-06-24  OCI3428  ...  PREMIUM             None              None
3 NaN 2024-06-24  OCI2587  ...  PREMIUM             None              None
4 NaN 2024-06-24  OCI3260  ...     None             None              None

[5 rows x 39 columns]
[2024-07-26T11:45:05.652+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-24  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-24  OCI3257       3257.0  ...  PREMIUM             None              None
2 2024-06-24  OCI3428       3428.0  ...  PREMIUM             None              None
3 2024-06-24  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-24  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T11:45:06.554+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-26T11:45:06.555+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-26T11:45:06.563+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-25T06:00:00+00:00, execution_date=20240625T060000, start_date=20240726T114459, end_date=20240726T114506
[2024-07-26T11:45:06.608+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-26T11:45:06.621+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-26T11:45:06.622+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-26T12:25:56.554+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-26T12:25:56.578+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-26T12:25:56.584+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-26T12:25:56.584+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-26T12:25:56.596+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-25 06:00:00+00:00
[2024-07-26T12:25:56.604+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=2143) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-26T12:25:56.606+0000] {standard_task_runner.py:64} INFO - Started process 2145 to run task
[2024-07-26T12:25:56.606+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-25T06:00:00+00:00', '--job-id', '653', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmp46jag3v4']
[2024-07-26T12:25:56.608+0000] {standard_task_runner.py:91} INFO - Job 653: Subtask motower_dcaparc
[2024-07-26T12:25:56.650+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [running]> on host 88c2b04746a4
[2024-07-26T12:25:56.730+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-25T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-25T06:00:00+00:00'
[2024-07-26T12:25:56.731+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-26T12:25:56.744+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-26T12:25:56.754+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-26T12:25:56.791+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T12:25:56.792+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T12:25:56.793+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-24
[2024-07-26T12:25:56.793+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/24.csv
[2024-07-26T12:25:56.810+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix      ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240624  5.165637e+08  765077813.8  16733340    9443567  11943670   842089  5930353   309964     1387765  1.338748e+09
[2024-07-26T12:25:56.810+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T12:25:56.811+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T12:25:56.811+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T12:25:56.812+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T12:25:56.812+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T12:25:56.812+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T12:25:56.813+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-26T12:25:56.813+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-26T12:25:56.813+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T12:25:56.814+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T12:25:56.814+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-26T12:25:56.817+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-26T12:25:56.817+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-26T12:25:56.819+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-26T12:25:56.820+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-26T12:25:56.820+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-26T12:25:56.820+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-26T12:25:56.821+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-26T12:25:56.821+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-26T12:25:56.821+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-26T12:25:56.822+0000] {logging_mixin.py:188} INFO - 6
[2024-07-26T12:25:56.822+0000] {logging_mixin.py:188} INFO - 2024-06-24 00:00:00
[2024-07-26T12:25:56.822+0000] {logging_mixin.py:188} INFO - Start date<exec_date
[2024-07-26T12:25:56.826+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:164: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  daily_month_df = pd.read_sql_query(sql_query, CONN, params=(mois, date))

[2024-07-26T12:25:57.636+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:165: FutureWarning: The behavior of DataFrame concatenation with empty or all-NA entries is deprecated. In a future version, this will no longer exclude empty or all-NA columns when determining the result dtypes. To retain the old behavior, exclude the relevant entries before the concat operation.
  month_data = pd.concat([daily_month_df, df_final])

[2024-07-26T12:25:57.718+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:169: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  last_month = pd.read_sql_query(sql_query, CONN, params=(lmonth.month,exec_date.day))

[2024-07-26T12:25:57.735+0000] {logging_mixin.py:188} INFO - (0, 39)
[2024-07-26T12:25:57.778+0000] {motower_daily.py:175} INFO - ADD  SEGMENT
[2024-07-26T12:26:02.281+0000] {logging_mixin.py:188} INFO - 3074    A DEVELOPER
Name: segment, dtype: object
[2024-07-26T12:26:02.282+0000] {logging_mixin.py:188} INFO - Series([], Name: segment, dtype: object)
[2024-07-26T12:26:02.282+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-26T12:26:02.282+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T12:26:02.283+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T12:26:02.290+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-24  5.047696e+08  7.522612e+08   14928167.0  9196059.0  3790896.0  115677.0  3122832.0  199641.0    459520.0  1.296053e+09
[2024-07-26T12:26:02.290+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T12:26:02.291+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T12:26:02.291+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T12:26:02.291+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T12:26:02.291+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T12:26:02.292+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T12:26:02.292+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-26T12:26:02.293+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-26T12:26:02.293+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T12:26:02.293+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T12:26:02.316+0000] {logging_mixin.py:188} INFO -    id       jour code_oci  ...  segment previous_segment evolution_segment
0 NaN 2024-06-24  OCI2831  ...  PREMIUM             None              None
1 NaN 2024-06-24  OCI3257  ...  PREMIUM             None              None
2 NaN 2024-06-24  OCI3428  ...  PREMIUM             None              None
3 NaN 2024-06-24  OCI2587  ...  PREMIUM             None              None
4 NaN 2024-06-24  OCI3260  ...     None             None              None

[5 rows x 39 columns]
[2024-07-26T12:26:02.341+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-24  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-24  OCI3257       3257.0  ...  PREMIUM             None              None
2 2024-06-24  OCI3428       3428.0  ...  PREMIUM             None              None
3 2024-06-24  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-24  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T12:26:02.457+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:133: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['mois'] = data["jour"].dt.month

[2024-07-26T12:26:02.458+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:134: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['annee'] = data["jour"].dt.year

[2024-07-26T12:26:03.242+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-26T12:26:03.242+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-26T12:26:03.251+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-25T06:00:00+00:00, execution_date=20240625T060000, start_date=20240726T122556, end_date=20240726T122603
[2024-07-26T12:26:03.392+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-26T12:26:03.407+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-26T12:26:03.408+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-26T12:31:41.920+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-26T12:31:42.131+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-26T12:31:42.139+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-26T12:31:42.139+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-26T12:31:42.153+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-25 06:00:00+00:00
[2024-07-26T12:31:42.163+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=3121) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-26T12:31:42.165+0000] {standard_task_runner.py:64} INFO - Started process 3123 to run task
[2024-07-26T12:31:42.165+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-25T06:00:00+00:00', '--job-id', '956', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpsgh5fq12']
[2024-07-26T12:31:42.167+0000] {standard_task_runner.py:91} INFO - Job 956: Subtask motower_dcaparc
[2024-07-26T12:31:42.211+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [running]> on host 88c2b04746a4
[2024-07-26T12:31:42.308+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-25T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-25T06:00:00+00:00'
[2024-07-26T12:31:42.309+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-26T12:31:42.324+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-26T12:31:42.335+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-26T12:31:42.382+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T12:31:42.384+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T12:31:42.384+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-24
[2024-07-26T12:31:42.384+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/24.csv
[2024-07-26T12:31:42.403+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix      ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240624  5.165637e+08  765077813.8  16733340    9443567  11943670   842089  5930353   309964     1387765  1.338748e+09
[2024-07-26T12:31:42.403+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T12:31:42.404+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T12:31:42.404+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T12:31:42.405+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T12:31:42.405+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T12:31:42.405+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T12:31:42.406+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-26T12:31:42.406+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-26T12:31:42.406+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T12:31:42.407+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T12:31:42.407+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-26T12:31:42.410+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-26T12:31:42.411+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-26T12:31:42.413+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-26T12:31:42.414+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-26T12:31:42.415+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-26T12:31:42.415+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-26T12:31:42.415+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-26T12:31:42.416+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-26T12:31:42.416+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-26T12:31:42.416+0000] {logging_mixin.py:188} INFO - 6
[2024-07-26T12:31:42.417+0000] {logging_mixin.py:188} INFO - 2024-06-24 00:00:00
[2024-07-26T12:31:42.417+0000] {logging_mixin.py:188} INFO - Start date<exec_date
[2024-07-26T12:31:42.421+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:164: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  daily_month_df = pd.read_sql_query(sql_query, CONN, params=(mois, date))

[2024-07-26T12:31:43.288+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:165: FutureWarning: The behavior of DataFrame concatenation with empty or all-NA entries is deprecated. In a future version, this will no longer exclude empty or all-NA columns when determining the result dtypes. To retain the old behavior, exclude the relevant entries before the concat operation.
  month_data = pd.concat([daily_month_df, df_final])

[2024-07-26T12:31:43.395+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:169: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  last_month = pd.read_sql_query(sql_query, CONN, params=(lmonth.month,exec_date.day))

[2024-07-26T12:31:43.417+0000] {logging_mixin.py:188} INFO - (0, 39)
[2024-07-26T12:31:43.460+0000] {motower_daily.py:175} INFO - ADD  SEGMENT
[2024-07-26T12:31:48.299+0000] {logging_mixin.py:188} INFO - 3074    A DEVELOPER
Name: segment, dtype: object
[2024-07-26T12:31:48.299+0000] {logging_mixin.py:188} INFO - Series([], Name: segment, dtype: object)
[2024-07-26T12:31:48.300+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-26T12:31:48.300+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T12:31:48.300+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T12:31:48.307+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-24  5.047696e+08  7.522612e+08   14928167.0  9196059.0  3790896.0  115677.0  3122832.0  199641.0    459520.0  1.296053e+09
[2024-07-26T12:31:48.308+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T12:31:48.308+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T12:31:48.308+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T12:31:48.309+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T12:31:48.309+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T12:31:48.310+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T12:31:48.310+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-26T12:31:48.310+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-26T12:31:48.311+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T12:31:48.311+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T12:31:48.335+0000] {logging_mixin.py:188} INFO -    id       jour code_oci  ...  segment previous_segment evolution_segment
0 NaN 2024-06-24  OCI2831  ...  PREMIUM             None              None
1 NaN 2024-06-24  OCI3257  ...  PREMIUM             None              None
2 NaN 2024-06-24  OCI3428  ...  PREMIUM             None              None
3 NaN 2024-06-24  OCI2587  ...  PREMIUM             None              None
4 NaN 2024-06-24  OCI3260  ...     None             None              None

[5 rows x 39 columns]
[2024-07-26T12:31:48.359+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-24  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-24  OCI3257       3257.0  ...  PREMIUM             None              None
2 2024-06-24  OCI3428       3428.0  ...  PREMIUM             None              None
3 2024-06-24  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-24  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T12:31:48.482+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:133: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['mois'] = data["jour"].dt.month

[2024-07-26T12:31:48.483+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:134: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['annee'] = data["jour"].dt.year

[2024-07-26T12:31:49.315+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-26T12:31:49.315+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-26T12:31:49.324+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-25T06:00:00+00:00, execution_date=20240625T060000, start_date=20240726T123142, end_date=20240726T123149
[2024-07-26T12:31:49.397+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-26T12:31:49.412+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-26T12:31:49.415+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-29T12:01:08.070+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-29T12:01:08.096+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-29T12:01:08.106+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-29T12:01:08.106+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-29T12:01:08.116+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-25 06:00:00+00:00
[2024-07-29T12:01:08.125+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=3551) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-29T12:01:08.126+0000] {standard_task_runner.py:64} INFO - Started process 3558 to run task
[2024-07-29T12:01:08.126+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-25T06:00:00+00:00', '--job-id', '982', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmp93nzs3zo']
[2024-07-29T12:01:08.128+0000] {standard_task_runner.py:91} INFO - Job 982: Subtask motower_dcaparc
[2024-07-29T12:01:08.164+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [running]> on host e824106b656d
[2024-07-29T12:01:08.245+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-25T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-25T06:00:00+00:00'
[2024-07-29T12:01:08.246+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-29T12:01:08.262+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-29T12:01:08.271+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-29T12:01:08.312+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-29T12:01:08.313+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-29T12:01:08.314+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-24
[2024-07-29T12:01:08.314+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/24.csv
[2024-07-29T12:01:08.331+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix      ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240624  5.165637e+08  765077813.8  16733340    9443567  11943670   842089  5930353   309964     1387765  1.338748e+09
[2024-07-29T12:01:08.332+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-29T12:01:08.333+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-29T12:01:08.333+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-29T12:01:08.333+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-29T12:01:08.334+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-29T12:01:08.334+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-29T12:01:08.334+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-29T12:01:08.335+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-29T12:01:08.335+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-29T12:01:08.336+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-29T12:01:08.336+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-29T12:01:08.339+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-29T12:01:08.340+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-29T12:01:08.341+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-29T12:01:08.342+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-29T12:01:08.342+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-29T12:01:08.343+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-29T12:01:08.343+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-29T12:01:08.343+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-29T12:01:08.344+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-29T12:01:08.344+0000] {logging_mixin.py:188} INFO - 6
[2024-07-29T12:01:08.344+0000] {logging_mixin.py:188} INFO - 2024-06-24 00:00:00
[2024-07-29T12:01:08.344+0000] {logging_mixin.py:188} INFO - Start date<exec_date
[2024-07-29T12:01:08.348+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:164: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  daily_month_df = pd.read_sql_query(sql_query, CONN, params=(mois, date))

[2024-07-29T12:01:09.247+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:165: FutureWarning: The behavior of DataFrame concatenation with empty or all-NA entries is deprecated. In a future version, this will no longer exclude empty or all-NA columns when determining the result dtypes. To retain the old behavior, exclude the relevant entries before the concat operation.
  month_data = pd.concat([daily_month_df, df_final])

[2024-07-29T12:01:09.341+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:169: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  last_month = pd.read_sql_query(sql_query, CONN, params=(lmonth.month,exec_date.day))

[2024-07-29T12:01:09.366+0000] {logging_mixin.py:188} INFO - (0, 39)
[2024-07-29T12:01:09.417+0000] {motower_daily.py:175} INFO - ADD  SEGMENT
[2024-07-29T12:01:14.005+0000] {logging_mixin.py:188} INFO - 3074    A DEVELOPER
Name: segment, dtype: object
[2024-07-29T12:01:14.006+0000] {logging_mixin.py:188} INFO - Series([], Name: segment, dtype: object)
[2024-07-29T12:01:14.006+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-29T12:01:14.006+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-29T12:01:14.007+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-29T12:01:14.014+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-24  5.047696e+08  7.522612e+08   14928167.0  9196059.0  3790896.0  115677.0  3122832.0  199641.0    459520.0  1.296053e+09
[2024-07-29T12:01:14.014+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-29T12:01:14.015+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-29T12:01:14.015+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-29T12:01:14.015+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-29T12:01:14.016+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-29T12:01:14.016+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-29T12:01:14.016+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-29T12:01:14.017+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-29T12:01:14.017+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-29T12:01:14.017+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-29T12:01:14.040+0000] {logging_mixin.py:188} INFO -    id       jour code_oci  ...  segment previous_segment evolution_segment
0 NaN 2024-06-24  OCI2831  ...  PREMIUM             None              None
1 NaN 2024-06-24  OCI3257  ...  PREMIUM             None              None
2 NaN 2024-06-24  OCI3428  ...  PREMIUM             None              None
3 NaN 2024-06-24  OCI2587  ...  PREMIUM             None              None
4 NaN 2024-06-24  OCI3260  ...     None             None              None

[5 rows x 39 columns]
[2024-07-29T12:01:14.065+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-24  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-24  OCI3257       3257.0  ...  PREMIUM             None              None
2 2024-06-24  OCI3428       3428.0  ...  PREMIUM             None              None
3 2024-06-24  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-24  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-29T12:01:14.184+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:139: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['mois'] = data["jour"].dt.month

[2024-07-29T12:01:14.184+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:140: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['annee'] = data["jour"].dt.year

[2024-07-29T12:01:14.951+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-29T12:01:14.951+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-29T12:01:14.960+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-25T06:00:00+00:00, execution_date=20240625T060000, start_date=20240729T120108, end_date=20240729T120114
[2024-07-29T12:01:14.991+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-29T12:01:15.004+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-29T12:01:15.005+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-29T14:34:12.877+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-29T14:34:13.068+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-29T14:34:13.077+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [queued]>
[2024-07-29T14:34:13.077+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-29T14:34:13.087+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-25 06:00:00+00:00
[2024-07-29T14:34:13.096+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=1580) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-29T14:34:13.097+0000] {standard_task_runner.py:64} INFO - Started process 1583 to run task
[2024-07-29T14:34:13.098+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-25T06:00:00+00:00', '--job-id', '1375', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpqi31zuth']
[2024-07-29T14:34:13.099+0000] {standard_task_runner.py:91} INFO - Job 1375: Subtask motower_dcaparc
[2024-07-29T14:34:13.141+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-25T06:00:00+00:00 [running]> on host e824106b656d
[2024-07-29T14:34:13.220+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-25T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-25T06:00:00+00:00'
[2024-07-29T14:34:13.221+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-29T14:34:13.234+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-29T14:34:13.242+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-29T14:34:13.280+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-29T14:34:13.282+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-29T14:34:13.282+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-24
[2024-07-29T14:34:13.282+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/24.csv
[2024-07-29T14:34:13.300+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix      ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240624  5.165637e+08  765077813.8  16733340    9443567  11943670   842089  5930353   309964     1387765  1.338748e+09
[2024-07-29T14:34:13.300+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-29T14:34:13.301+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-29T14:34:13.301+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-29T14:34:13.302+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-29T14:34:13.302+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-29T14:34:13.302+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-29T14:34:13.303+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-29T14:34:13.303+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-29T14:34:13.303+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-29T14:34:13.304+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-29T14:34:13.304+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-29T14:34:13.307+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-29T14:34:13.308+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-29T14:34:13.309+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-29T14:34:13.310+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-29T14:34:13.310+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-29T14:34:13.311+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-29T14:34:13.311+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-29T14:34:13.312+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-29T14:34:13.312+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-29T14:34:13.312+0000] {logging_mixin.py:188} INFO - 6
[2024-07-29T14:34:13.312+0000] {logging_mixin.py:188} INFO - 2024-06-24 00:00:00
[2024-07-29T14:34:13.313+0000] {logging_mixin.py:188} INFO - Start date<exec_date
[2024-07-29T14:34:13.316+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:164: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  daily_month_df = pd.read_sql_query(sql_query, CONN, params=(mois, date))

[2024-07-29T14:34:14.160+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:165: FutureWarning: The behavior of DataFrame concatenation with empty or all-NA entries is deprecated. In a future version, this will no longer exclude empty or all-NA columns when determining the result dtypes. To retain the old behavior, exclude the relevant entries before the concat operation.
  month_data = pd.concat([daily_month_df, df_final])

[2024-07-29T14:34:14.242+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:169: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  last_month = pd.read_sql_query(sql_query, CONN, params=(lmonth.month,exec_date.day))

[2024-07-29T14:34:14.259+0000] {logging_mixin.py:188} INFO - (0, 39)
[2024-07-29T14:34:14.298+0000] {motower_daily.py:175} INFO - ADD  SEGMENT
[2024-07-29T14:34:18.414+0000] {logging_mixin.py:188} INFO - 3074    A DEVELOPER
Name: segment, dtype: object
[2024-07-29T14:34:18.414+0000] {logging_mixin.py:188} INFO - Series([], Name: segment, dtype: object)
[2024-07-29T14:34:18.415+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-29T14:34:18.415+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-29T14:34:18.416+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-29T14:34:18.422+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-24  5.047696e+08  7.522612e+08   14928167.0  9196059.0  3790896.0  115677.0  3122832.0  199641.0    459520.0  1.296053e+09
[2024-07-29T14:34:18.422+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-29T14:34:18.423+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-29T14:34:18.423+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-29T14:34:18.424+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-29T14:34:18.424+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-29T14:34:18.424+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-29T14:34:18.424+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-29T14:34:18.425+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-29T14:34:18.425+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-29T14:34:18.426+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-29T14:34:18.447+0000] {logging_mixin.py:188} INFO -    id       jour code_oci  ...  segment previous_segment evolution_segment
0 NaN 2024-06-24  OCI2831  ...  PREMIUM             None              None
1 NaN 2024-06-24  OCI3257  ...  PREMIUM             None              None
2 NaN 2024-06-24  OCI3428  ...  PREMIUM             None              None
3 NaN 2024-06-24  OCI2587  ...  PREMIUM             None              None
4 NaN 2024-06-24  OCI3260  ...     None             None              None

[5 rows x 39 columns]
[2024-07-29T14:34:18.470+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-24  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-24  OCI3257       3257.0  ...  PREMIUM             None              None
2 2024-06-24  OCI3428       3428.0  ...  PREMIUM             None              None
3 2024-06-24  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-24  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-29T14:34:18.585+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:139: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['mois'] = data["jour"].dt.month

[2024-07-29T14:34:18.586+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:140: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['annee'] = data["jour"].dt.year

[2024-07-29T14:34:19.375+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-29T14:34:19.376+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-29T14:34:19.384+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-25T06:00:00+00:00, execution_date=20240625T060000, start_date=20240729T143413, end_date=20240729T143419
[2024-07-29T14:34:19.444+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-29T14:34:19.459+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-29T14:34:19.461+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
