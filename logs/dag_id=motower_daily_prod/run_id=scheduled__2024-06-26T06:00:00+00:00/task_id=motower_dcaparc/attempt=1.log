[2024-07-23T14:55:30.056+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-23T14:55:30.334+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-07-23T14:55:30.347+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-07-23T14:55:30.348+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-23T14:55:30.364+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-26 06:00:00+00:00
[2024-07-23T14:55:30.377+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=242) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-23T14:55:30.378+0000] {standard_task_runner.py:64} INFO - Started process 255 to run task
[2024-07-23T14:55:30.378+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-26T06:00:00+00:00', '--job-id', '40', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpd3rrpvhr']
[2024-07-23T14:55:30.381+0000] {standard_task_runner.py:91} INFO - Job 40: Subtask motower_dcaparc
[2024-07-23T14:55:30.423+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [running]> on host 4dd3fd89b847
[2024-07-23T14:55:30.520+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-26T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-26T06:00:00+00:00'
[2024-07-23T14:55:30.521+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-23T14:55:30.539+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-23T14:55:30.548+0000] {motower_daily.py:120} INFO - READING None
[2024-07-23T14:55:30.549+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-23T14:55:30.549+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 126, in generate_daily_caparc
    validate_site_actifs(df_bdd_site=bdd, col="code oci", host=smtphost, port=smtpport, user=smtpuser)
                                     ^^^
UnboundLocalError: cannot access local variable 'bdd' where it is not associated with a value
[2024-07-23T14:55:30.559+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-26T06:00:00+00:00, execution_date=20240626T060000, start_date=20240723T145530, end_date=20240723T145530
[2024-07-23T14:55:30.575+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-07-23T14:55:30.575+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-23T14:55:30.576+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-23T14:55:30.584+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-23T14:55:30.584+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-23T14:55:30.585+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 126, in generate_daily_caparc
    validate_site_actifs(df_bdd_site=bdd, col="code oci", host=smtphost, port=smtpport, user=smtpuser)
                                     ^^^
UnboundLocalError: cannot access local variable 'bdd' where it is not associated with a value

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-07-23T14:55:30.590+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-07-23T14:55:30.590+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-23T14:55:30.590+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-23T14:55:30.603+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 40 for task motower_dcaparc (cannot access local variable 'bdd' where it is not associated with a value; 255)
[2024-07-23T14:55:30.632+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-07-23T14:55:30.642+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-23T16:23:32.826+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-23T16:23:32.870+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-07-23T16:23:32.899+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-07-23T16:23:32.900+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-23T16:23:32.923+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-26 06:00:00+00:00
[2024-07-23T16:23:32.940+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=1201) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-23T16:23:32.943+0000] {standard_task_runner.py:64} INFO - Started process 1220 to run task
[2024-07-23T16:23:32.943+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-26T06:00:00+00:00', '--job-id', '174', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmp__v68iws']
[2024-07-23T16:23:32.946+0000] {standard_task_runner.py:91} INFO - Job 174: Subtask motower_dcaparc
[2024-07-23T16:23:33.024+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [running]> on host ebc7a11cfc7f
[2024-07-23T16:23:33.359+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-26T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-26T06:00:00+00:00'
[2024-07-23T16:23:33.360+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-23T16:23:33.380+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-23T16:23:33.392+0000] {motower_daily.py:120} INFO - READING BASE_SITES-cleaned/02.csv
[2024-07-23T16:23:33.448+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-23T16:23:33.449+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3487
[2024-07-23T16:23:33.450+0000] {motower_daily.py:130} INFO - GET CA PARC FILE OF THE DAY 2024-06-25
[2024-07-23T16:23:33.450+0000] {motower_daily.py:134} INFO - READING ca-parc/2024/06/25.csv
[2024-07-23T16:23:33.472+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-23T16:23:33.473+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 136, in generate_daily_caparc
    df_for_validation = ca.groupby("date_id").agg({'ca_voix': 'sum', 'ca_data': 'sum', 'parc': 'sum', 'parc_data': 'sum', "parc_2g": 'sum',
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/groupby/generic.py", line 1445, in aggregate
    result = op.agg()
             ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 175, in agg
    return self.agg_dict_like()
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 406, in agg_dict_like
    return self.agg_or_apply_dict_like(op_name="agg")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 1390, in agg_or_apply_dict_like
    result_index, result_data = self.compute_dict_like(
                                ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 445, in compute_dict_like
    func = self.normalize_dictlike_arg(op_name, selected_obj, func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 639, in normalize_dictlike_arg
    raise KeyError(f"Column(s) {list(cols)} do not exist")
KeyError: "Column(s) ['parc'] do not exist"
[2024-07-23T16:23:33.490+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-26T06:00:00+00:00, execution_date=20240626T060000, start_date=20240723T162332, end_date=20240723T162333
[2024-07-23T16:23:33.527+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-07-23T16:23:33.528+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-23T16:23:33.528+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-23T16:23:33.543+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-07-23T16:23:33.544+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-07-23T16:23:33.544+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 113, in gen_motower_daily
    data = generate_daily_caparc(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 136, in generate_daily_caparc
    df_for_validation = ca.groupby("date_id").agg({'ca_voix': 'sum', 'ca_data': 'sum', 'parc': 'sum', 'parc_data': 'sum', "parc_2g": 'sum',
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/groupby/generic.py", line 1445, in aggregate
    result = op.agg()
             ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 175, in agg
    return self.agg_dict_like()
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 406, in agg_dict_like
    return self.agg_or_apply_dict_like(op_name="agg")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 1390, in agg_or_apply_dict_like
    result_index, result_data = self.compute_dict_like(
                                ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 445, in compute_dict_like
    func = self.normalize_dictlike_arg(op_name, selected_obj, func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/apply.py", line 639, in normalize_dictlike_arg
    raise KeyError(f"Column(s) {list(cols)} do not exist")
KeyError: "Column(s) ['parc'] do not exist"

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-07-23T16:23:33.551+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-07-23T16:23:33.551+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-07-23T16:23:33.551+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-07-23T16:23:33.574+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 174 for task motower_dcaparc ("Column(s) ['parc'] do not exist"; 1220)
[2024-07-23T16:23:33.629+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-07-23T16:23:33.670+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-23T16:23:33.677+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-24T12:04:43.442+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-24T12:04:43.478+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-07-24T12:04:43.492+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-07-24T12:04:43.492+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-24T12:04:43.508+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-26 06:00:00+00:00
[2024-07-24T12:04:43.528+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=1939) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-24T12:04:43.530+0000] {standard_task_runner.py:64} INFO - Started process 1957 to run task
[2024-07-24T12:04:43.531+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-26T06:00:00+00:00', '--job-id', '251', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmphi0dukrg']
[2024-07-24T12:04:43.534+0000] {standard_task_runner.py:91} INFO - Job 251: Subtask motower_dcaparc
[2024-07-24T12:04:43.597+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-24T12:04:43.720+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-26T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-26T06:00:00+00:00'
[2024-07-24T12:04:43.722+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-24T12:04:43.753+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-24T12:04:43.766+0000] {motower_daily.py:120} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-24T12:04:43.834+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-24T12:04:43.837+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-24T12:04:43.837+0000] {motower_daily.py:130} INFO - GET CA PARC FILE OF THE DAY 2024-06-25
[2024-07-24T12:04:43.837+0000] {motower_daily.py:134} INFO - READING ca-parc/2024/06/25.csv
[2024-07-24T12:04:43.865+0000] {motower_daily.py:139} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240625  6.664774e+08  1.243799e+09  16753745    9453602  11948494   841665  5929920   308836     1388920  1.970652e+09
[2024-07-24T12:04:43.865+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-24T12:04:43.867+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-24T12:04:43.867+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-24T12:04:43.868+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-24T12:04:43.868+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-24T12:04:43.869+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-24T12:04:43.869+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-24T12:04:43.871+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-24T12:04:43.872+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-24T12:04:43.872+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-24T12:04:43.873+0000] {motower_daily.py:142} INFO - MERGING BDD AND CA
[2024-07-24T12:04:43.877+0000] {motower_daily.py:144} INFO - prepare final daily data
[2024-07-24T12:04:43.879+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-24T12:04:43.881+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-24T12:04:43.883+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-24T12:04:43.884+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-24T12:04:43.884+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-24T12:04:43.885+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:155: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-24T12:04:43.885+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:156: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-24T12:04:43.886+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:157: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-24T12:04:43.886+0000] {logging_mixin.py:188} INFO - 6
[2024-07-24T12:04:43.899+0000] {motower_daily.py:193} INFO - ADD  SEGMENT
[2024-07-24T12:04:44.133+0000] {motower_daily.py:198} INFO - DATA VALIDATION AFTER MERGING
[2024-07-24T12:04:44.133+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-24T12:04:44.134+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-24T12:04:44.143+0000] {motower_daily.py:209} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-25  6.524003e+08  1.224664e+09   14947858.0  9207249.0  3796997.0  115431.0  3123077.0  198532.0    461044.0  1.919708e+09
[2024-07-24T12:04:44.144+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-24T12:04:44.145+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-24T12:04:44.145+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-24T12:04:44.146+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-24T12:04:44.146+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-24T12:04:44.147+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-24T12:04:44.147+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-24T12:04:44.148+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-24T12:04:44.148+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-24T12:04:44.149+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-24T12:04:44.177+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-25  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-25  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-25  OCI3428       3428.0  ...  PREMIUM             None              None
3 2024-06-25  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-25  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-24T12:04:44.205+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-25  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-25  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-25  OCI3428       3428.0  ...  PREMIUM             None              None
3 2024-06-25  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-25  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-24T12:04:44.632+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-24T12:04:44.633+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-24T12:04:44.642+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-26T06:00:00+00:00, execution_date=20240626T060000, start_date=20240724T120443, end_date=20240724T120444
[2024-07-24T12:04:44.675+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-24T12:04:44.684+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-24T12:10:09.095+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-24T12:10:09.545+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-07-24T12:10:09.558+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-07-24T12:10:09.558+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-24T12:10:09.578+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-26 06:00:00+00:00
[2024-07-24T12:10:09.595+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=2176) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-24T12:10:09.596+0000] {standard_task_runner.py:64} INFO - Started process 2189 to run task
[2024-07-24T12:10:09.606+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-26T06:00:00+00:00', '--job-id', '305', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmp4ml_uq_a']
[2024-07-24T12:10:09.608+0000] {standard_task_runner.py:91} INFO - Job 305: Subtask motower_dcaparc
[2024-07-24T12:10:09.669+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-24T12:10:09.769+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-26T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-26T06:00:00+00:00'
[2024-07-24T12:10:09.770+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-24T12:10:09.787+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-24T12:10:09.797+0000] {motower_daily.py:120} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-24T12:10:09.847+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-24T12:10:09.849+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-24T12:10:09.849+0000] {motower_daily.py:130} INFO - GET CA PARC FILE OF THE DAY 2024-06-25
[2024-07-24T12:10:09.849+0000] {motower_daily.py:134} INFO - READING ca-parc/2024/06/25.csv
[2024-07-24T12:10:09.868+0000] {motower_daily.py:139} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240625  6.664774e+08  1.243799e+09  16753745    9453602  11948494   841665  5929920   308836     1388920  1.970652e+09
[2024-07-24T12:10:09.868+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-24T12:10:09.869+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-24T12:10:09.869+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-24T12:10:09.870+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-24T12:10:09.870+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-24T12:10:09.871+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-24T12:10:09.871+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-24T12:10:09.871+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-24T12:10:09.872+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-24T12:10:09.872+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-24T12:10:09.872+0000] {motower_daily.py:142} INFO - MERGING BDD AND CA
[2024-07-24T12:10:09.875+0000] {motower_daily.py:144} INFO - prepare final daily data
[2024-07-24T12:10:09.877+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-24T12:10:09.879+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-24T12:10:09.880+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-24T12:10:09.881+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-24T12:10:09.881+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-24T12:10:09.882+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:155: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-24T12:10:09.882+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:156: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-24T12:10:09.882+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:157: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-24T12:10:09.883+0000] {logging_mixin.py:188} INFO - 6
[2024-07-24T12:10:09.892+0000] {motower_daily.py:193} INFO - ADD  SEGMENT
[2024-07-24T12:10:10.050+0000] {motower_daily.py:198} INFO - DATA VALIDATION AFTER MERGING
[2024-07-24T12:10:10.050+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-24T12:10:10.051+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-24T12:10:10.058+0000] {motower_daily.py:209} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-25  6.524003e+08  1.224664e+09   14947858.0  9207249.0  3796997.0  115431.0  3123077.0  198532.0    461044.0  1.919708e+09
[2024-07-24T12:10:10.058+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-24T12:10:10.059+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-24T12:10:10.059+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-24T12:10:10.060+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-24T12:10:10.060+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-24T12:10:10.061+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-24T12:10:10.061+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-24T12:10:10.062+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-24T12:10:10.062+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-24T12:10:10.062+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-24T12:10:10.088+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-25  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-25  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-25  OCI3428       3428.0  ...  PREMIUM             None              None
3 2024-06-25  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-25  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-24T12:10:10.124+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-25  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-25  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-25  OCI3428       3428.0  ...  PREMIUM             None              None
3 2024-06-25  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-25  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-24T12:10:10.909+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-24T12:10:10.910+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-24T12:10:10.931+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-26T06:00:00+00:00, execution_date=20240626T060000, start_date=20240724T121009, end_date=20240724T121010
[2024-07-24T12:10:11.015+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-24T12:10:11.053+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-24T12:10:11.067+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-24T23:21:08.577+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-24T23:21:08.866+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-07-24T23:21:08.879+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-07-24T23:21:08.879+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-24T23:21:08.894+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-26 06:00:00+00:00
[2024-07-24T23:21:08.908+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=852) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-24T23:21:08.910+0000] {standard_task_runner.py:64} INFO - Started process 868 to run task
[2024-07-24T23:21:08.910+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-26T06:00:00+00:00', '--job-id', '382', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmp_3575w4u']
[2024-07-24T23:21:08.912+0000] {standard_task_runner.py:91} INFO - Job 382: Subtask motower_dcaparc
[2024-07-24T23:21:08.966+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-24T23:21:09.097+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-26T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-26T06:00:00+00:00'
[2024-07-24T23:21:09.099+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-24T23:21:09.117+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-24T23:21:09.132+0000] {motower_daily.py:120} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-24T23:21:09.206+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-24T23:21:09.208+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-24T23:21:09.209+0000] {motower_daily.py:130} INFO - GET CA PARC FILE OF THE DAY 2024-06-25
[2024-07-24T23:21:09.209+0000] {motower_daily.py:134} INFO - READING ca-parc/2024/06/25.csv
[2024-07-24T23:21:09.239+0000] {motower_daily.py:139} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240625  6.664774e+08  1.243799e+09  16753745    9453602  11948494   841665  5929920   308836     1388920  1.970652e+09
[2024-07-24T23:21:09.239+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-24T23:21:09.241+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-24T23:21:09.241+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-24T23:21:09.242+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-24T23:21:09.242+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-24T23:21:09.243+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-24T23:21:09.244+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-24T23:21:09.244+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-24T23:21:09.245+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-24T23:21:09.246+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-24T23:21:09.247+0000] {motower_daily.py:142} INFO - MERGING BDD AND CA
[2024-07-24T23:21:09.252+0000] {motower_daily.py:144} INFO - prepare final daily data
[2024-07-24T23:21:09.254+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-24T23:21:09.257+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-24T23:21:09.259+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-24T23:21:09.261+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-24T23:21:09.263+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-24T23:21:09.264+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:155: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-24T23:21:09.265+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:156: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-24T23:21:09.267+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:157: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-24T23:21:09.268+0000] {logging_mixin.py:188} INFO - 6
[2024-07-24T23:21:09.283+0000] {motower_daily.py:193} INFO - ADD  SEGMENT
[2024-07-24T23:21:09.581+0000] {motower_daily.py:198} INFO - DATA VALIDATION AFTER MERGING
[2024-07-24T23:21:09.582+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-24T23:21:09.583+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-24T23:21:09.596+0000] {motower_daily.py:209} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-25  6.524003e+08  1.224664e+09   14947858.0  9207249.0  3796997.0  115431.0  3123077.0  198532.0    461044.0  1.919708e+09
[2024-07-24T23:21:09.597+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-24T23:21:09.598+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-24T23:21:09.600+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-24T23:21:09.601+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-24T23:21:09.602+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-24T23:21:09.603+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-24T23:21:09.604+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-24T23:21:09.605+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-24T23:21:09.605+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-24T23:21:09.607+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-24T23:21:09.648+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-25  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-25  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-25  OCI3428       3428.0  ...  PREMIUM             None              None
3 2024-06-25  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-25  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-24T23:21:09.683+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-25  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-25  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-25  OCI3428       3428.0  ...  PREMIUM             None              None
3 2024-06-25  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-25  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-24T23:21:10.335+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-24T23:21:10.336+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-24T23:21:10.345+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-26T06:00:00+00:00, execution_date=20240626T060000, start_date=20240724T232108, end_date=20240724T232110
[2024-07-24T23:21:10.373+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-24T23:21:10.390+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-24T23:21:10.391+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-24T23:25:34.088+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-24T23:25:34.340+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-07-24T23:25:34.350+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-07-24T23:25:34.350+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-24T23:25:34.434+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-26 06:00:00+00:00
[2024-07-24T23:25:34.446+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=1166) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-24T23:25:34.448+0000] {standard_task_runner.py:64} INFO - Started process 1180 to run task
[2024-07-24T23:25:34.448+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-26T06:00:00+00:00', '--job-id', '467', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpx2y9ltkm']
[2024-07-24T23:25:34.450+0000] {standard_task_runner.py:91} INFO - Job 467: Subtask motower_dcaparc
[2024-07-24T23:25:34.492+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-24T23:25:34.614+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-26T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-26T06:00:00+00:00'
[2024-07-24T23:25:34.616+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-24T23:25:34.632+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-24T23:25:34.646+0000] {motower_daily.py:120} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-24T23:25:34.716+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-24T23:25:34.719+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-24T23:25:34.719+0000] {motower_daily.py:130} INFO - GET CA PARC FILE OF THE DAY 2024-06-25
[2024-07-24T23:25:34.719+0000] {motower_daily.py:134} INFO - READING ca-parc/2024/06/25.csv
[2024-07-24T23:25:34.748+0000] {motower_daily.py:139} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240625  6.664774e+08  1.243799e+09  16753745    9453602  11948494   841665  5929920   308836     1388920  1.970652e+09
[2024-07-24T23:25:34.749+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-24T23:25:34.750+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-24T23:25:34.751+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-24T23:25:34.752+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-24T23:25:34.752+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-24T23:25:34.753+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-24T23:25:34.753+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-24T23:25:34.754+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-24T23:25:34.754+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-24T23:25:34.755+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-24T23:25:34.755+0000] {motower_daily.py:142} INFO - MERGING BDD AND CA
[2024-07-24T23:25:34.760+0000] {motower_daily.py:144} INFO - prepare final daily data
[2024-07-24T23:25:34.762+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-24T23:25:34.765+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-24T23:25:34.767+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-24T23:25:34.767+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-24T23:25:34.768+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-24T23:25:34.769+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:155: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-24T23:25:34.770+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:156: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-24T23:25:34.770+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:157: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-24T23:25:34.770+0000] {logging_mixin.py:188} INFO - 6
[2024-07-24T23:25:34.784+0000] {motower_daily.py:193} INFO - ADD  SEGMENT
[2024-07-24T23:25:35.040+0000] {motower_daily.py:198} INFO - DATA VALIDATION AFTER MERGING
[2024-07-24T23:25:35.040+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-24T23:25:35.041+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-24T23:25:35.051+0000] {motower_daily.py:209} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-25  6.524003e+08  1.224664e+09   14947858.0  9207249.0  3796997.0  115431.0  3123077.0  198532.0    461044.0  1.919708e+09
[2024-07-24T23:25:35.051+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-24T23:25:35.052+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-24T23:25:35.052+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-24T23:25:35.053+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-24T23:25:35.053+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-24T23:25:35.054+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-24T23:25:35.054+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-24T23:25:35.055+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-24T23:25:35.055+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-24T23:25:35.056+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-24T23:25:35.089+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-25  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-25  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-25  OCI3428       3428.0  ...  PREMIUM             None              None
3 2024-06-25  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-25  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-24T23:25:35.121+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-25  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-25  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-25  OCI3428       3428.0  ...  PREMIUM             None              None
3 2024-06-25  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-25  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-24T23:25:35.717+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-24T23:25:35.719+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-24T23:25:35.729+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-26T06:00:00+00:00, execution_date=20240626T060000, start_date=20240724T232534, end_date=20240724T232535
[2024-07-24T23:25:36.050+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-24T23:25:36.076+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-24T23:25:36.077+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-25T08:33:42.534+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-25T08:33:42.561+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-07-25T08:33:42.570+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-07-25T08:33:42.571+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-25T08:33:42.584+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-26 06:00:00+00:00
[2024-07-25T08:33:42.595+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=2613) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-25T08:33:42.596+0000] {standard_task_runner.py:64} INFO - Started process 2621 to run task
[2024-07-25T08:33:42.596+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-26T06:00:00+00:00', '--job-id', '903', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmph9e0di1o']
[2024-07-25T08:33:42.598+0000] {standard_task_runner.py:91} INFO - Job 903: Subtask motower_dcaparc
[2024-07-25T08:33:42.639+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-25T08:33:42.729+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-26T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-26T06:00:00+00:00'
[2024-07-25T08:33:42.730+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-25T08:33:42.744+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-25T08:33:42.753+0000] {motower_daily.py:120} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-25T08:33:42.797+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-25T08:33:42.798+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-25T08:33:42.798+0000] {motower_daily.py:130} INFO - GET CA PARC FILE OF THE DAY 2024-06-25
[2024-07-25T08:33:42.798+0000] {motower_daily.py:134} INFO - READING ca-parc/2024/06/25.csv
[2024-07-25T08:33:42.816+0000] {motower_daily.py:139} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240625  6.664774e+08  1.243799e+09  16753745    9453602  11948494   841665  5929920   308836     1388920  1.970652e+09
[2024-07-25T08:33:42.817+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-25T08:33:42.818+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-25T08:33:42.818+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-25T08:33:42.818+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-25T08:33:42.819+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-25T08:33:42.819+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-25T08:33:42.819+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-25T08:33:42.820+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-25T08:33:42.820+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-25T08:33:42.821+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-25T08:33:42.821+0000] {motower_daily.py:142} INFO - MERGING BDD AND CA
[2024-07-25T08:33:42.824+0000] {motower_daily.py:144} INFO - prepare final daily data
[2024-07-25T08:33:42.826+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-25T08:33:42.828+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-25T08:33:42.829+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-25T08:33:42.829+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-25T08:33:42.829+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-25T08:33:42.830+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:155: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-25T08:33:42.830+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:156: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-25T08:33:42.831+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:157: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-25T08:33:42.831+0000] {logging_mixin.py:188} INFO - 6
[2024-07-25T08:33:42.842+0000] {motower_daily.py:193} INFO - ADD  SEGMENT
[2024-07-25T08:33:42.996+0000] {motower_daily.py:198} INFO - DATA VALIDATION AFTER MERGING
[2024-07-25T08:33:42.996+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-25T08:33:42.997+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-25T08:33:43.004+0000] {motower_daily.py:209} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-25  6.524003e+08  1.224664e+09   14947858.0  9207249.0  3796997.0  115431.0  3123077.0  198532.0    461044.0  1.919708e+09
[2024-07-25T08:33:43.004+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-25T08:33:43.004+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-25T08:33:43.005+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-25T08:33:43.005+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-25T08:33:43.006+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-25T08:33:43.006+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-25T08:33:43.006+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-25T08:33:43.007+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-25T08:33:43.007+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-25T08:33:43.008+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-25T08:33:43.034+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-25  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-25  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-25  OCI3428       3428.0  ...  PREMIUM             None              None
3 2024-06-25  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-25  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-25T08:33:43.060+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-25  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-25  OCI3257       3257.0  ...   NORMAL             None              None
2 2024-06-25  OCI3428       3428.0  ...  PREMIUM             None              None
3 2024-06-25  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-25  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-25T08:33:43.457+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-25T08:33:43.458+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-25T08:33:43.466+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-26T06:00:00+00:00, execution_date=20240626T060000, start_date=20240725T083342, end_date=20240725T083343
[2024-07-25T08:33:43.491+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-25T08:33:43.506+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-25T08:33:43.507+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-25T10:39:06.551+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-25T10:39:06.759+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-07-25T10:39:06.766+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-07-25T10:39:06.767+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-25T10:39:06.777+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-26 06:00:00+00:00
[2024-07-25T10:39:06.788+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=5841) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-25T10:39:06.789+0000] {standard_task_runner.py:64} INFO - Started process 5845 to run task
[2024-07-25T10:39:06.790+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-26T06:00:00+00:00', '--job-id', '1436', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmphfsjt6it']
[2024-07-25T10:39:06.791+0000] {standard_task_runner.py:91} INFO - Job 1436: Subtask motower_dcaparc
[2024-07-25T10:39:06.830+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-25T10:39:06.909+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-26T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-26T06:00:00+00:00'
[2024-07-25T10:39:06.910+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-25T10:39:06.923+0000] {motower_daily.py:109} INFO - get last modified bdd sites cleaned
[2024-07-25T10:39:06.932+0000] {motower_daily.py:120} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-25T10:39:06.972+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-25T10:39:06.974+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-25T10:39:06.974+0000] {motower_daily.py:130} INFO - GET CA PARC FILE OF THE DAY 2024-06-25
[2024-07-25T10:39:06.974+0000] {motower_daily.py:134} INFO - READING ca-parc/2024/06/25.csv
[2024-07-25T10:39:06.991+0000] {motower_daily.py:139} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240625  6.664774e+08  1.243799e+09  16753745    9453602  11948494   841665  5929920   308836     1388920  1.970652e+09
[2024-07-25T10:39:06.991+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-25T10:39:06.992+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-25T10:39:06.992+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-25T10:39:06.993+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-25T10:39:06.993+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-25T10:39:06.993+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-25T10:39:06.993+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-25T10:39:06.994+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-25T10:39:06.994+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-25T10:39:06.995+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-25T10:39:06.995+0000] {motower_daily.py:142} INFO - MERGING BDD AND CA
[2024-07-25T10:39:06.997+0000] {motower_daily.py:144} INFO - prepare final daily data
[2024-07-25T10:39:06.998+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-25T10:39:07.000+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-25T10:39:07.000+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-25T10:39:07.001+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-25T10:39:07.001+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-25T10:39:07.001+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:155: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-25T10:39:07.002+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:156: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-25T10:39:07.002+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:157: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-25T10:39:07.002+0000] {logging_mixin.py:188} INFO - 6
[2024-07-25T10:39:07.006+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:164: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  daily_month_df = pd.read_sql_query(sql_query, CONN, params=(mois, date))

[2024-07-25T10:39:07.841+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:165: FutureWarning: The behavior of DataFrame concatenation with empty or all-NA entries is deprecated. In a future version, this will no longer exclude empty or all-NA columns when determining the result dtypes. To retain the old behavior, exclude the relevant entries before the concat operation.
  month_data = pd.concat([daily_month_df, df_final])

[2024-07-25T10:39:07.942+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:169: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  last_month = pd.read_sql_query(sql_query, CONN, params=(lmonth.month,exec_date.day))

[2024-07-25T10:39:08.011+0000] {motower_daily.py:174} INFO - ADD  SEGMENT
[2024-07-25T10:39:13.000+0000] {motower_daily.py:198} INFO - DATA VALIDATION AFTER MERGING
[2024-07-25T10:39:13.001+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-25T10:39:13.001+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-25T10:39:13.009+0000] {motower_daily.py:209} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-25  6.524003e+08  1.224664e+09   14947858.0  9207249.0  3796997.0  115431.0  3123077.0  198532.0    461044.0  1.919708e+09
[2024-07-25T10:39:13.009+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-25T10:39:13.010+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-25T10:39:13.010+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-25T10:39:13.010+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-25T10:39:13.010+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-25T10:39:13.011+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-25T10:39:13.011+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-25T10:39:13.012+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-25T10:39:13.012+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-25T10:39:13.012+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-25T10:39:13.036+0000] {logging_mixin.py:188} INFO -    id       jour code_oci  ...  segment previous_segment evolution_segment
0 NaN 2024-06-25  OCI2831  ...  PREMIUM             None              None
1 NaN 2024-06-25  OCI3257  ...  PREMIUM             None              None
2 NaN 2024-06-25  OCI3428  ...  PREMIUM             None              None
3 NaN 2024-06-25  OCI2587  ...  PREMIUM             None              None
4 NaN 2024-06-25  OCI3260  ...     None             None              None

[5 rows x 39 columns]
[2024-07-25T10:39:13.060+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-25  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-25  OCI3257       3257.0  ...  PREMIUM             None              None
2 2024-06-25  OCI3428       3428.0  ...  PREMIUM             None              None
3 2024-06-25  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-25  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-25T10:39:13.536+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-25T10:39:13.537+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-25T10:39:13.546+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-26T06:00:00+00:00, execution_date=20240626T060000, start_date=20240725T103906, end_date=20240725T103913
[2024-07-25T10:39:13.776+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-25T10:39:13.790+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-25T10:39:13.791+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-25T13:27:18.016+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-25T13:27:18.040+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-07-25T13:27:18.046+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-07-25T13:27:18.046+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-25T13:27:18.055+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-26 06:00:00+00:00
[2024-07-25T13:27:18.068+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=12694) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-25T13:27:18.069+0000] {standard_task_runner.py:64} INFO - Started process 12696 to run task
[2024-07-25T13:27:18.069+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-26T06:00:00+00:00', '--job-id', '2998', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmp88uheg41']
[2024-07-25T13:27:18.072+0000] {standard_task_runner.py:91} INFO - Job 2998: Subtask motower_dcaparc
[2024-07-25T13:27:18.111+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-25T13:27:18.186+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-26T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-26T06:00:00+00:00'
[2024-07-25T13:27:18.187+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-25T13:27:18.199+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-25T13:27:18.208+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-25T13:27:18.247+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-25T13:27:18.248+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-25T13:27:18.248+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-25
[2024-07-25T13:27:18.248+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/25.csv
[2024-07-25T13:27:18.266+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240625  6.664774e+08  1.243799e+09  16753745    9453602  11948494   841665  5929920   308836     1388920  1.970652e+09
[2024-07-25T13:27:18.266+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-25T13:27:18.267+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-25T13:27:18.267+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-25T13:27:18.268+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-25T13:27:18.268+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-25T13:27:18.268+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-25T13:27:18.269+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-25T13:27:18.269+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-25T13:27:18.269+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-25T13:27:18.270+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-25T13:27:18.270+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-25T13:27:18.273+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-25T13:27:18.274+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-25T13:27:18.276+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-25T13:27:18.276+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-25T13:27:18.277+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-25T13:27:18.277+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-25T13:27:18.277+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-25T13:27:18.278+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-25T13:27:18.278+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-25T13:27:18.278+0000] {logging_mixin.py:188} INFO - 6
[2024-07-25T13:27:18.278+0000] {logging_mixin.py:188} INFO - 2024-06-25 00:00:00
[2024-07-25T13:27:18.279+0000] {logging_mixin.py:188} INFO - Start date<exec_date
[2024-07-25T13:27:18.282+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:164: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  daily_month_df = pd.read_sql_query(sql_query, CONN, params=(mois, date))

[2024-07-25T13:27:19.159+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:165: FutureWarning: The behavior of DataFrame concatenation with empty or all-NA entries is deprecated. In a future version, this will no longer exclude empty or all-NA columns when determining the result dtypes. To retain the old behavior, exclude the relevant entries before the concat operation.
  month_data = pd.concat([daily_month_df, df_final])

[2024-07-25T13:27:19.169+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:169: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  last_month = pd.read_sql_query(sql_query, CONN, params=(lmonth.month,exec_date.day))

[2024-07-25T13:27:19.220+0000] {logging_mixin.py:188} INFO - (3107, 39)
[2024-07-25T13:27:19.265+0000] {motower_daily.py:175} INFO - ADD  SEGMENT
[2024-07-25T13:27:23.838+0000] {logging_mixin.py:188} INFO - 3074    A DEVELOPER
Name: segment, dtype: object
[2024-07-25T13:27:23.839+0000] {logging_mixin.py:188} INFO - 2869    A DEVELOPER
Name: segment, dtype: object
[2024-07-25T13:27:23.839+0000] {logging_mixin.py:188} INFO - hello
[2024-07-25T13:27:23.839+0000] {motower_daily.py:184} INFO - ADD PREVIOUS SEGMENT
[2024-07-25T13:27:23.849+0000] {logging_mixin.py:188} INFO - ########################################################################
[2024-07-25T13:27:23.872+0000] {logging_mixin.py:188} INFO -       id       jour code_oci  ...  previous_segment evolution_segment    segment_y
3074 NaN 2024-06-25  OCI3190  ...       A DEVELOPER               NaN  A DEVELOPER

[1 rows x 40 columns]
[2024-07-25T13:27:23.873+0000] {motower_daily.py:191} INFO - ADD EVOLUTION SEGMENT
[2024-07-25T13:27:24.011+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-25T13:27:24.012+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-25T13:27:24.013+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-25T13:27:24.021+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-25  6.524003e+08  1.224664e+09   14947858.0  9207249.0  3796997.0  115431.0  3123077.0  198532.0    461044.0  1.919708e+09
[2024-07-25T13:27:24.021+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-25T13:27:24.022+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-25T13:27:24.022+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-25T13:27:24.023+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-25T13:27:24.023+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-25T13:27:24.024+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-25T13:27:24.024+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-25T13:27:24.025+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-25T13:27:24.025+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-25T13:27:24.026+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-25T13:27:24.054+0000] {logging_mixin.py:188} INFO -    id       jour code_oci  ...  previous_segment evolution_segment segment_y
0 NaN 2024-06-25  OCI2831  ...           PREMIUM               0.0   PREMIUM
1 NaN 2024-06-25  OCI3257  ...           PREMIUM               0.0   PREMIUM
2 NaN 2024-06-25  OCI3428  ...           PREMIUM               0.0   PREMIUM
3 NaN 2024-06-25  OCI2587  ...           PREMIUM               0.0   PREMIUM
4 NaN 2024-06-25  OCI3260  ...              None               NaN      None

[5 rows x 40 columns]
[2024-07-25T13:27:24.087+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-25  OCI2831       2831.0  ...  PREMIUM          PREMIUM               0.0
1 2024-06-25  OCI3257       3257.0  ...  PREMIUM          PREMIUM               0.0
2 2024-06-25  OCI3428       3428.0  ...  PREMIUM          PREMIUM               0.0
3 2024-06-25  OCI2587       2587.0  ...  PREMIUM          PREMIUM               0.0
4 2024-06-25  OCI3260       3260.0  ...     None             None               NaN

[5 rows x 38 columns]
[2024-07-25T13:27:24.811+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-25T13:27:24.812+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-25T13:27:24.823+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-26T06:00:00+00:00, execution_date=20240626T060000, start_date=20240725T132718, end_date=20240725T132724
[2024-07-25T13:27:24.901+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-25T13:27:24.917+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-25T13:27:24.918+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-25T15:08:37.257+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-25T15:08:37.282+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-07-25T15:08:37.291+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-07-25T15:08:37.291+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-25T15:08:37.301+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-26 06:00:00+00:00
[2024-07-25T15:08:37.310+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=14902) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-25T15:08:37.312+0000] {standard_task_runner.py:64} INFO - Started process 14907 to run task
[2024-07-25T15:08:37.312+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-26T06:00:00+00:00', '--job-id', '3292', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpb6zn1liz']
[2024-07-25T15:08:37.314+0000] {standard_task_runner.py:91} INFO - Job 3292: Subtask motower_dcaparc
[2024-07-25T15:08:37.355+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-25T15:08:37.432+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-26T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-26T06:00:00+00:00'
[2024-07-25T15:08:37.434+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-25T15:08:37.446+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-25T15:08:37.455+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-25T15:08:37.496+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-25T15:08:37.498+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-25T15:08:37.499+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-25
[2024-07-25T15:08:37.499+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/25.csv
[2024-07-25T15:08:37.518+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240625  6.664774e+08  1.243799e+09  16753745    9453602  11948494   841665  5929920   308836     1388920  1.970652e+09
[2024-07-25T15:08:37.518+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-25T15:08:37.519+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-25T15:08:37.519+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-25T15:08:37.520+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-25T15:08:37.520+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-25T15:08:37.521+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-25T15:08:37.521+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-25T15:08:37.521+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-25T15:08:37.521+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-25T15:08:37.522+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-25T15:08:37.522+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-25T15:08:37.525+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-25T15:08:37.526+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-25T15:08:37.527+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-25T15:08:37.528+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-25T15:08:37.528+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-25T15:08:37.529+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-25T15:08:37.529+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-25T15:08:37.529+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-25T15:08:37.530+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-25T15:08:37.530+0000] {logging_mixin.py:188} INFO - 6
[2024-07-25T15:08:37.530+0000] {logging_mixin.py:188} INFO - 2024-06-25 00:00:00
[2024-07-25T15:08:37.531+0000] {logging_mixin.py:188} INFO - Start date<exec_date
[2024-07-25T15:08:37.534+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:164: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  daily_month_df = pd.read_sql_query(sql_query, CONN, params=(mois, date))

[2024-07-25T15:08:38.402+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:165: FutureWarning: The behavior of DataFrame concatenation with empty or all-NA entries is deprecated. In a future version, this will no longer exclude empty or all-NA columns when determining the result dtypes. To retain the old behavior, exclude the relevant entries before the concat operation.
  month_data = pd.concat([daily_month_df, df_final])

[2024-07-25T15:08:38.412+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:169: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  last_month = pd.read_sql_query(sql_query, CONN, params=(lmonth.month,exec_date.day))

[2024-07-25T15:08:38.465+0000] {logging_mixin.py:188} INFO - (3107, 39)
[2024-07-25T15:08:38.509+0000] {motower_daily.py:175} INFO - ADD  SEGMENT
[2024-07-25T15:08:42.961+0000] {logging_mixin.py:188} INFO - 3074    A DEVELOPER
Name: segment, dtype: object
[2024-07-25T15:08:42.963+0000] {logging_mixin.py:188} INFO - 2850    A DEVELOPER
Name: segment, dtype: object
[2024-07-25T15:08:42.963+0000] {logging_mixin.py:188} INFO - hello
[2024-07-25T15:08:42.963+0000] {motower_daily.py:184} INFO - ADD PREVIOUS SEGMENT
[2024-07-25T15:08:42.972+0000] {logging_mixin.py:188} INFO - ########################################################################
[2024-07-25T15:08:42.994+0000] {logging_mixin.py:188} INFO -       id       jour code_oci  ...  previous_segment evolution_segment    segment_y
3074 NaN 2024-06-25  OCI3190  ...       A DEVELOPER               NaN  A DEVELOPER

[1 rows x 40 columns]
[2024-07-25T15:08:42.995+0000] {motower_daily.py:191} INFO - ADD EVOLUTION SEGMENT
[2024-07-25T15:08:43.110+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-25T15:08:43.111+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-25T15:08:43.112+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-25T15:08:43.119+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-25  6.524003e+08  1.224664e+09   14947858.0  9207249.0  3796997.0  115431.0  3123077.0  198532.0    461044.0  1.919708e+09
[2024-07-25T15:08:43.119+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-25T15:08:43.120+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-25T15:08:43.120+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-25T15:08:43.120+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-25T15:08:43.121+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-25T15:08:43.121+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-25T15:08:43.121+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-25T15:08:43.122+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-25T15:08:43.122+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-25T15:08:43.123+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-25T15:08:43.147+0000] {logging_mixin.py:188} INFO -    id       jour code_oci  ...  previous_segment evolution_segment segment_y
0 NaN 2024-06-25  OCI2831  ...           PREMIUM               0.0   PREMIUM
1 NaN 2024-06-25  OCI3257  ...           PREMIUM               0.0   PREMIUM
2 NaN 2024-06-25  OCI3428  ...           PREMIUM               0.0   PREMIUM
3 NaN 2024-06-25  OCI2587  ...           PREMIUM               0.0   PREMIUM
4 NaN 2024-06-25  OCI3260  ...              None               NaN      None

[5 rows x 40 columns]
[2024-07-25T15:08:43.176+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-25  OCI2831       2831.0  ...  PREMIUM          PREMIUM               0.0
1 2024-06-25  OCI3257       3257.0  ...  PREMIUM          PREMIUM               0.0
2 2024-06-25  OCI3428       3428.0  ...  PREMIUM          PREMIUM               0.0
3 2024-06-25  OCI2587       2587.0  ...  PREMIUM          PREMIUM               0.0
4 2024-06-25  OCI3260       3260.0  ...     None             None               NaN

[5 rows x 38 columns]
[2024-07-25T15:08:43.670+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-25T15:08:43.671+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-25T15:08:43.680+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-26T06:00:00+00:00, execution_date=20240626T060000, start_date=20240725T150837, end_date=20240725T150843
[2024-07-25T15:08:43.741+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-25T15:08:43.755+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-25T15:08:43.756+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-26T11:45:07.766+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-26T11:45:07.790+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-07-26T11:45:07.797+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-07-26T11:45:07.797+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-26T11:45:07.808+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-26 06:00:00+00:00
[2024-07-26T11:45:07.817+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=2970) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-26T11:45:07.818+0000] {standard_task_runner.py:64} INFO - Started process 2972 to run task
[2024-07-26T11:45:07.818+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-26T06:00:00+00:00', '--job-id', '3935', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpkuizatww']
[2024-07-26T11:45:07.820+0000] {standard_task_runner.py:91} INFO - Job 3935: Subtask motower_dcaparc
[2024-07-26T11:45:07.857+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [running]> on host b3845fb494d4
[2024-07-26T11:45:07.938+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-26T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-26T06:00:00+00:00'
[2024-07-26T11:45:07.938+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-26T11:45:07.951+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-26T11:45:07.960+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-26T11:45:08.000+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T11:45:08.001+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T11:45:08.002+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-25
[2024-07-26T11:45:08.002+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/25.csv
[2024-07-26T11:45:08.020+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240625  6.664774e+08  1.243799e+09  16753745    9453602  11948494   841665  5929920   308836     1388920  1.970652e+09
[2024-07-26T11:45:08.021+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T11:45:08.022+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T11:45:08.023+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T11:45:08.024+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T11:45:08.024+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T11:45:08.025+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T11:45:08.025+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-26T11:45:08.026+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-26T11:45:08.026+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T11:45:08.026+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T11:45:08.027+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-26T11:45:08.029+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-26T11:45:08.030+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-26T11:45:08.032+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-26T11:45:08.033+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-26T11:45:08.033+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-26T11:45:08.033+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-26T11:45:08.034+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-26T11:45:08.034+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-26T11:45:08.035+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-26T11:45:08.035+0000] {logging_mixin.py:188} INFO - 6
[2024-07-26T11:45:08.035+0000] {logging_mixin.py:188} INFO - 2024-06-25 00:00:00
[2024-07-26T11:45:08.035+0000] {logging_mixin.py:188} INFO - Start date<exec_date
[2024-07-26T11:45:08.039+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:164: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  daily_month_df = pd.read_sql_query(sql_query, CONN, params=(mois, date))

[2024-07-26T11:45:08.927+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:165: FutureWarning: The behavior of DataFrame concatenation with empty or all-NA entries is deprecated. In a future version, this will no longer exclude empty or all-NA columns when determining the result dtypes. To retain the old behavior, exclude the relevant entries before the concat operation.
  month_data = pd.concat([daily_month_df, df_final])

[2024-07-26T11:45:09.017+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:169: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  last_month = pd.read_sql_query(sql_query, CONN, params=(lmonth.month,exec_date.day))

[2024-07-26T11:45:09.034+0000] {logging_mixin.py:188} INFO - (0, 39)
[2024-07-26T11:45:09.087+0000] {motower_daily.py:175} INFO - ADD  SEGMENT
[2024-07-26T11:45:14.118+0000] {logging_mixin.py:188} INFO - 3074    A DEVELOPER
Name: segment, dtype: object
[2024-07-26T11:45:14.119+0000] {logging_mixin.py:188} INFO - Series([], Name: segment, dtype: object)
[2024-07-26T11:45:14.119+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-26T11:45:14.119+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T11:45:14.120+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T11:45:14.127+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-25  6.524003e+08  1.224664e+09   14947858.0  9207249.0  3796997.0  115431.0  3123077.0  198532.0    461044.0  1.919708e+09
[2024-07-26T11:45:14.127+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T11:45:14.128+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T11:45:14.128+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T11:45:14.129+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T11:45:14.129+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T11:45:14.129+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T11:45:14.130+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-26T11:45:14.130+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-26T11:45:14.130+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T11:45:14.131+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T11:45:14.154+0000] {logging_mixin.py:188} INFO -    id       jour code_oci  ...  segment previous_segment evolution_segment
0 NaN 2024-06-25  OCI2831  ...  PREMIUM             None              None
1 NaN 2024-06-25  OCI3257  ...  PREMIUM             None              None
2 NaN 2024-06-25  OCI3428  ...  PREMIUM             None              None
3 NaN 2024-06-25  OCI2587  ...  PREMIUM             None              None
4 NaN 2024-06-25  OCI3260  ...     None             None              None

[5 rows x 39 columns]
[2024-07-26T11:45:14.182+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-25  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-25  OCI3257       3257.0  ...  PREMIUM             None              None
2 2024-06-25  OCI3428       3428.0  ...  PREMIUM             None              None
3 2024-06-25  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-25  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T11:45:14.933+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-26T11:45:14.933+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-26T11:45:14.943+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-26T06:00:00+00:00, execution_date=20240626T060000, start_date=20240726T114507, end_date=20240726T114514
[2024-07-26T11:45:15.011+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-26T11:45:15.027+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-26T11:45:15.030+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-26T12:26:05.375+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-26T12:26:05.399+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-07-26T12:26:05.407+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-07-26T12:26:05.407+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-26T12:26:05.418+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-26 06:00:00+00:00
[2024-07-26T12:26:05.427+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=2146) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-26T12:26:05.428+0000] {standard_task_runner.py:64} INFO - Started process 2148 to run task
[2024-07-26T12:26:05.429+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-26T06:00:00+00:00', '--job-id', '654', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpultptf6v']
[2024-07-26T12:26:05.431+0000] {standard_task_runner.py:91} INFO - Job 654: Subtask motower_dcaparc
[2024-07-26T12:26:05.468+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [running]> on host 88c2b04746a4
[2024-07-26T12:26:05.548+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-26T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-26T06:00:00+00:00'
[2024-07-26T12:26:05.549+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-26T12:26:05.561+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-26T12:26:05.572+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-26T12:26:05.609+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T12:26:05.610+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T12:26:05.610+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-25
[2024-07-26T12:26:05.610+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/25.csv
[2024-07-26T12:26:05.627+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240625  6.664774e+08  1.243799e+09  16753745    9453602  11948494   841665  5929920   308836     1388920  1.970652e+09
[2024-07-26T12:26:05.628+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T12:26:05.629+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T12:26:05.629+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T12:26:05.629+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T12:26:05.630+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T12:26:05.630+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T12:26:05.630+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-26T12:26:05.631+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-26T12:26:05.631+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T12:26:05.631+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T12:26:05.632+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-26T12:26:05.634+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-26T12:26:05.635+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-26T12:26:05.636+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-26T12:26:05.637+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-26T12:26:05.638+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-26T12:26:05.638+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-26T12:26:05.638+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-26T12:26:05.639+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-26T12:26:05.639+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-26T12:26:05.639+0000] {logging_mixin.py:188} INFO - 6
[2024-07-26T12:26:05.639+0000] {logging_mixin.py:188} INFO - 2024-06-25 00:00:00
[2024-07-26T12:26:05.640+0000] {logging_mixin.py:188} INFO - Start date<exec_date
[2024-07-26T12:26:05.643+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:164: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  daily_month_df = pd.read_sql_query(sql_query, CONN, params=(mois, date))

[2024-07-26T12:26:06.481+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:165: FutureWarning: The behavior of DataFrame concatenation with empty or all-NA entries is deprecated. In a future version, this will no longer exclude empty or all-NA columns when determining the result dtypes. To retain the old behavior, exclude the relevant entries before the concat operation.
  month_data = pd.concat([daily_month_df, df_final])

[2024-07-26T12:26:06.568+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:169: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  last_month = pd.read_sql_query(sql_query, CONN, params=(lmonth.month,exec_date.day))

[2024-07-26T12:26:06.585+0000] {logging_mixin.py:188} INFO - (0, 39)
[2024-07-26T12:26:06.629+0000] {motower_daily.py:175} INFO - ADD  SEGMENT
[2024-07-26T12:26:11.383+0000] {logging_mixin.py:188} INFO - 3074    A DEVELOPER
Name: segment, dtype: object
[2024-07-26T12:26:11.383+0000] {logging_mixin.py:188} INFO - Series([], Name: segment, dtype: object)
[2024-07-26T12:26:11.384+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-26T12:26:11.384+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T12:26:11.384+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T12:26:11.392+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-25  6.524003e+08  1.224664e+09   14947858.0  9207249.0  3796997.0  115431.0  3123077.0  198532.0    461044.0  1.919708e+09
[2024-07-26T12:26:11.392+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T12:26:11.393+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T12:26:11.393+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T12:26:11.393+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T12:26:11.394+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T12:26:11.394+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T12:26:11.394+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-26T12:26:11.395+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-26T12:26:11.395+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T12:26:11.396+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T12:26:11.420+0000] {logging_mixin.py:188} INFO -    id       jour code_oci  ...  segment previous_segment evolution_segment
0 NaN 2024-06-25  OCI2831  ...  PREMIUM             None              None
1 NaN 2024-06-25  OCI3257  ...  PREMIUM             None              None
2 NaN 2024-06-25  OCI3428  ...  PREMIUM             None              None
3 NaN 2024-06-25  OCI2587  ...  PREMIUM             None              None
4 NaN 2024-06-25  OCI3260  ...     None             None              None

[5 rows x 39 columns]
[2024-07-26T12:26:11.445+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-25  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-25  OCI3257       3257.0  ...  PREMIUM             None              None
2 2024-06-25  OCI3428       3428.0  ...  PREMIUM             None              None
3 2024-06-25  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-25  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T12:26:11.578+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:133: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['mois'] = data["jour"].dt.month

[2024-07-26T12:26:11.579+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:134: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['annee'] = data["jour"].dt.year

[2024-07-26T12:26:12.524+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-26T12:26:12.525+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-26T12:26:12.535+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-26T06:00:00+00:00, execution_date=20240626T060000, start_date=20240726T122605, end_date=20240726T122612
[2024-07-26T12:26:12.658+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-26T12:26:12.672+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-26T12:26:12.673+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-26T12:31:51.187+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-26T12:31:51.397+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-07-26T12:31:51.405+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-07-26T12:31:51.405+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-26T12:31:51.417+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-26 06:00:00+00:00
[2024-07-26T12:31:51.426+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=3131) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-26T12:31:51.427+0000] {standard_task_runner.py:64} INFO - Started process 3133 to run task
[2024-07-26T12:31:51.427+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-26T06:00:00+00:00', '--job-id', '957', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmp_9xk8lie']
[2024-07-26T12:31:51.429+0000] {standard_task_runner.py:91} INFO - Job 957: Subtask motower_dcaparc
[2024-07-26T12:31:51.468+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [running]> on host 88c2b04746a4
[2024-07-26T12:31:51.546+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-26T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-26T06:00:00+00:00'
[2024-07-26T12:31:51.547+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-26T12:31:51.559+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-26T12:31:51.568+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-26T12:31:51.610+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T12:31:51.612+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T12:31:51.612+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-25
[2024-07-26T12:31:51.612+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/25.csv
[2024-07-26T12:31:51.634+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240625  6.664774e+08  1.243799e+09  16753745    9453602  11948494   841665  5929920   308836     1388920  1.970652e+09
[2024-07-26T12:31:51.635+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T12:31:51.636+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T12:31:51.636+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T12:31:51.636+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T12:31:51.636+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T12:31:51.637+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T12:31:51.637+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-26T12:31:51.638+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-26T12:31:51.638+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T12:31:51.638+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T12:31:51.639+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-26T12:31:51.642+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-26T12:31:51.643+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-26T12:31:51.645+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-26T12:31:51.646+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-26T12:31:51.646+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-26T12:31:51.647+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-26T12:31:51.647+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-26T12:31:51.647+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-26T12:31:51.648+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-26T12:31:51.648+0000] {logging_mixin.py:188} INFO - 6
[2024-07-26T12:31:51.648+0000] {logging_mixin.py:188} INFO - 2024-06-25 00:00:00
[2024-07-26T12:31:51.648+0000] {logging_mixin.py:188} INFO - Start date<exec_date
[2024-07-26T12:31:51.652+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:164: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  daily_month_df = pd.read_sql_query(sql_query, CONN, params=(mois, date))

[2024-07-26T12:31:52.545+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:165: FutureWarning: The behavior of DataFrame concatenation with empty or all-NA entries is deprecated. In a future version, this will no longer exclude empty or all-NA columns when determining the result dtypes. To retain the old behavior, exclude the relevant entries before the concat operation.
  month_data = pd.concat([daily_month_df, df_final])

[2024-07-26T12:31:52.634+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:169: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  last_month = pd.read_sql_query(sql_query, CONN, params=(lmonth.month,exec_date.day))

[2024-07-26T12:31:52.650+0000] {logging_mixin.py:188} INFO - (0, 39)
[2024-07-26T12:31:52.692+0000] {motower_daily.py:175} INFO - ADD  SEGMENT
[2024-07-26T12:31:57.706+0000] {logging_mixin.py:188} INFO - 3074    A DEVELOPER
Name: segment, dtype: object
[2024-07-26T12:31:57.707+0000] {logging_mixin.py:188} INFO - Series([], Name: segment, dtype: object)
[2024-07-26T12:31:57.707+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-26T12:31:57.707+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-26T12:31:57.708+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-26T12:31:57.716+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-25  6.524003e+08  1.224664e+09   14947858.0  9207249.0  3796997.0  115431.0  3123077.0  198532.0    461044.0  1.919708e+09
[2024-07-26T12:31:57.716+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-26T12:31:57.717+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-26T12:31:57.717+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-26T12:31:57.717+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-26T12:31:57.718+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-26T12:31:57.718+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-26T12:31:57.718+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-26T12:31:57.719+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-26T12:31:57.719+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-26T12:31:57.720+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-26T12:31:57.745+0000] {logging_mixin.py:188} INFO -    id       jour code_oci  ...  segment previous_segment evolution_segment
0 NaN 2024-06-25  OCI2831  ...  PREMIUM             None              None
1 NaN 2024-06-25  OCI3257  ...  PREMIUM             None              None
2 NaN 2024-06-25  OCI3428  ...  PREMIUM             None              None
3 NaN 2024-06-25  OCI2587  ...  PREMIUM             None              None
4 NaN 2024-06-25  OCI3260  ...     None             None              None

[5 rows x 39 columns]
[2024-07-26T12:31:57.771+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-25  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-25  OCI3257       3257.0  ...  PREMIUM             None              None
2 2024-06-25  OCI3428       3428.0  ...  PREMIUM             None              None
3 2024-06-25  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-25  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-26T12:31:57.897+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:133: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['mois'] = data["jour"].dt.month

[2024-07-26T12:31:57.897+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:134: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['annee'] = data["jour"].dt.year

[2024-07-26T12:31:58.749+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-26T12:31:58.750+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-26T12:31:58.759+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-26T06:00:00+00:00, execution_date=20240626T060000, start_date=20240726T123151, end_date=20240726T123158
[2024-07-26T12:31:58.825+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-26T12:31:58.838+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-26T12:31:58.840+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-29T12:01:16.186+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-29T12:01:16.210+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-07-29T12:01:16.218+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-07-29T12:01:16.219+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-29T12:01:16.228+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-26 06:00:00+00:00
[2024-07-29T12:01:16.236+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=3581) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-29T12:01:16.237+0000] {standard_task_runner.py:64} INFO - Started process 3583 to run task
[2024-07-29T12:01:16.238+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-26T06:00:00+00:00', '--job-id', '990', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpqulwc5a2']
[2024-07-29T12:01:16.240+0000] {standard_task_runner.py:91} INFO - Job 990: Subtask motower_dcaparc
[2024-07-29T12:01:16.277+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [running]> on host e824106b656d
[2024-07-29T12:01:16.356+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-26T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-26T06:00:00+00:00'
[2024-07-29T12:01:16.357+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-29T12:01:16.371+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-29T12:01:16.380+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-29T12:01:16.418+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-29T12:01:16.419+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-29T12:01:16.419+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-25
[2024-07-29T12:01:16.419+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/25.csv
[2024-07-29T12:01:16.436+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240625  6.664774e+08  1.243799e+09  16753745    9453602  11948494   841665  5929920   308836     1388920  1.970652e+09
[2024-07-29T12:01:16.436+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-29T12:01:16.437+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-29T12:01:16.438+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-29T12:01:16.438+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-29T12:01:16.438+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-29T12:01:16.439+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-29T12:01:16.439+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-29T12:01:16.439+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-29T12:01:16.440+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-29T12:01:16.440+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-29T12:01:16.440+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-29T12:01:16.443+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-29T12:01:16.444+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-29T12:01:16.445+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-29T12:01:16.446+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-29T12:01:16.446+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-29T12:01:16.447+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-29T12:01:16.447+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-29T12:01:16.447+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-29T12:01:16.448+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-29T12:01:16.448+0000] {logging_mixin.py:188} INFO - 6
[2024-07-29T12:01:16.448+0000] {logging_mixin.py:188} INFO - 2024-06-25 00:00:00
[2024-07-29T12:01:16.448+0000] {logging_mixin.py:188} INFO - Start date<exec_date
[2024-07-29T12:01:16.452+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:164: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  daily_month_df = pd.read_sql_query(sql_query, CONN, params=(mois, date))

[2024-07-29T12:01:17.267+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:165: FutureWarning: The behavior of DataFrame concatenation with empty or all-NA entries is deprecated. In a future version, this will no longer exclude empty or all-NA columns when determining the result dtypes. To retain the old behavior, exclude the relevant entries before the concat operation.
  month_data = pd.concat([daily_month_df, df_final])

[2024-07-29T12:01:17.353+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:169: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  last_month = pd.read_sql_query(sql_query, CONN, params=(lmonth.month,exec_date.day))

[2024-07-29T12:01:17.372+0000] {logging_mixin.py:188} INFO - (0, 39)
[2024-07-29T12:01:17.413+0000] {motower_daily.py:175} INFO - ADD  SEGMENT
[2024-07-29T12:01:21.878+0000] {logging_mixin.py:188} INFO - 3074    A DEVELOPER
Name: segment, dtype: object
[2024-07-29T12:01:21.878+0000] {logging_mixin.py:188} INFO - Series([], Name: segment, dtype: object)
[2024-07-29T12:01:21.879+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-29T12:01:21.879+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-29T12:01:21.879+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-29T12:01:21.886+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-25  6.524003e+08  1.224664e+09   14947858.0  9207249.0  3796997.0  115431.0  3123077.0  198532.0    461044.0  1.919708e+09
[2024-07-29T12:01:21.886+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-29T12:01:21.887+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-29T12:01:21.887+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-29T12:01:21.888+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-29T12:01:21.888+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-29T12:01:21.888+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-29T12:01:21.889+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-29T12:01:21.889+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-29T12:01:21.889+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-29T12:01:21.890+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-29T12:01:21.912+0000] {logging_mixin.py:188} INFO -    id       jour code_oci  ...  segment previous_segment evolution_segment
0 NaN 2024-06-25  OCI2831  ...  PREMIUM             None              None
1 NaN 2024-06-25  OCI3257  ...  PREMIUM             None              None
2 NaN 2024-06-25  OCI3428  ...  PREMIUM             None              None
3 NaN 2024-06-25  OCI2587  ...  PREMIUM             None              None
4 NaN 2024-06-25  OCI3260  ...     None             None              None

[5 rows x 39 columns]
[2024-07-29T12:01:21.935+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-25  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-25  OCI3257       3257.0  ...  PREMIUM             None              None
2 2024-06-25  OCI3428       3428.0  ...  PREMIUM             None              None
3 2024-06-25  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-25  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-29T12:01:22.058+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:139: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['mois'] = data["jour"].dt.month

[2024-07-29T12:01:22.059+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:140: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['annee'] = data["jour"].dt.year

[2024-07-29T12:01:22.870+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-29T12:01:22.870+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-29T12:01:22.879+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-26T06:00:00+00:00, execution_date=20240626T060000, start_date=20240729T120116, end_date=20240729T120122
[2024-07-29T12:01:22.948+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-29T12:01:22.963+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-29T12:01:22.964+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-29T14:34:21.023+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-29T14:34:21.213+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-07-29T14:34:21.220+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-07-29T14:34:21.221+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-29T14:34:21.233+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-26 06:00:00+00:00
[2024-07-29T14:34:21.242+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=1585) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-29T14:34:21.243+0000] {standard_task_runner.py:64} INFO - Started process 1587 to run task
[2024-07-29T14:34:21.243+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-26T06:00:00+00:00', '--job-id', '1377', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpn12sv4y9']
[2024-07-29T14:34:21.245+0000] {standard_task_runner.py:91} INFO - Job 1377: Subtask motower_dcaparc
[2024-07-29T14:34:21.282+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [running]> on host e824106b656d
[2024-07-29T14:34:21.360+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-26T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-26T06:00:00+00:00'
[2024-07-29T14:34:21.361+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-29T14:34:21.373+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-29T14:34:21.382+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-29T14:34:21.419+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-29T14:34:21.420+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-29T14:34:21.421+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-25
[2024-07-29T14:34:21.421+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/25.csv
[2024-07-29T14:34:21.438+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240625  6.664774e+08  1.243799e+09  16753745    9453602  11948494   841665  5929920   308836     1388920  1.970652e+09
[2024-07-29T14:34:21.438+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-29T14:34:21.439+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-29T14:34:21.439+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-29T14:34:21.440+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-29T14:34:21.440+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-29T14:34:21.441+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-29T14:34:21.441+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-29T14:34:21.441+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-29T14:34:21.442+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-29T14:34:21.442+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-29T14:34:21.442+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-29T14:34:21.445+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-29T14:34:21.446+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-29T14:34:21.447+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-29T14:34:21.448+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-29T14:34:21.448+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-29T14:34:21.449+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-29T14:34:21.449+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-29T14:34:21.450+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-29T14:34:21.450+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-29T14:34:21.450+0000] {logging_mixin.py:188} INFO - 6
[2024-07-29T14:34:21.450+0000] {logging_mixin.py:188} INFO - 2024-06-25 00:00:00
[2024-07-29T14:34:21.450+0000] {logging_mixin.py:188} INFO - Start date<exec_date
[2024-07-29T14:34:21.454+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:164: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  daily_month_df = pd.read_sql_query(sql_query, CONN, params=(mois, date))

[2024-07-29T14:34:22.263+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:165: FutureWarning: The behavior of DataFrame concatenation with empty or all-NA entries is deprecated. In a future version, this will no longer exclude empty or all-NA columns when determining the result dtypes. To retain the old behavior, exclude the relevant entries before the concat operation.
  month_data = pd.concat([daily_month_df, df_final])

[2024-07-29T14:34:22.349+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:169: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  last_month = pd.read_sql_query(sql_query, CONN, params=(lmonth.month,exec_date.day))

[2024-07-29T14:34:22.366+0000] {logging_mixin.py:188} INFO - (0, 39)
[2024-07-29T14:34:22.406+0000] {motower_daily.py:175} INFO - ADD  SEGMENT
[2024-07-29T14:34:26.711+0000] {logging_mixin.py:188} INFO - 3074    A DEVELOPER
Name: segment, dtype: object
[2024-07-29T14:34:26.712+0000] {logging_mixin.py:188} INFO - Series([], Name: segment, dtype: object)
[2024-07-29T14:34:26.712+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-29T14:34:26.712+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-29T14:34:26.713+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-29T14:34:26.723+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-25  6.524003e+08  1.224664e+09   14947858.0  9207249.0  3796997.0  115431.0  3123077.0  198532.0    461044.0  1.919708e+09
[2024-07-29T14:34:26.723+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-29T14:34:26.724+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-29T14:34:26.724+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-29T14:34:26.725+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-29T14:34:26.725+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-29T14:34:26.726+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-29T14:34:26.726+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-29T14:34:26.727+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-29T14:34:26.727+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-29T14:34:26.728+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-29T14:34:26.753+0000] {logging_mixin.py:188} INFO -    id       jour code_oci  ...  segment previous_segment evolution_segment
0 NaN 2024-06-25  OCI2831  ...  PREMIUM             None              None
1 NaN 2024-06-25  OCI3257  ...  PREMIUM             None              None
2 NaN 2024-06-25  OCI3428  ...  PREMIUM             None              None
3 NaN 2024-06-25  OCI2587  ...  PREMIUM             None              None
4 NaN 2024-06-25  OCI3260  ...     None             None              None

[5 rows x 39 columns]
[2024-07-29T14:34:26.777+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-25  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-25  OCI3257       3257.0  ...  PREMIUM             None              None
2 2024-06-25  OCI3428       3428.0  ...  PREMIUM             None              None
3 2024-06-25  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-25  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-29T14:34:26.902+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:139: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['mois'] = data["jour"].dt.month

[2024-07-29T14:34:26.903+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:140: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['annee'] = data["jour"].dt.year

[2024-07-29T14:34:27.708+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-29T14:34:27.708+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-29T14:34:27.717+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-26T06:00:00+00:00, execution_date=20240626T060000, start_date=20240729T143421, end_date=20240729T143427
[2024-07-29T14:34:27.754+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-29T14:34:27.768+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-07-29T14:34:27.770+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-07-30T11:17:54.055+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-07-30T11:17:54.125+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-07-30T11:17:54.143+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-07-30T11:17:54.144+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-07-30T11:17:54.167+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-26 06:00:00+00:00
[2024-07-30T11:17:54.181+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=3695) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-07-30T11:17:54.183+0000] {standard_task_runner.py:64} INFO - Started process 3699 to run task
[2024-07-30T11:17:54.184+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-26T06:00:00+00:00', '--job-id', '654', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmp78qn8ocr']
[2024-07-30T11:17:54.187+0000] {standard_task_runner.py:91} INFO - Job 654: Subtask motower_dcaparc
[2024-07-30T11:17:54.292+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [running]> on host 7d7c82e77e1e
[2024-07-30T11:17:54.481+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-26T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-26T06:00:00+00:00'
[2024-07-30T11:17:54.482+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-07-30T11:17:54.508+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-07-30T11:17:54.525+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/06/02.csv
[2024-07-30T11:17:54.631+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-30T11:17:54.634+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-30T11:17:54.635+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-25
[2024-07-30T11:17:54.635+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/25.csv
[2024-07-30T11:17:54.671+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240625  6.664774e+08  1.243799e+09  16753745    9453602  11948494   841665  5929920   308836     1388920  1.970652e+09
[2024-07-30T11:17:54.672+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-30T11:17:54.674+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-30T11:17:54.674+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-30T11:17:54.675+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-30T11:17:54.676+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-30T11:17:54.677+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-30T11:17:54.678+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-07-30T11:17:54.679+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-07-30T11:17:54.679+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-30T11:17:54.681+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-30T11:17:54.681+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-07-30T11:17:54.687+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-07-30T11:17:54.689+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-07-30T11:17:54.693+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-07-30T11:17:54.694+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-07-30T11:17:54.695+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-07-30T11:17:54.696+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-07-30T11:17:54.697+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-07-30T11:17:54.698+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-07-30T11:17:54.699+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-07-30T11:17:54.699+0000] {logging_mixin.py:188} INFO - 6
[2024-07-30T11:17:54.700+0000] {logging_mixin.py:188} INFO - 2024-06-25 00:00:00
[2024-07-30T11:17:54.700+0000] {logging_mixin.py:188} INFO - Start date<exec_date
[2024-07-30T11:17:54.707+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:164: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  daily_month_df = pd.read_sql_query(sql_query, CONN, params=(mois, date))

[2024-07-30T11:17:56.547+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:165: FutureWarning: The behavior of DataFrame concatenation with empty or all-NA entries is deprecated. In a future version, this will no longer exclude empty or all-NA columns when determining the result dtypes. To retain the old behavior, exclude the relevant entries before the concat operation.
  month_data = pd.concat([daily_month_df, df_final])

[2024-07-30T11:17:56.782+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:169: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  last_month = pd.read_sql_query(sql_query, CONN, params=(lmonth.month,exec_date.day))

[2024-07-30T11:17:56.808+0000] {logging_mixin.py:188} INFO - (0, 39)
[2024-07-30T11:17:56.860+0000] {motower_daily.py:175} INFO - ADD  SEGMENT
[2024-07-30T11:18:05.197+0000] {logging_mixin.py:188} INFO - 3074    A DEVELOPER
Name: segment, dtype: object
[2024-07-30T11:18:05.198+0000] {logging_mixin.py:188} INFO - Series([], Name: segment, dtype: object)
[2024-07-30T11:18:05.198+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-07-30T11:18:05.198+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-07-30T11:18:05.200+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-07-30T11:18:05.213+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-25  6.524003e+08  1.224664e+09   14947858.0  9207249.0  3796997.0  115431.0  3123077.0  198532.0    461044.0  1.919708e+09
[2024-07-30T11:18:05.213+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-07-30T11:18:05.214+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-07-30T11:18:05.215+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-07-30T11:18:05.216+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-07-30T11:18:05.216+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-07-30T11:18:05.217+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-07-30T11:18:05.217+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-07-30T11:18:05.219+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-07-30T11:18:05.219+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-07-30T11:18:05.220+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-07-30T11:18:05.270+0000] {logging_mixin.py:188} INFO -    id       jour code_oci  ...  segment previous_segment evolution_segment
0 NaN 2024-06-25  OCI2831  ...  PREMIUM             None              None
1 NaN 2024-06-25  OCI3257  ...  PREMIUM             None              None
2 NaN 2024-06-25  OCI3428  ...  PREMIUM             None              None
3 NaN 2024-06-25  OCI2587  ...  PREMIUM             None              None
4 NaN 2024-06-25  OCI3260  ...     None             None              None

[5 rows x 39 columns]
[2024-07-30T11:18:05.320+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-25  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-25  OCI3257       3257.0  ...  PREMIUM             None              None
2 2024-06-25  OCI3428       3428.0  ...  PREMIUM             None              None
3 2024-06-25  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-25  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-07-30T11:18:05.444+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:139: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['mois'] = data["jour"].dt.month

[2024-07-30T11:18:05.445+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:140: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['annee'] = data["jour"].dt.year

[2024-07-30T11:18:07.084+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-07-30T11:18:07.085+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-07-30T11:18:07.094+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-26T06:00:00+00:00, execution_date=20240626T060000, start_date=20240730T111754, end_date=20240730T111807
[2024-07-30T11:18:07.157+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-07-30T11:18:07.165+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-08-02T12:27:47.468+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-08-02T12:27:47.501+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-08-02T12:27:47.513+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [queued]>
[2024-08-02T12:27:47.513+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-08-02T12:27:47.526+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-06-26 06:00:00+00:00
[2024-08-02T12:27:47.533+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=1516) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-08-02T12:27:47.534+0000] {standard_task_runner.py:64} INFO - Started process 1518 to run task
[2024-08-02T12:27:47.534+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-06-26T06:00:00+00:00', '--job-id', '1070', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpitu1vgvs']
[2024-08-02T12:27:47.536+0000] {standard_task_runner.py:91} INFO - Job 1070: Subtask motower_dcaparc
[2024-08-02T12:27:47.579+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-06-26T06:00:00+00:00 [running]> on host 0ed00079025b
[2024-08-02T12:27:47.668+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-06-26T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-06-26T06:00:00+00:00'
[2024-08-02T12:27:47.669+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-08-02T12:27:47.684+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-08-02T12:27:47.693+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/07/02.csv
[2024-08-02T12:27:47.754+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-08-02T12:27:47.756+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-08-02T12:27:47.756+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-06-25
[2024-08-02T12:27:47.757+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/06/25.csv
[2024-08-02T12:27:47.780+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix       ca_data      parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240625  6.664774e+08  1.243799e+09  16753745    9453602  11948494   841665  5929920   308836     1388920  1.970652e+09
[2024-08-02T12:27:47.780+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-08-02T12:27:47.781+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-08-02T12:27:47.782+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-08-02T12:27:47.782+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-08-02T12:27:47.783+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-08-02T12:27:47.784+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-08-02T12:27:47.784+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-08-02T12:27:47.785+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-08-02T12:27:47.785+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-08-02T12:27:47.786+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-08-02T12:27:47.786+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-08-02T12:27:47.790+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-08-02T12:27:47.791+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'code oci', 'gestionnaire',
       'proprietaire', 'autre code', 'code esco', 'code ihs', 'longitude',
       'latitude', 'type du site', 'statut', 'couche en service',
       'technologie sans tdd', 'technologie', 'date mes 2g', 'date mes',
       'date mes 3g', 'date mes 4g', 'annee construction pylone',
       'statut sharing', 'statut proprietaire', 'statut partage',
       'geo localite', 'commune', 'departement', 'region', 'district',
       'partenaires', 'localisation', 'equipementier telecom', 'ville',
       'quartier', 'type baie', 'hauteur batiment', 'tower type',
       'tower location', 'type geolocalite', 'tower height', 'type site ihs',
       'type energie', 'projet', 'id quartier', 'id geolocalite', 'clutter',
       'position site', 'type indoor', 'decoupage', 'sous coloc', 'tenant',
       'type de cable', 'mois', 'code oci id', 'day_id', 'id_site', 'ca_voix',
       'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in', 'parc',
       'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g', 'parc_other',
       'jour'],
      dtype='object')
[2024-08-02T12:27:47.793+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-08-02T12:27:47.794+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-08-02T12:27:47.794+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-08-02T12:27:47.795+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-08-02T12:27:47.796+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-08-02T12:27:47.796+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-08-02T12:27:47.797+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-08-02T12:27:47.797+0000] {logging_mixin.py:188} INFO - 6
[2024-08-02T12:27:47.797+0000] {logging_mixin.py:188} INFO - 2024-06-25 00:00:00
[2024-08-02T12:27:47.797+0000] {logging_mixin.py:188} INFO - Start date<exec_date
[2024-08-02T12:27:47.802+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:164: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  daily_month_df = pd.read_sql_query(sql_query, CONN, params=(mois, date))

[2024-08-02T12:27:49.470+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:165: FutureWarning: The behavior of DataFrame concatenation with empty or all-NA entries is deprecated. In a future version, this will no longer exclude empty or all-NA columns when determining the result dtypes. To retain the old behavior, exclude the relevant entries before the concat operation.
  month_data = pd.concat([daily_month_df, df_final])

[2024-08-02T12:27:49.637+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:169: UserWarning: pandas only supports SQLAlchemy connectable (engine/connection) or database string URI or sqlite3 DBAPI2 connection. Other DBAPI2 objects are not tested. Please consider using SQLAlchemy.
  last_month = pd.read_sql_query(sql_query, CONN, params=(lmonth.month,exec_date.day))

[2024-08-02T12:27:49.658+0000] {logging_mixin.py:188} INFO - (0, 39)
[2024-08-02T12:27:49.704+0000] {motower_daily.py:175} INFO - ADD  SEGMENT
[2024-08-02T12:28:00.987+0000] {logging_mixin.py:188} INFO - 3074    A DEVELOPER
Name: segment, dtype: object
[2024-08-02T12:28:00.989+0000] {logging_mixin.py:188} INFO - Series([], Name: segment, dtype: object)
[2024-08-02T12:28:00.990+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-08-02T12:28:00.991+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-08-02T12:28:00.993+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3107
[2024-08-02T12:28:01.012+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-06-25  6.524003e+08  1.224664e+09   14947858.0  9207249.0  3796997.0  115431.0  3123077.0  198532.0    461044.0  1.919708e+09
[2024-08-02T12:28:01.013+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-08-02T12:28:01.014+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-08-02T12:28:01.014+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-08-02T12:28:01.016+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-08-02T12:28:01.016+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-08-02T12:28:01.017+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-08-02T12:28:01.018+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-08-02T12:28:01.019+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_global ARE VALID
[2024-08-02T12:28:01.019+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-08-02T12:28:01.021+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-08-02T12:28:01.086+0000] {logging_mixin.py:188} INFO -    id       jour code_oci  ...  segment previous_segment evolution_segment
0 NaN 2024-06-25  OCI2831  ...  PREMIUM             None              None
1 NaN 2024-06-25  OCI3257  ...  PREMIUM             None              None
2 NaN 2024-06-25  OCI3428  ...  PREMIUM             None              None
3 NaN 2024-06-25  OCI2587  ...  PREMIUM             None              None
4 NaN 2024-06-25  OCI3260  ...     None             None              None

[5 rows x 39 columns]
[2024-08-02T12:28:01.148+0000] {logging_mixin.py:188} INFO -         jour code_oci  code_oci_id  ...  segment previous_segment evolution_segment
0 2024-06-25  OCI2831       2831.0  ...  PREMIUM             None              None
1 2024-06-25  OCI3257       3257.0  ...  PREMIUM             None              None
2 2024-06-25  OCI3428       3428.0  ...  PREMIUM             None              None
3 2024-06-25  OCI2587       2587.0  ...  PREMIUM             None              None
4 2024-06-25  OCI3260       3260.0  ...     None             None              None

[5 rows x 38 columns]
[2024-08-02T12:28:01.307+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:139: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['mois'] = data["jour"].dt.month

[2024-08-02T12:28:01.309+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/custom_dags/motower_daily.py:140: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_faits['annee'] = data["jour"].dt.year

[2024-08-02T12:28:03.409+0000] {python.py:237} INFO - Done. Returned value was: None
[2024-08-02T12:28:03.410+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-08-02T12:28:03.421+0000] {taskinstance.py:1206} INFO - Marking task as SUCCESS. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-06-26T06:00:00+00:00, execution_date=20240626T060000, start_date=20240802T122747, end_date=20240802T122803
[2024-08-02T12:28:03.466+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 0
[2024-08-02T12:28:03.486+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-08-02T12:28:03.488+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
