[2024-08-06T17:11:58.291+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-08-06T17:11:58.365+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-04-18T06:00:00+00:00 [queued]>
[2024-08-06T17:11:58.392+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-04-18T06:00:00+00:00 [queued]>
[2024-08-06T17:11:58.392+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-08-06T17:11:58.428+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-04-18 06:00:00+00:00
[2024-08-06T17:11:58.447+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=4315) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-08-06T17:11:58.451+0000] {standard_task_runner.py:64} INFO - Started process 4327 to run task
[2024-08-06T17:11:58.461+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-04-18T06:00:00+00:00', '--job-id', '1088', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmp376kl8ud']
[2024-08-06T17:11:58.465+0000] {standard_task_runner.py:91} INFO - Job 1088: Subtask motower_dcaparc
[2024-08-06T17:11:58.552+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-04-18T06:00:00+00:00 [running]> on host 13681191f11c
[2024-08-06T17:11:58.758+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-04-18T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-04-18T06:00:00+00:00'
[2024-08-06T17:11:58.760+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-08-06T17:11:58.799+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-08-06T17:11:58.825+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/04/02.csv
[2024-08-06T17:11:58.967+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-08-06T17:11:58.969+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3482
[2024-08-06T17:11:58.970+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-04-17
[2024-08-06T17:11:58.971+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/04/17.csv
[2024-08-06T17:11:59.009+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix       ca_data  parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240417  5.638857e+08  6.647799e+08     0    8992982  13023039   923022  7262810   459204     1499625  1.253686e+09
[2024-08-06T17:11:59.010+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-08-06T17:11:59.012+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-08-06T17:11:59.012+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-08-06T17:11:59.014+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-08-06T17:11:59.014+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-08-06T17:11:59.015+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-08-06T17:11:59.016+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-08-06T17:11:59.023+0000] {logging_mixin.py:188} INFO - FILE OF 2024-04-17 have invalid parc: 

     day_id  parc
0  20240417     0
[2024-08-06T17:11:59.024+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-08-06T17:11:59.025+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-08-06T17:11:59.025+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-08-06T17:11:59.025+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 119, in gen_motower_daily
    data = generate_daily_caparc(
       ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 138, in generate_daily_caparc
    validate_column(df=df_for_validation, col=col, host=smtphost, port=smtpport, user=smtpuser, file_type="CAPARC", date=date)
  File "/opt/airflow/dags/gps/common/data_validation.py", line 19, in validate_column
    raise ValueError(message)
ValueError: FILE OF 2024-04-17 have invalid parc: 

     day_id  parc
0  20240417     0
[2024-08-06T17:11:59.040+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-04-18T06:00:00+00:00, execution_date=20240418T060000, start_date=20240806T171158, end_date=20240806T171159
[2024-08-06T17:11:59.065+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-08-06T17:11:59.066+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-08-06T17:11:59.066+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-08-06T17:11:59.077+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-08-06T17:11:59.077+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-08-06T17:11:59.078+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 119, in gen_motower_daily
    data = generate_daily_caparc(
       ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 138, in generate_daily_caparc
    validate_column(df=df_for_validation, col=col, host=smtphost, port=smtpport, user=smtpuser, file_type="CAPARC", date=date)
  File "/opt/airflow/dags/gps/common/data_validation.py", line 19, in validate_column
    raise ValueError(message)
ValueError: FILE OF 2024-04-17 have invalid parc: 

     day_id  parc
0  20240417     0

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-08-06T17:11:59.085+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-08-06T17:11:59.086+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-08-06T17:11:59.086+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-08-06T17:11:59.107+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 1088 for task motower_dcaparc (FILE OF 2024-04-17 have invalid parc: 

     day_id  parc
0  20240417     0; 4327)
[2024-08-06T17:11:59.124+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-08-06T17:11:59.146+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-08-06T17:11:59.148+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
[2024-08-06T17:42:41.355+0000] {local_task_job_runner.py:120} INFO - ::group::Pre task execution logs
[2024-08-06T17:42:41.393+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-04-18T06:00:00+00:00 [queued]>
[2024-08-06T17:42:41.409+0000] {taskinstance.py:2076} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-04-18T06:00:00+00:00 [queued]>
[2024-08-06T17:42:41.409+0000] {taskinstance.py:2306} INFO - Starting attempt 1 of 1
[2024-08-06T17:42:41.428+0000] {taskinstance.py:2330} INFO - Executing <Task(PythonOperator): motower_dcaparc> on 2024-04-18 06:00:00+00:00
[2024-08-06T17:42:41.438+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/task/task_runner/standard_task_runner.py:62: DeprecationWarning: This process (pid=8473) is multi-threaded, use of fork() may lead to deadlocks in the child.
  pid = os.fork()

[2024-08-06T17:42:41.439+0000] {standard_task_runner.py:64} INFO - Started process 8475 to run task
[2024-08-06T17:42:41.440+0000] {standard_task_runner.py:90} INFO - Running: ['***', 'tasks', 'run', 'motower_daily_prod', 'motower_dcaparc', 'scheduled__2024-04-18T06:00:00+00:00', '--job-id', '2351', '--raw', '--subdir', 'DAGS_FOLDER/gps/custom_dags/motower_daily.py', '--cfg-path', '/tmp/tmpwne_vb_g']
[2024-08-06T17:42:41.442+0000] {standard_task_runner.py:91} INFO - Job 2351: Subtask motower_dcaparc
[2024-08-06T17:42:41.494+0000] {task_command.py:426} INFO - Running <TaskInstance: motower_daily_prod.motower_dcaparc scheduled__2024-04-18T06:00:00+00:00 [running]> on host 13681191f11c
[2024-08-06T17:42:41.600+0000] {taskinstance.py:2648} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='richmond.kongo@orange.com,assane.diop@orange.com,cyrille1.danho@orange.com,mohamed2.sylla@orange.com,amadou.diomande@orange.com,Jonas.kouame@orange.com,armand.kablan@orange.com,anicet.azombade@orange.com,etienne.kouadio@orange.com,bertine.kouakou@orange.com,florentine.kouakou@orange.com,ange.phaceli@orange.com,soulegame.soro@orange.com,innocent.yengo@orange.com' AIRFLOW_CTX_DAG_OWNER='***' AIRFLOW_CTX_DAG_ID='motower_daily_prod' AIRFLOW_CTX_TASK_ID='motower_dcaparc' AIRFLOW_CTX_EXECUTION_DATE='2024-04-18T06:00:00+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='scheduled__2024-04-18T06:00:00+00:00'
[2024-08-06T17:42:41.601+0000] {taskinstance.py:430} INFO - ::endgroup::
[2024-08-06T17:42:41.621+0000] {motower_daily.py:106} INFO - get last modified bdd sites cleaned
[2024-08-06T17:42:41.634+0000] {motower_daily.py:117} INFO - READING BASE_SITES-cleaned/2024/04/02.csv
[2024-08-06T17:42:41.714+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-08-06T17:42:41.716+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3482
[2024-08-06T17:42:41.716+0000] {motower_daily.py:127} INFO - GET CA PARC FILE OF THE DAY 2024-04-17
[2024-08-06T17:42:41.716+0000] {motower_daily.py:131} INFO - READING ca-parc/2024/04/17.csv
[2024-08-06T17:42:41.742+0000] {motower_daily.py:136} INFO - DAILY KPI -      day_id       ca_voix       ca_data  parc  parc_data   parc_2g  parc_3g  parc_4g  parc_5g  parc_other      ca_total
0  20240417  5.638857e+08  6.647799e+08     0    8992982  13023039   923022  7262810   459204     1499625  1.253686e+09
[2024-08-06T17:42:41.742+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-08-06T17:42:41.743+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-08-06T17:42:41.743+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-08-06T17:42:41.744+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-08-06T17:42:41.745+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-08-06T17:42:41.745+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-08-06T17:42:41.746+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc
[2024-08-06T17:42:41.747+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc ARE VALID
[2024-08-06T17:42:41.747+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_data
[2024-08-06T17:42:41.748+0000] {data_validation.py:20} INFO - DATA OF COLUMN parc_data ARE VALID
[2024-08-06T17:42:41.748+0000] {motower_daily.py:139} INFO - MERGING BDD AND CA
[2024-08-06T17:42:41.753+0000] {motower_daily.py:141} INFO - prepare final daily data
[2024-08-06T17:42:41.754+0000] {logging_mixin.py:188} INFO - Index(['site', 'site bts', 'site physique', 'gestionnaire', 'proprietaire',
       'code oci', 'equipementier telecom', 'longitude', 'latitude',
       'type du site', 'antenna_mode', 'statut', 'couche en service',
       'technologie', 'technologie sans tdd', 'date mes', 'date mes 2g',
       'date mes 3g', 'date mes 4g', 'annee construction pylone', 'autre code',
       'code esco', 'code ihs', 'statut partage', 'statut sharing',
       'statut proprietaire', 'geo localite', 'commune', 'departement',
       'region', 'district', 'partenaires', 'localisation', 'ville',
       'quartier', 'type geolocalite', 'clutter', 'id quartier',
       'id geolocalite', 'type baie', 'hauteur batiment', 'tower type',
       'tower height', 'tower location', 'type energie', 'projet',
       'new project', 'position site', 'type indoor', 'decoupage',
       'sous coloc', 'tenant', 'mois', 'code oci id', 'day_id', 'id_site',
       'ca_voix', 'ca_data', 'ca_total', 'trafic_voix_in', 'trafic_data_in',
       'parc', 'parc_data', 'parc_2g', 'parc_3g', 'parc_4g', 'parc_5g',
       'parc_other', 'jour'],
      dtype='object')
[2024-08-06T17:42:41.757+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:148: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final.rename(columns=DAILY_CAPARC_COL, inplace=True)

[2024-08-06T17:42:41.758+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:149: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["trafic_data_in_mo"] = df_final["trafic_data_in"] / 1000

[2024-08-06T17:42:41.758+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:150: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_norm"] = None

[2024-08-06T17:42:41.759+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:151: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["ca_mtd"] = None

[2024-08-06T17:42:41.760+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:152: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["segment"] = None

[2024-08-06T17:42:41.760+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:153: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["previous_segment"] = None

[2024-08-06T17:42:41.761+0000] {warnings.py:112} WARNING - /opt/***/dags/gps/common/motower_daily.py:154: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_final["evolution_segment"] = None

[2024-08-06T17:42:41.761+0000] {logging_mixin.py:188} INFO - 4
[2024-08-06T17:42:41.762+0000] {logging_mixin.py:188} INFO - 2024-04-17 00:00:00
[2024-08-06T17:42:41.775+0000] {motower_daily.py:200} INFO - ADD  SEGMENT
[2024-08-06T17:42:42.136+0000] {motower_daily.py:205} INFO - DATA VALIDATION AFTER MERGING
[2024-08-06T17:42:42.137+0000] {data_validation.py:28} INFO - START VALIDATION 
[2024-08-06T17:42:42.138+0000] {data_validation.py:40} INFO - VALID ACTIFS SITES 3482
[2024-08-06T17:42:42.150+0000] {motower_daily.py:216} INFO - DAILY KPI -         jour       ca_voix       ca_data  parc_global  parc_data    parc_2g   parc_3g    parc_4g   parc_5g  autre_parc      ca_total
0 2024-04-17  5.611582e+08  6.618876e+08          0.0  8965804.0  5876437.0  200493.0  5072967.0  390545.0    686690.0  1.247107e+09
[2024-08-06T17:42:42.151+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_total
[2024-08-06T17:42:42.152+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_total ARE VALID
[2024-08-06T17:42:42.153+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_voix
[2024-08-06T17:42:42.154+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_voix ARE VALID
[2024-08-06T17:42:42.154+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN ca_data
[2024-08-06T17:42:42.155+0000] {data_validation.py:20} INFO - DATA OF COLUMN ca_data ARE VALID
[2024-08-06T17:42:42.156+0000] {data_validation.py:11} INFO - START VALIDATION OF COLUMN parc_global
[2024-08-06T17:42:42.157+0000] {taskinstance.py:441} INFO - ::group::Post task execution logs
[2024-08-06T17:42:42.157+0000] {taskinstance.py:2905} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 119, in gen_motower_daily
    data = generate_daily_caparc(
       ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 218, in generate_daily_caparc
    validate_column(df=df_for_validation, col=col,  host=smtphost, port= smtpport, user=smtpuser, file_type="CAPARC JOIN TO BDD SITE", date=date)
  File "/opt/airflow/dags/gps/common/data_validation.py", line 16, in validate_column
    message = "These dates have invalid {}: \n\n{}".format(col, df_not_valid[[date_for_group, col]]) if date is None else "FILE OF {} have invalid {}: \n\n{}".format(date, col, df_not_valid[[date_for_group, col]])
                                                                                                                                                                                 ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/frame.py", line 3899, in __getitem__
    indexer = self.columns._get_indexer_strict(key, "columns")[1]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 6115, in _get_indexer_strict
    self._raise_if_missing(keyarr, indexer, axis_name)
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 6179, in _raise_if_missing
    raise KeyError(f"{not_found} not in index")
KeyError: "['day_id'] not in index"
[2024-08-06T17:42:42.176+0000] {taskinstance.py:1206} INFO - Marking task as FAILED. dag_id=motower_daily_prod, task_id=motower_dcaparc, run_id=scheduled__2024-04-18T06:00:00+00:00, execution_date=20240418T060000, start_date=20240806T174241, end_date=20240806T174242
[2024-08-06T17:42:42.201+0000] {warnings.py:112} WARNING - /home/***/.local/lib/python3.12/site-packages/***/utils/email.py:154: RemovedInAirflow3Warning: Fetching SMTP credentials from configuration variables will be deprecated in a future release. Please set credentials using a connection instead.
  send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)

[2024-08-06T17:42:42.202+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-08-06T17:42:42.202+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-08-06T17:42:42.210+0000] {configuration.py:1053} WARNING - section/key [smtp/smtp_user] not found in config
[2024-08-06T17:42:42.211+0000] {email.py:271} INFO - Email alerting: attempt 1
[2024-08-06T17:42:42.211+0000] {taskinstance.py:879} ERROR - Failed to send email to: ['richmond.kongo@orange.com', 'assane.diop@orange.com', 'cyrille1.danho@orange.com', 'mohamed2.sylla@orange.com', 'amadou.diomande@orange.com', 'Jonas.kouame@orange.com', 'armand.kablan@orange.com', 'anicet.azombade@orange.com', 'etienne.kouadio@orange.com', 'bertine.kouakou@orange.com', 'florentine.kouakou@orange.com', 'ange.phaceli@orange.com', 'soulegame.soro@orange.com', 'innocent.yengo@orange.com']
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2479, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode, session=session)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2676, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 2701, in _execute_task
    return _execute_task(self, context, task_orig)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 465, in _execute_task
    result = _execute_callable(context=context, **execute_callable_kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 432, in _execute_callable
    return execute_callable(context=context, **execute_callable_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/baseoperator.py", line 401, in wrapper
    return func(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 235, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/operators/python.py", line 252, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/custom_dags/motower_daily.py", line 119, in gen_motower_daily
    data = generate_daily_caparc(
       ^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/gps/common/motower_daily.py", line 218, in generate_daily_caparc
    validate_column(df=df_for_validation, col=col,  host=smtphost, port= smtpport, user=smtpuser, file_type="CAPARC JOIN TO BDD SITE", date=date)
  File "/opt/airflow/dags/gps/common/data_validation.py", line 16, in validate_column
    message = "These dates have invalid {}: \n\n{}".format(col, df_not_valid[[date_for_group, col]]) if date is None else "FILE OF {} have invalid {}: \n\n{}".format(date, col, df_not_valid[[date_for_group, col]])
                                                                                                                                                                                 ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/frame.py", line 3899, in __getitem__
    indexer = self.columns._get_indexer_strict(key, "columns")[1]
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 6115, in _get_indexer_strict
    self._raise_if_missing(keyarr, indexer, axis_name)
  File "/home/airflow/.local/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 6179, in _raise_if_missing
    raise KeyError(f"{not_found} not in index")
KeyError: "['day_id'] not in index"

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1063, in _email_alert
    send_email(task.email, subject, html_content)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 877, in _handle_failure
    task_instance.email_alert(error, failure_context["task"])
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 3163, in email_alert
    _email_alert(task_instance=self, exception=exception, task=task)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/models/taskinstance.py", line 1065, in _email_alert
    send_email(task.email, subject, html_content_err)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 80, in send_email
    return backend(
           ^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 154, in send_email_smtp
    send_mime_email(e_from=mail_from, e_to=recipients, mime_msg=msg, conn_id=conn_id, dryrun=dryrun)
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 273, in send_mime_email
    smtp_conn = _get_smtp_connection(smtp_host, smtp_port, smtp_timeout, smtp_ssl)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.12/site-packages/airflow/utils/email.py", line 317, in _get_smtp_connection
    return smtplib.SMTP(host=host, port=port, timeout=timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 255, in __init__
    (code, msg) = self.connect(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 341, in connect
    self.sock = self._get_socket(host, port, self.timeout)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/smtplib.py", line 312, in _get_socket
    return socket.create_connection((host, port), timeout,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/socket.py", line 853, in create_connection
    raise exceptions[0]
  File "/usr/local/lib/python3.12/socket.py", line 838, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused
[2024-08-06T17:42:42.218+0000] {alerting.py:71} INFO - send alert mail to richmond.kongo@orange.com, assane.diop@orange.com, cyrille1.danho@orange.com, mohamed2.sylla@orange.com, amadou.diomande@orange.com, Jonas.kouame@orange.com, armand.kablan@orange.com, anicet.azombade@orange.com, etienne.kouadio@orange.com, bertine.kouakou@orange.com, florentine.kouakou@orange.com, ange.phaceli@orange.com, soulegame.soro@orange.com, innocent.yengo@orange.com
[2024-08-06T17:42:42.218+0000] {alerting.py:30} INFO - Sending mail ... 
[2024-08-06T17:42:42.219+0000] {alerting.py:38} ERROR - Failed to send email: please run connect() first
[2024-08-06T17:42:42.320+0000] {standard_task_runner.py:110} ERROR - Failed to execute job 2351 for task motower_dcaparc ("['day_id'] not in index"; 8475)
[2024-08-06T17:42:42.335+0000] {local_task_job_runner.py:243} INFO - Task exited with return code 1
[2024-08-06T17:42:42.352+0000] {taskinstance.py:3503} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2024-08-06T17:42:42.354+0000] {local_task_job_runner.py:222} INFO - ::endgroup::
